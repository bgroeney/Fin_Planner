import{_ as P,w as j,x as _,o as l,c as i,a as t,m as k,b,t as a,d as L,n as v,F as C,l as D,p as U,q as H,e as z,f as V,z as B,s as p,g as h,h as E,k as O}from"./index-oVbs5Hxd.js";import{usePortfolioStore as q}from"./portfolio-CjZnfIUI.js";import{_ as K}from"./MoneyBoxLoader-BOnNyVJS.js";import{f as W}from"./formatters-DwG4QyEz.js";const G={class:"import-view animate-fade-in content-container"},J={class:"card mb-xl"},Q={key:0},X={for:"fileInput",class:"upload-label"},Y={class:"upload-text"},Z={key:0,class:"font-medium text-primary"},tt={key:1},et={class:"flex-end"},st=["disabled"],ot={key:1,class:"preview-mode"},at={key:0,class:"loading-state p-xl flex-center flex-column"},lt={key:1,class:"preview-content"},it={class:"stats-grid mb-lg"},nt={class:"stat-box"},dt={class:"stat-value text-primary"},rt={class:"stat-box"},ct=["title"],ut={class:"stat-sub"},vt={class:"stat-box"},pt={class:"stat-value"},ht={class:"stat-box"},mt={class:"table-container preview-table mb-lg"},gt={class:"data-table"},wt={class:"whitespace-nowrap"},xt={class:"font-medium text-sm"},bt={class:"text-xs text-muted"},yt={key:0,class:"text-xs text-warning mt-1"},ft={class:"text-right font-mono"},_t={class:"text-right font-mono"},kt={class:"action-bar card bg-muted-light"},Ct={class:"checkbox-wrapper"},Dt={class:"flex gap-md"},Vt=["disabled"],Bt={key:0,class:"history-section animate-fade-in-up"},It={key:0,class:"empty-state card flex-center flex-column p-xl text-muted"},Nt={key:1,class:"card p-0 overflow-hidden shadow-sm"},At={class:"table-container history-table"},Mt={class:"w-full data-table"},Ft={class:"whitespace-nowrap pl-lg font-mono text-sm"},St=["title"],Tt={class:"text-xs text-muted"},Rt={class:"badge badge-sm"},$t={class:"font-mono text-sm"},Pt={class:"text-right pr-lg"},jt={class:"flex-end gap-sm action-buttons"},Lt=["onClick"],Ut=["onClick","title"],Ht={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},zt={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Et=["onClick"],Ot={__name:"ImportView",setup(qt){const I=q(),d=h(null),n=h(null),g=h(""),m=h(!1),w=h(!1),x=h([]);E();const c=B(()=>I.currentPortfolioId),y=B(()=>n.value?.previewRecords?.filter(o=>o.isDuplicate).length||0),u=async()=>{if(c.value)try{const o=await p.get(`/import/history/${c.value}`);x.value=o.data}catch(o){console.error("Failed to load history",o)}};j(c,()=>{u()}),_(()=>{c.value&&u()});const N=o=>{o.target.files.length>0&&(d.value=o.target.files[0])},A=o=>{if(o.dataTransfer.files.length>0){const e=o.dataTransfer.files[0];e.name.endsWith(".csv")?d.value=e:alert("Please upload a CSV file.")}},M=()=>{if(!d.value)return;const o=new FileReader;o.onload=async e=>{g.value=e.target.result.split(",")[1];try{const s=await p.post("/import/preview",{portfolioId:c.value,fileContentBase64:g.value,fileName:d.value.name});n.value=s.data}catch(s){alert("Error previewing file: "+(s.response?.data?.message||s.message))}},o.readAsDataURL(d.value)},F=async()=>{m.value=!0;try{await p.post("/import/confirm",{portfolioId:c.value,fileContentBase64:g.value,fileName:d.value.name,includeDuplicates:w.value}),n.value=null,d.value=null,u()}catch(o){alert("Import failed: "+o.message)}finally{m.value=!1}},S=async o=>{try{const e=await p.get(`/import/download/${o.id}`,{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=s,r.setAttribute("download",o.fileName),document.body.appendChild(r),r.click(),r.remove()}catch(e){alert("Failed to download: "+e.message)}},T=async o=>{const e=o.isActive?"unload":"reload";if(confirm(`Are you sure you want to ${e} this file? This will ${e==="unload"?"remove":"restore"} the associated data.`))try{await p.put(`/import/${o.id}/${e}`),await u()}catch(s){alert(`Failed to ${e}: `+s.message)}},R=async o=>{if(confirm("Permanently delete this file? This cannot be undone."))try{await p.delete(`/import/${o.id}`),await u()}catch(e){alert("Failed to delete: "+e.message)}},$=o=>{if(!o)return"badge-neutral";const e=o.toLowerCase();return e==="buy"||e==="deposit"?"text-success bg-success-light":e==="sell"||e==="withdrawal"?"text-danger bg-danger-light":"badge-neutral"};return _(()=>{c.value&&u()}),(o,e)=>(l(),i("div",G,[e[20]||(e[20]=t("div",{class:"page-header mb-lg"},[t("div",{class:"header-content"},[t("h1",null,"Import Data"),t("p",{class:"text-muted"},"Upload Netwealth CSV files to update your portfolio.")])],-1)),t("div",J,[n.value?(l(),i("div",ot,[m.value?(l(),i("div",at,[L(K,{size:"lg",text:"Processing Import..."})])):(l(),i("div",lt,[e[11]||(e[11]=t("div",{class:"flex-between mb-lg items-center"},[t("h2",{class:"text-xl font-bold"},"Preview Import"),t("div",{class:"text-sm text-muted"}," Review the data before adding it to your portfolio. ")],-1)),t("div",it,[t("div",nt,[e[5]||(e[5]=t("div",{class:"stat-label"},"File Type",-1)),t("div",dt,a(n.value.fileType),1)]),t("div",rt,[e[6]||(e[6]=t("div",{class:"stat-label"},"Account",-1)),t("div",{class:"stat-value truncate",title:n.value.accountName},a(n.value.accountName),9,ct),t("div",ut,a(n.value.accountNumber),1)]),t("div",vt,[e[7]||(e[7]=t("div",{class:"stat-label"},"Records",-1)),t("div",pt,a(n.value.totalRecords),1)]),t("div",ht,[e[8]||(e[8]=t("div",{class:"stat-label"},"Duplicates",-1)),t("div",{class:v(["stat-value",y.value>0?"text-warning":"text-success"])},a(y.value),3)])]),t("div",mt,[t("table",gt,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",{class:"sticky-header"},"Date"),t("th",{class:"sticky-header"},"Type"),t("th",{class:"sticky-header"},"Asset"),t("th",{class:"sticky-header text-right"},"Units"),t("th",{class:"sticky-header text-right"},"Amount")])],-1)),t("tbody",null,[(l(!0),i(C,null,D(n.value.previewRecords,(s,r)=>(l(),i("tr",{key:r,class:v({"tr-duplicate":s.isDuplicate})},[t("td",wt,a(s.date?new Date(s.date).toLocaleDateString():"-"),1),t("td",null,[t("span",{class:v(["badge",$(s.type)])},a(s.type),3)]),t("td",null,[t("div",xt,a(s.asset),1),t("div",bt,a(s.code),1),s.isDuplicate?(l(),i("div",yt,"Duplicate")):V("",!0)]),t("td",ft,a(s.units),1),t("td",_t,a(O(W)(s.amount)),1)],2))),128))])])]),t("div",kt,[t("label",Ct,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),class:"custom-checkbox"},null,512),[[H,w.value]]),e[10]||(e[10]=t("span",{class:"text-sm font-medium"},"Overwriting existing duplicates",-1))]),t("div",Dt,[t("button",{onClick:e[2]||(e[2]=s=>n.value=null),class:"btn btn-secondary"},"Cancel"),t("button",{onClick:F,class:"btn btn-primary shadow-sm",disabled:m.value}," Confirm & Import ",8,Vt)])])]))])):(l(),i("div",Q,[t("div",{class:"upload-area mb-lg",onDragover:e[0]||(e[0]=k(()=>{},["prevent"])),onDrop:k(A,["prevent"])},[t("input",{type:"file",id:"fileInput",onChange:N,accept:".csv",class:"hidden"},null,32),t("label",X,[e[3]||(e[3]=b('<div class="upload-icon" data-v-c2958d4b><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-c2958d4b><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-c2958d4b></path><polyline points="17 8 12 3 7 8" data-v-c2958d4b></polyline><line x1="12" y1="3" x2="12" y2="15" data-v-c2958d4b></line></svg></div>',1)),t("div",Y,[d.value?(l(),i("span",Z,a(d.value.name),1)):(l(),i("span",tt,"Click to upload or drag and drop CSV"))]),e[4]||(e[4]=t("div",{class:"text-xs text-muted mt-xs"},"Supported: Portfolio Valuation, Transaction Listing",-1))])],32),t("div",et,[t("button",{onClick:M,class:"btn btn-primary",disabled:!d.value||!c.value}," Next: Preview Import ",8,st)])]))]),n.value?V("",!0):(l(),i("div",Bt,[t("div",{class:"flex-between mb-md items-center"},[e[13]||(e[13]=t("div",null,[t("h2",{class:"text-lg font-bold"},"Import History"),t("p",{class:"text-muted text-sm"},"Manage previous uploads")],-1)),t("button",{onClick:u,class:"btn btn-sm btn-outline",title:"Refresh list"},[...e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"})],-1),z(" Refresh ",-1)])])]),x.value.length===0?(l(),i("div",It,[...e[14]||(e[14]=[b('<svg class="mb-md opacity-50" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" data-v-c2958d4b><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-c2958d4b></path><polyline points="14 2 14 8 20 8" data-v-c2958d4b></polyline><line x1="12" y1="18" x2="12" y2="12" data-v-c2958d4b></line><line x1="9" y1="15" x2="15" y2="15" data-v-c2958d4b></line></svg><p data-v-c2958d4b>No import history found.</p>',2)])])):(l(),i("div",Nt,[t("div",At,[t("table",Mt,[e[19]||(e[19]=t("thead",null,[t("tr",{class:"bg-muted-lighter"},[t("th",{class:"pl-lg"},"Date"),t("th",null,"File Name"),t("th",null,"Type"),t("th",null,"Records"),t("th",null,"Status"),t("th",{class:"text-right pr-lg"},"Actions")])],-1)),t("tbody",null,[(l(!0),i(C,null,D(x.value,(s,r)=>(l(),i("tr",{key:s.id,class:v({"opacity-60":!s.isActive,"bg-striped":r%2===1})},[t("td",Ft,a(new Date(s.uploadedAt).toLocaleDateString()),1),t("td",null,[t("div",{class:"font-medium text-sm text-primary truncate max-w-xs",title:s.fileName},a(s.fileName),9,St),t("div",Tt,a(s.fileType)+" â€¢ "+a((s.fileSizeBytes/1024).toFixed(1))+" KB",1)]),t("td",null,[t("span",Rt,a(s.fileType==="PortfolioValuation"?"Valuation":"Transactions"),1)]),t("td",$t,a(s.recordsProcessed),1),t("td",null,[t("span",{class:v(["status-badge",s.isActive?"active":"inactive"])},a(s.isActive?"Active":"Unloaded"),3)]),t("td",Pt,[t("div",jt,[t("button",{onClick:f=>S(s),class:"btn-icon-bg",title:"Download Original CSV"},[...e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,Lt),t("button",{onClick:f=>T(s),class:v(["btn-icon-bg",s.isActive?"text-warning":"text-success"]),title:s.isActive?"Unload Data (Hide)":"Reload Data (Show)"},[s.isActive?(l(),i("svg",Ht,[...e[16]||(e[16]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"},null,-1),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"},null,-1)])])):(l(),i("svg",zt,[...e[17]||(e[17]=[t("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"},null,-1)])]))],10,Ut),t("button",{onClick:f=>R(s),class:"btn-icon-bg text-danger hover-danger",title:"Delete Permanently"},[...e[18]||(e[18]=[b('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c2958d4b><polyline points="3 6 5 6 21 6" data-v-c2958d4b></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" data-v-c2958d4b></path><line x1="10" y1="11" x2="10" y2="17" data-v-c2958d4b></line><line x1="14" y1="11" x2="14" y2="17" data-v-c2958d4b></line></svg>',1)])],8,Et)])])],2))),128))])])])]))]))]))}},Qt=P(Ot,[["__scopeId","data-v-c2958d4b"]]);export{Qt as default};
