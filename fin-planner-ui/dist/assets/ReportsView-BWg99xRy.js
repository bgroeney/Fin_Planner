import{usePortfolioStore as R}from"./portfolio-CjZnfIUI.js";import{g as _,w,x as C,o as i,c as r,a as t,t as u,s as k,p as D,C as N,b as j,v as V,e as I,F as S,l as T,n as L,_ as F,f as g,d as x,z as A}from"./index-oVbs5Hxd.js";import{_ as B}from"./PerformanceChart-DQJ6edwA.js";const z={class:"tax-summary"},E={class:"header-row"},O={class:"fy-selector"},P={class:"grid-cards"},G={class:"summary-card"},M={class:"value"},Y={class:"summary-card"},J={class:"value"},W={class:"subtext"},Q={class:"summary-card highlight"},q={class:"value"},H={class:"summary-card info"},K={class:"value"},X={__name:"TaxSummary",props:{portfolioId:String},setup(h){const f=h,n=_(new Date().getFullYear()+(new Date().getMonth()>5?1:0)),a=_({realizedGains:0,dividends:0,frankingCredits:0}),d=async()=>{if(f.portfolioId)try{const p=await k.get(`/reports/tax-summary/${f.portfolioId}`,{params:{fiscalYear:n.value}});a.value=p.data}catch(p){console.error(p)}};w(()=>f.portfolioId,d),w(n,d);const v=p=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD"}).format(p||0);return C(d),(p,e)=>(i(),r("div",z,[t("div",E,[t("h3",null,"Tax Summary (FY "+u(n.value)+")",1),t("div",O,[t("button",{onClick:e[0]||(e[0]=o=>n.value--),class:"btn-icon"},"←"),t("span",null,u(n.value-1)+" - "+u(n.value),1),t("button",{onClick:e[1]||(e[1]=o=>n.value++),class:"btn-icon"},"→")])]),t("div",P,[t("div",G,[e[2]||(e[2]=t("div",{class:"label"},"Realized Capital Gains",-1)),t("div",M,u(v(a.value.realizedGains)),1),e[3]||(e[3]=t("div",{class:"subtext"},"From asset sales",-1))]),t("div",Y,[e[4]||(e[4]=t("div",{class:"label"},"Dividends",-1)),t("div",J,u(v(a.value.dividends)),1),t("div",W,"+ "+u(v(a.value.frankingCredits))+" Franking Credits",1)]),t("div",Q,[e[5]||(e[5]=t("div",{class:"label"},"Est. Tax Liability",-1)),t("div",q,u(v((a.value.realizedGains+a.value.dividends+a.value.frankingCredits)*.3)),1),e[6]||(e[6]=t("div",{class:"subtext"},"@ 30% Marginal Rate",-1))]),t("div",H,[e[7]||(e[7]=t("div",{class:"label"},"Gross Income",-1)),t("div",K,u(v(a.value.realizedGains+a.value.dividends+a.value.frankingCredits)),1),e[8]||(e[8]=t("div",{class:"subtext"},"Total Taxable Income",-1))])])]))}},Z={class:"transaction-ledger card"},tt={class:"toolbar"},et={class:"filters"},st={class:"data-table"},ot={key:0},at={class:"asset-cell"},nt={class:"symbol"},lt={class:"name text-muted"},it={class:"text-right"},rt={class:"text-right font-mono"},dt={class:"small-text"},ct={key:1},ut={key:2},vt={__name:"TransactionLedger",props:{portfolioId:String},setup(h){const f=h,n=_([]),a=_(!0),d=_(""),v=_(""),p=async()=>{if(f.portfolioId){a.value=!0;try{const s={};d.value&&(s.type=d.value),v.value&&(s.search=v.value);const l=await k.get(`/reports/transactions/${f.portfolioId}`,{params:s});n.value=l.data}catch(s){console.error("Failed to load transactions",s)}finally{a.value=!1}}};w(()=>f.portfolioId,p),w([d,v],()=>{p()});const e=s=>new Date(s).toLocaleDateString("en-AU"),o=s=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD"}).format(s),m=s=>{switch(s){case"Buy":return"badge-info";case"Sell":return"badge-warning";case"Dividend":return"badge-success";default:return"badge-neutral"}},b=()=>{const s=["Date","Type","Symbol","Units","Amount","Narration"],l=n.value.map(y=>[new Date(y.effectiveDate).toLocaleDateString(),y.type,y.assetCode,y.units,y.amount,`"${y.narration}"`]),c=[s.join(","),...l.map(y=>y.join(","))].join(`
`),U=new Blob([c],{type:"text/csv;charset=utf-8;"}),$=document.createElement("a");$.href=URL.createObjectURL(U),$.download=`transactions_${f.portfolioId}.csv`,$.click()};return C(p),(s,l)=>(i(),r("div",Z,[t("div",tt,[t("div",et,[D(t("select",{"onUpdate:modelValue":l[0]||(l[0]=c=>d.value=c),class:"form-select"},[...l[2]||(l[2]=[j('<option value="">All Types</option><option value="Buy">Buy</option><option value="Sell">Sell</option><option value="Dividend">Dividend</option><option value="Deposit">Deposit</option><option value="Withdrawal">Withdrawal</option>',6)])],512),[[N,d.value]]),D(t("input",{"onUpdate:modelValue":l[1]||(l[1]=c=>v.value=c),type:"text",placeholder:"Search items...",class:"form-input"},null,512),[[V,v.value]])]),t("button",{class:"btn btn-secondary",onClick:b},[...l[3]||(l[3]=[t("span",{class:"icon"},"↓",-1),I(" Export CSV ",-1)])])]),t("table",st,[l[6]||(l[6]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Type"),t("th",null,"Asset"),t("th",{class:"text-right"},"Units"),t("th",{class:"text-right"},"Amount"),t("th",null,"Narration")])],-1)),!a.value&&n.value.length>0?(i(),r("tbody",ot,[(i(!0),r(S,null,T(n.value,c=>(i(),r("tr",{key:c.id},[t("td",null,u(e(c.effectiveDate)),1),t("td",null,[t("span",{class:L(["badge",m(c.type)])},u(c.type),3)]),t("td",null,[t("div",at,[t("span",nt,u(c.assetCode),1),t("span",lt,u(c.assetName),1)])]),t("td",it,u(c.units!==0?c.units.toLocaleString():"-"),1),t("td",rt,u(o(c.amount)),1),t("td",dt,u(c.narration),1)]))),128))])):a.value?(i(),r("tbody",ct,[...l[4]||(l[4]=[t("tr",null,[t("td",{colspan:"6",class:"text-center"},"Loading...")],-1)])])):(i(),r("tbody",ut,[...l[5]||(l[5]=[t("tr",null,[t("td",{colspan:"6",class:"text-center text-muted"},"No transactions found")],-1)])]))])]))}},pt={class:"reports-view animate-fade-in content-container"},mt={class:"page-header mb-lg"},ft={class:"controls"},bt={key:0,class:"export-dropdown"},yt={key:0,class:"dropdown-menu"},_t={key:0},gt={class:"tabs mb-lg"},ht=["onClick"],wt={class:"tab-content"},$t={key:0,class:"animate-fade-in"},xt={key:1,class:"animate-fade-in"},kt={key:2,class:"animate-fade-in"},Dt={key:1,class:"loading-state card"},Ct={key:0,class:"spinner"},It={key:1,class:"text-muted"},St={__name:"ReportsView",setup(h){const f=R(),n=_("performance"),a=_(!1),d=A(()=>f.currentPortfolioId),v=[{id:"performance",label:"Performance"},{id:"tax",label:"Tax Center"},{id:"transactions",label:"Ledger"}],p=async e=>{a.value=!1;try{const o=await k.get(`/reports/export/${d.value}?format=${e}`,{responseType:e==="csv"?"blob":"json"});if(e==="csv"){const m=new Blob([o.data],{type:"text/csv"}),b=window.URL.createObjectURL(m),s=document.createElement("a");s.href=b,s.download=`portfolio_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(b),s.remove()}else{const m=new Blob([JSON.stringify(o.data,null,2)],{type:"application/json"}),b=window.URL.createObjectURL(m),s=document.createElement("a");s.href=b,s.download=`portfolio_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(b),s.remove()}}catch(o){console.error("Failed to export data",o),alert("Failed to export data. Please try again.")}};return(e,o)=>(i(),r("div",pt,[t("div",mt,[o[4]||(o[4]=t("div",null,[t("h1",null,"Reports & Analysis"),t("p",{class:"text-muted"},"Track performance, tax liabilities, and transaction history.")],-1)),t("div",ft,[d.value?(i(),r("div",bt,[t("button",{class:"btn btn-secondary",onClick:o[0]||(o[0]=m=>a.value=!a.value)},[...o[3]||(o[3]=[I(" Export Data ",-1),t("span",{class:"dropdown-arrow"},"▾",-1)])]),a.value?(i(),r("div",yt,[t("button",{onClick:o[1]||(o[1]=m=>p("csv"))},"Download CSV"),t("button",{onClick:o[2]||(o[2]=m=>p("json"))},"Download JSON")])):g("",!0)])):g("",!0)])]),d.value?(i(),r("div",_t,[t("div",gt,[(i(),r(S,null,T(v,m=>t("button",{key:m.id,class:L(["tab-btn",{active:n.value===m.id}]),onClick:b=>n.value=m.id},u(m.label),11,ht)),64))]),t("div",wt,[n.value==="performance"?(i(),r("div",$t,[o[5]||(o[5]=t("div",{class:"section-header mb-md"},[t("h2",null,"Portfolio Performance"),t("p",{class:"text-muted"},"Visualizing portfolio value and growth over time versus invested capital.")],-1)),x(B,{portfolioId:d.value},null,8,["portfolioId"])])):g("",!0),n.value==="tax"?(i(),r("div",xt,[o[6]||(o[6]=t("div",{class:"section-header mb-md"},[t("h2",null,"Tax Impact"),t("p",{class:"text-muted"},"Estimated tax liabilities, realized gains, and franking credits for the financial year.")],-1)),x(X,{portfolioId:d.value},null,8,["portfolioId"])])):g("",!0),n.value==="transactions"?(i(),r("div",kt,[o[7]||(o[7]=t("div",{class:"section-header mb-md"},[t("h2",null,"Transaction Ledger"),t("p",{class:"text-muted"},"Complete history of all buy, sell, and income events.")],-1)),x(vt,{portfolioId:d.value},null,8,["portfolioId"])])):g("",!0)])])):(i(),r("div",Dt,[e.loading?(i(),r("div",Ct)):(i(),r("p",It,"No portfolios found. Please create one to view reports."))]))]))}},Rt=F(St,[["__scopeId","data-v-6b213de3"]]);export{Rt as default};
