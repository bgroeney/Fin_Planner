import{_ as U,r as u,k as L,C as j,i as H,c as l,o as n,a as t,d as D,x as A,y as z,F as b,q as f,m as B,b as _,t as a,e as E,n as p,A as O,g as q,B as v,h as K}from"./index-D_ssXn_P.js";import{M as W}from"./MoneyBoxLoader-PyUYAG7W.js";const G={class:"import-view animate-fade-in content-container"},J={class:"card mb-xl"},Q={key:0},X={class:"form-group mb-lg"},Y={class:"select-wrapper"},Z=["value"],tt={for:"fileInput",class:"upload-label"},et={class:"upload-text"},st={key:0,class:"font-medium text-primary"},ot={key:1},at={class:"flex-end"},lt=["disabled"],nt={key:1,class:"preview-mode"},it={key:0,class:"loading-state p-xl flex-center flex-column"},rt={key:1,class:"preview-content"},dt={class:"stats-grid mb-lg"},ct={class:"stat-box"},ut={class:"stat-value text-primary"},vt={class:"stat-box"},pt=["title"],mt={class:"stat-sub"},ht={class:"stat-box"},gt={class:"stat-value"},wt={class:"stat-box"},xt={class:"table-container preview-table mb-lg"},yt={class:"data-table"},bt={class:"whitespace-nowrap"},ft={class:"font-medium text-sm"},_t={class:"text-xs text-muted"},kt={key:0,class:"text-xs text-warning mt-1"},Ct={class:"text-right font-mono"},Dt={class:"text-right font-mono"},At={class:"action-bar card bg-muted-light"},Bt={class:"checkbox-wrapper"},Mt={class:"flex gap-md"},Vt=["disabled"],Nt={key:0,class:"history-section animate-fade-in-up"},Ft={key:0,class:"empty-state card flex-center flex-column p-xl text-muted"},It={key:1,class:"card p-0 overflow-hidden shadow-sm"},St={class:"table-container history-table"},Tt={class:"w-full data-table"},Rt={class:"whitespace-nowrap pl-lg font-mono text-sm"},Pt=["title"],$t={class:"text-xs text-muted"},Ut={class:"badge badge-sm"},Lt={class:"font-mono text-sm"},jt={class:"text-right pr-lg"},Ht={class:"flex-end gap-sm action-buttons"},zt=["onClick"],Et=["onClick","title"],Ot={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},qt={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Kt=["onClick"],Wt={__name:"ImportView",setup(Gt){const h=u([]),d=u(""),r=u(null),i=u(null),w=u(""),g=u(!1),x=u(!1),y=u([]);K();const k=L(()=>i.value?.previewRecords?.filter(o=>o.isDuplicate).length||0),M=async()=>{try{const o=await v.get("/portfolios");h.value=o.data,h.value.length>0&&(d.value=h.value[0].id)}catch(o){console.error("Failed to fetch portfolios",o)}},m=async()=>{if(d.value)try{const o=await v.get(`/import/history/${d.value}`);y.value=o.data}catch(o){console.error("Failed to load history",o)}};j(d,o=>{o&&m()});const V=o=>{o.target.files.length>0&&(r.value=o.target.files[0])},N=o=>{if(o.dataTransfer.files.length>0){const e=o.dataTransfer.files[0];e.name.endsWith(".csv")?r.value=e:alert("Please upload a CSV file.")}},F=()=>{if(!r.value)return;const o=new FileReader;o.onload=async e=>{w.value=e.target.result.split(",")[1];try{const s=await v.post("/import/preview",{portfolioId:d.value,fileContentBase64:w.value,fileName:r.value.name});i.value=s.data}catch(s){alert("Error previewing file: "+(s.response?.data?.message||s.message))}},o.readAsDataURL(r.value)},I=async()=>{g.value=!0;try{await v.post("/import/confirm",{portfolioId:d.value,fileContentBase64:w.value,fileName:r.value.name,includeDuplicates:x.value}),i.value=null,r.value=null,m()}catch(o){alert("Import failed: "+o.message)}finally{g.value=!1}},S=async o=>{try{const e=await v.get(`/import/download/${o.id}`,{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([e.data])),c=document.createElement("a");c.href=s,c.setAttribute("download",o.fileName),document.body.appendChild(c),c.click(),c.remove()}catch(e){alert("Failed to download: "+e.message)}},T=async o=>{const e=o.isActive?"unload":"reload";if(confirm(`Are you sure you want to ${e} this file? This will ${e==="unload"?"remove":"restore"} the associated data.`))try{await v.put(`/import/${o.id}/${e}`),await m()}catch(s){alert(`Failed to ${e}: `+s.message)}},R=async o=>{if(confirm("Permanently delete this file? This cannot be undone."))try{await v.delete(`/import/${o.id}`),await m()}catch(e){alert("Failed to delete: "+e.message)}},P=o=>{if(!o)return"badge-neutral";const e=o.toLowerCase();return e==="buy"||e==="deposit"?"text-success bg-success-light":e==="sell"||e==="withdrawal"?"text-danger bg-danger-light":"badge-neutral"},$=o=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD"}).format(o);return H(M),(o,e)=>(n(),l("div",G,[e[23]||(e[23]=t("div",{class:"page-header mb-lg"},[t("div",{class:"header-content"},[t("h1",null,"Import Data"),t("p",{class:"text-muted"},"Upload Netwealth CSV files to update your portfolio.")])],-1)),t("div",J,[i.value?(n(),l("div",nt,[g.value?(n(),l("div",it,[E(W,{size:"lg",text:"Processing Import..."})])):(n(),l("div",rt,[e[14]||(e[14]=t("div",{class:"flex-between mb-lg items-center"},[t("h2",{class:"text-xl font-bold"},"Preview Import"),t("div",{class:"text-sm text-muted"}," Review the data before adding it to your portfolio. ")],-1)),t("div",dt,[t("div",ct,[e[8]||(e[8]=t("div",{class:"stat-label"},"File Type",-1)),t("div",ut,a(i.value.fileType),1)]),t("div",vt,[e[9]||(e[9]=t("div",{class:"stat-label"},"Account",-1)),t("div",{class:"stat-value truncate",title:i.value.accountName},a(i.value.accountName),9,pt),t("div",mt,a(i.value.accountNumber),1)]),t("div",ht,[e[10]||(e[10]=t("div",{class:"stat-label"},"Records",-1)),t("div",gt,a(i.value.totalRecords),1)]),t("div",wt,[e[11]||(e[11]=t("div",{class:"stat-label"},"Duplicates",-1)),t("div",{class:p(["stat-value",k.value>0?"text-warning":"text-success"])},a(k.value),3)])]),t("div",xt,[t("table",yt,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",{class:"sticky-header"},"Date"),t("th",{class:"sticky-header"},"Type"),t("th",{class:"sticky-header"},"Asset"),t("th",{class:"sticky-header text-right"},"Units"),t("th",{class:"sticky-header text-right"},"Amount")])],-1)),t("tbody",null,[(n(!0),l(b,null,f(i.value.previewRecords,(s,c)=>(n(),l("tr",{key:c,class:p({"tr-duplicate":s.isDuplicate})},[t("td",bt,a(s.date?new Date(s.date).toLocaleDateString():"-"),1),t("td",null,[t("span",{class:p(["badge",P(s.type)])},a(s.type),3)]),t("td",null,[t("div",ft,a(s.asset),1),t("div",_t,a(s.code),1),s.isDuplicate?(n(),l("div",kt,"Duplicate")):D("",!0)]),t("td",Ct,a(s.units),1),t("td",Dt,a($(s.amount)),1)],2))),128))])])]),t("div",At,[t("label",Bt,[A(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),class:"custom-checkbox"},null,512),[[O,x.value]]),e[13]||(e[13]=t("span",{class:"text-sm font-medium"},"Overwriting existing duplicates",-1))]),t("div",Mt,[t("button",{onClick:e[3]||(e[3]=s=>i.value=null),class:"btn btn-secondary"},"Cancel"),t("button",{onClick:I,class:"btn btn-primary shadow-sm",disabled:g.value}," Confirm & Import ",8,Vt)])])]))])):(n(),l("div",Q,[t("div",X,[e[5]||(e[5]=t("label",{class:"label-text mb-sm block"},"Select Portfolio",-1)),t("div",Y,[A(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),class:"form-select"},[e[4]||(e[4]=t("option",{disabled:"",value:""},"Choose a portfolio...",-1)),(n(!0),l(b,null,f(h.value,s=>(n(),l("option",{key:s.id,value:s.id},a(s.name),9,Z))),128))],512),[[z,d.value]])])]),t("div",{class:"upload-area mb-lg",onDragover:e[1]||(e[1]=B(()=>{},["prevent"])),onDrop:B(N,["prevent"])},[t("input",{type:"file",id:"fileInput",onChange:V,accept:".csv",class:"hidden"},null,32),t("label",tt,[e[6]||(e[6]=_('<div class="upload-icon" data-v-5a834636><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-5a834636><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-5a834636></path><polyline points="17 8 12 3 7 8" data-v-5a834636></polyline><line x1="12" y1="3" x2="12" y2="15" data-v-5a834636></line></svg></div>',1)),t("div",et,[r.value?(n(),l("span",st,a(r.value.name),1)):(n(),l("span",ot,"Click to upload or drag and drop CSV"))]),e[7]||(e[7]=t("div",{class:"text-xs text-muted mt-xs"},"Supported: Portfolio Valuation, Transaction Listing",-1))])],32),t("div",at,[t("button",{onClick:F,class:"btn btn-primary",disabled:!r.value||!d.value}," Next: Preview Import ",8,lt)])]))]),i.value?D("",!0):(n(),l("div",Nt,[t("div",{class:"flex-between mb-md items-center"},[e[16]||(e[16]=t("div",null,[t("h2",{class:"text-lg font-bold"},"Import History"),t("p",{class:"text-muted text-sm"},"Manage previous uploads")],-1)),t("button",{onClick:m,class:"btn btn-sm btn-outline",title:"Refresh list"},[...e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"})],-1),q(" Refresh ",-1)])])]),y.value.length===0?(n(),l("div",Ft,[...e[17]||(e[17]=[_('<svg class="mb-md opacity-50" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" data-v-5a834636><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-5a834636></path><polyline points="14 2 14 8 20 8" data-v-5a834636></polyline><line x1="12" y1="18" x2="12" y2="12" data-v-5a834636></line><line x1="9" y1="15" x2="15" y2="15" data-v-5a834636></line></svg><p data-v-5a834636>No import history found.</p>',2)])])):(n(),l("div",It,[t("div",St,[t("table",Tt,[e[22]||(e[22]=t("thead",null,[t("tr",{class:"bg-muted-lighter"},[t("th",{class:"pl-lg"},"Date"),t("th",null,"File Name"),t("th",null,"Type"),t("th",null,"Records"),t("th",null,"Status"),t("th",{class:"text-right pr-lg"},"Actions")])],-1)),t("tbody",null,[(n(!0),l(b,null,f(y.value,(s,c)=>(n(),l("tr",{key:s.id,class:p({"opacity-60":!s.isActive,"bg-striped":c%2===1})},[t("td",Rt,a(new Date(s.uploadedAt).toLocaleDateString()),1),t("td",null,[t("div",{class:"font-medium text-sm text-primary truncate max-w-xs",title:s.fileName},a(s.fileName),9,Pt),t("div",$t,a(s.fileType)+" â€¢ "+a((s.fileSizeBytes/1024).toFixed(1))+" KB",1)]),t("td",null,[t("span",Ut,a(s.fileType==="PortfolioValuation"?"Valuation":"Transactions"),1)]),t("td",Lt,a(s.recordsProcessed),1),t("td",null,[t("span",{class:p(["status-badge",s.isActive?"active":"inactive"])},a(s.isActive?"Active":"Unloaded"),3)]),t("td",jt,[t("div",Ht,[t("button",{onClick:C=>S(s),class:"btn-icon-bg",title:"Download Original CSV"},[...e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,zt),t("button",{onClick:C=>T(s),class:p(["btn-icon-bg",s.isActive?"text-warning":"text-success"]),title:s.isActive?"Unload Data (Hide)":"Reload Data (Show)"},[s.isActive?(n(),l("svg",Ot,[...e[19]||(e[19]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"},null,-1),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"},null,-1)])])):(n(),l("svg",qt,[...e[20]||(e[20]=[t("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"},null,-1)])]))],10,Et),t("button",{onClick:C=>R(s),class:"btn-icon-bg text-danger hover-danger",title:"Delete Permanently"},[...e[21]||(e[21]=[_('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-5a834636><polyline points="3 6 5 6 21 6" data-v-5a834636></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" data-v-5a834636></path><line x1="10" y1="11" x2="10" y2="17" data-v-5a834636></line><line x1="14" y1="11" x2="14" y2="17" data-v-5a834636></line></svg>',1)])],8,Kt)])])],2))),128))])])])]))]))]))}},Xt=U(Wt,[["__scopeId","data-v-5a834636"]]);export{Xt as default};
