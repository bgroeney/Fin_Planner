import{_ as ke,r as k,H as Oe,k as j,C as Pe,c as a,o as l,a as e,d as R,n as E,F as z,q as ae,t as h,g as I,m as Q,D as Ie,s as He,x as Y,z as W,I as Ve,i as Te,B as ee,v as ze,e as ie,b as _e,G as je,w as Re,T as Me,l as We,h as Ke,f as Qe,y as Le}from"./index-D2Wtd9Sa.js";import{c as Xe,P as Ze,f as Be,r as et}from"./PropertyRiskAnalyzer-DIAH-Cki.js";import{M as Ue}from"./MoneyBoxLoader-CzLxqCX3.js";const tt={class:"cashflow-spreadsheet"},st={class:"spreadsheet-toolbar"},nt={class:"toolbar-left"},lt={class:"granularity-toggle"},at={class:"spreadsheet-table"},it={class:"header-row"},ot={key:0,class:"category-row"},rt=["colspan"],ut=["onClick"],dt={class:"sticky-col row-label"},ct=["onClick"],vt=["onClick"],pt={class:"cell-value"},mt={key:0,class:"lock-indicator",title:"Monthly values overridden"},yt={class:"sticky-col row-label child-label"},gt=["onClick"],ft=["onClick"],ht=["onClick","onContextmenu"],bt=["value","onBlur","onKeydown"],kt={class:"cell-value"},wt={key:0,class:"override-indicator",title:"Manual override"},Ct={key:3,class:"add-row-row"},$t=["colspan"],xt=["onClick"],Rt={class:"sticky-col row-label"},_t={key:0,class:"row-indent"},Dt=["onClick"],St=["onClick","onContextmenu"],Pt=["value","onBlur","onKeydown"],Vt={class:"cell-value"},Mt={key:0,class:"override-indicator",title:"Manual override"},At={class:"add-line-modal card"},Ot={class:"modal-header"},It={class:"form-group"},Lt={class:"form-row"},Tt={class:"form-group"},Bt={class:"form-group"},Ut={class:"modal-actions"},Et={class:"variance-modal card"},Ft={class:"modal-header"},Nt={class:"modal-body"},Gt={class:"variance-context"},Yt={class:"variance-input-group"},qt={class:"variance-input-group time-variance"},Jt={class:"time-variance-row"},Ht={class:"time-input"},zt={class:"time-input"},jt={class:"time-variance-hint"},Wt={class:"modal-actions"},Kt={class:"confirmation-modal card"},Qt={class:"modal-header"},Xt={class:"modal-actions"},Zt={__name:"CashflowSpreadsheet",props:{deal:{type:Object,required:!0},holdingPeriod:{type:Number,default:10},initialOverridesJson:{type:String,default:null}},emits:["apply-changes","update:overrides"],setup(g,{emit:X}){const P=g,G=X,S=k("years"),$=k(["income","expenses","financing","summary"]),d=k(["outgoings"]),M=k(null),H=k(null),V=k([]),A=k(!1),te=k(""),L=k({label:"",amount:0,growthRate:3}),c=Oe({}),m=Oe({visible:!1,x:0,y:0,rowId:"",cellIndex:-1}),w=k(!1),O=k({label:"",context:"",rowId:"",cellIndex:-1}),F=k(10),q=k(0),Z=k(3),D=k(!1),p=j(()=>S.value==="months"),u=j(()=>{const i=[];if(S.value==="years")for(let s=1;s<=P.holdingPeriod;s++)i.push({key:`Y${s}`,label:`Y${s}`,year:s,isYearStart:!0,isYearSummary:!1,colType:"year"});else for(let s=1;s<=P.holdingPeriod;s++){for(let n=1;n<=12;n++)i.push({key:`Y${s}M${n}`,label:n===1?"M1":`M${n}`,year:s,month:n,isYearStart:n===1,isYearSummary:!1,colType:"month"});i.push({key:`Y${s}Total`,label:`Y${s}`,year:s,isYearStart:!1,isYearSummary:!0,colType:"yearTotal"})}return i}),J=(i,s,n=.025)=>i*Math.pow(1+n,s),K=i=>{if(!p.value)return i*12;if(u.value[i]?.isYearSummary)return-1;let n=0;for(let v=0;v<i;v++)u.value[v].isYearSummary||n++;return n},ce=i=>{const s=(i-1)*12;return Array.from({length:12},(n,v)=>s+v)},se=(i,s,n={})=>{const{growth:v=0,invert:y=!1}=n,_=[];if(S.value==="years")for(let T=0;T<P.holdingPeriod;T++){let N=0;for(let le=0;le<12;le++){const x=T*12+le,ve=`${s}-${x}`;if(c[ve])N+=c[ve].value;else{let ye=J(i/12,T,v);y&&(ye=-ye),N+=ye}}_.push({value:N,isOverride:!1})}else for(let T=1;T<=P.holdingPeriod;T++){let N=0;for(let x=1;x<=12;x++){const ve=(T-1)*12+(x-1),ye=`${s}-${ve}`;if(c[ye]){const pe=c[ye].value;_.push({value:pe,isOverride:!0}),N+=pe}else{let pe=J(i/12,T-1,v);y&&(pe=-pe),_.push({value:pe,isOverride:!1}),N+=pe}}const le=ce(T).some(x=>c[`${s}-${x}`]);_.push({value:N,isOverride:!1,isYearSummary:!0,hasMonthlyOverrides:le})}return _},U=j(()=>{const i=[],s=P.deal;i.push({id:"income",label:"Income",isCategory:!0,category:"income"}),i.push({id:"grossRent",label:"Gross Rent",category:"income",parentCategory:"income",isEditable:!0,baseValue:s.estimatedGrossRent,growth:(s.rentalGrowthPercent!==void 0?s.rentalGrowthPercent:2.5)/100});const n=s.estimatedGrossRent*(s.vacancyRatePercent/100);i.push({id:"vacancyLoss",label:"Less: Vacancy",category:"income",parentCategory:"income",isEditable:!0,baseValue:n,growth:(s.vacancyGrowthPercent??0)/100,invert:!0});const v=s.estimatedGrossRent*(1-s.vacancyRatePercent/100);i.push({id:"netRentalIncome",label:"Net Rental Income",category:"income",parentCategory:"income",isEditable:!1,componentIds:["grossRent","vacancyLoss"]}),i.push({id:"expenses",label:"Operating Expenses",isCategory:!0,category:"expenses"});const y=(s.outgoingsGrowthPercent??0)/100,_=[{id:"councilRates",label:"Council Rates",baseValue:s.outgoingsEstimate*.35,growth:y},{id:"waterRates",label:"Water Rates",baseValue:s.outgoingsEstimate*.1,growth:y},{id:"insurance",label:"Insurance",baseValue:s.outgoingsEstimate*.2,growth:y},{id:"maintenance",label:"Repairs & Maintenance",baseValue:s.outgoingsEstimate*.25,growth:y},{id:"other",label:"Other",baseValue:s.outgoingsEstimate*.1,growth:y},...V.value.filter(x=>x.parentId==="outgoings").map(x=>({id:x.id,label:x.label,baseValue:x.amount,growth:x.growthRate/100,isCustom:!0}))];i.push({id:"outgoings",label:"Outgoings",category:"expenses",parentCategory:"expenses",isExpandable:!0,childIds:_.map(x=>x.id)}),_.forEach(x=>{i.push({id:x.id,label:x.label,category:"expenses",parentCategory:"expenses",parentId:"outgoings",isChild:!0,isDeletable:x.isCustom,baseValue:x.baseValue,growth:x.growth,invert:!0})}),i.push({id:"addOutgoingsItem",isAddButton:!0,parentId:"outgoings",parentCategory:"expenses"});const T=v*(s.managementFeePercent/100);i.push({id:"managementFee",label:"Management Fee",category:"expenses",parentCategory:"expenses",isEditable:!0,baseValue:T,growth:(s.managementGrowthPercent??0)/100,invert:!0}),s.outgoingsEstimate,i.push({id:"noi",label:"Net Operating Income",category:"expenses",parentCategory:"expenses",isEditable:!1,componentIds:["netRentalIncome","outgoings","managementFee"]}),i.push({id:"financing",label:"Financing",isCategory:!0,category:"financing"});const N=s.loanAmount*(s.interestRatePercent/100);i.push({id:"debtService",label:"Debt Service",category:"financing",parentCategory:"financing",isEditable:!0,baseValue:N,invert:!0}),i.push({id:"netCashflow",label:"Net Cashflow",category:"financing",parentCategory:"financing",isEditable:!1,componentIds:["noi","debtService"]}),i.push({id:"summary",label:"Summary",isCategory:!0,category:"summary"});const le=s.askingPrice*Math.pow(1+s.capitalGrowthPercent/100,P.holdingPeriod);return i.push({id:"terminalValue",label:"Terminal Value",category:"summary",parentCategory:"summary",isEditable:!0,isTerminalValue:!0,terminalValue:le}),i}),re=new Map;Pe([()=>P.deal,()=>S.value,c,V],()=>{re.clear()},{deep:!0});function ue(i){if(re.has(i.id))return re.get(i.id);let s;return i.isExpandable||i.componentIds?s=we(i):i.isTerminalValue?s=u.value.map((n,v)=>({value:v===u.value.length-1?i.terminalValue:0,isOverride:!1})):s=se(i.baseValue,i.id,{growth:i.growth||0,invert:i.invert}),re.set(i.id,s),s}function we(i){let s=[];return i.componentIds?s=U.value.filter(n=>i.componentIds.includes(n.id)):i.isExpandable&&(s=U.value.filter(n=>n.parentId===i.id&&n.isChild)),u.value.map((n,v)=>{let y=0;return s.forEach(_=>{const T=ue(_);y+=T[v]?.value||0}),{value:y,isOverride:!1}})}function fe(i){const s=$.value.indexOf(i);s>-1?$.value.splice(s,1):$.value.push(i)}function he(i){const s=d.value.indexOf(i);s>-1?d.value.splice(s,1):d.value.push(i)}function b(i){return i.isCategory?!0:$.value.includes(i.parentCategory)}function o(i){return i.isExpandable?U.value.filter(n=>n.parentId===i.id&&n.isChild).some(n=>Object.keys(c).some(v=>v.startsWith(`${n.id}-`)&&c[v]?.isOverride)):!1}function B(i,s){if(!i.isExpandable)return!1;const n=u.value[s],v=U.value.filter(_=>_.parentId===i.id&&_.isChild);if(n?.isYearSummary){const _=ce(n.year);return v.some(T=>_.some(N=>c[`${T.id}-${N}`]?.isOverride))}const y=K(s);return y<0?!1:v.some(_=>c[`${_.id}-${y}`]?.isOverride)}function C(i){return Object.keys(c).some(s=>s.startsWith(`${i.id}-`)&&c[s]?.isOverride)}function de(i){Object.keys(c).forEach(s=>{s.startsWith(`${i.id}-`)&&delete c[s]})}function Ce(i){U.value.filter(n=>n.parentId===i.id&&n.isChild).forEach(n=>{Object.keys(c).forEach(v=>{v.startsWith(`${n.id}-`)&&delete c[v]})})}function ge(i,s){const n=u.value[s];(n?.isYearSummary||!p.value&&n?.colType==="year")&&B(i,s)||(M.value={rowId:i.id,index:s},Ve(()=>{const v=document.querySelector(".cell-input");v&&(v.focus(),v.select())}))}function xe(i,s,n){(i.key==="ArrowRight"||i.key==="ArrowLeft"||i.key==="ArrowUp"||i.key==="ArrowDown")&&(i.key==="ArrowRight"?(f(i,s,n),me(s,n,1,0)):i.key==="ArrowLeft"?(f(i,s,n),me(s,n,-1,0)):i.key==="ArrowUp"?(f(i,s,n),me(s,n,0,-1)):i.key==="ArrowDown"&&(f(i,s,n),me(s,n,0,1)))}function me(i,s,n,v){const y=U.value.filter(x=>(x.isEditable||x.isChild)&&b(x)&&!x.isCategory&&!x.isAddButton);let T=y.findIndex(x=>x.id===i.id)+v,N=s+n;T<0&&(T=0),T>=y.length&&(T=y.length-1),N<0&&(N=0),N>=u.value.length&&(N=u.value.length-1);const le=y[T];Ve(()=>{ge(le,N)})}function f(i,s,n){const v=parseFloat(i.target.value)||0,y=s.category==="expenses"||s.category==="financing",_=u.value[n];if(_?.isYearSummary||!p.value&&_?.colType==="year"){const le=_.year,x=ce(le),ve=v/12,ye=y?-Math.abs(ve):Math.abs(ve);x.forEach(pe=>{const Je=`${s.id}-${pe}`;c[Je]={value:ye,isOverride:!0}}),M.value=null,$e();return}const T=K(n);if(T<0){M.value=null;return}const N=`${s.id}-${T}`;c[N]={value:y?-Math.abs(v):v,isOverride:!0},M.value=null,$e()}function t(i,s,n){u.value[n]?.isYearSummary||(m.visible=!0,m.x=i.clientX,m.y=i.clientY,m.rowId=s.id,m.cellIndex=n)}function r(){m.visible=!1}function oe(){const i=K(m.cellIndex);if(i>=0){const s=`${m.rowId}-${i}`;delete c[s]}else if(u.value[m.cellIndex]?.isYearSummary){const s=u.value[m.cellIndex].year;ce(s).forEach(v=>{const y=`${m.rowId}-${v}`;delete c[y]})}r(),$e()}function ne(i){const{rowId:s,cellIndex:n}=m,v=K(n);if(v<0)return r();const y=U.value.find(x=>x.id===s);if(!y)return r();const T=ue(y)[n]?.value||0,N=[],le=P.holdingPeriod*12;if(i==="right")for(let x=v+1;x<le;x++)N.push(x);else for(let x=0;x<v;x++)N.push(x);N.forEach(x=>{const ve=`${s}-${x}`;c[ve]={value:T,isOverride:!0}}),r(),$e()}function be(){const i=U.value.find(s=>s.id===m.rowId);O.value={label:i?.label||"",context:u.value[m.cellIndex]?.label||"",rowId:m.rowId,cellIndex:m.cellIndex},F.value=10,q.value=P.deal.timeVarianceEarlyMonths||0,Z.value=P.deal.timeVarianceLateMonths||3,w.value=!0,r()}function Ee(){const i=K(O.value.cellIndex);if(i>=0){const s=`${O.value.rowId}-${i}`;c[s]&&(c[s].variance=F.value)}G("apply-changes",{...Ae(),timeVariance:{early:q.value,late:Z.value}}),w.value=!1}function Fe(i){te.value=i,L.value={label:"",amount:0,growthRate:3},A.value=!0}function Ne(){V.value.push({id:`custom-${Date.now()}`,parentId:te.value,label:L.value.label,amount:L.value.amount,growthRate:L.value.growthRate||3}),A.value=!1}function Ge(i){const s=V.value.findIndex(n=>n.id===i);s>-1&&(V.value.splice(s,1),Object.keys(c).forEach(n=>{n.startsWith(`${i}-`)&&delete c[n]}))}function De(i){if(i===0)return"-";const s=Math.abs(i),n=new Intl.NumberFormat("en-AU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(s);return i<0?`(${n})`:n}const $e=()=>{G("apply-changes",Ae())};function Ae(){return{rows:U.value.map(i=>({id:i.id,cells:ue(i)})),granularity:S.value,timeVariance:{early:q.value,late:Z.value}}}Pe(()=>P.initialOverridesJson,i=>{if(i)try{const s=JSON.parse(i);Object.keys(c).forEach(n=>delete c[n]),Object.assign(c,s)}catch(s){console.error("Failed to parse overrides JSON",s)}},{immediate:!0});let Se=null;Pe(c,i=>{Se&&clearTimeout(Se),Se=setTimeout(()=>{G("update:overrides",JSON.stringify(i))},1e3)},{deep:!0});function Ye(){D.value=!0}function qe(){Object.keys(c).forEach(i=>delete c[i]),$e(),D.value=!1}return(i,s)=>(l(),a("div",tt,[e("div",st,[e("div",nt,[s[22]||(s[22]=e("h3",{class:"spreadsheet-title"},"Cashflow Model",-1)),e("div",lt,[e("button",{class:E(["toggle-btn",{active:S.value==="years"}]),onClick:s[0]||(s[0]=n=>S.value="years")},"Years",2),e("button",{class:E(["toggle-btn",{active:S.value==="months"}]),onClick:s[1]||(s[1]=n=>S.value="months")},"Months",2)])]),e("div",{class:"toolbar-right"},[e("button",{class:"btn btn-secondary btn-sm",onClick:Ye,title:"Clear all manual locks"}," Unlock All ")])]),e("div",{class:"spreadsheet-container",ref:"spreadsheetContainer",onContextmenu:s[2]||(s[2]=Q(()=>{},["prevent"]))},[e("table",at,[e("thead",null,[e("tr",it,[s[23]||(s[23]=e("th",{class:"sticky-col row-label-header"},"Parameter",-1)),(l(!0),a(z,null,ae(u.value,n=>(l(),a("th",{key:n.key,class:E(["period-header",{"year-start":n.isYearStart,"year-summary":n.isYearSummary}])},h(n.label),3))),128))])]),e("tbody",null,[(l(!0),a(z,null,ae(U.value,n=>(l(),a(z,{key:n.id},[n.isCategory?(l(),a("tr",ot,[e("td",{colspan:u.value.length+1,class:"category-cell"},[e("button",{class:"expand-btn",onClick:v=>fe(n.id)},[(l(),a("svg",{class:E({rotated:!$.value.includes(n.id)}),width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...s[24]||(s[24]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,ut),I(" "+h(n.label),1)],8,rt)])):n.isExpandable&&b(n)?(l(),a("tr",{key:1,class:E(["data-row expandable-row",{"has-overrides":o(n),expanded:d.value.includes(n.id)}])},[e("td",dt,[e("button",{class:"expand-btn",onClick:v=>he(n.id)},[(l(),a("svg",{class:E({rotated:!d.value.includes(n.id)}),width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...s[25]||(s[25]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,ct),I(" "+h(n.label)+" ",1),o(n)?(l(),a("span",{key:0,class:"locked-badge",onClick:v=>Ce(n),title:"Child values overridden. Click to unlock and reset."},[...s[26]||(s[26]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])],8,vt)):R("",!0)]),(l(!0),a(z,null,ae(ue(n),(v,y)=>(l(),a("td",{key:y,class:E(["value-cell parent-cell calculation-cell",{locked:B(n,y),"year-summary":u.value[y]?.isYearSummary,negative:v.value<0}])},[e("span",pt,h(De(v.value)),1),B(n,y)?(l(),a("span",mt,[...s[27]||(s[27]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):R("",!0)],2))),128))],2)):n.isChild&&d.value.includes(n.parentId)?(l(),a("tr",{key:2,class:E(["data-row child-row",{"has-override":C(n)}])},[e("td",yt,[s[29]||(s[29]=e("span",{class:"child-indent"},null,-1)),I(" "+h(n.label)+" ",1),C(n)?(l(),a("span",{key:0,class:"locked-badge",onClick:v=>de(n),title:"Row contains manual overrides. Click to reset."},[...s[28]||(s[28]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])],8,gt)):R("",!0),n.isDeletable?(l(),a("button",{key:1,class:"delete-row-btn",onClick:v=>Ge(n.id),title:"Remove"},"×",8,ft)):R("",!0)]),(l(!0),a(z,null,ae(ue(n),(v,y)=>(l(),a("td",{key:y,class:E(["value-cell",{editable:!u.value[y]?.isYearSummary,"calculation-cell":u.value[y]?.isYearSummary,"year-summary":u.value[y]?.isYearSummary,negative:v.value<0,"has-override":v.isOverride}]),onClick:_=>!u.value[y]?.isYearSummary&&ge(n,y),onContextmenu:Q(_=>!u.value[y]?.isYearSummary&&t(_,n,y),["prevent"])},[M.value?.rowId===n.id&&M.value?.index===y?(l(),a("input",{key:0,ref_for:!0,ref_key:"editInput",ref:H,type:"number",value:Math.abs(v.value),onBlur:_=>f(_,n,y),onKeydown:[Ie(_=>f(_,n,y),["enter"]),_=>xe(_,n,y)],class:"cell-input"},null,40,bt)):(l(),a(z,{key:1},[e("span",kt,h(De(v.value)),1),v.isOverride?(l(),a("span",wt,"●")):R("",!0)],64))],42,ht))),128))],2)):n.isAddButton&&d.value.includes(n.parentId)?(l(),a("tr",Ct,[e("td",{colspan:u.value.length+1,class:"add-row-cell"},[e("button",{class:"add-row-btn",onClick:v=>Fe(n.parentId)},[...s[30]||(s[30]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),I(" Add Line Item ",-1)])],8,xt)],8,$t)])):!n.isChild&&!n.isAddButton&&b(n)?(l(),a("tr",{key:4,class:E(["data-row",{"derived-row":!n.isEditable,"summary-row":n.category==="summary"}])},[e("td",Rt,[n.indent?(l(),a("span",_t,h("  ".repeat(n.indent)),1)):R("",!0),I(" "+h(n.label)+" ",1),C(n)?(l(),a("span",{key:1,class:"locked-badge",onClick:v=>de(n),title:"Row contains manual overrides. Click to reset."},[...s[31]||(s[31]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])],8,Dt)):R("",!0)]),(l(!0),a(z,null,ae(ue(n),(v,y)=>(l(),a("td",{key:y,class:E(["value-cell",{editable:n.isEditable&&!u.value[y]?.isYearSummary,"calculation-cell":!n.isEditable||u.value[y]?.isYearSummary,"year-summary":u.value[y]?.isYearSummary,negative:v.value<0,"has-override":v.isOverride}]),onClick:_=>n.isEditable&&!u.value[y]?.isYearSummary&&ge(n,y),onContextmenu:Q(_=>n.isEditable&&!u.value[y]?.isYearSummary&&t(_,n,y),["prevent"])},[M.value?.rowId===n.id&&M.value?.index===y?(l(),a("input",{key:0,ref_for:!0,ref_key:"editInput",ref:H,type:"number",value:Math.abs(v.value),onBlur:_=>f(_,n,y),onKeydown:[Ie(_=>f(_,n,y),["enter"]),_=>xe(_,n,y)],class:"cell-input"},null,40,Pt)):(l(),a(z,{key:1},[e("span",Vt,h(De(v.value)),1),v.isOverride?(l(),a("span",Mt,"●")):R("",!0)],64))],42,St))),128))],2)):R("",!0)],64))),128))])])],544),m.visible?(l(),a("div",{key:0,class:"context-menu",style:He({top:m.y+"px",left:m.x+"px"}),onClick:s[5]||(s[5]=Q(()=>{},["stop"]))},[e("button",{class:"context-menu-item",onClick:oe},[...s[32]||(s[32]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"1 4 1 10 7 10"}),e("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),I(" Reset to Calculated ",-1)])]),e("button",{class:"context-menu-item",onClick:s[3]||(s[3]=n=>ne("left"))},[...s[33]||(s[33]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"15 18 9 12 15 6"})],-1),I(" Copy Left ",-1)])]),e("button",{class:"context-menu-item",onClick:s[4]||(s[4]=n=>ne("right"))},[...s[34]||(s[34]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9 18 15 12 9 6"})],-1),I(" Copy Right ",-1)])]),e("button",{class:"context-menu-item",onClick:be},[...s[35]||(s[35]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 20V10"}),e("path",{d:"M18 20V4"}),e("path",{d:"M6 20v-4"})],-1),I(" Set Variance (±%) ",-1)])])],4)):R("",!0),m.visible?(l(),a("div",{key:1,class:"context-menu-backdrop",onClick:r})):R("",!0),A.value?(l(),a("div",{key:2,class:"modal-backdrop",onClick:s[11]||(s[11]=Q(n=>A.value=!1,["self"]))},[e("div",At,[e("div",Ot,[s[36]||(s[36]=e("h4",null,"Add Custom Line Item",-1)),e("button",{class:"btn-close",onClick:s[6]||(s[6]=n=>A.value=!1)},"×")]),e("form",{onSubmit:Q(Ne,["prevent"]),class:"modal-body"},[e("div",It,[s[37]||(s[37]=e("label",null,"Label *",-1)),Y(e("input",{"onUpdate:modelValue":s[7]||(s[7]=n=>L.value.label=n),type:"text",required:"",placeholder:"e.g., Security System"},null,512),[[W,L.value.label]])]),e("div",Lt,[e("div",Tt,[s[38]||(s[38]=e("label",null,"Annual Amount *",-1)),Y(e("input",{"onUpdate:modelValue":s[8]||(s[8]=n=>L.value.amount=n),type:"number",min:"0",required:"",placeholder:"5000"},null,512),[[W,L.value.amount,void 0,{number:!0}]])]),e("div",Bt,[s[39]||(s[39]=e("label",null,"Growth Rate (%)",-1)),Y(e("input",{"onUpdate:modelValue":s[9]||(s[9]=n=>L.value.growthRate=n),type:"number",step:"0.5",placeholder:"3.0"},null,512),[[W,L.value.growthRate,void 0,{number:!0}]])])]),e("div",Ut,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[10]||(s[10]=n=>A.value=!1)},"Cancel"),s[40]||(s[40]=e("button",{type:"submit",class:"btn btn-primary"},"Add Line Item",-1))])],32)])])):R("",!0),w.value?(l(),a("div",{key:3,class:"modal-backdrop",onClick:s[18]||(s[18]=Q(n=>w.value=!1,["self"]))},[e("div",Et,[e("div",Ft,[s[41]||(s[41]=e("h4",null,"Set Uncertainty Range",-1)),e("button",{class:"btn-close",onClick:s[12]||(s[12]=n=>w.value=!1)},"×")]),e("div",Nt,[e("p",Gt,h(O.value.label)+" - "+h(O.value.context),1),e("div",Yt,[s[42]||(s[42]=e("label",null,[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 20V10"}),e("path",{d:"M18 20V4"}),e("path",{d:"M6 20v-4"})]),I(" Value Variance (±%) ")],-1)),Y(e("input",{type:"number","onUpdate:modelValue":s[13]||(s[13]=n=>F.value=n),min:"0",max:"100",step:"1",class:"variance-input"},null,512),[[W,F.value,void 0,{number:!0}]]),Y(e("input",{type:"range","onUpdate:modelValue":s[14]||(s[14]=n=>F.value=n),min:"0",max:"50",step:"1",class:"variance-slider"},null,512),[[W,F.value,void 0,{number:!0}]])]),e("div",qt,[s[48]||(s[48]=e("label",null,[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})]),I(" Timing Variance (months) ")],-1)),e("div",Jt,[e("div",Ht,[s[43]||(s[43]=e("span",{class:"time-label p10-label"},"P10 (Early)",-1)),Y(e("input",{type:"number","onUpdate:modelValue":s[15]||(s[15]=n=>q.value=n),min:"0",max:"24",class:"variance-input small"},null,512),[[W,q.value,void 0,{number:!0}]]),s[44]||(s[44]=e("span",{class:"time-unit"},"mo",-1))]),s[47]||(s[47]=e("span",{class:"time-divider"},"↔",-1)),e("div",zt,[s[45]||(s[45]=e("span",{class:"time-label p90-label"},"P90 (Late)",-1)),Y(e("input",{type:"number","onUpdate:modelValue":s[16]||(s[16]=n=>Z.value=n),min:"0",max:"24",class:"variance-input small"},null,512),[[W,Z.value,void 0,{number:!0}]]),s[46]||(s[46]=e("span",{class:"time-unit"},"mo",-1))])]),e("div",jt," Cashflow timing: Receive "+h(q.value)+"mo early (P10) to "+h(Z.value)+"mo late (P90) ",1)])]),e("div",Wt,[e("button",{class:"btn btn-secondary",onClick:s[17]||(s[17]=n=>w.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:Ee},"Apply")])])])):R("",!0),D.value?(l(),a("div",{key:4,class:"modal-backdrop",onClick:s[21]||(s[21]=Q(n=>D.value=!1,["self"]))},[e("div",Kt,[e("div",Qt,[s[49]||(s[49]=e("h4",null,"Confirm Unlock All",-1)),e("button",{class:"btn-close",onClick:s[19]||(s[19]=n=>D.value=!1)},"×")]),s[50]||(s[50]=e("div",{class:"modal-body"},[e("p",null,"Are you sure you want to remove all manual overrides? This action cannot be undone and all cells will revert to their calculated values.")],-1)),e("div",Xt,[e("button",{class:"btn btn-secondary",onClick:s[20]||(s[20]=n=>D.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",onClick:qe},"Unlock & Reset")])])])):R("",!0)]))}},es=ke(Zt,[["__scopeId","data-v-c5a5a775"]]),ts={class:"lifecycle-stepper"},ss={class:"stepper-track"},ns=["onClick"],ls={class:"step-indicator"},as={class:"step-circle"},is={key:0,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},os={key:1},rs={key:0,class:"step-line"},us={class:"step-label"},ds={class:"step-name"},cs={key:0,class:"step-status"},vs={key:0,class:"lifecycle-actions"},ps={class:"action-left"},ms={key:0,class:"action-right"},ys={key:0,class:"revert-dropdown-wrapper"},gs={key:0,class:"revert-menu glass-card"},fs=["onClick"],hs={key:1,class:"forward-action"},bs={class:"next-label"},ks={__name:"LifecycleStepper",props:{currentStatus:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["request-transition","request-revert","toggle-history"],setup(g,{emit:X}){const P={mounted(m,w){m._clickOutsideHandler=O=>{m===O.target||m.contains(O.target)||w.value(O)},document.body.addEventListener("click",m._clickOutsideHandler)},unmounted(m){document.body.removeEventListener("click",m._clickOutsideHandler)}},G=g,S=X,$=k(!1),d=[{key:"Draft",label:"Draft"},{key:"Under Review",label:"Under Review"},{key:"Proceed to Acquire",label:"Proceed"},{key:"Offer Made",label:"Offer Made"},{key:"Under Due Diligence",label:"Due Diligence"},{key:"Waiting Settlement",label:"Settlement"},{key:"Acquired",label:"Acquired"}],M=j(()=>{const m=d.findIndex(w=>w.key===G.currentStatus);return m===-1?0:m});j(()=>d[M.value]);const H=j(()=>d.slice(0,M.value).reverse()),V=j(()=>M.value===d.length-1),A=j(()=>{if(V.value)return null;const m=d[M.value+1];let w="Advance";return m.key==="Proceed to Acquire"&&(w="Proceed"),m.key==="Offer Made"&&(w="Record Offer"),m.key==="Under Due Diligence"&&(w="Start DD"),m.key==="Acquired"&&(w="Settled"),{label:m.label,key:m.key,buttonText:w}});function te(m){}function L(m){$.value=!1,S("request-revert",m)}function c(){A.value&&S("request-transition",A.value.key)}return(m,w)=>(l(),a("div",ts,[e("div",ss,[(l(),a(z,null,ae(d,(O,F)=>e("div",{key:O.key,class:E(["step-item",{active:M.value===F,completed:M.value>F,future:M.value<F}]),onClick:q=>void 0},[e("div",ls,[e("div",as,[M.value>F?(l(),a("svg",is,[...w[2]||(w[2]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(l(),a("span",os,h(F+1),1))]),F<d.length-1?(l(),a("div",rs)):R("",!0)]),e("div",us,[e("span",ds,h(O.label),1),M.value===F?(l(),a("span",cs,"Current Stage")):R("",!0)])],10,ns)),64))]),g.loading?R("",!0):(l(),a("div",vs,[e("div",ps,[e("button",{class:"btn-text-icon",onClick:w[0]||(w[0]=O=>m.$emit("toggle-history"))},[...w[3]||(w[3]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1),I(" History ",-1)])])]),V.value?R("",!0):(l(),a("div",ms,[M.value>0?(l(),a("div",ys,[e("button",{class:"btn-text-danger",onClick:w[1]||(w[1]=O=>$.value=!$.value)}," Revert Status "),$.value?Y((l(),a("div",gs,[w[4]||(w[4]=e("div",{class:"menu-label"},"Revert to:",-1)),(l(!0),a(z,null,ae(H.value,(O,F)=>(l(),a("button",{key:O.key,class:"menu-item",onClick:q=>L(O.key)},h(O.label),9,fs))),128))])),[[P,()=>$.value=!1]]):R("",!0)])):R("",!0),A.value?(l(),a("div",hs,[e("span",bs,"Next: "+h(A.value.label),1),e("button",{class:"btn btn-primary btn-sm",onClick:c},[I(h(A.value.buttonText)+" ",1),w[5]||(w[5]=e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9 18 15 12 9 6"})],-1))])])):R("",!0)]))]))]))}},ws=ke(ks,[["__scopeId","data-v-f9aedc5c"]]),Cs={class:"deal-documents"},$s={class:"docs-header flex-between mb-lg"},xs={class:"flex gap-md items-center"},Rs=["disabled"],_s={key:0,class:"spinner-sm mr-sm"},Ds={key:1},Ss={key:0,class:"text-sm text-muted"},Ps={class:"search-box"},Vs={key:0,class:"flex-center p-xl"},Ms={key:1,class:"empty-state card flex-center flex-col p-xl"},As={key:2,class:"documents-grid"},Os=["onClick"],Is={class:"doc-icon"},Ls={key:0,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"#ef4444","stroke-width":"1.5"},Ts={key:1,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 24 24",fill:"none",stroke:"#3b82f6","stroke-width":"1.5"},Bs={key:2,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},Us={class:"doc-info"},Es=["title"],Fs={class:"doc-meta"},Ns={key:0,class:"doc-tags mt-xs"},Gs={class:"doc-actions flex gap-xs"},Ys=["onClick"],qs=["onClick"],Js={class:"modal-header flex-between"},Hs={class:"flex items-center gap-md"},zs={class:"m-0 text-truncate",style:{"max-width":"400px"}},js={key:0,class:"tag-badge"},Ws={class:"flex gap-sm"},Ks=["disabled"],Qs={class:"modal-body p-0 preview-body"},Xs={key:0,class:"flex-center h-full flex-col"},Zs=["src"],en=["src"],tn={key:3,class:"flex-center h-full flex-col"},sn={__name:"DealDocuments",props:{dealId:{type:String,required:!0}},setup(g){const X=g,P=k([]),G=k(!1),S=k(!1),$=k(""),d=k(null),M=k(!1),H=k(!1),V=k(null),A=k(null),te=j(()=>{if(!$.value)return P.value;const D=$.value.toLowerCase();return P.value.filter(p=>p.fileName.toLowerCase().includes(D)||p.tags?.toLowerCase().includes(D))});Te(()=>{L()});const L=async()=>{G.value=!0;try{const D=await ee.get(`/propertydeals/${X.dealId}/documents`);P.value=D.data}catch(D){console.error("Failed to load docs",D)}finally{G.value=!1}},c=async D=>{const p=D.target.files;if(p.length){S.value=!0;try{for(let u=0;u<p.length;u++){const J=new FormData;J.append("file",p[u]),await ee.post(`/propertydeals/${X.dealId}/documents`,J,{headers:{"Content-Type":"multipart/form-data"}})}await L()}catch(u){alert("Upload failed"),console.error(u)}finally{S.value=!1,d.value.value=""}}},m=async D=>{V.value=D,M.value=!0,H.value=!0;try{const p=await ee.get(`/propertydeals/${X.dealId}/documents/${D.id}/download?inline=true`,{responseType:"blob"}),u=new Blob([p.data],{type:D.contentType});A.value=URL.createObjectURL(u)}catch(p){console.error("Failed to load preview",p)}finally{H.value=!1}},w=()=>{M.value=!1,H.value=!1,A.value&&URL.revokeObjectURL(A.value),A.value=null,V.value=null},O=async D=>{try{const p=await ee.get(`/propertydeals/${X.dealId}/documents/${D.id}/download`,{responseType:"blob"}),u=new Blob([p.data],{type:D.contentType||"application/octet-stream"}),J=window.URL.createObjectURL(u),K=document.createElement("a");K.href=J,K.download=D.fileName,document.body.appendChild(K),K.click(),document.body.removeChild(K),window.URL.revokeObjectURL(J)}catch(p){console.error("Download failed",p),alert("Failed to download file")}},F=async D=>{console.log("Delete requested for ID:",D);try{await ee.delete(`/propertydeals/${X.dealId}/documents/${D}`),P.value=P.value.filter(p=>p.id!==D)}catch(p){console.error("Delete failed error details:",p),alert("Delete failed")}},q=D=>{if(D===0)return"0 B";const p=1024,u=["B","KB","MB","GB"],J=Math.floor(Math.log(D)/Math.log(p));return parseFloat((D/Math.pow(p,J)).toFixed(1))+" "+u[J]},Z=D=>new Date(D).toLocaleDateString();return(D,p)=>(l(),a("div",Cs,[e("div",$s,[e("div",xs,[e("input",{type:"file",ref_key:"fileInput",ref:d,onChange:c,class:"hidden",multiple:""},null,544),e("button",{onClick:p[0]||(p[0]=u=>D.$refs.fileInput.click()),class:"btn btn-primary",disabled:S.value},[S.value?(l(),a("span",_s)):(l(),a("span",Ds,"+")),p[5]||(p[5]=I(" Upload Document ",-1))],8,Rs),S.value?(l(),a("span",Ss,"Uploading...")):R("",!0)]),e("div",Ps,[Y(e("input",{"onUpdate:modelValue":p[1]||(p[1]=u=>$.value=u),placeholder:"Search documents...",class:"form-input-sm"},null,512),[[W,$.value]])])]),G.value?(l(),a("div",Vs,[ie(Ue,{size:"lg",text:"Loading Documents..."})])):P.value.length===0?(l(),a("div",Ms,[...p[6]||(p[6]=[_e('<div class="empty-icon-bg mb-md" data-v-468e7619><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-468e7619><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-468e7619></path><polyline points="14 2 14 8 20 8" data-v-468e7619></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-468e7619></line><line x1="16" y1="17" x2="8" y2="17" data-v-468e7619></line><polyline points="10 9 9 9 8 9" data-v-468e7619></polyline></svg></div><h3 data-v-468e7619>No Documents Yet</h3><p data-v-468e7619>Upload contracts, due diligence reports, or floor plans.</p>',3)])])):(l(),a("div",As,[(l(!0),a(z,null,ae(te.value,u=>(l(),a("div",{key:u.id,class:"doc-card card",onClick:J=>m(u)},[e("div",Is,[u.contentType?.toLowerCase().includes("pdf")?(l(),a("svg",Ls,[...p[7]||(p[7]=[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},null,-1),e("polyline",{points:"14 2 14 8 20 8"},null,-1),e("line",{x1:"12",y1:"18",x2:"12",y2:"12"},null,-1),e("line",{x1:"9",y1:"15",x2:"15",y2:"15"},null,-1)])])):u.contentType?.toLowerCase().includes("image")?(l(),a("svg",Ts,[...p[8]||(p[8]=[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},null,-1),e("circle",{cx:"8.5",cy:"8.5",r:"1.5"},null,-1),e("polyline",{points:"21 15 16 10 5 21"},null,-1)])])):(l(),a("svg",Bs,[...p[9]||(p[9]=[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},null,-1),e("polyline",{points:"14 2 14 8 20 8"},null,-1)])]))]),e("div",Us,[e("div",{class:"doc-name text-truncate",title:u.fileName},h(u.fileName),9,Es),e("div",Fs,h(q(u.fileSizeBytes))+" • "+h(Z(u.uploadedAt)),1),u.tags?(l(),a("div",Ns,[(l(!0),a(z,null,ae(u.tags.split(","),J=>(l(),a("span",{key:J,class:"tag-badge"},h(J),1))),128))])):R("",!0)]),e("div",Gs,[e("button",{onClick:Q(J=>O(u),["stop"]),class:"btn-icon",title:"Download"},[...p[10]||(p[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,Ys),e("button",{onClick:Q(J=>F(u.id),["stop"]),class:"btn-icon text-danger",title:"Delete"},[...p[11]||(p[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,qs)])],8,Os))),128))])),(l(),ze(je,{to:"body"},[M.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:w},[e("div",{class:"modal preview-modal card",onClick:p[4]||(p[4]=Q(()=>{},["stop"]))},[e("div",Js,[e("div",Hs,[e("h3",zs,h(V.value?.fileName),1),V.value?.tags?(l(),a("span",js,h(V.value.tags),1)):R("",!0)]),e("div",Ws,[e("button",{onClick:p[2]||(p[2]=u=>O(V.value)),class:"btn btn-secondary btn-sm",disabled:H.value},[...p[12]||(p[12]=[e("span",{class:"flex items-center gap-xs"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]),I(" Download ")],-1)])],8,Ks),e("button",{onClick:w,class:"btn-close"},"×")])]),e("div",Qs,[H.value?(l(),a("div",Xs,[...p[13]||(p[13]=[e("span",{class:"spinner-lg mb-md"},null,-1),e("p",null,"Loading document...",-1)])])):A.value&&V.value.contentType?.toLowerCase().includes("pdf")?(l(),a("iframe",{key:1,src:A.value,width:"100%",height:"100%",frameborder:"0"},null,8,Zs)):A.value&&V.value.contentType?.toLowerCase().includes("image")?(l(),a("img",{key:2,src:A.value,class:"preview-image"},null,8,en)):(l(),a("div",tn,[p[14]||(p[14]=e("p",null,"Preview not available for this file type.",-1)),e("button",{onClick:p[3]||(p[3]=u=>O(V.value)),class:"btn btn-primary mt-md"},"Download File")]))])])])):R("",!0)]))]))}},nn=ke(sn,[["__scopeId","data-v-468e7619"]]),ln={class:"status-history"},an={key:0,class:"loading-state"},on={key:1,class:"empty-history"},rn={key:2,class:"history-timeline"},un={class:"history-content"},dn={class:"history-header"},cn={class:"history-date"},vn={key:0,class:"history-user"},pn={key:1,class:"history-comment"},mn={__name:"DealStatusHistory",props:{history:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(g){function X(G){switch(G){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";case"Acquired":return"status-buy";default:return"status-draft"}}function P(G){return G?new Date(G).toLocaleString("en-AU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):""}return(G,S)=>(l(),a("div",ln,[g.loading?(l(),a("div",an,[...S[0]||(S[0]=[e("span",{class:"spinner-sm"},null,-1),I(" Loading history... ",-1)])])):g.history.length===0?(l(),a("div",on,[...S[1]||(S[1]=[e("p",null,"No status history recorded.",-1)])])):(l(),a("ul",rn,[(l(!0),a(z,null,ae(g.history,($,d)=>(l(),a("li",{key:d,class:"history-item"},[S[2]||(S[2]=e("div",{class:"timeline-line"},null,-1)),e("div",{class:E(["timeline-marker",X($.status)])},null,2),e("div",un,[e("div",dn,[e("span",{class:E(["status-badge",X($.status)])},h($.status),3),e("span",cn,h(P($.timestamp)),1)]),$.userName?(l(),a("div",vn," by "+h($.userName),1)):R("",!0),$.comment?(l(),a("div",pn,' "'+h($.comment)+'" ',1)):R("",!0)])]))),128))]))]))}},yn=ke(mn,[["__scopeId","data-v-d71c40b6"]]),gn={key:0,class:"deal-workbench card"},fn={key:1,class:"deal-workbench card"},hn={class:"workbench-header"},bn={class:"deal-info"},kn={class:"deal-title"},wn={class:"deal-meta"},Cn={key:0,class:"deal-address"},$n={key:1,class:"deal-type badge"},xn={class:"lifecycle-container"},Rn={class:"view-tabs"},_n={key:0,class:"workbench-grid-container"},Dn={class:"workbench-toolbar"},Sn={class:"save-status"},Pn={key:0,class:"status-saving"},Vn={key:1,class:"status-saved"},Mn={class:"bento-grid"},An={class:"input-card glass-card"},On={class:"card-content"},In={class:"input-row"},Ln={class:"input-wrapper"},Tn=["value"],Bn={class:"input-row"},Un={class:"input-wrapper"},En=["value"],Fn={class:"input-row"},Nn={class:"input-wrapper"},Gn=["value"],Yn={class:"input-row"},qn={class:"input-wrapper"},Jn=["value"],Hn={class:"input-row"},zn={class:"input-wrapper"},jn=["value"],Wn={class:"summary-row"},Kn={class:"summary-value"},Qn={class:"input-card glass-card"},Xn={class:"card-content"},Zn={class:"input-grid-row"},el={class:"input-wrapper"},tl=["value"],sl={class:"input-wrapper"},nl=["value"],ll={class:"input-grid-row"},al={class:"input-wrapper"},il=["value"],ol={class:"input-wrapper"},rl=["value"],ul={key:1,class:"col-span-2 detailed-label"},dl={key:0,class:"detailed-subgroup"},cl={class:"input-row compact"},vl={class:"input-wrapper xs"},pl=["value"],ml={class:"input-row compact"},yl=["value"],gl={key:0,class:"input-row compact"},fl={class:"input-wrapper xs"},hl=["value"],bl={class:"input-row compact"},kl={class:"input-wrapper xs"},wl=["value"],Cl={class:"input-grid-row"},$l={class:"input-wrapper"},xl=["value"],Rl={class:"input-wrapper"},_l=["value"],Dl={class:"input-grid-row"},Sl={class:"input-wrapper"},Pl=["value"],Vl={class:"input-wrapper"},Ml=["value"],Al={class:"summary-row"},Ol={class:"summary-value"},Il={class:"input-card glass-card"},Ll={class:"card-header-flex"},Tl={class:"card-content"},Bl={class:"input-row"},Ul={class:"input-wrapper"},El=["value"],Fl={class:"input-row"},Nl={class:"input-wrapper"},Gl=["value"],Yl={class:"input-row"},ql={class:"input-wrapper"},Jl=["value"],Hl={key:1,class:"detailed-subgroup"},zl=["onUpdate:modelValue"],jl={class:"input-wrapper xs"},Wl=["onUpdate:modelValue"],Kl={class:"input-wrapper xs"},Ql=["onUpdate:modelValue"],Xl=["onClick"],Zl={class:"loan-summary-mini"},ea={class:"summary-row"},ta={class:"input-card glass-card"},sa={class:"card-content"},na={class:"input-row"},la={class:"input-wrapper"},aa=["value"],ia={class:"input-row"},oa={class:"input-wrapper"},ra=["value"],ua={class:"input-row"},da={class:"input-wrapper"},ca=["value"],va={class:"input-row"},pa={class:"input-wrapper"},ma=["value"],ya={class:"results-bar glass-card"},ga={key:0,class:"metrics-flex"},fa={class:"metric-item"},ha={class:"metric-item"},ba={class:"metric-value-lg"},ka={class:"metric-item"},wa={key:1,class:"empty-metrics"},Ca={key:1,class:"risk-view"},$a={key:0,class:"alert-banner"},xa={class:"risk-actions-bar"},Ra=["disabled"],_a={key:0,class:"spinner"},Da={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Sa={key:2,class:"spreadsheet-view"},Pa={key:3,class:"documents-view p-lg"},Va={key:0,class:"history-panel glass-card"},Ma={class:"panel-header"},Aa={class:"modal revert-modal glass-card"},Oa={class:"modal-header"},Ia={class:"modal-body"},La={class:"form-group"},Ta={class:"modal-actions"},Ba=["disabled"],Ua={key:0,class:"spinner-sm"},Ea={class:"modal transition-modal glass-card"},Fa={class:"modal-header"},Na={class:"modal-body"},Ga={class:"form-group"},Ya={class:"modal-actions"},qa=["disabled"],Ja={key:0,class:"spinner-sm"},Ha={__name:"DealWorkbench",props:{deal:{type:Object,required:!0},simulationResults:{type:Object,default:null},runningSimulation:{type:Boolean,default:!1}},emits:["update","run-simulation","record-decision","refresh"],setup(g,{emit:X}){const P=k("summary"),G=k(null),S=k(!1),$=k(!1),d=k(!1),M=k(""),H=k(""),V=k(""),A=k(!1),te=k([]),L=k(!1),c=g,m=X,w=k(!1),O=k(!1);let F=null;function q(){w.value=!0,O.value=!1,F&&clearTimeout(F),setTimeout(()=>{w.value=!1,O.value=!0,F=setTimeout(()=>O.value=!1,3e3)},800)}async function Z(){if(c.deal)try{L.value=!0;const f=await ee.get(`/propertydeals/${c.deal.id}/status-history`);te.value=f.data}catch(f){console.error("Failed to fetch history:",f),te.value=[]}finally{L.value=!1}}function D(f){M.value=f,H.value=f,V.value="",$.value=!0}async function p(){if(c.deal)try{S.value=!0,await ee.post(`/propertydeals/${c.deal.id}/status`,{status:H.value,comment:V.value}),$.value=!1,d.value=!1,m("refresh"),A.value&&await Z()}catch(f){console.error("Failed to update status:",f),alert("Failed to update status. Please try again.")}finally{S.value=!1}}function u(f,t){q();const r=parseFloat(t.target.value)||0;m("update",{[f]:r})}function J(f){q(),m("update",{spreadsheetOverridesJson:f})}function K(f){G.value=f,f.timeVariance&&m("update",{timeVarianceEarlyMonths:f.timeVariance.early,timeVarianceLateMonths:f.timeVariance.late})}function ce(){m("run-simulation",G.value)}const se=j(()=>{try{return c.deal.leaseDetailsJson?JSON.parse(c.deal.leaseDetailsJson):null}catch{return null}}),U=j(()=>{try{return c.deal.loanDetailsJson?JSON.parse(c.deal.loanDetailsJson):null}catch{return null}}),re=j(()=>U.value?U.value.reduce((f,t)=>f+(t.amount||0),0):c.deal.loanAmount),ue=j(()=>!U.value||re.value===0?c.deal.interestRatePercent:U.value.reduce((t,r)=>t+r.amount*r.rate,0)/re.value),we=j(()=>{if(!c.deal)return 0;const f=c.deal.askingPrice||0,t=f*((c.deal.stampDutyRate||0)/100);return f+t+(c.deal.legalCosts||0)+(c.deal.capExReserve||0)}),fe=j(()=>c.deal?Xe(c.deal.estimatedGrossRent||0,c.deal.vacancyRatePercent||0,c.deal.managementFeePercent||0,c.deal.outgoingsEstimate||0):0),he=j(()=>!c.deal||!c.deal.askingPrice?0:re.value/c.deal.askingPrice*100);function b(){q(),se.value?m("update",{leaseDetailsJson:""}):m("update",{leaseDetailsJson:JSON.stringify({remainingTerm:3,reviewType:"fixed",reviewValue:3,vacancyDurationMonths:3})})}function o(f,t){q();const r={...se.value};let oe=t.target.value;t.target.type==="number"&&(oe=parseFloat(oe)),r[f]=oe,m("update",{leaseDetailsJson:JSON.stringify(r)})}function B(){if(q(),U.value)m("update",{loanDetailsJson:""});else{const f=[{name:"Senior Debt",amount:c.deal.loanAmount,rate:c.deal.interestRatePercent}];m("update",{loanDetailsJson:JSON.stringify(f)})}}function C(){const f=[...U.value||[]];f.push({name:"Mezzanine",amount:0,rate:8}),ge(f)}function de(f){const t=[...U.value];t.splice(f,1),ge(t)}function Ce(){ge(U.value)}function ge(f){q();const t=JSON.stringify(f),r=f.reduce((ne,be)=>ne+(be.amount||0),0);let oe=0;r>0&&(oe=f.reduce((ne,be)=>ne+be.amount*be.rate,0)/r),m("update",{loanDetailsJson:t,loanAmount:r,interestRatePercent:parseFloat(oe.toFixed(2))})}function xe(f){switch(f){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";default:return"status-draft"}}function me(f){return Be(f)}return(f,t)=>g.deal?(l(),a("div",fn,[e("div",hn,[e("div",bn,[e("h2",kn,h(g.deal.name),1),e("div",wn,[g.deal.address?(l(),a("span",Cn,h(g.deal.address),1)):R("",!0),g.deal.buildingType?(l(),a("span",$n,h(g.deal.buildingType),1)):R("",!0)])]),e("div",xn,[ie(ws,{"current-status":g.deal.status,loading:S.value,onTransition:f.handleLifecycleTransition,onRequestRevert:D},null,8,["current-status","loading","onTransition"])])]),e("div",Rn,[e("button",{class:E(["view-tab",{active:P.value==="summary"}]),onClick:t[0]||(t[0]=r=>P.value="summary")},[...t[38]||(t[38]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),e("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1),I(" Assumptions & Inputs ",-1)])],2),e("button",{class:E(["view-tab",{active:P.value==="detailed"}]),onClick:t[1]||(t[1]=r=>P.value="detailed")},[...t[39]||(t[39]=[_e('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-3a1817ed><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-3a1817ed></rect><line x1="3" y1="9" x2="21" y2="9" data-v-3a1817ed></line><line x1="3" y1="15" x2="21" y2="15" data-v-3a1817ed></line><line x1="9" y1="3" x2="9" y2="21" data-v-3a1817ed></line><line x1="15" y1="3" x2="15" y2="21" data-v-3a1817ed></line></svg> Detailed Model ',2)])],2),e("button",{class:E(["view-tab",{active:P.value==="risk"}]),onClick:t[2]||(t[2]=r=>P.value="risk")},[...t[40]||(t[40]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})],-1),I(" Risk Analysis ",-1)])],2),e("button",{class:E(["view-tab",{active:P.value==="documents"}]),onClick:t[3]||(t[3]=r=>P.value="documents")},[...t[41]||(t[41]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})],-1),I(" Documents ",-1)])],2)]),P.value==="summary"?(l(),a("div",_n,[e("div",Dn,[t[43]||(t[43]=e("h3",{class:"section-title"},"Deal Assumptions",-1)),e("div",Sn,[w.value?(l(),a("span",Pn,[...t[42]||(t[42]=[e("span",{class:"spinner-sm"},null,-1),I(" Saving... ",-1)])])):O.value?(l(),a("span",Vn," ✓ Saved ")):R("",!0)])]),e("div",Mn,[e("section",An,[t[55]||(t[55]=e("h4",{class:"card-title"},"Acquisition",-1)),e("div",On,[e("div",In,[t[45]||(t[45]=e("label",null,"Asking Price",-1)),e("div",Ln,[t[44]||(t[44]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:g.deal.askingPrice,onChange:t[4]||(t[4]=r=>u("askingPrice",r))},null,40,Tn)])]),e("div",Bn,[t[47]||(t[47]=e("label",null,"Stamp Duty",-1)),e("div",Un,[e("input",{type:"number",step:"0.1",value:g.deal.stampDutyRate,onChange:t[5]||(t[5]=r=>u("stampDutyRate",r))},null,40,En),t[46]||(t[46]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Fn,[t[49]||(t[49]=e("label",null,"Buyers Agent",-1)),e("div",Nn,[e("input",{type:"number",step:"0.1",value:g.deal.buyersAgentFeeRate,onChange:t[6]||(t[6]=r=>u("buyersAgentFeeRate",r))},null,40,Gn),t[48]||(t[48]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Yn,[t[51]||(t[51]=e("label",null,"Legal Costs",-1)),e("div",qn,[t[50]||(t[50]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:g.deal.legalCosts,onChange:t[7]||(t[7]=r=>u("legalCosts",r))},null,40,Jn)])]),e("div",Hn,[t[53]||(t[53]=e("label",null,"CapEx Reserve",-1)),e("div",zn,[t[52]||(t[52]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:g.deal.capExReserve,onChange:t[8]||(t[8]=r=>u("capExReserve",r))},null,40,jn)])]),e("div",Wn,[t[54]||(t[54]=e("label",null,"Total Cost",-1)),e("span",Kn,h(me(we.value)),1)])])]),e("section",Qn,[t[73]||(t[73]=e("h4",{class:"card-title"},"Income & Expenses",-1)),t[74]||(t[74]=e("div",{class:"card-header-row"},[e("span"),e("span",{class:"col-header"},"Value"),e("span",{class:"col-header"},"Growth %")],-1)),e("div",Xn,[e("div",Zn,[t[57]||(t[57]=e("label",null,"Gross Rent",-1)),e("div",el,[t[56]||(t[56]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:g.deal.estimatedGrossRent,onChange:t[9]||(t[9]=r=>u("estimatedGrossRent",r))},null,40,tl)]),e("div",sl,[e("input",{type:"number",step:"0.5",value:g.deal.rentalGrowthPercent,onChange:t[10]||(t[10]=r=>u("rentalGrowthPercent",r))},null,40,nl)])]),e("div",ll,[e("label",null,[t[58]||(t[58]=I("Vacancy ",-1)),e("button",{class:"btn-xs-link",onClick:b},h(g.deal.leaseDetailsJson?"(Detailed)":"(Simple)"),1)]),se.value?(l(),a("div",ul,"Configured via Details")):(l(),a(z,{key:0},[e("div",al,[e("input",{type:"number",step:"0.5",value:g.deal.vacancyRatePercent,onChange:t[11]||(t[11]=r=>u("vacancyRatePercent",r))},null,40,il),t[59]||(t[59]=e("span",{class:"input-suffix"},"%",-1))]),e("div",ol,[e("input",{type:"number",step:"0.5",value:g.deal.vacancyGrowthPercent??0,onChange:t[12]||(t[12]=r=>u("vacancyGrowthPercent",r))},null,40,rl)])],64))]),se.value?(l(),a("div",dl,[e("div",cl,[t[61]||(t[61]=e("label",null,"Term",-1)),e("div",vl,[e("input",{type:"number",value:se.value.remainingTerm,onChange:t[13]||(t[13]=r=>o("remainingTerm",r))},null,40,pl),t[60]||(t[60]=e("span",{class:"input-suffix"},"yrs",-1))])]),e("div",ml,[t[63]||(t[63]=e("label",null,"Review",-1)),e("select",{value:se.value.reviewType,onChange:t[14]||(t[14]=r=>o("reviewType",r)),class:"select-xs"},[...t[62]||(t[62]=[e("option",{value:"fixed"},"Fixed",-1),e("option",{value:"cpi"},"CPI",-1)])],40,yl)]),se.value.reviewType==="fixed"?(l(),a("div",gl,[t[65]||(t[65]=e("label",null,"Rate",-1)),e("div",fl,[e("input",{type:"number",step:"0.1",value:se.value.reviewValue,onChange:t[15]||(t[15]=r=>o("reviewValue",r))},null,40,hl),t[64]||(t[64]=e("span",{class:"input-suffix"},"%",-1))])])):R("",!0),e("div",bl,[t[67]||(t[67]=e("label",null,"Vac. Shift",-1)),e("div",kl,[e("input",{type:"number",value:se.value.vacancyDurationMonths,onChange:t[16]||(t[16]=r=>o("vacancyDurationMonths",r))},null,40,wl),t[66]||(t[66]=e("span",{class:"input-suffix"},"m",-1))])])])):R("",!0),e("div",Cl,[t[69]||(t[69]=e("label",null,"Outgoings",-1)),e("div",$l,[t[68]||(t[68]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:g.deal.outgoingsEstimate,onChange:t[17]||(t[17]=r=>u("outgoingsEstimate",r))},null,40,xl)]),e("div",Rl,[e("input",{type:"number",step:"0.5",value:g.deal.outgoingsGrowthPercent??0,onChange:t[18]||(t[18]=r=>u("outgoingsGrowthPercent",r))},null,40,_l)])]),e("div",Dl,[t[71]||(t[71]=e("label",null,"Mgmt Fee",-1)),e("div",Sl,[e("input",{type:"number",step:"0.5",value:g.deal.managementFeePercent,onChange:t[19]||(t[19]=r=>u("managementFeePercent",r))},null,40,Pl),t[70]||(t[70]=e("span",{class:"input-suffix"},"%",-1))]),e("div",Vl,[e("input",{type:"number",step:"0.5",value:g.deal.managementGrowthPercent??0,onChange:t[20]||(t[20]=r=>u("managementGrowthPercent",r))},null,40,Ml)])]),e("div",Al,[t[72]||(t[72]=e("label",null,"Net Operating Income",-1)),e("span",Ol,h(me(fe.value)),1)])])]),e("section",Il,[e("div",Ll,[t[75]||(t[75]=e("h4",{class:"card-title"},"Financing",-1)),e("button",{class:"btn-xs-link",onClick:B},h(U.value?"Multi-Tranche":"Simple Loan"),1)]),e("div",Tl,[!U.value||U.value.length===0?(l(),a(z,{key:0},[e("div",Bl,[t[77]||(t[77]=e("label",null,"Loan Amount",-1)),e("div",Ul,[t[76]||(t[76]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:g.deal.loanAmount,onChange:t[21]||(t[21]=r=>u("loanAmount",r))},null,40,El)])]),e("div",Fl,[t[79]||(t[79]=e("label",null,"Interest Rate",-1)),e("div",Nl,[e("input",{type:"number",step:"0.1",value:g.deal.interestRatePercent,onChange:t[22]||(t[22]=r=>u("interestRatePercent",r))},null,40,Gl),t[78]||(t[78]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Yl,[t[82]||(t[82]=e("label",null,"Rate Variance (Risk)",-1)),e("div",ql,[t[80]||(t[80]=e("span",{class:"input-prefix"},"±",-1)),e("input",{type:"number",step:"0.1",value:g.deal.interestVariancePercent,onChange:t[23]||(t[23]=r=>u("interestVariancePercent",r))},null,40,Jl),t[81]||(t[81]=e("span",{class:"input-suffix"},"%",-1))])])],64)):(l(),a("div",Hl,[t[83]||(t[83]=e("div",{class:"multi-loan-header"},[e("span",null,"Tranche"),e("span",null,"Amount"),e("span",null,"Rate"),e("span")],-1)),(l(!0),a(z,null,ae(U.value,(r,oe)=>(l(),a("div",{key:oe,class:"loan-item-grid"},[Y(e("input",{type:"text","onUpdate:modelValue":ne=>r.name=ne,placeholder:"Name",class:"input-xs",onChange:Ce},null,40,zl),[[W,r.name]]),e("div",jl,[Y(e("input",{type:"number","onUpdate:modelValue":ne=>r.amount=ne,onChange:Ce},null,40,Wl),[[W,r.amount,void 0,{number:!0}]])]),e("div",Kl,[Y(e("input",{type:"number",step:"0.1","onUpdate:modelValue":ne=>r.rate=ne,onChange:Ce},null,40,Ql),[[W,r.rate,void 0,{number:!0}]])]),e("button",{class:"btn-icon-xs text-danger",onClick:ne=>de(oe)},"×",8,Xl)]))),128)),e("button",{class:"btn-xs-secondary full-width mt-sm",onClick:C},"+ Add Tranche"),e("div",Zl," Avg Rate: "+h(ue.value.toFixed(2))+"% ",1)])),e("div",ea,[t[84]||(t[84]=e("label",null,"LVR",-1)),e("span",{class:E(["summary-value",{"text-warning":he.value>65}])},h(he.value.toFixed(1))+"%",3)])])]),e("section",ta,[t[94]||(t[94]=e("h4",{class:"card-title"},"Market & Projections",-1)),e("div",sa,[e("div",na,[t[86]||(t[86]=e("label",null,"Capital Growth",-1)),e("div",la,[e("input",{type:"number",step:"0.5",value:g.deal.capitalGrowthPercent,onChange:t[24]||(t[24]=r=>u("capitalGrowthPercent",r))},null,40,aa),t[85]||(t[85]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",ia,[t[89]||(t[89]=e("label",null,"Growth Variance",-1)),e("div",oa,[t[87]||(t[87]=e("span",{class:"input-prefix"},"±",-1)),e("input",{type:"number",step:"0.5",value:g.deal.capitalGrowthVariancePercent,onChange:t[25]||(t[25]=r=>u("capitalGrowthVariancePercent",r))},null,40,ra),t[88]||(t[88]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",ua,[t[91]||(t[91]=e("label",null,"Discount Rate",-1)),e("div",da,[e("input",{type:"number",step:"0.1",value:g.deal.discountRate||8,onChange:t[26]||(t[26]=r=>u("discountRate",r))},null,40,ca),t[90]||(t[90]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",va,[t[93]||(t[93]=e("label",null,"Holding Period",-1)),e("div",pa,[e("input",{type:"number",min:"1",max:"30",value:g.deal.holdingPeriodYears,onChange:t[27]||(t[27]=r=>u("holdingPeriodYears",r))},null,40,ma),t[92]||(t[92]=e("span",{class:"input-suffix"},"yrs",-1))])])])])]),e("section",ya,[g.simulationResults?(l(),a("div",ga,[e("div",fa,[t[95]||(t[95]=e("span",{class:"metric-label"},"Median NPV",-1)),e("span",{class:E(["metric-value-lg",g.simulationResults.medianNPV>=0?"text-success":"text-danger"])},h(me(g.simulationResults.medianNPV)),3)]),t[98]||(t[98]=e("div",{class:"vertical-divider"},null,-1)),e("div",ha,[t[96]||(t[96]=e("span",{class:"metric-label"},"Median IRR",-1)),e("span",ba,h(g.simulationResults.medianIRR.toFixed(1))+"%",1)]),t[99]||(t[99]=e("div",{class:"vertical-divider"},null,-1)),e("div",ka,[t[97]||(t[97]=e("span",{class:"metric-label"},"Rec. Decision",-1)),e("span",{class:E(["metric-tag",xe(g.simulationResults.recommendedDecision)])},h(g.simulationResults.recommendedDecision),3)])])):(l(),a("div",wa,[...t[100]||(t[100]=[e("span",null,"Run simulation to see results",-1)])]))])])):P.value==="risk"?(l(),a("div",Ca,[f.hasUnsavedChanges?(l(),a("div",$a,[t[101]||(t[101]=e("span",null,"⚠️ The deal inputs have changed since the last simulation.",-1)),e("button",{class:"btn btn-sm btn-primary",onClick:ce},"Run New Simulation")])):R("",!0),e("div",xa,[e("button",{class:"btn btn-primary run-simulation-btn full-width",onClick:ce,disabled:g.runningSimulation},[g.runningSimulation?(l(),a("span",_a)):(l(),a("svg",Da,[...t[102]||(t[102]=[e("polygon",{points:"5 3 19 12 5 21 5 3"},null,-1)])])),I(" "+h(g.runningSimulation?"Running...":"Update & Run Analysis"),1)],8,Ra)]),ie(Ze,{"initial-data":f.simulationInputSource,"initial-results":g.simulationResults,"detailed-cashflow":G.value,"hide-run-button":!0,"onUpdate:inputs":f.handleInputsUpdate},null,8,["initial-data","initial-results","detailed-cashflow","onUpdate:inputs"])])):P.value==="detailed"?(l(),a("div",Sa,[ie(es,{deal:g.deal,"holding-period":g.deal.holdingPeriodYears,"initial-overrides-json":g.deal.spreadsheetOverridesJson,onApplyChanges:K,"onUpdate:overrides":J},null,8,["deal","holding-period","initial-overrides-json"])])):P.value==="documents"?(l(),a("div",Pa,[ie(nn,{"deal-id":g.deal.id},null,8,["deal-id"])])):R("",!0),ie(Me,{name:"slide-fade"},{default:Re(()=>[A.value?(l(),a("div",Va,[e("div",Ma,[t[103]||(t[103]=e("h3",null,"Status History",-1)),e("button",{class:"btn-close-sm",onClick:t[28]||(t[28]=r=>A.value=!1)},"×")]),ie(yn,{history:te.value,loading:L.value},null,8,["history","loading"])])):R("",!0)]),_:1}),$.value?(l(),a("div",{key:4,class:"modal-backdrop",onClick:t[32]||(t[32]=Q(r=>$.value=!1,["self"]))},[e("div",Aa,[e("div",Oa,[t[104]||(t[104]=e("h2",null,"Revert Status",-1)),e("button",{class:"btn-close",onClick:t[29]||(t[29]=r=>$.value=!1)},"×")]),e("div",Ia,[e("p",null,[t[105]||(t[105]=I("Are you sure you want to revert the status to ",-1)),e("strong",null,h(M.value),1),t[106]||(t[106]=I("?",-1))]),e("div",La,[t[107]||(t[107]=e("label",null,"Reason for reverting (optional)",-1)),Y(e("textarea",{"onUpdate:modelValue":t[30]||(t[30]=r=>V.value=r),class:"form-control",rows:"3",placeholder:"e.g., Lease details were incorrect, need to re-evaluate..."},null,512),[[W,V.value]])])]),e("div",Ta,[e("button",{class:"btn btn-secondary",onClick:t[31]||(t[31]=r=>$.value=!1)},"Cancel"),e("button",{class:"btn btn-warning",onClick:p,disabled:S.value},[S.value?(l(),a("span",Ua)):R("",!0),I(" "+h(S.value?"Reverting...":"Confirm Revert"),1)],8,Ba)])])])):R("",!0),d.value?(l(),a("div",{key:5,class:"modal-backdrop",onClick:t[36]||(t[36]=Q(r=>d.value=!1,["self"]))},[e("div",Ea,[e("div",Fa,[t[108]||(t[108]=e("h2",null,"Update Status",-1)),e("button",{class:"btn-close",onClick:t[33]||(t[33]=r=>d.value=!1)},"×")]),e("div",Na,[e("p",null,[t[109]||(t[109]=I("Move stage to ",-1)),e("strong",null,h(H.value),1),t[110]||(t[110]=I("?",-1))]),e("div",Ga,[t[111]||(t[111]=e("label",null,"Comment (optional)",-1)),Y(e("textarea",{"onUpdate:modelValue":t[34]||(t[34]=r=>V.value=r),class:"form-control",rows:"3",placeholder:"e.g., Offer accepted by vendor..."},null,512),[[W,V.value]])])]),e("div",Ya,[e("button",{class:"btn btn-secondary",onClick:t[35]||(t[35]=r=>d.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:p,disabled:S.value},[S.value?(l(),a("span",Ja)):R("",!0),I(" "+h(S.value?"Updating...":"Confirm Update"),1)],8,qa)])])])):R("",!0)])):(l(),a("div",gn,[...t[37]||(t[37]=[e("div",{class:"workbench-loading"},[e("div",{class:"spinner"}),e("p",null,"Loading deal...")],-1)])]))}},za=ke(Ha,[["__scopeId","data-v-3a1817ed"]]),ja={class:"acquisition-planner"},Wa={class:"planner-header"},Ka={class:"header-content"},Qa={class:"nav-area"},Xa={class:"breadcrumb"},Za={key:1,class:"breadcrumb-current"},ei={key:0,class:"page-title-wrapper"},ti={key:1,class:"deal-selector-wrapper"},si={class:"deal-selector-name"},ni={key:0,class:"deal-dropdown-menu glass-card"},li={class:"dropdown-search"},ai={class:"dropdown-list"},ii={key:0,class:"dropdown-empty"},oi=["onClick"],ri={class:"dropdown-item-name"},ui={class:"header-actions"},di={class:"view-toggles"},ci={class:"immersive-content"},vi={key:0,class:"dashboard-grid-view"},pi={key:0,class:"loading-state"},mi={key:1,class:"empty-state-large"},yi={key:2,class:"deals-grid"},gi=["onClick"],fi={class:"deal-card-header"},hi={class:"deal-card-body"},bi={class:"deal-card-title"},ki={class:"deal-card-address"},wi={class:"deal-metrics"},Ci={class:"metric"},$i={class:"value"},xi={class:"metric"},Ri={class:"value"},_i={class:"deal-card-footer"},Di={key:0,class:"sim-badge success"},Si={key:1,class:"sim-badge empty"},Pi={class:"workbench-container",key:"workbench"},Vi={class:"modal deal-modal glass-card"},Mi={class:"modal-header"},Ai={class:"form-group"},Oi={class:"form-row"},Ii={class:"form-group"},Li={class:"form-group"},Ti={class:"form-row"},Bi={class:"form-group"},Ui={class:"form-group"},Ei={class:"modal-actions"},Fi=["disabled"],Ni={__name:"AcquisitionPlannerView",setup(g){const X={mounted(b,o){b._clickOutsideHandler=B=>{b===B.target||b.contains(B.target)||o.value(B)},document.body.addEventListener("click",b._clickOutsideHandler)},unmounted(b){document.body.removeEventListener("click",b._clickOutsideHandler)}},P=We(),G=Ke(),S=k(!0),$=k([]),d=k(null),M=k(null),H=k(""),V=k(!1),A=k(!1),te=k(!1),L=k(!1),c=k(""),m=k(null),w=k({name:"",address:"",buildingType:"",askingPrice:0,estimatedGrossRent:0}),O=j(()=>H.value?$.value.filter(b=>b.status===H.value):$.value),F=j(()=>{let b=$.value;if(c.value){const o=c.value.toLowerCase();b=b.filter(B=>B.name.toLowerCase().includes(o)||B.address&&B.address.toLowerCase().includes(o))}return b});Te(async()=>{await q();const b=P.query.deal;b&&await Z(b)});async function q(){try{S.value=!0;const b=await ee.get("/propertydeals");$.value=b.data}catch(b){console.error("Failed to fetch deals:",b)}finally{S.value=!1}}async function Z(b){try{if($.value.length>0&&d.value?.id===b)return;const o=await ee.get(`/propertydeals/${b}`);d.value=o.data,M.value=o.data.simulationResults?.[0]||null,G.replace({query:{deal:b}}),L.value=!1}catch(o){console.error("Failed to load deal:",o)}}function D(){d.value=null,G.replace({query:{}}),L.value=!1,q()}function p(b){Z(b)}function u(){L.value=!L.value,L.value&&Ve(()=>{m.value?.focus()})}function J(){L.value=!1}function K(){w.value={name:"",address:"",buildingType:"",askingPrice:0,estimatedGrossRent:0},V.value=!0}function ce(){L.value=!1,K()}async function se(){try{A.value=!0;const b=await ee.post("/propertydeals",w.value);V.value=!1,await q(),await Z(b.data.id)}catch(b){console.error("Failed to create deal:",b),alert("Failed to create deal. Please try again.")}finally{A.value=!1}}async function U(b){if(d.value)try{const o=await ee.put(`/propertydeals/${d.value.id}`,b);d.value=o.data;const B=$.value.findIndex(C=>C.id===d.value.id);B!==-1&&($.value[B]={...$.value[B],...o.data})}catch(o){console.error("Failed to update deal:",o)}}async function re(){if(d.value)try{te.value=!0;const b={askingPrice:d.value.askingPrice,stampDutyRate:d.value.stampDutyRate,legalCosts:d.value.legalCosts,capExReserve:d.value.capExReserve,estimatedGrossRent:d.value.estimatedGrossRent,vacancyRatePercent:d.value.vacancyRatePercent,managementFeePercent:d.value.managementFeePercent,outgoingsEstimate:d.value.outgoingsEstimate,loanAmount:d.value.loanAmount,interestRatePercent:d.value.interestRatePercent,capitalGrowthPercent:d.value.capitalGrowthPercent,holdingPeriodYears:d.value.holdingPeriodYears,rentVariancePercent:d.value.rentVariancePercent,vacancyVariancePercent:d.value.vacancyVariancePercent,interestVariancePercent:d.value.interestVariancePercent,capitalGrowthVariancePercent:d.value.capitalGrowthVariancePercent,discountRate:d.value.discountRate,leaseDetails:d.value.leaseDetailsJson?JSON.parse(d.value.leaseDetailsJson):null,loanDetails:d.value.loanDetailsJson?JSON.parse(d.value.loanDetailsJson):null},o=et(b,5e3);M.value=o,await ee.post(`/propertydeals/${d.value.id}/simulations`,{iterations:o.iterations,medianNPV:o.medianNPV,p10NPV:o.p10NPV,p90NPV:o.p90NPV,medianIRR:o.medianIRR,p10IRR:o.p10IRR,p90IRR:o.p90IRR,calculatedCapRate:o.calculatedCapRate,recommendedDecision:o.recommendedDecision,npvHistogramJson:JSON.stringify(o.npvHistogram),irrHistogramJson:JSON.stringify(o.irrHistogram),yearlyDCFJson:JSON.stringify(o.yearlyDCF),inputsSnapshotJson:JSON.stringify(b)});const B=await ee.get(`/propertydeals/${d.value.id}`);d.value=B.data;const C=$.value.findIndex(de=>de.id===d.value.id);C!==-1&&($.value[C]={...B.data})}catch(b){console.error("Simulation failed:",b),alert("Simulation failed. Please try again.")}finally{te.value=!1}}async function ue(b,o){if(d.value)try{await ee.put(`/propertydeals/${d.value.id}/decision`,{decision:b,rationale:o});const B=await ee.get(`/propertydeals/${d.value.id}`);d.value=B.data;const C=$.value.findIndex(de=>de.id===d.value.id);C!==-1&&($.value[C].status=b)}catch(B){console.error("Failed to record decision:",B),alert("Failed to record decision. Please try again.")}}async function we(){d.value&&await Z(d.value.id)}function fe(b){switch(b){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";default:return"status-draft"}}function he(b){return Be(b)}return(b,o)=>{const B=Qe("router-link");return l(),a("div",ja,[e("header",Wa,[e("div",Ka,[e("div",Qa,[e("div",Xa,[ie(B,{to:"/properties",class:"breadcrumb-link"},{default:Re(()=>[...o[11]||(o[11]=[I("Properties",-1)])]),_:1}),o[12]||(o[12]=e("span",{class:"breadcrumb-sep"},"/",-1)),d.value?(l(),a("a",{key:0,href:"#",onClick:Q(D,["prevent"]),class:"breadcrumb-link"},"Acquisitions")):(l(),a("span",Za,"Acquisitions"))]),d.value?Y((l(),a("div",ti,[e("button",{class:"deal-selector-btn",onClick:u},[e("span",si,h(d.value.name),1),(l(),a("svg",{class:E(["chevron-icon",{rotated:L.value}]),width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...o[14]||(o[14]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))]),ie(Me,{name:"dropdown-fade"},{default:Re(()=>[L.value?(l(),a("div",ni,[e("div",li,[Y(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=C=>c.value=C),placeholder:"Search deals...",class:"search-input",ref_key:"searchInput",ref:m},null,512),[[W,c.value]])]),e("div",ai,[F.value.length===0?(l(),a("div",ii,"No deals found")):R("",!0),(l(!0),a(z,null,ae(F.value,C=>(l(),a("button",{key:C.id,class:E(["dropdown-item",{active:C.id===d.value.id}]),onClick:de=>p(C.id)},[e("span",ri,h(C.name),1),e("span",{class:E(["dropdown-item-status",fe(C.status)])},h(C.status),3)],10,oi))),128))]),e("div",{class:"dropdown-footer"},[e("button",{class:"btn-create-dropdown",onClick:ce}," + New Deal ")])])):R("",!0)]),_:1})])),[[X,J]]):(l(),a("div",ei,[...o[13]||(o[13]=[e("h1",{class:"page-title"},"Acquisition Planner",-1),e("p",{class:"page-subtitle"},"Analyze potential deals with uncertainty modeling",-1)])]))])]),e("div",ui,[d.value?(l(),a("button",{key:1,class:"btn btn-secondary",onClick:D}," Close Deal ")):(l(),a(z,{key:0},[e("div",di,[Y(e("select",{"onUpdate:modelValue":o[1]||(o[1]=C=>H.value=C),class:"status-filter-large"},[...o[15]||(o[15]=[_e('<option value="" data-v-3952a881>All Statuses</option><option value="Draft" data-v-3952a881>Drafts</option><option value="Analyzing" data-v-3952a881>Analyzing</option><option value="Buy" data-v-3952a881>Buy</option><option value="Pass" data-v-3952a881>Pass</option>',5)])],512),[[Le,H.value]])]),e("button",{class:"btn btn-primary",onClick:K},[...o[16]||(o[16]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),I(" New Deal ",-1)])])],64))])]),e("div",ci,[ie(Me,{name:"fade-slide",mode:"out-in"},{default:Re(()=>[d.value?(l(),a("div",Pi,[ie(za,{deal:d.value,"simulation-results":M.value,"running-simulation":te.value,onUpdate:U,onRunSimulation:re,onRecordDecision:ue,onRefresh:we},null,8,["deal","simulation-results","running-simulation"])])):(l(),a("div",vi,[S.value?(l(),a("div",pi,[ie(Ue)])):O.value.length===0?(l(),a("div",mi,[e("div",{class:"empty-content"},[o[17]||(o[17]=e("div",{class:"empty-icon-circle"},[e("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e("polyline",{points:"9 22 9 12 15 12 15 22"})])],-1)),o[18]||(o[18]=e("h3",null,"No Deals Found",-1)),o[19]||(o[19]=e("p",null,"Start your acquisition pipeline by adding a new property deal.",-1)),e("button",{class:"btn btn-primary mt-4",onClick:K},"Create First Deal")])])):(l(),a("div",yi,[(l(!0),a(z,null,ae(O.value,C=>(l(),a("div",{key:C.id,class:"deal-card glass-card hover-lift",onClick:de=>Z(C.id)},[e("div",fi,[e("span",{class:E(["deal-status-badge",fe(C.status)])},h(C.status),3),e("button",{class:"btn-icon-more",onClick:o[2]||(o[2]=Q(()=>{},["stop"]))},[...o[20]||(o[20]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"1"}),e("circle",{cx:"19",cy:"12",r:"1"}),e("circle",{cx:"5",cy:"12",r:"1"})],-1)])])]),e("div",hi,[e("h3",bi,h(C.name),1),e("p",ki,h(C.address||"No address provided"),1),e("div",wi,[e("div",Ci,[o[21]||(o[21]=e("span",{class:"label"},"Price",-1)),e("span",$i,h(he(C.askingPrice)),1)]),e("div",xi,[o[22]||(o[22]=e("span",{class:"label"},"Cap Rate",-1)),e("span",Ri,h(C.calculatedCapRate?(C.calculatedCapRate*100).toFixed(1)+"%":"-"),1)])])]),e("div",_i,[C.simulationResults&&C.simulationResults.length>0?(l(),a("div",Di," Simulated ")):(l(),a("div",Si," No Analysis ")),o[23]||(o[23]=e("span",{class:"last-updated"},"Updated today",-1))])],8,gi))),128))]))]))]),_:1})]),V.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:o[10]||(o[10]=Q(C=>V.value=!1,["self"]))},[e("div",Vi,[e("div",Mi,[o[24]||(o[24]=e("h2",null,"New Property Deal",-1)),e("button",{class:"btn-close",onClick:o[3]||(o[3]=C=>V.value=!1)},"×")]),e("form",{onSubmit:Q(se,["prevent"]),class:"modal-body"},[e("div",Ai,[o[25]||(o[25]=e("label",null,"Deal Name *",-1)),Y(e("input",{"onUpdate:modelValue":o[4]||(o[4]=C=>w.value.name=C),type:"text",required:"",placeholder:"e.g., 123 Industrial Ave - Warehouse",class:"input-lg"},null,512),[[W,w.value.name]])]),e("div",Oi,[e("div",Ii,[o[26]||(o[26]=e("label",null,"Address",-1)),Y(e("input",{"onUpdate:modelValue":o[5]||(o[5]=C=>w.value.address=C),type:"text",placeholder:"123 Main St, Sydney NSW"},null,512),[[W,w.value.address]])]),e("div",Li,[o[28]||(o[28]=e("label",null,"Building Type",-1)),Y(e("select",{"onUpdate:modelValue":o[6]||(o[6]=C=>w.value.buildingType=C)},[...o[27]||(o[27]=[_e('<option value="" data-v-3952a881>Select type</option><option value="Office" data-v-3952a881>Office</option><option value="Retail" data-v-3952a881>Retail</option><option value="Industrial" data-v-3952a881>Industrial</option><option value="Mixed" data-v-3952a881>Mixed Use</option>',5)])],512),[[Le,w.value.buildingType]])])]),e("div",Ti,[e("div",Bi,[o[29]||(o[29]=e("label",null,"Asking Price *",-1)),Y(e("input",{"onUpdate:modelValue":o[7]||(o[7]=C=>w.value.askingPrice=C),type:"number",min:"0",step:"any",required:"",placeholder:"1500000"},null,512),[[W,w.value.askingPrice,void 0,{number:!0}]])]),e("div",Ui,[o[30]||(o[30]=e("label",null,"Estimated Gross Rent (p.a.) *",-1)),Y(e("input",{"onUpdate:modelValue":o[8]||(o[8]=C=>w.value.estimatedGrossRent=C),type:"number",min:"0",step:"any",required:"",placeholder:"120000"},null,512),[[W,w.value.estimatedGrossRent,void 0,{number:!0}]])])]),e("div",Ei,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[9]||(o[9]=C=>V.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:A.value},h(A.value?"Creating...":"Create & Analyze"),9,Fi)])],32)])])):R("",!0)])}}},Ji=ke(Ni,[["__scopeId","data-v-3952a881"]]);export{Ji as default};
