import{_ as se,r as d,k as E,i as le,q as p,c as n,o as a,a as e,d as r,x as T,A as ne,F as g,s as M,g as w,b as ae,n as y,t as o,e as j,y as U,m as oe}from"./index-CajTN6Mj.js";import{M as L}from"./MoneyBoxLoader-C_1gdrvW.js";const ie={class:"decisions-page animate-fade-in"},de={class:"flex-between mb-lg items-start"},re={class:"flex gap-md"},ce={class:"portfolio-select-wrapper"},ue=["value"],ve=["disabled"],me={key:0,class:"empty-state-large card flex-center flex-col p-xl"},pe={key:1},be={class:"stats-row mb-lg"},fe={class:"count"},he={class:"count"},ge={class:"count"},ye={class:"count"},ke={class:"flex-between mb-md border-bottom pb-sm"},we={class:"tabs"},_e=["onClick"],xe={class:"flex gap-sm"},De=["disabled"],Ce={key:0,class:"spinner-sm mr-sm"},Ae=["disabled"],$e={key:0,class:"spinner-sm mr-sm"},Ie={key:1,class:"mr-sm text-accent",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Me={key:0,class:"flex-center p-xl"},Be={key:1,class:"modal-backdrop"},Se={class:"card p-xl"},Ve={key:2,class:"empty-state card flex-center flex-col p-lg"},Pe={class:"flex gap-md mt-md"},Te=["disabled"],je={key:0,class:"spinner-sm mr-sm"},Le={key:3,class:"decisions-table-container card"},Re={class:"table"},Ne={class:"font-medium"},He={class:"text-xs text-muted truncate max-w-md"},Fe={class:"flex items-center gap-xs"},ze={key:0,class:"text-accent",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ee={class:"text-right"},Ue={class:"flex-end gap-xs"},Ge=["onClick"],Ze=["onClick"],qe=["onClick"],Oe=["onClick"],Je=["onClick"],Ke=["onClick"],Qe=["onClick"],We={class:"modal-header flex-between mb-lg"},Xe={class:"modal-body mb-lg"},Ye={key:0,class:"view-mode"},et={class:"flex-between mb-md"},tt={class:"flex items-center gap-md"},st={class:"text-muted text-sm"},lt={key:0,class:"history-view animate-fade-in"},nt={key:0,class:"flex-center p-md"},at={key:1,class:"text-muted text-sm p-md italic"},ot={key:2,class:"history-list"},it={class:"flex-between text-xs mb-xs"},dt={class:"font-bold uppercase text-accent"},rt={class:"text-muted"},ct={class:"text-sm m-0"},ut={class:"text-xs text-muted mt-xs italic"},vt={key:1,class:"details-view"},mt={class:"mb-md"},pt={class:"info-block bg-gray-50 p-md radius-md mb-md"},bt={class:"markdown-text"},ft={key:0,class:"text-accent text-sm font-bold flex items-center gap-xs"},ht={key:1,class:"edit-mode"},gt={class:"form-group"},yt={class:"form-group"},kt={class:"modal-footer flex-end gap-md"},wt={__name:"DecisionsView",setup(_t){const C=d([]),c=d(null),b=d([]),B=d(!1),_=d(!1),k=d(!1),i=d("All"),S=d([]),V=d(!1),x=d(!1),D=d(!1),v=d("view"),u=d(null),m=d({title:"",rationale:""}),A=E(()=>({pending:b.value.filter(s=>s.status==="Pending").length,draft:b.value.filter(s=>s.status==="Draft").length,toBeImplemented:b.value.filter(s=>s.status==="To be implemented").length,implemented:b.value.filter(s=>s.status==="Implemented").length,deleted:b.value.filter(s=>s.status==="Deleted").length})),R=E(()=>i.value==="All"?b.value.filter(s=>s.status!=="Deleted"):b.value.filter(s=>s.status===i.value));le(async()=>{await G()});const G=async()=>{try{const s=await p.get("/portfolios");C.value=s.data,C.value.length>0&&(c.value=C.value[0].id,f())}catch(s){console.error("Failed to fetch portfolios",s)}},Z=()=>{f()},f=async()=>{if(c.value){B.value=!0;try{const s=await p.get(`/decisions/portfolio/${c.value}`);b.value=s.data}catch(s){console.error(s)}finally{B.value=!1}}},q=async()=>{if(c.value){_.value=!0;try{await p.post(`/decisions/ai-recommendations/${c.value}`),await f(),i.value="Pending"}catch(s){alert("Failed to generate recommendations: "+(s.response?.data||s.message))}finally{_.value=!1}}},N=async()=>{if(c.value&&confirm("Generate retroactive decisions for existing history? This will create 'Implemented' decisions for past Buy/Sell transactions.")){k.value=!0;try{const s=await p.post(`/decisions/backfill/${c.value}`);alert(s.data.message),f()}catch(s){console.error(s),alert("Backfill failed: "+(s.response?.data?.message||s.message))}finally{k.value=!1}}},H=()=>{v.value="create",m.value={title:"",rationale:""},D.value=!0},O=s=>{u.value=s,v.value="view",x.value=!1,D.value=!0,J(s.id)},J=async s=>{V.value=!0;try{const t=await p.get(`/decisions/${s}/history`);S.value=t.data}catch(t){console.error("Failed to fetch history",t)}finally{V.value=!1}},K=s=>{u.value=s,m.value={title:s.title,rationale:s.rationale},v.value="edit",D.value=!0},F=async s=>{try{const t={portfolioId:c.value,title:m.value.title,rationale:m.value.rationale,saveAsDraft:s};v.value==="create"?await p.post("/decisions",t):await p.put(`/decisions/${u.value.id}`,t),I(),f()}catch(t){console.error(t),alert("Failed to save")}},Q=async s=>{confirm("Submit this decision for approval?")&&await $(`/decisions/${s}/submit`)},W=async s=>{await $(`/decisions/${s}/approve`)},X=async s=>{confirm("Reject this decision?")&&await $(`/decisions/${s}/reject`)},Y=async s=>{confirm("Mark this decision as implemented?")&&await $(`/decisions/${s}/implement`)},ee=async s=>{if(confirm("Are you sure you want to delete this decision? It will be moved to the Deleted tab."))try{await p.delete(`/decisions/${s}`),f()}catch(t){console.error(t),alert("Delete failed")}},$=async s=>{try{await p.put(s),f()}catch(t){console.error(t),alert("Action failed")}},I=()=>{D.value=!1,u.value=null,m.value={title:"",rationale:""}},P=s=>new Date(s).toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"}),te=(s,t)=>s&&s.length>t?s.substring(0,t)+"...":s,z=s=>{switch(s){case"Approved":return"badge-success";case"To be implemented":return"badge-primary";case"Implemented":return"badge-success";case"Rejected":return"badge-danger";case"Draft":return"badge-muted";case"Deleted":return"badge-danger";default:return"badge-warning"}};return(s,t)=>(a(),n("div",ie,[e("div",de,[t[14]||(t[14]=e("div",null,[e("h1",null,"Decisions"),e("p",{class:"text-muted"},"Track, approve, and implement portfolio decisions")],-1)),e("div",re,[e("div",ce,[T(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>c.value=l),onChange:Z,class:"portfolio-select"},[t[11]||(t[11]=e("option",{value:null,disabled:""},"Select Portfolio",-1)),(a(!0),n(g,null,M(C.value,l=>(a(),n("option",{key:l.id,value:l.id},o(l.name),9,ue))),128))],544),[[ne,c.value]]),t[12]||(t[12]=e("svg",{class:"select-icon",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m6 9 6 6 6-6"})],-1))]),e("button",{onClick:H,class:"btn btn-primary",disabled:!c.value},[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 5v14M5 12h14"})],-1),w(" New Decision ",-1)])],8,ve)])]),c.value?(a(),n("div",pe,[e("div",be,[e("div",{class:y(["stat-badge pending",{active:i.value==="Pending"}]),onClick:t[1]||(t[1]=l=>i.value="Pending")},[e("span",fe,o(A.value.pending),1),t[16]||(t[16]=e("span",{class:"label"},"Pending",-1))],2),e("div",{class:y(["stat-badge draft",{active:i.value==="Draft"}]),onClick:t[2]||(t[2]=l=>i.value="Draft")},[e("span",he,o(A.value.draft),1),t[17]||(t[17]=e("span",{class:"label"},"Drafts",-1))],2),e("div",{class:y(["stat-badge to-be-implemented",{active:i.value==="To be implemented"}]),onClick:t[3]||(t[3]=l=>i.value="To be implemented")},[e("span",ge,o(A.value.toBeImplemented),1),t[18]||(t[18]=e("span",{class:"label"},"Ready to Implement",-1))],2),e("div",{class:y(["stat-badge implemented",{active:i.value==="Implemented"}]),onClick:t[4]||(t[4]=l=>i.value="Implemented")},[e("span",ye,o(A.value.implemented),1),t[19]||(t[19]=e("span",{class:"label"},"Implemented",-1))],2)]),e("div",ke,[e("div",we,[(a(),n(g,null,M(["All","Pending","Draft","To be implemented","Implemented","Rejected","Deleted"],l=>e("button",{key:l,class:y(["tab",{active:i.value===l}]),onClick:h=>i.value=l},o(l),11,_e)),64))]),e("div",xe,[e("button",{onClick:N,class:"btn btn-ghost btn-sm",disabled:k.value},[k.value?(a(),n("span",Ce)):r("",!0),t[20]||(t[20]=w(" Sync History ",-1))],8,De),e("button",{onClick:q,class:"btn btn-secondary btn-sm",disabled:_.value},[_.value?(a(),n("span",$e)):(a(),n("svg",Ie,[...t[21]||(t[21]=[e("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"},null,-1)])])),t[22]||(t[22]=w(" AI Recommendations ",-1))],8,Ae)])]),B.value?(a(),n("div",Me,[j(L,{size:"lg",text:"Loading Decisions..."})])):r("",!0),_.value?(a(),n("div",Be,[e("div",Se,[j(L,{size:"lg",text:"AI is Analyzing Market Opportunities..."})])])):R.value.length===0?(a(),n("div",Ve,[t[24]||(t[24]=e("p",null,"No decisions found for this filter.",-1)),e("div",Pe,[i.value==="Draft"||i.value==="All"?(a(),n("button",{key:0,onClick:H,class:"btn btn-primary"},"Create First Draft")):r("",!0),i.value==="All"||i.value==="Implemented"?(a(),n("button",{key:1,onClick:N,class:"btn btn-secondary",disabled:k.value},[k.value?(a(),n("span",je)):r("",!0),t[23]||(t[23]=w(" Generate from History ",-1))],8,Te)):r("",!0)])])):(a(),n("div",Le,[e("table",Re,[t[26]||(t[26]=e("thead",null,[e("tr",null,[e("th",null,"Date"),e("th",null,"Decision"),e("th",null,"Type"),e("th",null,"Status"),e("th",{class:"text-right"},"Actions")])],-1)),e("tbody",null,[(a(!0),n(g,null,M(R.value,l=>(a(),n("tr",{key:l.id},[e("td",null,o(P(l.createdAt)),1),e("td",null,[e("div",Ne,o(l.title||"Untitled"),1),e("div",He,o(te(l.rationale,80)),1)]),e("td",null,[e("span",Fe,[l.type==="AI"?(a(),n("svg",ze,[...t[25]||(t[25]=[e("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"},null,-1)])])):r("",!0),w(" "+o(l.type),1)])]),e("td",null,[e("span",{class:y(["badge",z(l.status)])},o(l.status),3)]),e("td",Ee,[e("div",Ue,[e("button",{onClick:h=>O(l),class:"btn btn-ghost btn-xs"},"View",8,Ge),l.status==="Draft"?(a(),n(g,{key:0},[e("button",{onClick:h=>K(l),class:"btn btn-secondary btn-xs"},"Edit",8,Ze),e("button",{onClick:h=>Q(l.id),class:"btn btn-primary btn-xs"},"Submit",8,qe)],64)):r("",!0),l.status==="Pending"?(a(),n(g,{key:1},[e("button",{onClick:h=>W(l.id),class:"btn btn-success btn-xs",title:"Approve"},"✓",8,Oe),e("button",{onClick:h=>X(l.id),class:"btn btn-danger-outline btn-xs",title:"Reject"},"✗",8,Je)],64)):r("",!0),l.status==="To be implemented"?(a(),n("button",{key:2,onClick:h=>Y(l.id),class:"btn btn-primary btn-xs"},"Mark Implemented",8,Ke)):r("",!0),l.status!=="Deleted"?(a(),n("button",{key:3,onClick:h=>ee(l.id),class:"btn btn-danger-outline btn-xs",title:"Soft Delete"},"Delete",8,Qe)):r("",!0)])])]))),128))])])]))])):(a(),n("div",me,[...t[15]||(t[15]=[ae('<div class="empty-icon-bg mb-md" data-v-406cf8bc><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-406cf8bc><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" data-v-406cf8bc></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" data-v-406cf8bc></polyline><line x1="12" y1="22.08" x2="12" y2="12" data-v-406cf8bc></line></svg></div><h3 data-v-406cf8bc>Select a Portfolio</h3><p data-v-406cf8bc>Please select a portfolio to view and manage decisions.</p>',3)])])),D.value?(a(),n("div",{key:2,class:"modal-backdrop",onClick:I},[e("div",{class:"modal card",onClick:t[10]||(t[10]=oe(()=>{},["stop"]))},[e("div",We,[e("h2",null,o(v.value==="create"?"New Decision":v.value==="edit"?"Edit Decision":"Decision Details"),1),e("button",{onClick:I,class:"btn-close"},"×")]),e("div",Xe,[v.value==="view"?(a(),n("div",Ye,[e("div",et,[e("div",tt,[e("span",{class:y(["badge",z(u.value.status)])},o(u.value.status),3),e("span",st,o(P(u.value.createdAt)),1)]),e("button",{onClick:t[5]||(t[5]=l=>x.value=!x.value),class:"btn btn-ghost btn-xs"},o(x.value?"View Details":"View History"),1)]),x.value?(a(),n("div",lt,[t[27]||(t[27]=e("h4",{class:"mb-sm"},"Decision History",-1)),V.value?(a(),n("div",nt,[j(L,{size:"sm"})])):S.value.length===0?(a(),n("div",at," No history recorded for this decision. ")):(a(),n("div",ot,[(a(!0),n(g,null,M(S.value,l=>(a(),n("div",{key:l.id,class:"history-item mb-sm border-bottom-subtle pb-xs"},[e("div",it,[e("span",dt,o(l.action),1),e("span",rt,o(P(l.timestamp)),1)]),e("p",ct,o(l.details),1),e("div",ut,"By: "+o(l.userEmail),1)]))),128))]))])):(a(),n("div",vt,[e("h3",mt,o(u.value.title),1),e("div",pt,[t[28]||(t[28]=e("label",null,"Rationale / Analysis",-1)),e("div",bt,o(u.value.rationale),1)]),u.value.type==="AI"?(a(),n("span",ft,[...t[29]||(t[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"})],-1),w(" AI Generated Recommendation ",-1)])])):r("",!0)]))])):(a(),n("div",ht,[e("div",gt,[t[30]||(t[30]=e("label",null,"Title",-1)),T(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>m.value.title=l),placeholder:"e.g. Rebalance Defensive Assets"},null,512),[[U,m.value.title]])]),e("div",yt,[t[31]||(t[31]=e("label",null,"Rationale",-1)),T(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>m.value.rationale=l),rows:"6",placeholder:"Explain the reasoning behind this decision..."},null,512),[[U,m.value.rationale]])])]))]),e("div",kt,[e("button",{onClick:I,class:"btn btn-secondary"},"Close"),v.value==="create"||v.value==="edit"?(a(),n(g,{key:0},[e("button",{onClick:t[8]||(t[8]=l=>F(!0)),class:"btn btn-secondary"},"Save Draft"),e("button",{onClick:t[9]||(t[9]=l=>F(!1)),class:"btn btn-primary"},"Submit for Approval")],64)):r("",!0)])])])):r("",!0)]))}},Ct=se(wt,[["__scopeId","data-v-406cf8bc"]]);export{Ct as default};
