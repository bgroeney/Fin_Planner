import{_ as K,k as T,f as Z,c as r,o as i,a as e,e as P,F as z,s as j,v as te,t as a,r as c,z as E,d as S,p as V,n as O,x as L,y as G,A as se,g as B,q as N,B as oe,w as W,m as Q,C as le,T as X,i as ae,l as ne,h as ie,D as re}from"./index-CajTN6Mj.js";import{M as de}from"./MoneyBoxLoader-C_1gdrvW.js";import{a as M,f as ue}from"./formatters-BT-Yo01K.js";const ce={key:0,class:"allocation-section"},ve={class:"chart-wrapper"},pe={class:"legend-wrapper"},me={class:"legend-label"},fe={class:"legend-value"},he={class:"legend-percent"},ge={key:1,class:"empty-state text-muted text-center"},ye={__name:"AllocationChart",props:{holdings:{type:Array,required:!0}},setup(x){const D=x,d=["#1e40af","#3b82f6","#60a5fa","#93c5fd","#2563eb","#1d4ed8","#dbeafe"],k=T(()=>{const s={};return D.holdings.forEach(y=>{const A=y.categoryName||"Uncategorized";s[A]=(s[A]||0)+y.currentValue}),Object.values(s)}),m=T(()=>k.value),h=T(()=>{const s={};return D.holdings.forEach(y=>{const A=y.categoryName||"Uncategorized";s[A]=(s[A]||0)+y.currentValue}),Object.keys(s)}),l=T(()=>k.value.reduce((s,y)=>s+y,0)),b=s=>l.value===0?"0":(k.value[s]/l.value*100).toFixed(1),g=s=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(s),_=T(()=>({labels:h.value,colors:d,chart:{type:"donut",fontFamily:"inherit"},plotOptions:{pie:{donut:{size:"75%",labels:{show:!0,name:{show:!1},value:{show:!1},total:{show:!0,label:"Total",fontSize:"12px",fontWeight:600,color:"var(--color-text-muted)",formatter:()=>g(l.value)}}}}},dataLabels:{enabled:!1},legend:{show:!1},stroke:{width:2,colors:["var(--color-bg-secondary)"]},tooltip:{y:{formatter:s=>g(s)}}}));return(s,y)=>{const A=Z("apexchart");return m.value.length>0?(i(),r("div",ce,[e("div",ve,[P(A,{type:"donut",height:"200",options:_.value,series:m.value},null,8,["options","series"])]),e("div",pe,[(i(!0),r(z,null,j(h.value,(F,C)=>(i(),r("div",{key:F,class:"legend-item"},[e("span",{class:"legend-dot",style:te({background:d[C%d.length]})},null,4),e("span",me,a(F),1),e("span",fe,a(g(k.value[C])),1),e("span",he,a(b(C))+"%",1)]))),128))])])):(i(),r("div",ge," No allocation data "))}}},be=K(ye,[["__scopeId","data-v-3fd051ec"]]),ke={key:0,class:"drawer-loading"},we={key:1,class:"drawer-error"},_e={key:2,class:"drawer-body"},xe={class:"drawer-header"},$e={class:"asset-info"},Ce={class:"asset-symbol"},Ie={class:"asset-name"},Ae={class:"asset-category"},De={class:"category-badge"},Se={class:"value-section"},Ve={class:"current-value"},Me={class:"chart-section"},Oe={class:"actions-section"},Te={key:0,class:"action-buttons"},Fe={key:1,class:"decision-form card"},Be={class:"form-title"},Ne={class:"form-group"},Pe={key:0,class:"form-group"},Le={key:0,class:"tax-hint"},Ue={class:"form-group"},ze={class:"form-actions"},je=["disabled"],Re={class:"stats-section"},He={class:"stats-grid"},qe={class:"stat-item"},Ee={class:"stat-value"},Ge={class:"stat-item"},Ke={class:"stat-value"},We={class:"stat-item"},Qe={class:"stat-value"},Ze={class:"stat-item"},Je={class:"transactions-section"},Xe={class:"transactions-list"},Ye={key:0,class:"transactions-loading"},et={key:1,class:"transactions-empty"},tt={class:"tx-date"},st={class:"tx-type"},ot={class:"tx-units"},lt={class:"tx-amount"},at={__name:"AssetDetailDrawer",props:{isOpen:Boolean,portfolioId:String,assetId:String,embedded:{type:Boolean,default:!1}},emits:["close"],setup(x,{emit:D}){const d=x,k=D,m=c(!1),h=c(!1),l=c(null),b=c([]),g=c([]),_=c(!1),s=c(1),y=c(!0),A=u=>{const o=b.value.find(q=>q.id===u);return o?o.name:"Uncategorized"},F=async()=>{if(d.portfolioId)try{const u=await N.get(`/portfolios/${d.portfolioId}`);b.value=u.data.targetAllocation?.map(o=>({id:o.id,name:o.name}))||[]}catch(u){console.error(u)}},C=async()=>{if(!(!d.portfolioId||!d.assetId)){m.value=!0,h.value=!1,g.value=[],s.value=1,y.value=!0;try{const u=await N.get(`/portfolios/${d.portfolioId}/assets/${d.assetId}/details`);l.value=u.data,m.value=!1,await U()}catch(u){console.error(u),h.value=!0,m.value=!1}}},U=async()=>{if(!(!d.portfolioId||!d.assetId||_.value||!y.value)){_.value=!0;try{const u=await N.get(`/portfolios/${d.portfolioId}/assets/${d.assetId}/transactions?page=${s.value}&pageSize=20`);u.data.length<20&&(y.value=!1),g.value.push(...u.data),s.value++}catch(u){console.error("Failed to load transactions",u)}finally{_.value=!1}}},R=u=>{const{scrollTop:o,clientHeight:q,scrollHeight:w}=u.target;w-o<=q+50&&U()};E(()=>d.isOpen,u=>{u&&(C(),F())},{immediate:!0}),E(()=>d.assetId,u=>{d.isOpen&&u&&C()});const $=T(()=>[{name:"Value",data:l.value?.history?.map(u=>({x:new Date(u.date).getTime(),y:u.value}))||[]}]),p=c(!1),n=c("Buy"),t=c(0),v=c(""),f=c("FIFO"),I=c(null),H=c(!1),J=u=>{n.value=u,p.value=!0,t.value=0,v.value="",f.value="FIFO",I.value=null};E([t,f],async()=>{n.value==="Sell"&&t.value>0});const Y=async()=>{if(!(!d.portfolioId||!t.value)){H.value=!0;try{await N.post("/decisions",{portfolioId:d.portfolioId,title:`${n.value} ${t.value} ${l.value.symbol}`,rationale:v.value||`${n.value} decision for ${l.value.symbol}`,allocationMethod:n.value==="Sell"?f.value:null,saveAsDraft:!1}),p.value=!1,C(),k("updated")}catch(u){console.error(u),alert("Failed to create decision")}finally{H.value=!1}}},ee=T(()=>({chart:{type:"area",toolbar:{show:!1},sparkline:{enabled:!1},fontFamily:"inherit"},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2,colors:["var(--color-accent)"]},xaxis:{type:"datetime",labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{show:!1},grid:{show:!1},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.3,opacityTo:.05,stops:[0,100]}},tooltip:{x:{format:"dd MMM yyyy"},y:{formatter:u=>M(u)}},colors:["var(--color-accent)"]}));return(u,o)=>{const q=Z("apexchart");return x.isOpen?(i(),r("div",{key:0,class:O(["asset-drawer",{"is-overlay":!x.embedded}])},[x.embedded?S("",!0):(i(),r("div",{key:0,class:"drawer-backdrop",onClick:o[0]||(o[0]=w=>u.$emit("close"))})),e("div",{class:O(["drawer-content",{"overlay-mode":!x.embedded}])},[m.value?(i(),r("div",ke,[P(de,{size:"lg",text:"Loading Asset Data..."})])):h.value?(i(),r("div",we,[o[8]||(o[8]=e("p",null,"Failed to load asset details",-1)),e("button",{onClick:C,class:"btn btn-secondary"},"Retry")])):l.value?(i(),r("div",_e,[e("div",xe,[e("div",$e,[e("div",Ce,a(l.value.symbol),1),e("div",Ie,a(l.value.name),1),e("div",Ae,[e("span",De,a(A(l.value.categoryId)),1)])]),e("button",{onClick:o[1]||(o[1]=w=>u.$emit("close")),class:"btn-close",title:"Close"},[...o[9]||(o[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",Se,[e("div",Ve,a(V(M)(l.value.position.currentValue)),1),e("div",{class:O(["return-badge",{positive:l.value.position.returnPercent>=0,negative:l.value.position.returnPercent<0}])},a(l.value.position.returnPercent>=0?"+":"")+a(l.value.position.returnPercent.toFixed(2))+"% ",3)]),e("div",Me,[P(q,{type:"area",height:"160",options:ee.value,series:$.value},null,8,["options","series"])]),e("div",Oe,[p.value?(i(),r("div",Fe,[e("h4",Be,a(n.value)+" "+a(l.value.symbol),1),e("div",Ne,[o[10]||(o[10]=e("label",null,"Units",-1)),L(e("input",{"onUpdate:modelValue":o[4]||(o[4]=w=>t.value=w),type:"number",class:"form-input",placeholder:"0"},null,512),[[G,t.value,void 0,{number:!0}]])]),n.value==="Sell"?(i(),r("div",Pe,[o[12]||(o[12]=e("label",null,"Tax Optimization Method",-1)),L(e("select",{"onUpdate:modelValue":o[5]||(o[5]=w=>f.value=w),class:"form-select"},[...o[11]||(o[11]=[e("option",{value:"FIFO"},"First-In-First-Out (Standard)",-1),e("option",{value:"MinTax"},"Minimize Tax (High Cost/Long Term)",-1),e("option",{value:"MaxGain"},"Maximize Gain (Low Cost)",-1)])],512),[[se,f.value]]),I.value!==null?(i(),r("div",Le," Projected Taxable Gain: "+a(V(M)(I.value)),1)):S("",!0)])):S("",!0),e("div",Ue,[o[13]||(o[13]=e("label",null,"Rationale",-1)),L(e("textarea",{"onUpdate:modelValue":o[6]||(o[6]=w=>v.value=w),class:"form-input",rows:"2",placeholder:"Why make this trade?"},null,512),[[G,v.value]])]),e("div",ze,[e("button",{onClick:o[7]||(o[7]=w=>p.value=!1),class:"btn btn-secondary"},"Cancel"),e("button",{onClick:Y,class:"btn btn-primary",disabled:H.value},a(H.value?"Saving...":"Create Decision"),9,je)])])):(i(),r("div",Te,[e("button",{onClick:o[2]||(o[2]=w=>J("Buy")),class:"btn btn-success flex-1"},"Buy"),e("button",{onClick:o[3]||(o[3]=w=>J("Sell")),class:"btn btn-danger flex-1"},"Sell")]))]),e("div",Re,[o[18]||(o[18]=e("h4",{class:"section-title"},"Position Details",-1)),e("div",He,[e("div",qe,[o[14]||(o[14]=e("span",{class:"stat-label"},"Units",-1)),e("span",Ee,a(l.value.position.units.toLocaleString()),1)]),e("div",Ge,[o[15]||(o[15]=e("span",{class:"stat-label"},"Avg Cost",-1)),e("span",Ke,a(V(M)(Math.abs(l.value.position.avgCost))),1)]),e("div",We,[o[16]||(o[16]=e("span",{class:"stat-label"},"Total Cost",-1)),e("span",Qe,a(V(M)(Math.abs(l.value.position.totalCost))),1)]),e("div",Ze,[o[17]||(o[17]=e("span",{class:"stat-label"},"P&L",-1)),e("span",{class:O(["stat-value",{"text-success":l.value.position.profitLoss>=0,"text-danger":l.value.position.profitLoss<0}])},a(V(M)(l.value.position.profitLoss)),3)])])]),e("div",Je,[o[20]||(o[20]=e("h4",{class:"section-title"},"Transaction History",-1)),e("div",Xe,[_.value&&g.value.length===0?(i(),r("div",Ye,[...o[19]||(o[19]=[e("div",{class:"spinner-sm"},null,-1),B(" Loading transactions... ",-1)])])):g.value.length===0?(i(),r("div",et," No transactions found ")):(i(),r("div",{key:2,class:"transaction-items",onScroll:R},[(i(!0),r(z,null,j(g.value,w=>(i(),r("div",{key:w.id,class:"transaction-item"},[e("div",tt,a(V(ue)(w.date)),1),e("div",st,[e("span",{class:O(["tx-badge",w.type.toLowerCase()])},a(w.type),3)]),e("div",ot,a(w.units.toLocaleString()),1),e("div",lt,a(V(M)(Math.abs(w.cost||w.value))),1)]))),128))],32))])])])):S("",!0)],2)],2)):S("",!0)}}},nt=K(at,[["__scopeId","data-v-b2797ae5"]]),it={class:"modal card danger-modal"},rt={class:"modal-body"},dt={class:"warning-text"},ut={class:"confirmation-section"},ct={for:"confirmInput"},vt={class:"highlight"},pt=["placeholder"],mt={class:"modal-footer"},ft=["disabled"],ht={key:0,class:"spinner"},gt={__name:"ConfirmDeleteModal",props:{isOpen:Boolean,portfolioName:{type:String,required:!0}},emits:["cancel","confirm"],setup(x,{emit:D}){const d=x,k=D,m=c(""),h=c(!1),l=T(()=>m.value.trim()===d.portfolioName);E(()=>d.isOpen,_=>{_||(m.value="",h.value=!1)});const b=()=>{k("cancel")},g=()=>{!l.value||h.value||(h.value=!0,k("confirm"))};return(_,s)=>(i(),oe(X,{name:"modal"},{default:W(()=>[x.isOpen?(i(),r("div",{key:0,class:"modal-backdrop",onClick:Q(b,["self"])},[e("div",it,[e("div",{class:"modal-header"},[s[3]||(s[3]=e("div",{class:"danger-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})])],-1)),s[4]||(s[4]=e("h2",null,"Delete Portfolio",-1)),e("button",{onClick:b,class:"btn-close","aria-label":"Close"},[...s[2]||(s[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",rt,[e("p",dt,[s[5]||(s[5]=B(" This action ",-1)),s[6]||(s[6]=e("strong",null,"cannot be undone",-1)),s[7]||(s[7]=B(". This will permanently delete the ",-1)),e("strong",null,a(x.portfolioName),1),s[8]||(s[8]=B(" portfolio and all associated data. ",-1))]),s[11]||(s[11]=e("div",{class:"deletion-summary"},[e("h4",null,"The following will be permanently deleted:"),e("ul",null,[e("li",null,"All accounts and their settings"),e("li",null,"All holdings and position history"),e("li",null,"All transaction records"),e("li",null,"All asset categories and allocations"),e("li",null,"All decisions and recommendations"),e("li",null,"All performance snapshots")])],-1)),e("div",ut,[e("label",ct,[s[9]||(s[9]=B(" To confirm, type ",-1)),e("strong",vt,a(x.portfolioName),1),s[10]||(s[10]=B(" below: ",-1))]),L(e("input",{id:"confirmInput","onUpdate:modelValue":s[0]||(s[0]=y=>m.value=y),type:"text",class:"input confirm-input",placeholder:`Type ${x.portfolioName} to confirm`,autocomplete:"off",onKeyup:s[1]||(s[1]=le(y=>l.value&&g(),["enter"]))},null,40,pt),[[G,m.value]])])]),e("div",mt,[e("button",{onClick:b,class:"btn btn-secondary"},"Cancel"),e("button",{onClick:g,class:"btn btn-danger",disabled:!l.value||h.value},[h.value?(i(),r("span",ht)):S("",!0),B(" "+a(h.value?"Deleting...":"Delete this portfolio"),1)],8,ft)])])])):S("",!0)]),_:1}))}},yt=K(gt,[["__scopeId","data-v-cedc7de3"]]),bt={class:"modal card p-xl slide-in"},kt={class:"form-group mb-lg"},wt={class:"form-group mb-xl"},_t={class:"relative"},xt={key:0,class:"dropdown-list"},$t=["onClick"],Ct={class:"font-bold"},It={key:0,class:"mt-sm p-sm bg-gray-50 flex-between border-radius text-sm"},At={class:"font-bold text-primary"},Dt={class:"text-muted ml-sm"},St={class:"flex-end gap-md"},Vt=["disabled"],Mt={class:"danger-zone"},Ot={class:"danger-content"},Tt={__name:"PortfolioSettingsModal",props:["isOpen","portfolio"],emits:["close","updated","deleted"],setup(x,{emit:D}){const d=x,k=D,m=c({name:"",benchmarkAssetId:null}),h=c(""),l=c([]),b=c(null),g=c(!1),_=c(!1);let s=null;E(()=>d.isOpen,$=>{$&&d.portfolio&&(m.value.name=d.portfolio.name,m.value.benchmarkAssetId=d.portfolio.benchmarkAssetId,d.portfolio.benchmarkAssetId&&d.portfolio.benchmarkSymbol?b.value={id:d.portfolio.benchmarkAssetId,symbol:d.portfolio.benchmarkSymbol,name:"Benchmark Asset"}:b.value=null,h.value="",l.value=[])});const y=async()=>{if(!h.value){l.value=[];return}clearTimeout(s),s=setTimeout(async()=>{try{const $=await N.get(`/assets?query=${h.value}`);l.value=$.data}catch($){console.error($)}},300)},A=$=>{b.value=$,m.value.benchmarkAssetId=$.id,l.value=[],h.value=""},F=()=>{b.value=null,m.value.benchmarkAssetId=null},C=()=>k("close"),U=async()=>{g.value=!0;try{await N.put(`/portfolios/${d.portfolio.id}`,{name:m.value.name,benchmarkAssetId:m.value.benchmarkAssetId}),k("updated"),C()}catch($){console.error($),alert("Failed to save settings")}finally{g.value=!1}},R=async()=>{try{await N.delete(`/portfolios/${d.portfolio.id}`),_.value=!1,k("deleted"),C()}catch($){console.error("Failed to delete portfolio:",$),alert("Failed to delete portfolio. Please try again."),_.value=!1}};return($,p)=>x.isOpen?(i(),r("div",{key:0,class:"modal-backdrop",onClick:Q(C,["self"])},[e("div",bt,[e("div",{class:"flex-between mb-lg"},[p[4]||(p[4]=e("h2",null,"Portfolio Settings",-1)),e("button",{onClick:C,class:"btn-icon"},"Ã—")]),e("form",{onSubmit:Q(U,["prevent"])},[e("div",kt,[p[5]||(p[5]=e("label",{class:"block mb-sm text-sm font-bold text-muted"},"Portfolio Name",-1)),L(e("input",{"onUpdate:modelValue":p[0]||(p[0]=n=>m.value.name=n),type:"text",class:"input w-full",required:""},null,512),[[G,m.value.name]])]),e("div",wt,[p[6]||(p[6]=e("label",{class:"block mb-sm text-sm font-bold text-muted"},"Benchmark Index",-1)),p[7]||(p[7]=e("p",{class:"text-xs text-muted mb-sm"},"Select an asset to compare your portfolio against (e.g. VAS, IVV).",-1)),e("div",_t,[L(e("input",{"onUpdate:modelValue":p[1]||(p[1]=n=>h.value=n),onInput:y,type:"text",class:"input w-full",placeholder:"Search for an index (e.g. VAS)..."},null,544),[[G,h.value]]),l.value.length>0?(i(),r("div",xt,[(i(!0),r(z,null,j(l.value,n=>(i(),r("div",{key:n.id,class:"dropdown-item",onClick:t=>A(n)},[e("span",Ct,a(n.symbol),1),B(" - "+a(n.name),1)],8,$t))),128))])):S("",!0)]),b.value?(i(),r("div",It,[e("div",null,[e("span",At,a(b.value.symbol),1),e("span",Dt,a(b.value.name),1)]),e("button",{type:"button",onClick:F,class:"text-danger text-xs hover:underline"},"Remove")])):S("",!0)]),e("div",St,[e("button",{type:"button",onClick:C,class:"btn btn-secondary"},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:g.value},a(g.value?"Saving...":"Save Changes"),9,Vt)])],32),e("div",Mt,[p[9]||(p[9]=e("h3",{class:"danger-title"},"Danger Zone",-1)),e("div",Ot,[p[8]||(p[8]=e("div",{class:"danger-info"},[e("strong",null,"Delete this portfolio"),e("p",null,"Once deleted, this portfolio and all its data cannot be recovered.")],-1)),e("button",{type:"button",onClick:p[2]||(p[2]=n=>_.value=!0),class:"btn btn-danger-outline"}," Delete Portfolio ")])])]),P(yt,{isOpen:_.value,portfolioName:x.portfolio?.name||"",onCancel:p[3]||(p[3]=n=>_.value=!1),onConfirm:R},null,8,["isOpen","portfolioName"])])):S("",!0)}},Ft=K(Tt,[["__scopeId","data-v-7aae9440"]]),Bt={key:0,class:"portfolio-detail animate-fade-in"},Nt={class:"page-header"},Pt={class:"header-info"},Lt={class:"title-row"},Ut={key:0,class:"benchmark-badge"},zt={class:"text-muted"},jt={class:"controls-bar"},Rt={class:"tabs"},Ht=["onClick"],qt={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Et={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Gt={class:"allocation-section"},Kt={class:"total-value"},Wt={class:"allocation-chart"},Qt={class:"holdings-table card"},Zt={class:"group-row"},Jt={colspan:"5"},Xt=["onClick"],Yt={class:"col-name"},es={class:"holding-name"},ts={class:"holding-symbol"},ss={class:"col-num"},os={class:"col-num"},ls={class:"col-num font-bold"},as={class:"col-num"},ns={key:0,class:"side-panel"},is={key:1,class:"loading-state"},rs={__name:"PortfolioDetailView",setup(x){const D=ne(),d=ie(),k=c(null),m=c([]),h=c([]),l=c(null),b=c(!1),g=c(!1),_=c(!1),s=c(null),y=c(!0),A=T(()=>{let n=[];if(l.value)n=h.value.filter(t=>t.accountId===l.value);else{const t=new Map;for(const v of h.value){t.has(v.assetId)||t.set(v.assetId,{...v,units:0,currentValue:0,totalCost:0});const f=t.get(v.assetId);f.units+=v.units,f.currentValue+=v.currentValue,f.totalCost+=v.units*v.avgCost}n=Array.from(t.values()).map(v=>({...v,avgCost:v.units!==0?v.totalCost/v.units:0}))}return b.value||(n=n.filter(t=>Math.abs(t.units)>1e-4)),n}),F=T(()=>A.value.reduce((n,t)=>n+t.currentValue,0)),C=T(()=>{const n={};for(const t of A.value){const v=t.categoryName||"Uncategorized";n[v]||(n[v]={name:v,holdings:[],totalValue:0}),n[v].holdings.push(t),n[v].totalValue+=t.currentValue}return Object.values(n).sort((t,v)=>v.totalValue-t.totalValue)}),U=n=>{s.value=n,g.value=!0,y.value=!1},R=()=>{g.value=!1,s.value=null},$=async()=>{try{const n=await N.get(`/portfolios/${D.params.id}`);k.value=n.data;const t=await N.get(`/accounts/portfolio/${D.params.id}`);m.value=t.data;const v=await N.get(`/holdings/portfolio/${D.params.id}`);h.value=v.data}catch(n){console.error(n)}},p=()=>{d.push("/portfolios")};return ae($),(n,t)=>{const v=Z("router-link");return k.value?(i(),r("div",Bt,[e("div",Nt,[e("div",Pt,[e("div",Lt,[e("h1",null,a(k.value.name),1),e("button",{onClick:t[0]||(t[0]=f=>_.value=!0),class:"btn-icon",title:"Edit Portfolio"},[...t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])]),k.value.benchmarkSymbol?(i(),r("span",Ut,"vs "+a(k.value.benchmarkSymbol),1)):S("",!0)]),e("p",zt,a(m.value.length)+" accounts connected",1)]),P(v,{to:"/import",class:"btn btn-secondary"},{default:W(()=>[...t[6]||(t[6]=[B("Import Data",-1)])]),_:1})]),e("div",jt,[e("div",Rt,[e("button",{class:O(["tab",{active:!l.value}]),onClick:t[1]||(t[1]=f=>l.value=null)},"All Accounts",2),(i(!0),r(z,null,j(m.value,f=>(i(),r("button",{key:f.id,class:O(["tab",{active:l.value===f.id}]),onClick:I=>l.value=f.id},a(f.accountName||f.accountNumber),11,Ht))),128))]),e("button",{class:O(["toggle-btn",{active:b.value}]),onClick:t[2]||(t[2]=f=>b.value=!b.value)},[b.value?(i(),r("svg",qt,[...t[7]||(t[7]=[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1),e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)])])):(i(),r("svg",Et,[...t[8]||(t[8]=[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},null,-1)])])),t[9]||(t[9]=B(" Show Closed ",-1))],2)]),e("div",Gt,[e("button",{onClick:t[3]||(t[3]=f=>y.value=!y.value),class:"section-header"},[e("span",{class:O(["chevron",{expanded:y.value}])},[...t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"9 18 15 12 9 6"})],-1)])],2),t[11]||(t[11]=e("span",null,"Allocation",-1)),e("span",Kt,a(V(M)(F.value)),1)]),P(X,{name:"collapse"},{default:W(()=>[L(e("div",Wt,[P(be,{holdings:A.value},null,8,["holdings"])],512),[[re,y.value]])]),_:1})]),e("div",{class:O(["split-layout",{"panel-open":g.value}])},[e("div",Qt,[e("table",null,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",{class:"col-name"},"Name"),e("th",{class:"col-num"},"Units"),e("th",{class:"col-num"},"Price"),e("th",{class:"col-num"},"Value"),e("th",{class:"col-num"},"Alloc")])],-1)),(i(!0),r(z,null,j(C.value,f=>(i(),r("tbody",{key:f.name},[e("tr",Zt,[e("td",Jt,a(f.name)+" ("+a(V(M)(f.totalValue))+")",1)]),(i(!0),r(z,null,j(f.holdings,I=>(i(),r("tr",{key:I.id,class:O(["holding-row",{selected:s.value===I.assetId}]),onClick:H=>U(I.assetId)},[e("td",Yt,[e("div",es,a(I.name),1),e("div",ts,a(I.symbol),1)]),e("td",ss,a(I.units.toLocaleString("en-AU",{maximumFractionDigits:4})),1),e("td",os,a(I.units!==0?V(M)(I.currentValue/I.units):"-"),1),e("td",ls,a(V(M)(I.currentValue)),1),e("td",as,a(F.value?(I.currentValue/F.value*100).toFixed(1):"0")+"%",1)],10,Xt))),128))]))),128))])]),g.value?(i(),r("div",ns,[P(nt,{isOpen:g.value,portfolioId:k.value?.id,assetId:s.value,embedded:!0,onClose:R},null,8,["isOpen","portfolioId","assetId"])])):S("",!0)],2),P(Ft,{isOpen:_.value,portfolio:k.value,onClose:t[4]||(t[4]=f=>_.value=!1),onUpdated:$,onDeleted:p},null,8,["isOpen","portfolio"])])):(i(),r("div",is,"Loading Portfolio..."))}}},vs=K(rs,[["__scopeId","data-v-d240a6fa"]]);export{vs as default};
