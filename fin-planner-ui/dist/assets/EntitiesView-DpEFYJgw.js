import{_ as K,w as Q,x as W,o,c as a,a as t,F as B,e as g,l as P,d as X,j as Y,f as k,i as U,m as w,p as r,v as d,C as F,q as I,t as i,G as R,z as Z,s as h,g as v,r as tt,h as et,n as st,k as ot}from"./index-oVbs5Hxd.js";import{usePortfolioStore as nt}from"./portfolio-CjZnfIUI.js";import{f as at}from"./formatters-DwG4QyEz.js";const lt={class:"entities-view animate-fade-in"},it={key:0,class:"loader-container"},rt={class:"entity-grid"},ut={class:"entity-section"},dt={key:0,class:"empty-card card"},vt={key:1,class:"entity-cards"},pt=["onClick"],mt={class:"entity-avatar person-avatar"},ct={class:"entity-info"},yt={class:"entity-meta"},ft={key:0},bt={class:"entity-section"},gt={key:0,class:"empty-card card"},kt={key:1,class:"entity-cards"},wt=["onClick"],ht={class:"entity-avatar trust-avatar"},xt={class:"entity-info"},Ct={class:"entity-meta"},Nt={class:"trust-type"},Tt={class:"entity-section"},Bt={key:0,class:"empty-card card"},Mt={key:1,class:"entity-cards"},At=["onClick"],Vt={class:"entity-avatar company-avatar"},_t={class:"entity-info"},Pt={class:"entity-meta"},Ut={class:"company-rate"},Rt={key:0,class:"loan-warning"},$t={key:0,class:"optimization-cta card"},Ft={class:"modal-card"},It={class:"modal-header"},Dt={class:"form-group"},St={class:"form-group"},Et={class:"form-group"},Ht={class:"form-group"},jt={class:"checkbox-label"},qt={class:"modal-actions"},zt=["disabled"],Ot={class:"modal-card"},Lt={class:"modal-header"},Gt={class:"form-group"},Jt={class:"form-group"},Kt={class:"form-group"},Qt={class:"form-group"},Wt={class:"modal-actions"},Xt=["disabled"],Yt={class:"modal-card"},Zt={class:"modal-header"},te={class:"form-group"},ee={class:"form-group"},se={class:"form-group"},oe={class:"form-group"},ne={class:"checkbox-label"},ae={class:"form-row"},le={class:"form-group"},ie={class:"form-group"},re={class:"form-group"},ue={class:"modal-actions"},de=["disabled"],ve={__name:"EntitiesView",setup(pe){const M=et(),D=nt(),x=v(!0),u=v(!1),N=v([]),T=v([]),A=v([]),c=Z(()=>D.currentPortfolioId),y=v(!1),f=v(!1),b=v(!1),p=v({fullName:"",dateOfBirth:"",marginalTaxRate:.325,hasPrivateHealthInsurance:!1}),m=v({trustName:"",abn:"",trusteeName:"",trustType:"Discretionary"}),l=v({companyName:"",abn:"",acn:"",isBaseRateEntity:!0,retainedProfits:0,frankingAccountBalance:0,incorporationDate:""}),V=n=>{if(!n)return"?";const e=n.split(" ");return e.length>=2?e[0][0]+e[1][0]:n.substring(0,2).toUpperCase()},S=n=>n<=.19?"tax-low":n<=.325?"tax-medium":"tax-high",C=async()=>{if(!c.value){x.value=!1;return}x.value=!0;try{const[n,e,_]=await Promise.all([h.get(`/persons?portfolioId=${c.value}`),h.get(`/trusts?portfolioId=${c.value}`),h.get(`/companies?portfolioId=${c.value}`)]);N.value=n.data,T.value=e.data,A.value=_.data}catch(n){console.error("Failed to load entities",n)}finally{x.value=!1}},E=()=>{p.value={fullName:"",dateOfBirth:"",marginalTaxRate:.325,hasPrivateHealthInsurance:!1},y.value=!0},H=()=>{m.value={trustName:"",abn:"",trusteeName:"",trustType:"Discretionary"},f.value=!0},j=()=>{l.value={companyName:"",abn:"",acn:"",isBaseRateEntity:!0,retainedProfits:0,frankingAccountBalance:0,incorporationDate:""},b.value=!0},q=async()=>{u.value=!0;try{await h.post("/persons",{portfolioId:c.value,...p.value}),y.value=!1,await C()}catch(n){console.error("Failed to create person",n),alert("Failed to create person")}finally{u.value=!1}},z=async()=>{u.value=!0;try{await h.post("/trusts",{portfolioId:c.value,...m.value}),f.value=!1,await C()}catch(n){console.error("Failed to create trust",n),alert("Failed to create trust")}finally{u.value=!1}},O=async()=>{u.value=!0;try{await h.post("/companies",{portfolioId:c.value,...l.value}),b.value=!1,await C()}catch(n){console.error("Failed to create company",n),alert("Failed to create company")}finally{u.value=!1}},L=n=>{M.push(`/entities/person/${n.id}`)},G=n=>{M.push(`/entities/trust/${n.id}`)},J=n=>{M.push(`/entities/company/${n.id}`)};return Q(c,()=>{C()}),W(()=>{c.value?C():x.value=!1}),(n,e)=>{const _=tt("router-link");return o(),a("div",lt,[e[56]||(e[56]=t("div",{class:"header-row"},[t("div",{class:"header-content"},[t("h1",null,"Entity Structure"),t("p",{class:"subtitle"},"Manage family members, trusts, and companies for tax planning")])],-1)),x.value?(o(),a("div",it,[...e[24]||(e[24]=[t("div",{class:"spinner"},null,-1)])])):(o(),a(B,{key:1},[t("div",rt,[t("div",ut,[t("div",{class:"section-header"},[e[25]||(e[25]=t("h2",null,[t("svg",{class:"section-icon",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),t("circle",{cx:"12",cy:"7",r:"4"})]),g(" Family Members ")],-1)),t("button",{class:"btn btn-primary btn-sm",onClick:E}," + Add Person ")]),N.value.length===0?(o(),a("div",dt,[...e[26]||(e[26]=[t("p",null,"No family members added yet.",-1)])])):(o(),a("div",vt,[(o(!0),a(B,null,P(N.value,s=>(o(),a("div",{key:s.id,class:"entity-card card",onClick:$=>L(s)},[t("div",mt,i(V(s.fullName)),1),t("div",ct,[t("h3",null,i(s.fullName),1),t("div",yt,[t("span",{class:st(["tax-rate",S(s.marginalTaxRate)])},i((s.marginalTaxRate*100).toFixed(0))+"% marginal ",3),s.superAccounts?.length?(o(),a("span",ft,i(s.superAccounts.length)+" super account(s) ",1)):k("",!0)])]),e[27]||(e[27]=t("svg",{class:"entity-arrow",xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"9 18 15 12 9 6"})],-1))],8,pt))),128))]))]),t("div",bt,[t("div",{class:"section-header"},[e[28]||(e[28]=t("h2",null,[t("svg",{class:"section-icon",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M3 21h18M3 10h18M5 6l7-3 7 3M4 10v11M20 10v11M8 14v3M12 14v3M16 14v3"})]),g(" Trusts ")],-1)),t("button",{class:"btn btn-primary btn-sm",onClick:H}," + Add Trust ")]),T.value.length===0?(o(),a("div",gt,[...e[29]||(e[29]=[t("p",null,"No trusts added yet.",-1)])])):(o(),a("div",kt,[(o(!0),a(B,null,P(T.value,s=>(o(),a("div",{key:s.id,class:"entity-card card",onClick:$=>G(s)},[t("div",ht,i(V(s.trustName)),1),t("div",xt,[t("h3",null,i(s.trustName),1),t("div",Ct,[t("span",Nt,i(s.trustType),1),t("span",null,i(s.beneficiaries?.length||0)+" beneficiaries",1)])]),e[30]||(e[30]=t("svg",{class:"entity-arrow",xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"9 18 15 12 9 6"})],-1))],8,wt))),128))]))]),t("div",Tt,[t("div",{class:"section-header"},[e[31]||(e[31]=t("h2",null,[t("svg",{class:"section-icon",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",ry:"2"}),t("path",{d:"M9 22V6h6v16"}),t("path",{d:"M8 6h.01M16 6h.01M8 10h.01M16 10h.01M8 14h.01M16 14h.01M8 18h.01M16 18h.01"})]),g(" Companies ")],-1)),t("button",{class:"btn btn-primary btn-sm",onClick:j}," + Add Company ")]),A.value.length===0?(o(),a("div",Bt,[...e[32]||(e[32]=[t("p",null,"No companies added yet.",-1)])])):(o(),a("div",Mt,[(o(!0),a(B,null,P(A.value,s=>(o(),a("div",{key:s.id,class:"entity-card card",onClick:$=>J(s)},[t("div",Vt,i(V(s.companyName)),1),t("div",_t,[t("h3",null,i(s.companyName),1),t("div",Pt,[t("span",Ut,i((s.taxRate*100).toFixed(0))+"% tax rate",1),t("span",null,"Franking: "+i(ot(at)(s.frankingAccountBalance)),1)]),s.division7ALoans?.length?(o(),a("div",Rt," âš ï¸ "+i(s.division7ALoans.length)+" Div 7A loan(s) ",1)):k("",!0)]),e[33]||(e[33]=t("svg",{class:"entity-arrow",xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"9 18 15 12 9 6"})],-1))],8,At))),128))]))])]),T.value.length>0&&N.value.length>0?(o(),a("div",$t,[e[35]||(e[35]=t("div",{class:"cta-content"},[t("h3",null,"ðŸŽ¯ Optimize Trust Distributions"),t("p",null,"Use our tax optimization engine to distribute trust income efficiently across family members.")],-1)),X(_,{to:"/tax-optimization",class:"btn btn-accent"},{default:Y(()=>[...e[34]||(e[34]=[g(" Open Tax Optimizer ",-1)])]),_:1})])):k("",!0)],64)),(o(),U(R,{to:"body"},[y.value?(o(),a("div",{key:0,class:"modal-overlay",onClick:e[6]||(e[6]=w(s=>y.value=!1,["self"]))},[t("div",Ft,[t("div",It,[e[36]||(e[36]=t("h2",null,"Add Family Member",-1)),t("button",{class:"btn-close",onClick:e[0]||(e[0]=s=>y.value=!1)},"Ã—")]),t("form",{onSubmit:w(q,["prevent"]),class:"modal-form"},[t("div",Dt,[e[37]||(e[37]=t("label",null,"Full Name",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>p.value.fullName=s),type:"text",required:""},null,512),[[d,p.value.fullName]])]),t("div",St,[e[38]||(e[38]=t("label",null,"Date of Birth",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>p.value.dateOfBirth=s),type:"date",required:""},null,512),[[d,p.value.dateOfBirth]])]),t("div",Et,[e[40]||(e[40]=t("label",null,"Marginal Tax Rate",-1)),r(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>p.value.marginalTaxRate=s)},[...e[39]||(e[39]=[t("option",{value:0},"0% (Tax-free threshold)",-1),t("option",{value:.19},"19%",-1),t("option",{value:.325},"32.5%",-1),t("option",{value:.37},"37%",-1),t("option",{value:.45},"45%",-1)])],512),[[F,p.value.marginalTaxRate]])]),t("div",Ht,[t("label",jt,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=s=>p.value.hasPrivateHealthInsurance=s)},null,512),[[I,p.value.hasPrivateHealthInsurance]]),e[41]||(e[41]=g(" Has private health insurance ",-1))])]),t("div",qt,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[5]||(e[5]=s=>y.value=!1)},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:u.value},i(u.value?"Saving...":"Add Person"),9,zt)])],32)])])):k("",!0)])),(o(),U(R,{to:"body"},[f.value?(o(),a("div",{key:0,class:"modal-overlay",onClick:e[13]||(e[13]=w(s=>f.value=!1,["self"]))},[t("div",Ot,[t("div",Lt,[e[42]||(e[42]=t("h2",null,"Add Trust",-1)),t("button",{class:"btn-close",onClick:e[7]||(e[7]=s=>f.value=!1)},"Ã—")]),t("form",{onSubmit:w(z,["prevent"]),class:"modal-form"},[t("div",Gt,[e[43]||(e[43]=t("label",null,"Trust Name",-1)),r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>m.value.trustName=s),type:"text",required:""},null,512),[[d,m.value.trustName]])]),t("div",Jt,[e[44]||(e[44]=t("label",null,"ABN (optional)",-1)),r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>m.value.abn=s),type:"text"},null,512),[[d,m.value.abn]])]),t("div",Kt,[e[45]||(e[45]=t("label",null,"Trustee Name",-1)),r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>m.value.trusteeName=s),type:"text",required:""},null,512),[[d,m.value.trusteeName]])]),t("div",Qt,[e[47]||(e[47]=t("label",null,"Trust Type",-1)),r(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>m.value.trustType=s)},[...e[46]||(e[46]=[t("option",{value:"Discretionary"},"Discretionary (Family Trust)",-1),t("option",{value:"Unit"},"Unit Trust",-1),t("option",{value:"Hybrid"},"Hybrid Trust",-1)])],512),[[F,m.value.trustType]])]),t("div",Wt,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[12]||(e[12]=s=>f.value=!1)},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:u.value},i(u.value?"Saving...":"Add Trust"),9,Xt)])],32)])])):k("",!0)])),(o(),U(R,{to:"body"},[b.value?(o(),a("div",{key:0,class:"modal-overlay",onClick:e[23]||(e[23]=w(s=>b.value=!1,["self"]))},[t("div",Yt,[t("div",Zt,[e[48]||(e[48]=t("h2",null,"Add Company",-1)),t("button",{class:"btn-close",onClick:e[14]||(e[14]=s=>b.value=!1)},"Ã—")]),t("form",{onSubmit:w(O,["prevent"]),class:"modal-form"},[t("div",te,[e[49]||(e[49]=t("label",null,"Company Name",-1)),r(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>l.value.companyName=s),type:"text",required:""},null,512),[[d,l.value.companyName]])]),t("div",ee,[e[50]||(e[50]=t("label",null,"ABN (optional)",-1)),r(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>l.value.abn=s),type:"text"},null,512),[[d,l.value.abn]])]),t("div",se,[e[51]||(e[51]=t("label",null,"ACN (optional)",-1)),r(t("input",{"onUpdate:modelValue":e[17]||(e[17]=s=>l.value.acn=s),type:"text"},null,512),[[d,l.value.acn]])]),t("div",oe,[t("label",ne,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[18]||(e[18]=s=>l.value.isBaseRateEntity=s)},null,512),[[I,l.value.isBaseRateEntity]]),e[52]||(e[52]=g(" Base rate entity (25% tax rate) ",-1))])]),t("div",ae,[t("div",le,[e[53]||(e[53]=t("label",null,"Retained Profits",-1)),r(t("input",{"onUpdate:modelValue":e[19]||(e[19]=s=>l.value.retainedProfits=s),type:"number",step:"0.01"},null,512),[[d,l.value.retainedProfits,void 0,{number:!0}]])]),t("div",ie,[e[54]||(e[54]=t("label",null,"Franking Balance",-1)),r(t("input",{"onUpdate:modelValue":e[20]||(e[20]=s=>l.value.frankingAccountBalance=s),type:"number",step:"0.01"},null,512),[[d,l.value.frankingAccountBalance,void 0,{number:!0}]])])]),t("div",re,[e[55]||(e[55]=t("label",null,"Incorporation Date",-1)),r(t("input",{"onUpdate:modelValue":e[21]||(e[21]=s=>l.value.incorporationDate=s),type:"date",required:""},null,512),[[d,l.value.incorporationDate]])]),t("div",ue,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[22]||(e[22]=s=>b.value=!1)},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:u.value},i(u.value?"Saving...":"Add Company"),9,de)])],32)])])):k("",!0)]))])}}},fe=K(ve,[["__scopeId","data-v-cc52b9aa"]]);export{fe as default};
