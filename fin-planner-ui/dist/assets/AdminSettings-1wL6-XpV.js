import{_ as Q,r,k as W,i as X,B as c,c as n,o as i,a as e,F as f,q as P,d as p,x as h,z as A,t as d,m as Z,n as $,A as ee,g as U,y as te}from"./index-D2Wtd9Sa.js";const se={class:"admin-container"},ae={class:"tabs"},ne=["onClick"],ie={class:"tab-content"},oe={key:0,class:"settings-panel"},le={class:"card"},re={class:"form-group"},de={class:"input-group"},ce={class:"form-group"},ue={class:"last-update-text"},pe=["disabled"],ve={key:0},me={key:1},ye={key:1,class:"sources-panel"},_e={class:"card"},ge=["onDragstart","onDragenter"],fe={class:"source-header"},he={class:"priority-badge"},be={class:"toggle"},ke={class:"switch"},Se=["onUpdate:modelValue","onChange"],Ie={class:"source-details"},xe={class:"code"},Pe={class:"source-actions"},we={key:0,class:"text-muted text-sm"},Ce={key:1,class:"api-key-status"},Ae=["onClick"],Ue={key:2,class:"api-key-input-group"},De=["onUpdate:modelValue"],Me={class:"btn-group"},$e=["onClick"],Fe=["onClick"],Ne={key:0,class:"priority-actions"},Ve={key:2,class:"assets-panel"},Ke={class:"card"},Ee={class:"table-container"},Te={class:"assets-table"},Oe={key:0},Le={class:"font-medium text-main"},Re={class:"text-sm text-muted hidden-sm"},Be={class:"pricing-code-cell"},Ye=["onUpdate:modelValue","placeholder","onInput"],qe={key:0,class:"text-xs text-muted mt-1 flex items-center gap-1"},ze={key:1,class:"text-xs text-primary mt-1 flex items-center gap-1"},He={class:"select-wrapper"},Je=["onUpdate:modelValue","onChange"],je=["value"],Ge={class:"price-display"},Qe={key:0,class:"price-tag"},We={key:1,class:"price-error"},Xe={key:2,class:"source-badge"},Ze={class:"flex flex-col"},et={class:"text-sm font-medium"},tt={key:0,class:"text-xs text-muted"},st={key:1,class:"text-xs text-danger"},at={class:"actions-row"},nt=["onClick","disabled"],it={key:0},ot={key:1},lt=["onClick"],rt=["onClick"],dt={__name:"AdminSettings",setup(ct){const _=r("settings"),F=[{id:"settings",label:"Price Update Settings"},{id:"sources",label:"Price Source Priority"},{id:"assets",label:"Asset Price Sources"}],b=r({updateIntervalMinutes:15}),v=r([]),k=r([]),l=r({}),m=r({}),S=r({}),I=r(!1),g=r({}),w=r(null),N=W(()=>{if(!w.value)return"Never";const t=new Date(w.value);return isNaN(t.getTime())||t.getFullYear()<2e3?"Never":t.toLocaleString()});X(async()=>{await D(),await E(),await C()});async function D(){try{const{data:t}=await c.get("/admin/price-settings");b.value.updateIntervalMinutes=t.updateIntervalMinutes,w.value=t.lastUpdateTime}catch(t){console.error("Failed to load price settings",t)}}async function V(){try{await c.put("/admin/price-settings/interval",{intervalMinutes:b.value.updateIntervalMinutes}),alert("Price update interval saved!")}catch{alert("Failed to save settings")}}async function K(){I.value=!0;try{await c.post("/admin/price-refresh"),alert("Price refresh triggered! This may take a few moments."),setTimeout(()=>D(),3e3)}catch{alert("Failed to trigger refresh")}finally{I.value=!1}}async function E(){try{const{data:t}=await c.get("/admin/price-sources");v.value=t,x.value=!1}catch(t){console.error("Failed to load price sources",t)}}const y=r(null),x=r(!1);function T(t){y.value=t}function O(t){if(y.value===t)return;const s=[...v.value],a=s[y.value];s.splice(y.value,1),s.splice(t,0,a),v.value=s,y.value=t,x.value=!0}function L(){y.value=null}async function R(){try{const t=v.value.map((s,a)=>({sourceId:s.id,newPriority:a+1}));await c.put("/admin/price-sources/priority",t),alert("Priority order saved!"),x.value=!1}catch{alert("Failed to save priority order")}}async function B(t){try{await c.put(`/admin/price-sources/${t.id}/toggle`)}catch{alert("Failed to toggle source"),t.isEnabled=!t.isEnabled}}async function Y(t){if(!m.value[t.id]){alert("Please enter an API key");return}try{await c.put(`/admin/price-sources/${t.id}/apikey`,{apiKey:m.value[t.id]}),alert(`API key saved for ${t.name}`),t.hasApiKey=!0,m.value[t.id]="",S.value[t.id]=!1}catch{alert("Failed to save API key")}}function q(t){S.value[t]=!1,m.value[t]=""}async function C(){try{const{data:t}=await c.get("/admin/assets/price-sources");k.value=t,l.value={},t.forEach(s=>{l.value[s.assetId]={customSymbol:s.customSymbol||"",sourceId:s.overrideSourceId||"",modified:!1}})}catch(t){console.error("Failed to load asset price sources",t)}}function M(t){l.value[t].modified=!0}async function z(t){const s=l.value[t];try{await c.put(`/admin/assets/${t}/price-source`,{sourceId:s.sourceId||null,customSymbol:s.customSymbol||null}),alert("Asset mapping saved!"),s.modified=!1,await C()}catch{alert("Failed to save asset mapping")}}async function H(t){try{await c.put(`/admin/assets/${t}/price-source`,{sourceId:null,customSymbol:null}),alert("Asset mapping reset to default!"),l.value[t].customSymbol="",l.value[t].sourceId="",l.value[t].modified=!1,await C()}catch{alert("Failed to reset asset mapping")}}async function J(t){g.value[t]=!0;try{const{data:s}=await c.post(`/admin/assets/${t}/sync-price`),a=k.value.findIndex(o=>o.assetId===t);a!==-1&&(k.value[a]=s)}catch(s){console.error("Failed to sync asset price",s),alert("Failed to sync price for this asset")}finally{g.value[t]=!1}}function j(t){if(!t)return"Never";const s=new Date(t);return isNaN(s.getTime())||s.getFullYear()<2e3?"Never":s.toLocaleString()}function G(t){if(!t)return!0;const s=new Date(t);return new Date-s>1440*60*1e3}return(t,s)=>(i(),n("div",se,[s[17]||(s[17]=e("h1",null,"Admin Settings",-1)),e("div",ae,[(i(),n(f,null,P(F,a=>e("button",{key:a.id,class:$(["tab-btn",{active:_.value===a.id}]),onClick:o=>_.value=a.id},d(a.label),11,ne)),64))]),e("div",ie,[_.value==="settings"?(i(),n("div",oe,[e("div",le,[s[4]||(s[4]=e("h2",null,"Price Update Configuration",-1)),e("div",re,[s[2]||(s[2]=e("label",null,"Update Interval (minutes)",-1)),e("div",de,[h(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>b.value.updateIntervalMinutes=a),type:"number",min:"1",max:"1440",class:"input"},null,512),[[A,b.value.updateIntervalMinutes,void 0,{number:!0}]]),e("button",{onClick:V,class:"btn btn-primary"},"Save Interval")])]),e("div",ce,[s[3]||(s[3]=e("label",null,"Last Update",-1)),e("p",ue,d(N.value),1)]),e("button",{onClick:K,disabled:I.value,class:"btn btn-success"},[I.value?(i(),n("span",me,"Refreshing...")):(i(),n("span",ve,"ðŸ”„ Refresh Prices Now"))],8,pe)])])):p("",!0),_.value==="sources"?(i(),n("div",ye,[e("div",_e,[s[8]||(s[8]=e("h2",null,"Price Source Priority",-1)),s[9]||(s[9]=e("p",{class:"help-text"},"Drag to reorder priority (top = first tried)",-1)),e("div",{class:"sources-list",onDragover:s[1]||(s[1]=Z(()=>{},["prevent"])),onDrop:L},[(i(!0),n(f,null,P(v.value,(a,o)=>(i(),n("div",{key:a.id,class:"source-item",draggable:"true",onDragstart:u=>T(o),onDragenter:u=>O(o)},[e("div",fe,[s[6]||(s[6]=e("span",{class:"drag-handle"},"â‰¡",-1)),e("span",he,d(o+1),1),e("strong",null,d(a.name),1),e("span",be,[e("label",ke,[h(e("input",{type:"checkbox","onUpdate:modelValue":u=>a.isEnabled=u,onChange:u=>B(a)},null,40,Se),[[ee,a.isEnabled]]),s[5]||(s[5]=e("span",{class:"slider"},null,-1))])])]),e("div",Ie,[e("span",xe,d(a.code),1),e("span",null,"Rate: "+d(a.rateLimitPerMinute)+"/min",1)]),e("div",Pe,[a.code==="YAHOO"?(i(),n("div",we," No API key required for Yahoo Finance. ")):a.hasApiKey&&!S.value[a.id]?(i(),n("div",Ce,[s[7]||(s[7]=e("span",{class:"key-indicator"},"Saved Key: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",-1)),e("button",{onClick:u=>S.value[a.id]=!0,class:"btn-sm btn-outline"},"Change",8,Ae)])):(i(),n("div",Ue,[h(e("input",{"onUpdate:modelValue":u=>m.value[a.id]=u,type:"password",placeholder:"Enter API Key",class:"input-sm"},null,8,De),[[A,m.value[a.id]]]),e("div",Me,[e("button",{onClick:u=>Y(a),class:"btn-sm btn-save-key"},"Save Key",8,$e),a.hasApiKey?(i(),n("button",{key:0,onClick:u=>q(a.id),class:"btn-sm btn-outline"},"Cancel",8,Fe)):p("",!0)])]))])],40,ge))),128))],32),x.value?(i(),n("div",Ne,[e("button",{onClick:R,class:"btn btn-primary"},"Save New Priority Order")])):p("",!0)])])):p("",!0),_.value==="assets"?(i(),n("div",Ve,[e("div",Ke,[s[15]||(s[15]=e("h2",null,"Asset Price Symbol Mapping",-1)),s[16]||(s[16]=e("p",{class:"help-text"},"Manually configure pricing symbols and sources for each asset",-1)),e("div",Ee,[e("table",Te,[s[14]||(s[14]=e("thead",null,[e("tr",null,[e("th",null,"Asset Code"),e("th",null,"Name"),e("th",null,"Pricing Code"),e("th",null,"Source"),e("th",null,"Current Price"),e("th",null,"Last Updated"),e("th",null,"Actions")])],-1)),e("tbody",null,[(i(!0),n(f,null,P(k.value,a=>(i(),n(f,{key:a.assetId},[l.value[a.assetId]?(i(),n("tr",Oe,[e("td",Le,d(a.symbol),1),e("td",Re,d(a.name),1),e("td",null,[e("div",Be,[h(e("input",{"onUpdate:modelValue":o=>l.value[a.assetId].customSymbol=o,type:"text",placeholder:a.symbol,class:"input-premium",onInput:o=>M(a.assetId)},null,40,Ye),[[A,l.value[a.assetId].customSymbol]]),l.value[a.assetId].customSymbol?(i(),n("div",ze,[...s[11]||(s[11]=[e("span",{class:"status-dot active"},null,-1),U(" Custom Override ",-1)])])):(i(),n("div",qe,[...s[10]||(s[10]=[e("span",{class:"status-dot"},null,-1),U(" Uses Default ",-1)])]))])]),e("td",null,[e("div",He,[h(e("select",{"onUpdate:modelValue":o=>l.value[a.assetId].sourceId=o,onChange:o=>M(a.assetId),class:"select-premium"},[s[12]||(s[12]=e("option",{value:""},"Default (Priority Order)",-1)),(i(!0),n(f,null,P(v.value.filter(o=>o.isEnabled),o=>(i(),n("option",{key:o.id,value:o.id},d(o.name),9,je))),128))],40,Je),[[te,l.value[a.assetId].sourceId]])])]),e("td",null,[e("div",Ge,[a.currentPrice?(i(),n("div",Qe," $"+d(a.currentPrice.toFixed(2)),1)):(i(),n("div",We,[...s[13]||(s[13]=[e("span",{class:"error-icon"},"âš ï¸",-1),U(" No Data ",-1)])])),a.currentSourceUsed?(i(),n("span",Xe,d(a.currentSourceUsed),1)):p("",!0)])]),e("td",null,[e("div",Ze,[e("span",et,d(j(a.lastUpdated)),1),G(a.lastUpdated)?(i(),n("span",st,"Outdated")):(i(),n("span",tt,"Just now"))])]),e("td",null,[e("div",at,[e("button",{onClick:o=>J(a.assetId),class:$(["btn-icon btn-sync",{spinning:g.value[a.assetId]}]),disabled:g.value[a.assetId],title:"Sync Price"},[g.value[a.assetId]?(i(),n("span",it,"âŒ›")):(i(),n("span",ot,"ðŸ”„"))],10,nt),l.value[a.assetId].modified?(i(),n("button",{key:0,onClick:o=>z(a.assetId),class:"btn-icon btn-save",title:"Save Changes"}," ðŸ’¾ ",8,lt)):p("",!0),a.overrideSourceId||a.customSymbol?(i(),n("button",{key:1,onClick:o=>H(a.assetId),class:"btn-icon btn-reset",title:"Reset to Default"}," âœ• ",8,rt)):p("",!0)])])])):p("",!0)],64))),128))])])])])])):p("",!0)])]))}},pt=Q(dt,[["__scopeId","data-v-0fb83a65"]]);export{pt as default};
