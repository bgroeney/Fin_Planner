import{_ as U,r as p,H as L,i as N,c as i,o as d,a as t,d as y,x as b,y as _,b as P,F as S,q as $,t as n,m as E,n as h,B as w}from"./index-D_ssXn_P.js";const F={class:"audit-view animate-fade-in"},x={class:"filters card"},B={class:"filter-group"},M={class:"filter-group"},z={key:0,class:"loader-container"},H={key:1,class:"empty-state card"},J={key:2,class:"logs-table card"},G={class:"data-table"},I={class:"timestamp-cell"},O={class:"date"},R={class:"time"},q={class:"user-email"},j={class:"entity-cell"},K={class:"entity-type"},Q={class:"entity-name"},W=["onClick"],X={class:"pagination"},Y=["disabled"],Z={class:"page-info"},tt=["disabled"],et={class:"modal-card"},st={class:"modal-header"},at={class:"detail-content"},nt={class:"detail-row"},lt={class:"detail-row"},ot={class:"detail-row"},it={class:"detail-row"},dt={key:0,class:"detail-row"},rt={key:1,class:"values-section"},ut={class:"json-display"},ct={key:2,class:"values-section"},pt={class:"json-display"},k=50,vt={__name:"AuditLogView",setup(yt){const m=p(!0),c=p([]),r=p(1),v=p(!1),l=p(null),o=L({entityType:"",action:""}),T=s=>s?new Date(s).toLocaleDateString("en-AU",{day:"2-digit",month:"short",year:"numeric"}):"",C=s=>s?new Date(s).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"}):"",D=s=>s?new Date(s).toLocaleString("en-AU"):"",g=s=>{if(!s)return"";try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}},f=s=>{switch(s){case"Create":return"action-create";case"Update":return"action-update";case"Delete":return"action-delete";default:return""}},u=async()=>{m.value=!0;try{const s=new URLSearchParams;s.append("page",r.value),s.append("pageSize",k),o.entityType&&s.append("entityType",o.entityType),o.action&&s.append("action",o.action);const e=await w.get(`/audit?${s.toString()}`);c.value=e.data}catch(s){console.error("Failed to load audit logs",s),c.value=[]}finally{m.value=!1}},A=async s=>{try{const e=await w.get(`/audit/${s.id}`);l.value=e.data,v.value=!0}catch(e){console.error("Failed to load log details",e)}},V=()=>{o.entityType="",o.action="",r.value=1,u()};return N(u),(s,e)=>(d(),i("div",F,[e[21]||(e[21]=t("div",{class:"header-row"},[t("div",{class:"header-content"},[t("h1",null,"Audit Log"),t("p",{class:"subtitle"},"Track all changes to financial data for compliance")])],-1)),t("div",x,[t("div",B,[e[7]||(e[7]=t("label",null,"Entity Type",-1)),b(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.entityType=a),onChange:u},[...e[6]||(e[6]=[P('<option value="" data-v-18dc08e9>All</option><option value="Portfolio" data-v-18dc08e9>Portfolio</option><option value="Holding" data-v-18dc08e9>Holding</option><option value="Transaction" data-v-18dc08e9>Transaction</option><option value="Goal" data-v-18dc08e9>Goal</option><option value="Decision" data-v-18dc08e9>Decision</option>',6)])],544),[[_,o.entityType]])]),t("div",M,[e[9]||(e[9]=t("label",null,"Action",-1)),b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.action=a),onChange:u},[...e[8]||(e[8]=[t("option",{value:""},"All",-1),t("option",{value:"Create"},"Create",-1),t("option",{value:"Update"},"Update",-1),t("option",{value:"Delete"},"Delete",-1)])],544),[[_,o.action]])]),t("button",{class:"btn btn-secondary",onClick:V}," Reset Filters ")]),m.value?(d(),i("div",z,[...e[10]||(e[10]=[t("div",{class:"spinner"},null,-1)])])):c.value.length===0?(d(),i("div",H,[...e[11]||(e[11]=[t("div",{class:"empty-icon"},"ðŸ“‹",-1),t("h3",null,"No audit logs found",-1),t("p",null,"Changes to financial data will appear here.",-1)])])):(d(),i("div",J,[t("table",G,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"Timestamp"),t("th",null,"User"),t("th",null,"Action"),t("th",null,"Entity"),t("th",null,"Details")])],-1)),t("tbody",null,[(d(!0),i(S,null,$(c.value,a=>(d(),i("tr",{key:a.id},[t("td",null,[t("div",I,[t("span",O,n(T(a.timestamp)),1),t("span",R,n(C(a.timestamp)),1)])]),t("td",null,[t("span",q,n(a.userEmail),1)]),t("td",null,[t("span",{class:h(["action-badge",f(a.action)])},n(a.action),3)]),t("td",null,[t("div",j,[t("span",K,n(a.entityType),1),t("span",Q,n(a.entityName),1)])]),t("td",null,[t("button",{class:"btn btn-ghost btn-sm",onClick:mt=>A(a)}," View ",8,W)])]))),128))])]),t("div",X,[t("button",{class:"btn btn-ghost",disabled:r.value<=1,onClick:e[2]||(e[2]=a=>{r.value--,u()})}," Previous ",8,Y),t("span",Z,"Page "+n(r.value),1),t("button",{class:"btn btn-ghost",disabled:c.value.length<k,onClick:e[3]||(e[3]=a=>{r.value++,u()})}," Next ",8,tt)])])),v.value?(d(),i("div",{key:3,class:"modal-overlay",onClick:e[5]||(e[5]=E(a=>v.value=!1,["self"]))},[t("div",et,[t("div",st,[e[13]||(e[13]=t("h2",null,"Change Details",-1)),t("button",{class:"btn-close",onClick:e[4]||(e[4]=a=>v.value=!1)},"Ã—")]),t("div",at,[t("div",nt,[e[14]||(e[14]=t("span",{class:"label"},"Timestamp:",-1)),t("span",null,n(D(l.value?.timestamp)),1)]),t("div",lt,[e[15]||(e[15]=t("span",{class:"label"},"User:",-1)),t("span",null,n(l.value?.userEmail),1)]),t("div",ot,[e[16]||(e[16]=t("span",{class:"label"},"Action:",-1)),t("span",{class:h(["action-badge",f(l.value?.action)])},n(l.value?.action),3)]),t("div",it,[e[17]||(e[17]=t("span",{class:"label"},"Entity:",-1)),t("span",null,n(l.value?.entityType)+" - "+n(l.value?.entityName),1)]),l.value?.ipAddress?(d(),i("div",dt,[e[18]||(e[18]=t("span",{class:"label"},"IP Address:",-1)),t("span",null,n(l.value.ipAddress),1)])):y("",!0),l.value?.oldValues?(d(),i("div",rt,[e[19]||(e[19]=t("h4",null,"Previous Values",-1)),t("pre",ut,n(g(l.value.oldValues)),1)])):y("",!0),l.value?.newValues?(d(),i("div",ct,[e[20]||(e[20]=t("h4",null,"New Values",-1)),t("pre",pt,n(g(l.value.newValues)),1)])):y("",!0)])])])):y("",!0)]))}},ft=U(vt,[["__scopeId","data-v-18dc08e9"]]);export{ft as default};
