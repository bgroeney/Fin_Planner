import{_ as V,g as c,w as A,x as B,o,c as l,a as t,p as w,C as D,F as b,l as h,t as i,f as u,b as G,i as S,j as U,z,s as _,r as M,n as T,e as g}from"./index-oVbs5Hxd.js";import{usePortfolioStore as R}from"./portfolio-CjZnfIUI.js";const $={class:"tax-optimizer-view animate-fade-in"},E={class:"controls-row card"},P={class:"control-group"},j=["value"],L={class:"control-group"},q=["value"],H=["disabled"],J={key:0,class:"loader-container"},K={key:1,class:"optimization-results"},Q={class:"summary-grid"},W={class:"summary-card card"},X={class:"value-large"},Z={class:"summary-card card"},tt={class:"value-large"},et={class:"text-muted"},st={class:"summary-card card highlight-success"},at={class:"value-large value-positive"},it={class:"recommendations-section card"},ot={class:"section-description"},lt={key:0,class:"data-table"},nt={class:"beneficiary-cell"},rt={class:"beneficiary-name"},dt={class:"text-right"},ut={key:0,class:"text-muted text-small"},ct={class:"text-right"},vt={class:"text-right"},mt={key:0},pt={key:1},yt={key:2},ft={class:"text-right font-semibold"},bt={class:"text-right"},ht={class:"rate-change"},_t={class:"rate-before"},gt={class:"rate-after"},xt={key:0,class:"text-small"},kt={key:1,class:"empty-state"},Ct={key:0,class:"action-row"},wt=["disabled"],Dt={key:2,class:"empty-state card"},zt={__name:"TaxOptimizerView",setup(Tt){const F=R(),v=c(!1),p=c(!1),m=c([]),r=c(null),y=c(new Date().getMonth()>5?new Date().getFullYear()+1:new Date().getFullYear()),n=c(null),f=z(()=>F.currentPortfolioId),O=z(()=>{const a=new Date().getFullYear();return[a+1,a,a-1]}),d=a=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(a||0),x=a=>((a||0)*100).toFixed(1)+"%",k=async()=>{if(!f.value){m.value=[];return}try{const a=await _.get(`/trusts?portfolioId=${f.value}`);m.value=a.data,r.value&&!m.value.find(e=>e.id===r.value)&&(r.value=null,n.value=null)}catch(a){console.error("Failed to load trusts",a)}},I=async()=>{if(r.value){v.value=!0,n.value=null;try{const a=await _.get(`/trusts/${r.value}/optimize-distribution?fiscalYear=${y.value}`);n.value=a.data}catch(a){console.error("Failed to run optimization",a),alert("Failed to run optimization. Make sure you have trust income recorded for this fiscal year.")}finally{v.value=!1}}},Y=async()=>{if(!(!r.value||!n.value)){p.value=!0;try{const a=await _.post(`/trusts/${r.value}/apply-optimization?fiscalYear=${y.value}`);alert(a.data.message||"Distributions created successfully")}catch(a){console.error("Failed to apply optimization",a),alert("Failed to apply optimization")}finally{p.value=!1}}},C=()=>{n.value=null};return A(f,()=>{k()}),B(()=>{f.value&&k()}),(a,e)=>{const N=M("router-link");return o(),l("div",$,[e[17]||(e[17]=t("div",{class:"header-row"},[t("div",{class:"header-content"},[t("h1",null,"Tax Distribution Optimizer"),t("p",{class:"subtitle"},"Optimize trust income distribution to minimize family tax liability")])],-1)),t("div",E,[t("div",P,[e[3]||(e[3]=t("label",null,"Trust",-1)),w(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),onChange:C},[e[2]||(e[2]=t("option",{value:null,disabled:""},"Select a trust...",-1)),(o(!0),l(b,null,h(m.value,s=>(o(),l("option",{key:s.id,value:s.id},i(s.trustName),9,j))),128))],544),[[D,r.value]])]),t("div",L,[e[4]||(e[4]=t("label",null,"Financial Year",-1)),w(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s)},[(o(!0),l(b,null,h(O.value,s=>(o(),l("option",{key:s,value:s},"FY "+i(s),9,q))),128))],512),[[D,y.value]])]),t("button",{class:"btn btn-primary",disabled:!r.value||v.value,onClick:I},i(v.value?"Optimizing...":"Optimize Distribution"),9,H)]),v.value?(o(),l("div",J,[...e[5]||(e[5]=[t("div",{class:"spinner"},null,-1)])])):n.value?(o(),l("div",K,[t("div",Q,[t("div",W,[e[6]||(e[6]=t("div",{class:"label-text"},"Total Distributable Income",-1)),t("div",X,i(d(n.value.totalDistributableIncome)),1)]),t("div",Z,[e[7]||(e[7]=t("div",{class:"label-text"},"Franking Credits Available",-1)),t("div",tt,i(d(n.value.totalFrankingCredits)),1),t("div",et,"Used: "+i(d(n.value.totalFrankingCreditsUsed)),1)]),t("div",st,[e[8]||(e[8]=t("div",{class:"label-text"},"Estimated Total Tax",-1)),t("div",at,i(d(n.value.totalEstimatedTax)),1),e[9]||(e[9]=t("div",{class:"text-muted"},"After franking credit offsets",-1))])]),t("div",it,[e[14]||(e[14]=t("h2",null,"Recommended Distributions",-1)),t("p",ot,i(n.value.message),1),n.value.recommendations?.length>0?(o(),l("table",lt,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"Beneficiary"),t("th",null,"Type"),t("th",{class:"text-right"},"Franked Dividends"),t("th",{class:"text-right"},"Other Income"),t("th",{class:"text-right"},"Capital Gains"),t("th",{class:"text-right"},"Total"),t("th",{class:"text-right"},"Tax Rate"),t("th",{class:"text-right"},"Est. Tax")])],-1)),t("tbody",null,[(o(!0),l(b,null,h(n.value.recommendations,s=>(o(),l("tr",{key:s.beneficiaryId},[t("td",null,[t("div",nt,[t("span",rt,i(s.beneficiaryName),1)])]),t("td",null,[t("span",{class:T(["type-badge",s.isCompany?"type-company":"type-person"])},i(s.isCompany?"Company":"Individual"),3)]),t("td",dt,[t("div",null,i(d(s.frankedDividends)),1),s.frankingCredits>0?(o(),l("div",ut," + "+i(d(s.frankingCredits))+" FC ",1)):u("",!0)]),t("td",ct,i(d(s.unfrankedIncome)),1),t("td",vt,[s.discountCapitalGains>0?(o(),l("div",mt,[g(i(d(s.discountCapitalGains))+" ",1),e[10]||(e[10]=t("span",{class:"text-muted text-small"},"(50% disc.)",-1))])):u("",!0),s.nonDiscountCapitalGains>0?(o(),l("div",pt,i(d(s.nonDiscountCapitalGains)),1)):u("",!0),s.discountCapitalGains===0&&s.nonDiscountCapitalGains===0?(o(),l("span",yt,"-")):u("",!0)]),t("td",ft,i(d(s.totalDistribution)),1),t("td",bt,[t("div",ht,[t("span",_t,i(x(s.marginalTaxRateBefore)),1),e[11]||(e[11]=t("span",{class:"rate-arrow"},"â†’",-1)),t("span",gt,i(x(s.marginalTaxRateAfter)),1)])]),t("td",{class:T(["text-right",s.estimatedTaxOnDistribution<0?"value-positive":""])},[g(i(d(s.estimatedTaxOnDistribution))+" ",1),s.estimatedTaxOnDistribution<0?(o(),l("span",xt,"(refund)")):u("",!0)],2)]))),128))])])):(o(),l("div",kt,[...e[13]||(e[13]=[t("p",null,"No distribution recommendations available. Make sure you have beneficiaries added to this trust.",-1)])]))]),n.value.recommendations?.length>0?(o(),l("div",Ct,[t("button",{class:"btn btn-secondary",onClick:C}," Reset "),t("button",{class:"btn btn-primary",onClick:Y,disabled:p.value},i(p.value?"Applying...":"Apply as Draft Distributions"),9,wt)])):u("",!0)])):r.value?u("",!0):(o(),l("div",Dt,[e[16]||(e[16]=G('<div class="empty-icon" data-v-1f5b0851><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-1f5b0851><circle cx="12" cy="12" r="10" data-v-1f5b0851></circle><circle cx="12" cy="12" r="6" data-v-1f5b0851></circle><circle cx="12" cy="12" r="2" data-v-1f5b0851></circle></svg></div><h3 data-v-1f5b0851>Select a Trust to Optimize</h3><p data-v-1f5b0851>Choose a trust from the dropdown above to run the tax distribution optimizer.</p>',3)),m.value.length===0?(o(),S(N,{key:0,to:"/entities",class:"btn btn-secondary"},{default:U(()=>[...e[15]||(e[15]=[g(" Create a Trust First ",-1)])]),_:1})):u("",!0)]))])}}},It=V(zt,[["__scopeId","data-v-1f5b0851"]]);export{It as default};
