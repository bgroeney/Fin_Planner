import{_ as U,w as L,x as S,o as i,c as d,a as t,p as _,C as w,b as $,F as E,l as F,t as l,m as x,n as h,f as y,z as I,s as k,g as v,H as z}from"./index-oVbs5Hxd.js";import{usePortfolioStore as M}from"./portfolio-CjZnfIUI.js";import{a as B}from"./formatters-DwG4QyEz.js";const H={class:"audit-view animate-fade-in"},J={class:"filters card"},G={class:"filter-group"},O={class:"filter-group"},R={key:0,class:"loader-container"},j={key:1,class:"empty-state card"},q={key:2,class:"logs-table card"},K={class:"data-table"},Q={class:"timestamp-cell"},W={class:"date"},X={class:"time"},Y={class:"user-email"},Z={class:"entity-cell"},tt={class:"entity-type"},et={class:"entity-name"},st=["onClick"],at={class:"pagination"},lt=["disabled"],nt={class:"page-info"},ot=["disabled"],it={class:"modal-card"},dt={class:"modal-header"},rt={class:"detail-content"},ut={class:"detail-row"},ct={class:"detail-row"},pt={class:"detail-row"},vt={class:"detail-row"},ft={key:0,class:"detail-row"},mt={key:1,class:"values-section"},yt={class:"json-display"},gt={key:2,class:"values-section"},bt={class:"json-display"},C=50,_t={__name:"AuditLogView",setup(wt){const p=v(!0),c=v([]),r=v(1),f=v(!1),n=v(null),T=M(),m=I(()=>T.currentPortfolioId),o=z({entityType:"",action:""}),D=s=>s?B(s,"short"):"",A=s=>s?new Date(s).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"}):"",V=s=>s?new Date(s).toLocaleString("en-AU"):"",g=s=>{if(!s)return"";try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}},b=s=>{switch(s){case"Create":return"action-create";case"Update":return"action-update";case"Delete":return"action-delete";default:return""}},u=async()=>{if(!m.value){c.value=[],p.value=!1;return}p.value=!0;try{const s=new URLSearchParams;s.append("portfolioId",m.value),s.append("page",r.value),s.append("pageSize",C),o.entityType&&s.append("entityType",o.entityType),o.action&&s.append("action",o.action);const e=await k.get(`/audit?${s.toString()}`);c.value=e.data}catch(s){console.error("Failed to load audit logs",s),c.value=[]}finally{p.value=!1}},N=async s=>{try{const e=await k.get(`/audit/${s.id}`);n.value=e.data,f.value=!0}catch(e){console.error("Failed to load log details",e)}},P=()=>{o.entityType="",o.action="",r.value=1,u()};return L(m,()=>{r.value=1,u()}),S(()=>{m.value?u():p.value=!1}),(s,e)=>(i(),d("div",H,[e[21]||(e[21]=t("div",{class:"header-row"},[t("div",{class:"header-content"},[t("h1",null,"Audit Log"),t("p",{class:"subtitle"},"Track all changes to financial data for compliance")])],-1)),t("div",J,[t("div",G,[e[7]||(e[7]=t("label",null,"Entity Type",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.entityType=a),onChange:u},[...e[6]||(e[6]=[$('<option value="" data-v-9a250f7d>All</option><option value="Portfolio" data-v-9a250f7d>Portfolio</option><option value="Holding" data-v-9a250f7d>Holding</option><option value="Transaction" data-v-9a250f7d>Transaction</option><option value="Goal" data-v-9a250f7d>Goal</option><option value="Decision" data-v-9a250f7d>Decision</option>',6)])],544),[[w,o.entityType]])]),t("div",O,[e[9]||(e[9]=t("label",null,"Action",-1)),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.action=a),onChange:u},[...e[8]||(e[8]=[t("option",{value:""},"All",-1),t("option",{value:"Create"},"Create",-1),t("option",{value:"Update"},"Update",-1),t("option",{value:"Delete"},"Delete",-1)])],544),[[w,o.action]])]),t("button",{class:"btn btn-secondary",onClick:P}," Reset Filters ")]),p.value?(i(),d("div",R,[...e[10]||(e[10]=[t("div",{class:"spinner"},null,-1)])])):c.value.length===0?(i(),d("div",j,[...e[11]||(e[11]=[t("div",{class:"empty-icon"},"ðŸ“‹",-1),t("h3",null,"No audit logs found",-1),t("p",null,"Changes to financial data will appear here.",-1)])])):(i(),d("div",q,[t("table",K,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"Timestamp"),t("th",null,"User"),t("th",null,"Action"),t("th",null,"Entity"),t("th",null,"Details")])],-1)),t("tbody",null,[(i(!0),d(E,null,F(c.value,a=>(i(),d("tr",{key:a.id},[t("td",null,[t("div",Q,[t("span",W,l(D(a.timestamp)),1),t("span",X,l(A(a.timestamp)),1)])]),t("td",null,[t("span",Y,l(a.userEmail),1)]),t("td",null,[t("span",{class:h(["action-badge",b(a.action)])},l(a.action),3)]),t("td",null,[t("div",Z,[t("span",tt,l(a.entityType),1),t("span",et,l(a.entityName),1)])]),t("td",null,[t("button",{class:"btn btn-ghost btn-sm",onClick:ht=>N(a)}," View ",8,st)])]))),128))])]),t("div",at,[t("button",{class:"btn btn-ghost",disabled:r.value<=1,onClick:e[2]||(e[2]=a=>{r.value--,u()})}," Previous ",8,lt),t("span",nt,"Page "+l(r.value),1),t("button",{class:"btn btn-ghost",disabled:c.value.length<C,onClick:e[3]||(e[3]=a=>{r.value++,u()})}," Next ",8,ot)])])),f.value?(i(),d("div",{key:3,class:"modal-overlay",onClick:e[5]||(e[5]=x(a=>f.value=!1,["self"]))},[t("div",it,[t("div",dt,[e[13]||(e[13]=t("h2",null,"Change Details",-1)),t("button",{class:"btn-close",onClick:e[4]||(e[4]=a=>f.value=!1)},"Ã—")]),t("div",rt,[t("div",ut,[e[14]||(e[14]=t("span",{class:"label"},"Timestamp:",-1)),t("span",null,l(V(n.value?.timestamp)),1)]),t("div",ct,[e[15]||(e[15]=t("span",{class:"label"},"User:",-1)),t("span",null,l(n.value?.userEmail),1)]),t("div",pt,[e[16]||(e[16]=t("span",{class:"label"},"Action:",-1)),t("span",{class:h(["action-badge",b(n.value?.action)])},l(n.value?.action),3)]),t("div",vt,[e[17]||(e[17]=t("span",{class:"label"},"Entity:",-1)),t("span",null,l(n.value?.entityType)+" - "+l(n.value?.entityName),1)]),n.value?.ipAddress?(i(),d("div",ft,[e[18]||(e[18]=t("span",{class:"label"},"IP Address:",-1)),t("span",null,l(n.value.ipAddress),1)])):y("",!0),n.value?.oldValues?(i(),d("div",mt,[e[19]||(e[19]=t("h4",null,"Previous Values",-1)),t("pre",yt,l(g(n.value.oldValues)),1)])):y("",!0),n.value?.newValues?(i(),d("div",gt,[e[20]||(e[20]=t("h4",null,"New Values",-1)),t("pre",bt,l(g(n.value.newValues)),1)])):y("",!0)])])])):y("",!0)]))}},Dt=U(_t,[["__scopeId","data-v-9a250f7d"]]);export{Dt as default};
