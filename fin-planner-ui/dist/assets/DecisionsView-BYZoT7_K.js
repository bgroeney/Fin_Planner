import{_ as le,r,k as U,i as ae,B as v,c as n,o as a,a as e,v as ne,x as P,y as oe,F as h,q as M,g as w,b as ie,d,n as y,t as o,e as j,z as G,m as Z,G as re}from"./index-D2Wtd9Sa.js";import{M as L}from"./MoneyBoxLoader-CzLxqCX3.js";const de={class:"decisions-page animate-fade-in"},ce={class:"flex-between mb-lg items-start"},ue={class:"flex gap-md"},ve={class:"portfolio-select-wrapper"},me=["value"],pe=["disabled"],be={key:0,class:"empty-state-large card flex-center flex-col p-xl"},fe={key:1},ge={class:"stats-row mb-lg"},he={class:"count"},ye={class:"count"},ke={class:"count"},we={class:"count"},xe={class:"flex-between mb-md border-bottom pb-sm"},_e={class:"tabs"},De=["onClick"],Ce={class:"flex gap-sm"},Ae=["disabled"],$e={key:0,class:"spinner-sm mr-sm"},Ie=["disabled"],Me={key:0,class:"spinner-sm mr-sm"},Be={key:1,class:"mr-sm text-accent",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Se={key:0,class:"flex-center p-xl"},Ve={key:1,class:"modal-backdrop"},Te={class:"card p-xl"},Pe={key:2,class:"empty-state card flex-center flex-col p-lg"},je={class:"flex gap-md mt-md"},Le=["disabled"],Re={key:0,class:"spinner-sm mr-sm"},Ne={key:3,class:"decisions-table-container card"},He={class:"table"},ze=["onClick"],Fe={class:"font-medium"},Ee={class:"text-xs text-muted truncate max-w-md"},Ue={class:"flex items-center gap-xs"},Ge={key:0,class:"text-accent",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ze={class:"text-right"},qe=["onClick"],Oe=["onClick"],Je=["onClick"],Ke=["onClick"],Qe=["onClick"],We=["onClick"],Xe=["onClick"],Ye={class:"modal-header flex-between mb-lg"},et={class:"modal-body mb-lg"},tt={key:0,class:"view-mode"},st={class:"flex-between mb-md"},lt={class:"flex items-center gap-md"},at={class:"text-muted text-sm"},nt={key:0,class:"history-view animate-fade-in"},ot={key:0,class:"flex-center p-md"},it={key:1,class:"text-muted text-sm p-md italic"},rt={key:2,class:"history-list"},dt={class:"flex-between text-xs mb-xs"},ct={class:"font-bold uppercase text-accent"},ut={class:"text-muted"},vt={class:"text-sm m-0"},mt={class:"text-xs text-muted mt-xs italic"},pt={key:1,class:"details-view"},bt={class:"mb-md"},ft={class:"info-block bg-gray-50 p-md radius-md mb-md"},gt={class:"markdown-text"},ht={key:0,class:"text-accent text-sm font-bold flex items-center gap-xs"},yt={key:1,class:"edit-mode"},kt={class:"form-group"},wt={class:"form-group"},xt={class:"modal-footer flex-end gap-md"},_t={__name:"DecisionsView",setup(Dt){const C=r([]),c=r(null),b=r([]),B=r(!1),x=r(!1),k=r(!1),i=r("All"),S=r([]),V=r(!1),_=r(!0),D=r(!1),m=r("view"),u=r(null),p=r({title:"",rationale:""}),A=U(()=>({pending:b.value.filter(s=>s.status==="Pending").length,draft:b.value.filter(s=>s.status==="Draft").length,toBeImplemented:b.value.filter(s=>s.status==="To be implemented").length,implemented:b.value.filter(s=>s.status==="Implemented").length,deleted:b.value.filter(s=>s.status==="Deleted").length})),R=U(()=>i.value==="All"?b.value.filter(s=>s.status!=="Deleted"):b.value.filter(s=>s.status===i.value));ae(async()=>{await q()});const q=async()=>{try{const s=await v.get("/portfolios");C.value=s.data,C.value.length>0&&(c.value=C.value[0].id,g())}catch(s){console.error("Failed to fetch portfolios",s)}},O=()=>{g()},g=async()=>{if(c.value){B.value=!0;try{const s=await v.get(`/decisions/portfolio/${c.value}`);b.value=s.data}catch(s){console.error(s)}finally{B.value=!1}}},J=async()=>{if(c.value){x.value=!0;try{await v.post(`/decisions/ai-recommendations/${c.value}`),await g(),i.value="Pending"}catch(s){alert("Failed to generate recommendations: "+(s.response?.data||s.message))}finally{x.value=!1}}},N=async()=>{if(c.value&&confirm("Generate retroactive decisions for existing history? This will create 'Implemented' decisions for past Buy/Sell transactions.")){k.value=!0;try{const s=await v.post(`/decisions/backfill/${c.value}`);alert(s.data.message),g()}catch(s){console.error(s),alert("Backfill failed: "+(s.response?.data?.message||s.message))}finally{k.value=!1}}},H=()=>{m.value="create",p.value={title:"",rationale:""},D.value=!0},z=s=>{u.value=s,m.value="view",_.value=!0,D.value=!0,K(s.id)},K=async s=>{V.value=!0;try{const t=await v.get(`/decisions/${s}/history`);S.value=t.data}catch(t){console.error("Failed to fetch history",t)}finally{V.value=!1}},Q=s=>{u.value=s,p.value={title:s.title,rationale:s.rationale},m.value="edit",D.value=!0},F=async s=>{try{const t={portfolioId:c.value,title:p.value.title,rationale:p.value.rationale,saveAsDraft:s};m.value==="create"?await v.post("/decisions",t):(await v.put(`/decisions/${u.value.id}`,t),s||await v.put(`/decisions/${u.value.id}/submit`)),I(),g()}catch(t){console.error(t),alert("Failed to save")}},W=async s=>{confirm("Submit this decision for approval?")&&await $(`/decisions/${s}/submit`)},X=async s=>{await $(`/decisions/${s}/approve`)},Y=async s=>{confirm("Reject this decision?")&&await $(`/decisions/${s}/reject`)},ee=async s=>{confirm("Mark this decision as implemented?")&&await $(`/decisions/${s}/implement`)},te=async s=>{if(confirm("Are you sure you want to delete this decision? It will be moved to the Deleted tab."))try{await v.delete(`/decisions/${s}`),g()}catch(t){console.error(t),alert("Delete failed")}},$=async s=>{try{await v.put(s),g()}catch(t){console.error(t),alert("Action failed")}},I=()=>{D.value=!1,u.value=null,p.value={title:"",rationale:""}},T=s=>new Date(s).toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"}),se=(s,t)=>s&&s.length>t?s.substring(0,t)+"...":s,E=s=>{switch(s){case"Approved":return"badge-success";case"To be implemented":return"badge-primary";case"Implemented":return"badge-success";case"Rejected":return"badge-danger";case"Draft":return"badge-muted";case"Deleted":return"badge-danger";default:return"badge-warning"}};return(s,t)=>(a(),n("div",de,[e("div",ce,[t[15]||(t[15]=e("div",null,[e("h1",null,"Decisions"),e("p",{class:"text-muted"},"Track, approve, and implement portfolio decisions")],-1)),e("div",ue,[e("div",ve,[P(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>c.value=l),onChange:O,class:"portfolio-select"},[t[12]||(t[12]=e("option",{value:null,disabled:""},"Select Portfolio",-1)),(a(!0),n(h,null,M(C.value,l=>(a(),n("option",{key:l.id,value:l.id},o(l.name),9,me))),128))],544),[[oe,c.value]]),t[13]||(t[13]=e("svg",{class:"select-icon",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m6 9 6 6 6-6"})],-1))]),e("button",{onClick:H,class:"btn btn-primary",disabled:!c.value},[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 5v14M5 12h14"})],-1),w(" New Decision ",-1)])],8,pe)])]),c.value?(a(),n("div",fe,[e("div",ge,[e("div",{class:y(["stat-badge pending",{active:i.value==="Pending"}]),onClick:t[1]||(t[1]=l=>i.value="Pending")},[e("span",he,o(A.value.pending),1),t[17]||(t[17]=e("span",{class:"label"},"Pending",-1))],2),e("div",{class:y(["stat-badge draft",{active:i.value==="Draft"}]),onClick:t[2]||(t[2]=l=>i.value="Draft")},[e("span",ye,o(A.value.draft),1),t[18]||(t[18]=e("span",{class:"label"},"Drafts",-1))],2),e("div",{class:y(["stat-badge to-be-implemented",{active:i.value==="To be implemented"}]),onClick:t[3]||(t[3]=l=>i.value="To be implemented")},[e("span",ke,o(A.value.toBeImplemented),1),t[19]||(t[19]=e("span",{class:"label"},"Ready to Implement",-1))],2),e("div",{class:y(["stat-badge implemented",{active:i.value==="Implemented"}]),onClick:t[4]||(t[4]=l=>i.value="Implemented")},[e("span",we,o(A.value.implemented),1),t[20]||(t[20]=e("span",{class:"label"},"Implemented",-1))],2)]),e("div",xe,[e("div",_e,[(a(),n(h,null,M(["All","Pending","Draft","To be implemented","Implemented","Rejected","Deleted"],l=>e("button",{key:l,class:y(["tab",{active:i.value===l}]),onClick:f=>i.value=l},o(l),11,De)),64))]),e("div",Ce,[e("button",{onClick:N,class:"btn btn-ghost btn-sm",disabled:k.value},[k.value?(a(),n("span",$e)):d("",!0),t[21]||(t[21]=w(" Sync History ",-1))],8,Ae),e("button",{onClick:J,class:"btn btn-secondary btn-sm",disabled:x.value},[x.value?(a(),n("span",Me)):(a(),n("svg",Be,[...t[22]||(t[22]=[e("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"},null,-1)])])),t[23]||(t[23]=w(" AI Recommendations ",-1))],8,Ie)])]),B.value?(a(),n("div",Se,[j(L,{size:"lg",text:"Loading Decisions..."})])):d("",!0),x.value?(a(),n("div",Ve,[e("div",Te,[j(L,{size:"lg",text:"AI is Analyzing Market Opportunities..."})])])):R.value.length===0?(a(),n("div",Pe,[t[25]||(t[25]=e("p",null,"No decisions found for this filter.",-1)),e("div",je,[i.value==="Draft"||i.value==="All"?(a(),n("button",{key:0,onClick:H,class:"btn btn-primary"},"Create First Draft")):d("",!0),i.value==="All"||i.value==="Implemented"?(a(),n("button",{key:1,onClick:N,class:"btn btn-secondary",disabled:k.value},[k.value?(a(),n("span",Re)):d("",!0),t[24]||(t[24]=w(" Generate from History ",-1))],8,Le)):d("",!0)])])):(a(),n("div",Ne,[e("table",He,[t[27]||(t[27]=e("thead",null,[e("tr",null,[e("th",null,"Date"),e("th",null,"Decision"),e("th",null,"Type"),e("th",null,"Status"),e("th",{class:"text-right"},"Actions")])],-1)),e("tbody",null,[(a(!0),n(h,null,M(R.value,l=>(a(),n("tr",{key:l.id,onClick:f=>z(l),class:"clickable-row"},[e("td",null,o(T(l.createdAt)),1),e("td",null,[e("div",Fe,o(l.title||"Untitled"),1),e("div",Ee,o(se(l.rationale,80)),1)]),e("td",null,[e("span",Ue,[l.type==="AI"?(a(),n("svg",Ge,[...t[26]||(t[26]=[e("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"},null,-1)])])):d("",!0),w(" "+o(l.type),1)])]),e("td",null,[e("span",{class:y(["badge",E(l.status)])},o(l.status),3)]),e("td",Ze,[e("div",{class:"flex-end gap-xs",onClick:t[5]||(t[5]=Z(()=>{},["stop"]))},[e("button",{onClick:f=>z(l),class:"btn btn-ghost btn-xs"},"View",8,qe),l.status==="Draft"?(a(),n(h,{key:0},[e("button",{onClick:f=>Q(l),class:"btn btn-secondary btn-xs"},"Edit",8,Oe),e("button",{onClick:f=>W(l.id),class:"btn btn-primary btn-xs"},"Submit",8,Je)],64)):d("",!0),l.status==="Pending"?(a(),n(h,{key:1},[e("button",{onClick:f=>X(l.id),class:"btn btn-success btn-xs",title:"Approve"},"✓",8,Ke),e("button",{onClick:f=>Y(l.id),class:"btn btn-danger-outline btn-xs",title:"Reject"},"✗",8,Qe)],64)):d("",!0),l.status==="To be implemented"?(a(),n("button",{key:2,onClick:f=>ee(l.id),class:"btn btn-primary btn-xs"},"Mark Implemented",8,We)):d("",!0),l.status!=="Deleted"?(a(),n("button",{key:3,onClick:f=>te(l.id),class:"btn btn-danger-outline btn-xs",title:"Soft Delete"},"Delete",8,Xe)):d("",!0)])])],8,ze))),128))])])]))])):(a(),n("div",be,[...t[16]||(t[16]=[ie('<div class="empty-icon-bg mb-md" data-v-8100a531><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-8100a531><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" data-v-8100a531></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" data-v-8100a531></polyline><line x1="12" y1="22.08" x2="12" y2="12" data-v-8100a531></line></svg></div><h3 data-v-8100a531>Select a Portfolio</h3><p data-v-8100a531>Please select a portfolio to view and manage decisions.</p>',3)])])),(a(),ne(re,{to:"body"},[D.value?(a(),n("div",{key:0,class:"modal-backdrop",onClick:I},[e("div",{class:"modal card",onClick:t[11]||(t[11]=Z(()=>{},["stop"]))},[e("div",Ye,[e("h2",null,o(m.value==="create"?"New Decision":m.value==="edit"?"Edit Decision":"Decision Details"),1),e("button",{onClick:I,class:"btn-close"},"×")]),e("div",et,[m.value==="view"?(a(),n("div",tt,[e("div",st,[e("div",lt,[e("span",{class:y(["badge",E(u.value.status)])},o(u.value.status),3),e("span",at,o(T(u.value.createdAt)),1)]),e("button",{onClick:t[6]||(t[6]=l=>_.value=!_.value),class:"btn btn-ghost btn-xs"},o(_.value?"View Details":"View History"),1)]),_.value?(a(),n("div",nt,[t[28]||(t[28]=e("h4",{class:"mb-sm"},"Decision History",-1)),V.value?(a(),n("div",ot,[j(L,{size:"sm"})])):S.value.length===0?(a(),n("div",it," No history recorded for this decision. ")):(a(),n("div",rt,[(a(!0),n(h,null,M(S.value,l=>(a(),n("div",{key:l.id,class:"history-item mb-sm border-bottom-subtle pb-xs"},[e("div",dt,[e("span",ct,o(l.action),1),e("span",ut,o(T(l.timestamp)),1)]),e("p",vt,o(l.details),1),e("div",mt,"By: "+o(l.userEmail),1)]))),128))]))])):(a(),n("div",pt,[e("h3",bt,o(u.value.title),1),e("div",ft,[t[29]||(t[29]=e("label",null,"Rationale / Analysis",-1)),e("div",gt,o(u.value.rationale),1)]),u.value.type==="AI"?(a(),n("span",ht,[...t[30]||(t[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"})],-1),w(" AI Generated Recommendation ",-1)])])):d("",!0)]))])):(a(),n("div",yt,[e("div",kt,[t[31]||(t[31]=e("label",null,"Title",-1)),P(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>p.value.title=l),placeholder:"e.g. Rebalance Defensive Assets"},null,512),[[G,p.value.title]])]),e("div",wt,[t[32]||(t[32]=e("label",null,"Rationale",-1)),P(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=l=>p.value.rationale=l),rows:"6",placeholder:"Explain the reasoning behind this decision..."},null,512),[[G,p.value.rationale]])])]))]),e("div",xt,[e("button",{onClick:I,class:"btn btn-secondary"},"Close"),m.value==="create"||m.value==="edit"?(a(),n(h,{key:0},[e("button",{onClick:t[9]||(t[9]=l=>F(!0)),class:"btn btn-secondary"},"Save Draft"),e("button",{onClick:t[10]||(t[10]=l=>F(!1)),class:"btn btn-primary"},"Submit for Approval")],64)):d("",!0)])])])):d("",!0)]))]))}},$t=le(_t,[["__scopeId","data-v-8100a531"]]);export{$t as default};
