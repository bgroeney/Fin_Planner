import{_ as se,w as le,x as ae,s as p,o as a,c as n,a as e,e as k,b as ne,n as y,t as o,F as w,l as S,f as r,d as T,i as oe,k as V,p as G,v as U,m as Z,G as ie,z as P,g as d}from"./index-oVbs5Hxd.js";import{usePortfolioStore as re}from"./portfolio-CjZnfIUI.js";import{_ as j}from"./MoneyBoxLoader-BOnNyVJS.js";import{a as N}from"./formatters-DwG4QyEz.js";const de={class:"decisions-page animate-fade-in"},ce={class:"flex-between mb-lg items-start"},ue=["disabled"],ve={key:0,class:"empty-state-large card flex-center flex-col p-xl"},me={key:1},pe={class:"stats-row mb-lg"},be={class:"count"},fe={class:"count"},he={class:"count"},ye={class:"count"},ge={class:"flex-between mb-md border-bottom pb-sm"},ke={class:"tabs"},we=["onClick"],_e={class:"flex gap-sm"},xe=["disabled"],De={key:0,class:"spinner-sm mr-sm"},Ce=["disabled"],$e={key:0,class:"spinner-sm mr-sm"},Ae={key:1,class:"mr-sm text-accent",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ie={key:0,class:"flex-center p-xl"},Me={key:1,class:"modal-backdrop"},Be={class:"card p-xl"},Se={key:2,class:"empty-state card flex-center flex-col p-lg"},Te={class:"flex gap-md mt-md"},Ve=["disabled"],Pe={key:0,class:"spinner-sm mr-sm"},je={key:3,class:"decisions-table-container card"},Ne={class:"table"},Re=["onClick"],Le={class:"font-medium"},He={class:"text-xs text-muted truncate max-w-md"},ze={class:"flex items-center gap-xs"},Fe={key:0,class:"text-accent",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ee={class:"text-right"},Ge=["onClick"],Ue=["onClick"],Ze=["onClick"],Oe=["onClick"],qe=["onClick"],Je=["onClick"],Ke=["onClick"],Qe={class:"modal-header flex-between mb-lg"},We={class:"modal-body mb-lg"},Xe={key:0,class:"view-mode"},Ye={class:"flex-between mb-md"},et={class:"flex items-center gap-md"},tt={class:"text-muted text-sm"},st={key:0,class:"history-view animate-fade-in"},lt={key:0,class:"flex-center p-md"},at={key:1,class:"text-muted text-sm p-md italic"},nt={key:2,class:"history-list"},ot={class:"flex-between text-xs mb-xs"},it={class:"font-bold uppercase text-accent"},rt={class:"text-muted"},dt={class:"text-sm m-0"},ct={class:"text-xs text-muted mt-xs italic"},ut={key:1,class:"details-view"},vt={class:"mb-md"},mt={class:"info-block bg-gray-50 p-md radius-md mb-md"},pt={class:"markdown-text"},bt={key:0,class:"text-accent text-sm font-bold flex items-center gap-xs"},ft={key:1,class:"edit-mode"},ht={class:"form-group"},yt={class:"form-group"},gt={class:"modal-footer flex-end gap-md"},kt={__name:"DecisionsView",setup(wt){const O=re(),b=d([]),I=d(!1),_=d(!1),g=d(!1),i=d("All"),M=d([]),B=d(!1),x=d(!0),c=P(()=>O.currentPortfolioId),D=d(!1),v=d("view"),u=d(null),m=d({title:"",rationale:""}),C=P(()=>({pending:b.value.filter(s=>s.status==="Pending").length,draft:b.value.filter(s=>s.status==="Draft").length,toBeImplemented:b.value.filter(s=>s.status==="To be implemented").length,implemented:b.value.filter(s=>s.status==="Implemented").length,deleted:b.value.filter(s=>s.status==="Deleted").length})),R=P(()=>i.value==="All"?b.value.filter(s=>s.status!=="Deleted"):b.value.filter(s=>s.status===i.value));le(c,()=>{h()}),ae(()=>{c.value&&h()});const h=async()=>{if(c.value){I.value=!0;try{const s=await p.get(`/decisions/portfolio/${c.value}`);b.value=s.data}catch(s){console.error(s)}finally{I.value=!1}}},q=async()=>{if(c.value){_.value=!0;try{await p.post(`/decisions/ai-recommendations/${c.value}`),await h(),i.value="Pending"}catch(s){alert("Failed to generate recommendations: "+(s.response?.data||s.message))}finally{_.value=!1}}},L=async()=>{if(c.value&&confirm("Generate retroactive decisions for existing history? This will create 'Implemented' decisions for past Buy/Sell transactions.")){g.value=!0;try{const s=await p.post(`/decisions/backfill/${c.value}`);alert(s.data.message),h()}catch(s){console.error(s),alert("Backfill failed: "+(s.response?.data?.message||s.message))}finally{g.value=!1}}},H=()=>{v.value="create",m.value={title:"",rationale:""},D.value=!0},z=s=>{u.value=s,v.value="view",x.value=!0,D.value=!0,J(s.id)},J=async s=>{B.value=!0;try{const t=await p.get(`/decisions/${s}/history`);M.value=t.data}catch(t){console.error("Failed to fetch history",t)}finally{B.value=!1}},K=s=>{u.value=s,m.value={title:s.title,rationale:s.rationale},v.value="edit",D.value=!0},F=async s=>{try{const t={portfolioId:c.value,title:m.value.title,rationale:m.value.rationale,saveAsDraft:s};v.value==="create"?await p.post("/decisions",t):(await p.put(`/decisions/${u.value.id}`,t),s||await p.put(`/decisions/${u.value.id}/submit`)),A(),h()}catch(t){console.error(t),alert("Failed to save")}},Q=async s=>{confirm("Submit this decision for approval?")&&await $(`/decisions/${s}/submit`)},W=async s=>{await $(`/decisions/${s}/approve`)},X=async s=>{confirm("Reject this decision?")&&await $(`/decisions/${s}/reject`)},Y=async s=>{confirm("Mark this decision as implemented?")&&await $(`/decisions/${s}/implement`)},ee=async s=>{if(confirm("Are you sure you want to delete this decision? It will be moved to the Deleted tab."))try{await p.delete(`/decisions/${s}`),h()}catch(t){console.error(t),alert("Delete failed")}},$=async s=>{try{await p.put(s),h()}catch(t){console.error(t),alert("Action failed")}},A=()=>{D.value=!1,u.value=null,m.value={title:"",rationale:""}},te=(s,t)=>s&&s.length>t?s.substring(0,t)+"...":s,E=s=>{switch(s){case"Approved":return"badge-success";case"To be implemented":return"badge-primary";case"Implemented":return"badge-success";case"Rejected":return"badge-danger";case"Draft":return"badge-muted";case"Deleted":return"badge-danger";default:return"badge-warning"}};return(s,t)=>(a(),n("div",de,[e("div",ce,[t[12]||(t[12]=e("div",null,[e("h1",null,"Decisions"),e("p",{class:"text-muted"},"Track, approve, and implement portfolio decisions")],-1)),e("button",{onClick:H,class:"btn btn-primary",disabled:!c.value},[...t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 5v14M5 12h14"})],-1),k(" New Decision ",-1)])],8,ue)]),c.value?(a(),n("div",me,[e("div",pe,[e("div",{class:y(["stat-badge pending",{active:i.value==="Pending"}]),onClick:t[0]||(t[0]=l=>i.value="Pending")},[e("span",be,o(C.value.pending),1),t[14]||(t[14]=e("span",{class:"label"},"Pending",-1))],2),e("div",{class:y(["stat-badge draft",{active:i.value==="Draft"}]),onClick:t[1]||(t[1]=l=>i.value="Draft")},[e("span",fe,o(C.value.draft),1),t[15]||(t[15]=e("span",{class:"label"},"Drafts",-1))],2),e("div",{class:y(["stat-badge to-be-implemented",{active:i.value==="To be implemented"}]),onClick:t[2]||(t[2]=l=>i.value="To be implemented")},[e("span",he,o(C.value.toBeImplemented),1),t[16]||(t[16]=e("span",{class:"label"},"Ready to Implement",-1))],2),e("div",{class:y(["stat-badge implemented",{active:i.value==="Implemented"}]),onClick:t[3]||(t[3]=l=>i.value="Implemented")},[e("span",ye,o(C.value.implemented),1),t[17]||(t[17]=e("span",{class:"label"},"Implemented",-1))],2)]),e("div",ge,[e("div",ke,[(a(),n(w,null,S(["All","Pending","Draft","To be implemented","Implemented","Rejected","Deleted"],l=>e("button",{key:l,class:y(["tab",{active:i.value===l}]),onClick:f=>i.value=l},o(l),11,we)),64))]),e("div",_e,[e("button",{onClick:L,class:"btn btn-ghost btn-sm",disabled:g.value},[g.value?(a(),n("span",De)):r("",!0),t[18]||(t[18]=k(" Sync History ",-1))],8,xe),e("button",{onClick:q,class:"btn btn-secondary btn-sm",disabled:_.value},[_.value?(a(),n("span",$e)):(a(),n("svg",Ae,[...t[19]||(t[19]=[e("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"},null,-1)])])),t[20]||(t[20]=k(" AI Recommendations ",-1))],8,Ce)])]),I.value?(a(),n("div",Ie,[T(j,{size:"lg",text:"Loading Decisions..."})])):r("",!0),_.value?(a(),n("div",Me,[e("div",Be,[T(j,{size:"lg",text:"AI is Analyzing Market Opportunities..."})])])):R.value.length===0?(a(),n("div",Se,[t[22]||(t[22]=e("p",null,"No decisions found for this filter.",-1)),e("div",Te,[i.value==="Draft"||i.value==="All"?(a(),n("button",{key:0,onClick:H,class:"btn btn-primary"},"Create First Draft")):r("",!0),i.value==="All"||i.value==="Implemented"?(a(),n("button",{key:1,onClick:L,class:"btn btn-secondary",disabled:g.value},[g.value?(a(),n("span",Pe)):r("",!0),t[21]||(t[21]=k(" Generate from History ",-1))],8,Ve)):r("",!0)])])):(a(),n("div",je,[e("table",Ne,[t[24]||(t[24]=e("thead",null,[e("tr",null,[e("th",null,"Date"),e("th",null,"Decision"),e("th",null,"Type"),e("th",null,"Status"),e("th",{class:"text-right"},"Actions")])],-1)),e("tbody",null,[(a(!0),n(w,null,S(R.value,l=>(a(),n("tr",{key:l.id,onClick:f=>z(l),class:"clickable-row"},[e("td",null,o(V(N)(l.createdAt)),1),e("td",null,[e("div",Le,o(l.title||"Untitled"),1),e("div",He,o(te(l.rationale,80)),1)]),e("td",null,[e("span",ze,[l.type==="AI"?(a(),n("svg",Fe,[...t[23]||(t[23]=[e("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"},null,-1)])])):r("",!0),k(" "+o(l.type),1)])]),e("td",null,[e("span",{class:y(["badge",E(l.status)])},o(l.status),3)]),e("td",Ee,[e("div",{class:"flex-end gap-xs",onClick:t[4]||(t[4]=Z(()=>{},["stop"]))},[e("button",{onClick:f=>z(l),class:"btn btn-ghost btn-xs"},"View",8,Ge),l.status==="Draft"?(a(),n(w,{key:0},[e("button",{onClick:f=>K(l),class:"btn btn-secondary btn-xs"},"Edit",8,Ue),e("button",{onClick:f=>Q(l.id),class:"btn btn-primary btn-xs"},"Submit",8,Ze)],64)):r("",!0),l.status==="Pending"?(a(),n(w,{key:1},[e("button",{onClick:f=>W(l.id),class:"btn btn-success btn-xs",title:"Approve"},"✓",8,Oe),e("button",{onClick:f=>X(l.id),class:"btn btn-danger-outline btn-xs",title:"Reject"},"✗",8,qe)],64)):r("",!0),l.status==="To be implemented"?(a(),n("button",{key:2,onClick:f=>Y(l.id),class:"btn btn-primary btn-xs"},"Mark Implemented",8,Je)):r("",!0),l.status!=="Deleted"?(a(),n("button",{key:3,onClick:f=>ee(l.id),class:"btn btn-danger-outline btn-xs",title:"Soft Delete"},"Delete",8,Ke)):r("",!0)])])],8,Re))),128))])])]))])):(a(),n("div",ve,[...t[13]||(t[13]=[ne('<div class="empty-icon-bg mb-md" data-v-4fec925a><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-4fec925a><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" data-v-4fec925a></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" data-v-4fec925a></polyline><line x1="12" y1="22.08" x2="12" y2="12" data-v-4fec925a></line></svg></div><h3 data-v-4fec925a>No Portfolio Selected</h3><p data-v-4fec925a>Please select a portfolio from the header to view and manage decisions.</p>',3)])])),(a(),oe(ie,{to:"body"},[D.value?(a(),n("div",{key:0,class:"modal-backdrop",onClick:A},[e("div",{class:"modal card",onClick:t[10]||(t[10]=Z(()=>{},["stop"]))},[e("div",Qe,[e("h2",null,o(v.value==="create"?"New Decision":v.value==="edit"?"Edit Decision":"Decision Details"),1),e("button",{onClick:A,class:"btn-close"},"×")]),e("div",We,[v.value==="view"?(a(),n("div",Xe,[e("div",Ye,[e("div",et,[e("span",{class:y(["badge",E(u.value.status)])},o(u.value.status),3),e("span",tt,o(V(N)(u.value.createdAt)),1)]),e("button",{onClick:t[5]||(t[5]=l=>x.value=!x.value),class:"btn btn-ghost btn-xs"},o(x.value?"View Details":"View History"),1)]),x.value?(a(),n("div",st,[t[25]||(t[25]=e("h4",{class:"mb-sm"},"Decision History",-1)),B.value?(a(),n("div",lt,[T(j,{size:"sm"})])):M.value.length===0?(a(),n("div",at," No history recorded for this decision. ")):(a(),n("div",nt,[(a(!0),n(w,null,S(M.value,l=>(a(),n("div",{key:l.id,class:"history-item mb-sm border-bottom-subtle pb-xs"},[e("div",ot,[e("span",it,o(l.action),1),e("span",rt,o(V(N)(l.timestamp)),1)]),e("p",dt,o(l.details),1),e("div",ct,"By: "+o(l.userEmail),1)]))),128))]))])):(a(),n("div",ut,[e("h3",vt,o(u.value.title),1),e("div",mt,[t[26]||(t[26]=e("label",null,"Rationale / Analysis",-1)),e("div",pt,o(u.value.rationale),1)]),u.value.type==="AI"?(a(),n("span",bt,[...t[27]||(t[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"})],-1),k(" AI Generated Recommendation ",-1)])])):r("",!0)]))])):(a(),n("div",ft,[e("div",ht,[t[28]||(t[28]=e("label",null,"Title",-1)),G(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>m.value.title=l),placeholder:"e.g. Rebalance Defensive Assets"},null,512),[[U,m.value.title]])]),e("div",yt,[t[29]||(t[29]=e("label",null,"Rationale",-1)),G(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>m.value.rationale=l),rows:"6",placeholder:"Explain the reasoning behind this decision..."},null,512),[[U,m.value.rationale]])])]))]),e("div",gt,[e("button",{onClick:A,class:"btn btn-secondary"},"Close"),v.value==="create"||v.value==="edit"?(a(),n(w,{key:0},[e("button",{onClick:t[8]||(t[8]=l=>F(!0)),class:"btn btn-secondary"},"Save Draft"),e("button",{onClick:t[9]||(t[9]=l=>F(!1)),class:"btn btn-primary"},"Submit for Approval")],64)):r("",!0)])])])):r("",!0)]))]))}},$t=se(kt,[["__scopeId","data-v-4fec925a"]]);export{$t as default};
