import{x as Se,w as Ue,z as J,o as l,c as a,a as e,n as N,e as E,F as I,l as Y,t as y,f as P,m as G,D as Q,i as $e,B as tt,G as De,p as H,v as W,H as Fe,g as h,I as Ve,s as Z,d as pe,b as _e,_ as Ne,j as Ee,T as qe,C as Ge,A as st,h as nt,r as lt}from"./index-oVbs5Hxd.js";import{usePortfolioStore as at}from"./portfolio-CjZnfIUI.js";import{P as ot,f as Je,c as it,r as rt}from"./PropertyRiskAnalyzer-DayF37os.js";import{_ as He}from"./MoneyBoxLoader-BOnNyVJS.js";const ut={class:"detailed-model"},dt={class:"model-toolbar"},ct={class:"toolbar-section"},vt={class:"view-toggle"},pt={class:"spreadsheet"},mt={class:"section-header"},ft={colspan:"100%"},yt={class:"row-header sticky-col"},gt={class:"row-label"},ht=["onClick"],bt=["onClick"],kt=["onClick","onDblclick","onContextmenu"],wt=["value"],$t={class:"cell-value"},xt={key:0,class:"lock-icon",title:"Manually overridden"},Ct={key:1,class:"lock-icon mixed",title:"Locked due to monthly inputs"},Rt={class:"add-row"},Dt={colspan:"100%"},Pt={class:"row-header sticky-col"},Vt={class:"row-label"},_t={class:"cell-value"},St={class:"section-header"},Mt={colspan:"100%"},At={class:"row-header sticky-col"},Lt=["onClick"],Bt=["onClick"],Ft=["onClick","onDblclick","onContextmenu"],Et=["value"],Ut={class:"cell-value"},Nt={key:0,class:"lock-icon",title:"Manually overridden"},Tt={key:1,class:"lock-icon mixed",title:"Locked due to monthly inputs"},Ot={class:"add-row"},It={colspan:"100%"},qt={class:"row-header sticky-col"},Gt={class:"row-label"},Jt={class:"cell-value"},Ht={class:"section-header"},Yt={colspan:"100%"},zt={class:"row-header sticky-col"},jt={class:"row-label"},Wt=["onClick"],Kt=["onClick"],Qt=["onClick","onDblclick","onContextmenu"],Xt=["value"],Zt={class:"cell-value"},es={key:0,class:"lock-icon",title:"Manually overridden"},ts={key:1,class:"lock-icon mixed",title:"Locked due to monthly inputs"},ss={class:"add-row"},ns={colspan:"100%"},ls={class:"section-header summary-section"},as={colspan:"100%"},os={class:"row-header sticky-col"},is={class:"row-label summary-label"},rs={class:"cell-value"},us=["disabled"],ds={class:"modal"},cs={class:"modal-header"},vs={class:"form-group"},ps={class:"form-row"},ms={class:"form-group"},fs={class:"form-group"},ys={class:"modal-actions"},gs={class:"modal"},hs={class:"modal-header"},bs={class:"form-group"},ks={class:"form-row"},ws={class:"form-group"},$s={class:"form-group"},xs={class:"modal-actions"},Cs={class:"modal"},Rs={class:"modal-header"},Ds={class:"form-group"},Ps={class:"form-group"},Vs={class:"modal-actions"},_s={__name:"CashflowSpreadsheet",props:{deal:{type:Object,required:!0},holdingPeriod:{type:Number,default:10},initialOverridesJson:{type:String,default:null}},emits:["update:overrides","apply-changes"],setup(w,{emit:se}){const F=w,K=se,L=h("years"),B=Fe({income:!0,expenses:!0,financing:!0,summary:!0}),$=h(null),c=h(null),T=h(""),U=h(""),A=h(null),ee=h(null),R=Fe({}),V=h([]),b=h([]),_=h([]),M=Fe({visible:!1,x:0,y:0,rowId:"",colIdx:-1}),k=h(!1),p=h(!1),O=h(!1),D=h({label:"",amount:0,growth:3}),v=h({label:"",amount:0,growth:2.5}),S=h({label:"",amount:0});Se(()=>{console.log("[CashflowSpreadsheet] Mounted with:",{deal:F.deal,holdingPeriod:F.holdingPeriod,columnsCount:x.value.length,incomeRowsCount:te.value.length,expenseRowsCount:le.value.length,firstIncomeRow:te.value[0],columns:x.value.slice(0,3)}),te.value[0]&&x.value.length>0&&console.log("[CashflowSpreadsheet] First cell value:",g(te.value[0],0))}),Ue(()=>F.initialOverridesJson,o=>{if(o)try{const t=JSON.parse(o);Object.keys(R).forEach(n=>delete R[n]),Object.assign(R,t)}catch(t){console.error("Failed to parse overrides",t)}},{immediate:!0});const x=J(()=>{const o=[],t=F.holdingPeriod||10;if(L.value==="years")for(let n=1;n<=t;n++)o.push({key:`Y${n}`,label:`Year ${n}`,year:n,isYearTotal:!1});else for(let n=1;n<=t;n++){for(let r=1;r<=12;r++)o.push({key:`Y${n}M${r}`,label:`M${r}`,year:n,month:r,isYearStart:r===1,isYearTotal:!1});o.push({key:`Y${n}Total`,label:`Y${n}`,year:n,isYearTotal:!0})}return o}),oe=J(()=>{const o=F.deal||{},t=o.estimatedGrossRent||0,n=o.vacancyRatePercent||5,r=o.rentalGrowthPercent||2.5;return[{id:"grossRent",label:"Gross Rent",baseValue:t,growth:r/100,editable:!0},{id:"vacancy",label:"Less: Vacancy Allowance",baseValue:t*(n/100),growth:0,editable:!0,isExpense:!0},...b.value.map(d=>({id:d.id,label:d.label,isCustom:!0,baseValue:d.amount||0,growth:(d.growth||2.5)/100,editable:!0}))]}),be=J(()=>[{id:"netRentalIncome",label:"Net Rental Income",isCalculated:!0,formula:o=>{let t=(o.grossRent||0)-(o.vacancy||0);return b.value.forEach(n=>{t+=o[n.id]||0}),t}}]),te=J(()=>[...oe.value,...be.value]),ne=J(()=>{const o=F.deal||{},t=(o.outgoingsGrowthPercent||3)/100,n=o.outgoingsEstimate||1e4,r=o.estimatedGrossRent||0,d=o.vacancyRatePercent||5,m=o.managementFeePercent||7,de=r*(1-d/100);return[{id:"councilRates",label:"Council Rates",isChild:!0,baseValue:n*.35,growth:t,editable:!0},{id:"waterRates",label:"Water Rates",isChild:!0,baseValue:n*.1,growth:t,editable:!0},{id:"insurance",label:"Insurance",isChild:!0,baseValue:n*.2,growth:t,editable:!0},{id:"maintenance",label:"Repairs & Maintenance",isChild:!0,baseValue:n*.25,growth:t,editable:!0},{id:"managementFee",label:"Management Fee",isChild:!0,baseValue:de*(m/100),growth:t,editable:!0},{id:"otherExpenses",label:"Other",isChild:!0,baseValue:n*.1,growth:t,editable:!0},...V.value.map(j=>({id:j.id,label:j.label,isChild:!0,isCustom:!0,baseValue:j.amount||0,growth:(j.growth||3)/100,editable:!0}))]}),X=J(()=>[{id:"totalExpenses",label:"Total Operating Expenses",isCalculated:!0,formula:o=>{let t=(o.councilRates||0)+(o.waterRates||0)+(o.insurance||0)+(o.maintenance||0)+(o.managementFee||0)+(o.otherExpenses||0);return V.value.forEach(n=>{t+=o[n.id]||0}),t}},{id:"noi",label:"Net Operating Income",isCalculated:!0,formula:o=>(o.netRentalIncome||0)-(o.totalExpenses||0)}]),le=J(()=>[...ne.value,...X.value]),ke=J(()=>{const o=F.deal||{},t=o.loanAmount||0,n=o.interestRatePercent||5;return[{id:"debtService",label:"Debt Service (Interest)",baseValue:t*(n/100),growth:0,editable:!0},..._.value.map(d=>({id:d.id,label:d.label,isCustom:!0,baseValue:d.amount||0,growth:0,editable:!0}))]}),ce=J(()=>ke.value),fe=J(()=>[{id:"netCashflowSummary",label:"Net Cashflow",isCalculated:!0,formula:o=>o.netCashflow||0}]);function ve(o){B[o]=!B[o]}function me(o){if(L.value==="years")return o*12;const t=x.value[o];return t?.isYearTotal?-1:(t.year-1)*12+(t.month-1)}function g(o,t){const n=x.value[t];if(o.isCalculated){const d=q(t);return o.formula(d)}const r=me(t);if(L.value==="years"){let d=0;for(let m=0;m<12;m++){const de=`${o.id}-${t*12+m}`;R[de]!==void 0?d+=R[de]:d+=i(o,t,m)}return o.isExpense?-d:d}else{if(n?.isYearTotal){let de=0;for(let j=0;j<12;j++){const et=(n.year-1)*12+j,Ie=`${o.id}-${et}`;R[Ie]!==void 0?de+=R[Ie]:de+=i(o,n.year-1,j)}return o.isExpense?-de:de}const d=`${o.id}-${r}`;if(R[d]!==void 0)return o.isExpense?-R[d]:R[d];const m=i(o,n.year-1,n.month-1);return o.isExpense?-m:m}}function i(o,t,n=0){const r=o.baseValue||0;if(!r||isNaN(r))return 0;const d=r/12,m=o.growth||0;return d*Math.pow(1+m,t)}function q(o){const t={},n=[...te.value,...le.value,...ce.value];for(const d of n)d.isCalculated||(t[d.id]=Math.abs(g(d,o)));t.netRentalIncome=(t.grossRent||0)-(t.vacancy||0),t.totalExpenses=(t.councilRates||0)+(t.waterRates||0)+(t.insurance||0)+(t.maintenance||0)+(t.managementFee||0)+(t.otherExpenses||0),V.value.forEach(d=>{t.totalExpenses+=t[d.id]||0}),t.noi=t.netRentalIncome-t.totalExpenses;let r=t.debtService||0;return _.value.forEach(d=>{r+=t[d.id]||0}),t.netCashflow=t.noi-r,t}function C(o,t,n){const r=["cell"];return t.isYearTotal&&r.push("year-total"),t.isYearStart&&r.push("year-start"),o.editable&&!t.isYearTotal&&r.push("editable"),o.isCalculated&&r.push("calculated"),$.value?.rowId===o.id&&$.value?.colIdx===n&&r.push("selected"),ae(o.id,n)&&r.push("locked"),he(o.id,n)&&r.push("mixed-locked"),g(o,n)<0&&r.push("negative"),r}function ae(o,t){if(L.value==="years"){for(let r=0;r<12;r++)if(R[`${o}-${t*12+r}`]!==void 0)return!0;return!1}const n=me(t);return n>=0&&R[`${o}-${n}`]!==void 0}function Me(o,t){$.value={rowId:o,colIdx:t}}function xe(o,t){Me(o.id,t),ie(o,t)}function ye(o,t){return c.value?.rowId===o&&c.value?.colIdx===t}function ge(){Ve(()=>{ee.value&&ee.value.focus()})}function he(o,t){if(L.value!=="years")return!1;const n=t*12,r=`${o}-${n}`,d=R[r];if(d===void 0){for(let m=1;m<12;m++)if(R[`${o}-${n+m}`]!==void 0)return!0;return!1}for(let m=1;m<12;m++)if(R[`${o}-${n+m}`]!==d)return!0;return!1}function ie(o,t){const n=x.value[t];o.isCalculated||n?.isYearTotal||he(o.id,t)||(c.value={rowId:o.id,colIdx:t},T.value=Math.abs(g(o,t)).toFixed(0),U.value=T.value,Ve(()=>{const r=document.querySelector(".cell-edit");r&&(r.focus(),r.select())}))}function f(){if(!c.value)return;const{rowId:o,colIdx:t}=c.value,n=parseFloat(T.value)||0,r=parseFloat(U.value)||0;if(Math.abs(n-r)<.01){c.value=null,ge();return}if(L.value==="years"){const d=n/12;for(let m=0;m<12;m++)R[`${o}-${t*12+m}`]=d}else{const d=me(t);d>=0&&(R[`${o}-${d}`]=n)}c.value=null,Re(),ge()}function s(){c.value=null,ge()}function u(o){if(!$.value)return;const{rowId:t,colIdx:n}=$.value,r=[...te.value,...le.value,...ce.value,...fe.value],d=r.findIndex(m=>m.id===t);switch(o){case"right":n<x.value.length-1&&($.value={rowId:t,colIdx:n+1});break;case"left":n>0&&($.value={rowId:t,colIdx:n-1});break;case"down":d<r.length-1&&($.value={rowId:r[d+1].id,colIdx:n});break;case"up":d>0&&($.value={rowId:r[d-1].id,colIdx:n});break}}function re(o){if(!(!$.value||c.value))switch(o.key){case"ArrowRight":o.preventDefault(),u("right");break;case"ArrowLeft":o.preventDefault(),u("left");break;case"ArrowDown":o.preventDefault(),u("down");break;case"ArrowUp":o.preventDefault(),u("up");break;case"Enter":const n=[...te.value,...le.value,...ce.value,...fe.value].find(r=>r.id===$.value.rowId);n?.editable&&ie(n,$.value.colIdx);break;default:if(o.key.length===1&&!o.ctrlKey&&!o.metaKey&&/[0-9.]/.test(o.key)){o.preventDefault();const d=[...te.value,...le.value,...ce.value,...fe.value].find(m=>m.id===$.value.rowId);d?.editable&&(ie(d,$.value.colIdx),Ve(()=>{T.value=o.key}))}break}}function z(o){f(),u(o)}function ue(o,t){const r=o.target.selectionStart,d=T.value.length;if(t==="right"&&r===d){o.preventDefault(),z("right");return}if(t==="left"&&r===0){o.preventDefault(),z("left");return}}function Ae(o,t,n){t.isCalculated||(M.visible=!0,M.x=o.clientX,M.y=o.clientY,M.rowId=t.id,M.colIdx=n)}function Te(){M.visible=!1}function Ce(o){const{rowId:t,colIdx:n}=M;switch(o){case"edit":const r=[...te.value,...le.value,...ce.value].find(d=>d.id===t);r&&ie(r,n);break;case"copyLeft":Oe(t,n,"left");break;case"copyRight":Oe(t,n,"right");break;case"reset":Ye(t,n);break;case"unlockRow":Pe(t);break}Te()}function Le(o){return Object.keys(R).some(t=>t.startsWith(`${o}-`))}function Pe(o){Object.keys(R).forEach(t=>{t.startsWith(`${o}-`)&&delete R[t]}),Re()}function Oe(o,t,n){const r=me(t);if(r<0)return;const d=`${o}-${r}`,m=R[d]??i([...te.value,...le.value,...ce.value].find(j=>j.id===o),Math.floor(r/12),r%12),de=F.holdingPeriod*12;if(n==="right")for(let j=r+1;j<de;j++)R[`${o}-${j}`]=m;else for(let j=0;j<r;j++)R[`${o}-${j}`]=m;Re()}function Ye(o,t){if(L.value==="years")for(let n=0;n<12;n++)delete R[`${o}-${t*12+n}`];else{const n=me(t);n>=0&&delete R[`${o}-${n}`]}Re()}function ze(){Object.keys(R).forEach(o=>delete R[o]),Re()}function je(){D.value.label&&(V.value.push({id:`expense-${Date.now()}`,label:D.value.label,amount:D.value.amount,growth:D.value.growth||3}),D.value={label:"",amount:0,growth:3},k.value=!1)}function We(){v.value.label&&(b.value.push({id:`revenue-${Date.now()}`,label:v.value.label,amount:v.value.amount,growth:v.value.growth||2.5}),v.value={label:"",amount:0,growth:2.5},p.value=!1)}function Ke(){S.value.label&&(_.value.push({id:`debt-${Date.now()}`,label:S.value.label,amount:S.value.amount}),S.value={label:"",amount:0},O.value=!1)}function Qe(o){const t=V.value.findIndex(n=>n.id===o);t>=0&&(V.value.splice(t,1),Object.keys(R).forEach(n=>{n.startsWith(`${o}-`)&&delete R[n]}))}function Xe(o){const t=b.value.findIndex(n=>n.id===o);t>=0&&(b.value.splice(t,1),Object.keys(R).forEach(n=>{n.startsWith(`${o}-`)&&delete R[n]}))}function Ze(o){const t=_.value.findIndex(n=>n.id===o);t>=0&&(_.value.splice(t,1),Object.keys(R).forEach(n=>{n.startsWith(`${o}-`)&&delete R[n]}))}function we(o,t=!1){if(o==null||isNaN(o)||o===0)return"-";const n=Math.abs(o);if(L.value==="months")return n>=1e6?`${Math.round(n/1e6)}m`:n>=1e3?`${Math.round(n/1e3)}k`:Math.round(n).toString();const r=new Intl.NumberFormat("en-AU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(n);return o<0?`(${r})`:r}function Re(){K("update:overrides",JSON.stringify(R))}let Be=null;return Ue(R,()=>{Be&&clearTimeout(Be),Be=setTimeout(()=>{K("update:overrides",JSON.stringify(R))},1e3)},{deep:!0}),(o,t)=>(l(),a("div",ut,[e("div",dt,[e("div",ct,[e("div",vt,[e("button",{class:N(["toggle-btn",{active:L.value==="years"}]),onClick:t[0]||(t[0]=n=>L.value="years")},"Years",2),e("button",{class:N(["toggle-btn",{active:L.value==="months"}]),onClick:t[1]||(t[1]=n=>L.value="months")},"Months",2)])]),e("div",{class:"toolbar-section"},[e("button",{class:"btn btn-secondary btn-sm",onClick:ze,title:"Remove all manual overrides"},[...t[47]||(t[47]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})],-1),E(" Unlock All ",-1)])])])]),e("div",{class:"spreadsheet-wrapper",ref_key:"spreadsheetWrapper",ref:ee,onKeydown:re,tabindex:"0"},[e("table",pt,[e("thead",null,[e("tr",null,[t[48]||(t[48]=e("th",{class:"row-header sticky-col"},"Line Item",-1)),(l(!0),a(I,null,Y(x.value,n=>(l(),a("th",{key:n.key,class:N(["period-col",{"year-boundary":n.isYearStart,"year-total":n.isYearTotal}])},y(n.label),3))),128))])]),e("tbody",null,[e("tr",mt,[e("td",ft,[e("button",{class:"section-toggle",onClick:t[2]||(t[2]=n=>ve("income"))},[(l(),a("svg",{class:N({collapsed:!B.income}),width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...t[49]||(t[49]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2)),t[50]||(t[50]=E(" Income ",-1))])])]),B.income?(l(),a(I,{key:0},[(l(!0),a(I,null,Y(oe.value,n=>(l(),a("tr",{key:n.id,class:N(["data-row",{"calculated-row":n.isCalculated}])},[e("td",yt,[e("span",gt,y(n.label),1),Le(n.id)?(l(),a("button",{key:0,class:"unlock-row-btn",onClick:r=>Pe(n.id),title:"Unlock all cells in this row"},[...t[51]||(t[51]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})],-1)])],8,ht)):P("",!0),n.isCustom?(l(),a("button",{key:1,class:"delete-btn",onClick:r=>Xe(n.id),title:"Remove"},"×",8,bt)):P("",!0)]),(l(!0),a(I,null,Y(x.value,(r,d)=>(l(),a("td",{key:r.key,class:N(C(n,r,d)),onClick:m=>xe(n,d),onDblclick:m=>ie(n,d),onContextmenu:G(m=>Ae(m,n,d),["prevent"])},[ye(n.id,d)?(l(),a("input",{key:0,ref_for:!0,ref_key:"editInput",ref:A,type:"text",class:"cell-edit",value:T.value,onInput:t[3]||(t[3]=m=>T.value=m.target.value),onBlur:f,onKeydown:[Q(f,["enter"]),Q(s,["escape"]),t[4]||(t[4]=Q(G(m=>z("up"),["prevent"]),["up"])),t[5]||(t[5]=Q(G(m=>z("down"),["prevent"]),["down"])),t[6]||(t[6]=Q(m=>ue(m,"left"),["left"])),t[7]||(t[7]=Q(m=>ue(m,"right"),["right"]))]},null,40,wt)):(l(),a(I,{key:1},[e("span",$t,y(we(g(n,d))),1),ae(n.id,d)?(l(),a("span",xt,[...t[52]||(t[52]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):he(n.id,d)?(l(),a("span",Ct,[...t[53]||(t[53]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):P("",!0)],64))],42,kt))),128))],2))),128)),e("tr",Rt,[e("td",Dt,[e("button",{class:"add-btn",onClick:t[8]||(t[8]=n=>p.value=!0)},[...t[54]||(t[54]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" Add Revenue Line ",-1)])])])]),(l(!0),a(I,null,Y(be.value,n=>(l(),a("tr",{key:n.id,class:"data-row calculated-row"},[e("td",Pt,[e("span",Vt,y(n.label),1)]),(l(!0),a(I,null,Y(x.value,(r,d)=>(l(),a("td",{key:r.key,class:N(["cell","calculated",{"year-total":r.isYearTotal}])},[e("span",_t,y(we(g(n,d))),1)],2))),128))]))),128))],64)):P("",!0),e("tr",St,[e("td",Mt,[e("button",{class:"section-toggle",onClick:t[9]||(t[9]=n=>ve("expenses"))},[(l(),a("svg",{class:N({collapsed:!B.expenses}),width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...t[55]||(t[55]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2)),t[56]||(t[56]=E(" Operating Expenses ",-1))])])]),B.expenses?(l(),a(I,{key:1},[(l(!0),a(I,null,Y(ne.value,n=>(l(),a("tr",{key:n.id,class:N(["data-row",{"calculated-row":n.isCalculated,"sub-row":n.isChild}])},[e("td",At,[e("span",{class:N(["row-label",{indented:n.isChild}])},y(n.label),3),Le(n.id)?(l(),a("button",{key:0,class:"unlock-row-btn",onClick:r=>Pe(n.id),title:"Unlock all cells in this row"},[...t[57]||(t[57]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})],-1)])],8,Lt)):P("",!0),n.isCustom?(l(),a("button",{key:1,class:"delete-btn",onClick:r=>Qe(n.id),title:"Remove"},"×",8,Bt)):P("",!0)]),(l(!0),a(I,null,Y(x.value,(r,d)=>(l(),a("td",{key:r.key,class:N(C(n,r,d)),onClick:m=>xe(n,d),onDblclick:m=>ie(n,d),onContextmenu:G(m=>Ae(m,n,d),["prevent"])},[ye(n.id,d)?(l(),a("input",{key:0,ref_for:!0,ref_key:"editInput",ref:A,type:"text",class:"cell-edit",value:T.value,onInput:t[10]||(t[10]=m=>T.value=m.target.value),onBlur:f,onKeydown:[Q(f,["enter"]),Q(s,["escape"]),t[11]||(t[11]=Q(G(m=>z("up"),["prevent"]),["up"])),t[12]||(t[12]=Q(G(m=>z("down"),["prevent"]),["down"])),t[13]||(t[13]=Q(m=>ue(m,"left"),["left"])),t[14]||(t[14]=Q(m=>ue(m,"right"),["right"]))]},null,40,Et)):(l(),a(I,{key:1},[e("span",Ut,y(we(g(n,d),!0)),1),ae(n.id,d)?(l(),a("span",Nt,[...t[58]||(t[58]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):he(n.id,d)?(l(),a("span",Tt,[...t[59]||(t[59]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):P("",!0)],64))],42,Ft))),128))],2))),128)),e("tr",Ot,[e("td",It,[e("button",{class:"add-btn",onClick:t[15]||(t[15]=n=>k.value=!0)},[...t[60]||(t[60]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" Add Expense Line ",-1)])])])]),(l(!0),a(I,null,Y(X.value,n=>(l(),a("tr",{key:n.id,class:"data-row calculated-row"},[e("td",qt,[e("span",Gt,y(n.label),1)]),(l(!0),a(I,null,Y(x.value,(r,d)=>(l(),a("td",{key:r.key,class:N(["cell","calculated",{"year-total":r.isYearTotal}])},[e("span",Jt,y(we(g(n,d),!0)),1)],2))),128))]))),128))],64)):P("",!0),e("tr",Ht,[e("td",Yt,[e("button",{class:"section-toggle",onClick:t[16]||(t[16]=n=>ve("financing"))},[(l(),a("svg",{class:N({collapsed:!B.financing}),width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...t[61]||(t[61]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2)),t[62]||(t[62]=E(" Financing ",-1))])])]),B.financing?(l(),a(I,{key:2},[(l(!0),a(I,null,Y(ke.value,n=>(l(),a("tr",{key:n.id,class:N(["data-row",{"calculated-row":n.isCalculated}])},[e("td",zt,[e("span",jt,y(n.label),1),Le(n.id)?(l(),a("button",{key:0,class:"unlock-row-btn",onClick:r=>Pe(n.id),title:"Unlock all cells in this row"},[...t[63]||(t[63]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})],-1)])],8,Wt)):P("",!0),n.isCustom?(l(),a("button",{key:1,class:"delete-btn",onClick:r=>Ze(n.id),title:"Remove"},"×",8,Kt)):P("",!0)]),(l(!0),a(I,null,Y(x.value,(r,d)=>(l(),a("td",{key:r.key,class:N(C(n,r,d)),onClick:m=>xe(n,d),onDblclick:m=>ie(n,d),onContextmenu:G(m=>Ae(m,n,d),["prevent"])},[ye(n.id,d)?(l(),a("input",{key:0,ref_for:!0,ref_key:"editInput",ref:A,type:"text",class:"cell-edit",value:T.value,onInput:t[17]||(t[17]=m=>T.value=m.target.value),onBlur:f,onKeydown:[Q(f,["enter"]),Q(s,["escape"]),t[18]||(t[18]=Q(G(m=>z("up"),["prevent"]),["up"])),t[19]||(t[19]=Q(G(m=>z("down"),["prevent"]),["down"])),t[20]||(t[20]=Q(m=>ue(m,"left"),["left"])),t[21]||(t[21]=Q(m=>ue(m,"right"),["right"]))]},null,40,Xt)):(l(),a(I,{key:1},[e("span",Zt,y(we(g(n,d),!0)),1),ae(n.id,d)?(l(),a("span",es,[...t[64]||(t[64]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):he(n.id,d)?(l(),a("span",ts,[...t[65]||(t[65]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):P("",!0)],64))],42,Qt))),128))],2))),128)),e("tr",ss,[e("td",ns,[e("button",{class:"add-btn",onClick:t[22]||(t[22]=n=>O.value=!0)},[...t[66]||(t[66]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" Add Debt Line ",-1)])])])])],64)):P("",!0),e("tr",ls,[e("td",as,[e("button",{class:"section-toggle",onClick:t[23]||(t[23]=n=>ve("summary"))},[(l(),a("svg",{class:N({collapsed:!B.summary}),width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...t[67]||(t[67]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2)),t[68]||(t[68]=E(" Summary ",-1))])])]),B.summary?(l(!0),a(I,{key:3},Y(fe.value,n=>(l(),a("tr",{key:n.id,class:N(["data-row","spreadsheet-summary-row"])},[e("td",os,[e("span",is,y(n.label),1)]),(l(!0),a(I,null,Y(x.value,(r,d)=>(l(),a("td",{key:r.key,class:N(["cell","spreadsheet-summary-cell",{"year-total":r.isYearTotal,negative:g(n,d)<0}])},[e("span",rs,y(we(g(n,d))),1)],2))),128))]))),128)):P("",!0)])])],544),(l(),$e(De,{to:"body"},[M.visible?(l(),a("div",{key:0,class:"context-menu",style:tt({top:M.y+"px",left:M.x+"px"}),onClick:t[29]||(t[29]=G(()=>{},["stop"]))},[e("button",{class:"context-item",onClick:t[24]||(t[24]=n=>Ce("edit"))},[...t[69]||(t[69]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1),E(" Edit Value ",-1)])]),e("button",{class:"context-item",onClick:t[25]||(t[25]=n=>Ce("copyLeft"))},[...t[70]||(t[70]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"15 18 9 12 15 6"})],-1),E(" Copy Left ",-1)])]),e("button",{class:"context-item",onClick:t[26]||(t[26]=n=>Ce("copyRight"))},[...t[71]||(t[71]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9 18 15 12 9 6"})],-1),E(" Copy Right ",-1)])]),t[74]||(t[74]=e("div",{class:"context-divider"},null,-1)),e("button",{class:"context-item",onClick:t[27]||(t[27]=n=>Ce("unlockRow"))},[...t[72]||(t[72]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})],-1),E(" Unlock Row ",-1)])]),t[75]||(t[75]=e("div",{class:"context-divider"},null,-1)),e("button",{class:"context-item",onClick:t[28]||(t[28]=n=>Ce("reset")),disabled:!ae(M.rowId,M.colIdx)},[...t[73]||(t[73]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"1 4 1 10 7 10"}),e("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),E(" Reset to Calculated ",-1)])],8,us)],4)):P("",!0),M.visible?(l(),a("div",{key:1,class:"context-backdrop",onClick:Te})):P("",!0)])),(l(),$e(De,{to:"body"},[k.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:t[35]||(t[35]=G(n=>k.value=!1,["self"]))},[e("div",ds,[e("div",cs,[t[76]||(t[76]=e("h3",null,"Add Expense Line Item",-1)),e("button",{class:"modal-close",onClick:t[30]||(t[30]=n=>k.value=!1)},"×")]),e("form",{onSubmit:G(je,["prevent"]),class:"modal-body"},[e("div",vs,[t[77]||(t[77]=e("label",null,"Label",-1)),H(e("input",{"onUpdate:modelValue":t[31]||(t[31]=n=>D.value.label=n),type:"text",required:"",placeholder:"e.g., Body Corporate"},null,512),[[W,D.value.label]])]),e("div",ps,[e("div",ms,[t[78]||(t[78]=e("label",null,"Annual Amount ($)",-1)),H(e("input",{"onUpdate:modelValue":t[32]||(t[32]=n=>D.value.amount=n),type:"number",min:"0",required:""},null,512),[[W,D.value.amount,void 0,{number:!0}]])]),e("div",fs,[t[79]||(t[79]=e("label",null,"Growth Rate (%)",-1)),H(e("input",{"onUpdate:modelValue":t[33]||(t[33]=n=>D.value.growth=n),type:"number",step:"0.5"},null,512),[[W,D.value.growth,void 0,{number:!0}]])])]),e("div",ys,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[34]||(t[34]=n=>k.value=!1)},"Cancel"),t[80]||(t[80]=e("button",{type:"submit",class:"btn btn-primary"},"Add",-1))])],32)])])):P("",!0)])),(l(),$e(De,{to:"body"},[p.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:t[41]||(t[41]=G(n=>p.value=!1,["self"]))},[e("div",gs,[e("div",hs,[t[81]||(t[81]=e("h3",null,"Add Revenue Line Item",-1)),e("button",{class:"modal-close",onClick:t[36]||(t[36]=n=>p.value=!1)},"×")]),e("form",{onSubmit:G(We,["prevent"]),class:"modal-body"},[e("div",bs,[t[82]||(t[82]=e("label",null,"Label",-1)),H(e("input",{"onUpdate:modelValue":t[37]||(t[37]=n=>v.value.label=n),type:"text",required:"",placeholder:"e.g., Parking Income"},null,512),[[W,v.value.label]])]),e("div",ks,[e("div",ws,[t[83]||(t[83]=e("label",null,"Annual Amount ($)",-1)),H(e("input",{"onUpdate:modelValue":t[38]||(t[38]=n=>v.value.amount=n),type:"number",min:"0",required:""},null,512),[[W,v.value.amount,void 0,{number:!0}]])]),e("div",$s,[t[84]||(t[84]=e("label",null,"Growth Rate (%)",-1)),H(e("input",{"onUpdate:modelValue":t[39]||(t[39]=n=>v.value.growth=n),type:"number",step:"0.5"},null,512),[[W,v.value.growth,void 0,{number:!0}]])])]),e("div",xs,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[40]||(t[40]=n=>p.value=!1)},"Cancel"),t[85]||(t[85]=e("button",{type:"submit",class:"btn btn-primary"},"Add",-1))])],32)])])):P("",!0)])),(l(),$e(De,{to:"body"},[O.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:t[46]||(t[46]=G(n=>O.value=!1,["self"]))},[e("div",Cs,[e("div",Rs,[t[86]||(t[86]=e("h3",null,"Add Debt Line Item",-1)),e("button",{class:"modal-close",onClick:t[42]||(t[42]=n=>O.value=!1)},"×")]),e("form",{onSubmit:G(Ke,["prevent"]),class:"modal-body"},[e("div",Ds,[t[87]||(t[87]=e("label",null,"Label",-1)),H(e("input",{"onUpdate:modelValue":t[43]||(t[43]=n=>S.value.label=n),type:"text",required:"",placeholder:"e.g., Second Mortgage"},null,512),[[W,S.value.label]])]),e("div",Ps,[t[88]||(t[88]=e("label",null,"Annual Payment ($)",-1)),H(e("input",{"onUpdate:modelValue":t[44]||(t[44]=n=>S.value.amount=n),type:"number",min:"0",required:""},null,512),[[W,S.value.amount,void 0,{number:!0}]])]),e("div",Vs,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[45]||(t[45]=n=>O.value=!1)},"Cancel"),t[89]||(t[89]=e("button",{type:"submit",class:"btn btn-primary"},"Add",-1))])],32)])])):P("",!0)]))]))}},Ss={class:"lifecycle-stepper"},Ms={class:"stepper-track"},As=["onClick"],Ls={class:"step-indicator"},Bs={class:"step-circle"},Fs={key:0,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},Es={key:1},Us={key:0,class:"step-line"},Ns={class:"step-label"},Ts={class:"step-name"},Os={key:0,class:"step-status"},Is={key:0,class:"lifecycle-actions"},qs={class:"action-left"},Gs={key:0,class:"action-right"},Js={key:0,class:"revert-dropdown-wrapper"},Hs={key:0,class:"revert-menu glass-card"},Ys=["onClick"],zs={key:1,class:"forward-action"},js={class:"next-label"},Ws={__name:"LifecycleStepper",props:{currentStatus:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["request-transition","request-revert","toggle-history"],setup(w,{emit:se}){const F={mounted(b,_){b._clickOutsideHandler=M=>{b===M.target||b.contains(M.target)||_.value(M)},document.body.addEventListener("click",b._clickOutsideHandler)},unmounted(b){document.body.removeEventListener("click",b._clickOutsideHandler)}},K=w,L=se,B=h(!1),$=[{key:"Draft",label:"Draft"},{key:"Under Review",label:"Under Review"},{key:"Proceed to Acquire",label:"Proceed"},{key:"Offer Made",label:"Offer Made"},{key:"Under Due Diligence",label:"Due Diligence"},{key:"Waiting Settlement",label:"Settlement"},{key:"Acquired",label:"Acquired"}],c=J(()=>{const b=$.findIndex(_=>_.key===K.currentStatus);return b===-1?0:b}),T=J(()=>$.slice(0,c.value).reverse()),U=J(()=>c.value===$.length-1),A=J(()=>{if(U.value)return null;const b=$[c.value+1];let _="Advance";return b.key==="Proceed to Acquire"&&(_="Proceed"),b.key==="Offer Made"&&(_="Record Offer"),b.key==="Under Due Diligence"&&(_="Start DD"),b.key==="Acquired"&&(_="Settled"),{label:b.label,key:b.key,buttonText:_}});function ee(b){}function R(b){B.value=!1,L("request-revert",b)}function V(){A.value&&L("request-transition",A.value.key)}return(b,_)=>(l(),a("div",Ss,[e("div",Ms,[(l(),a(I,null,Y($,(M,k)=>e("div",{key:M.key,class:N(["step-item",{active:c.value===k,completed:c.value>k,future:c.value<k}]),onClick:p=>void 0},[e("div",Ls,[e("div",Bs,[c.value>k?(l(),a("svg",Fs,[..._[2]||(_[2]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(l(),a("span",Es,y(k+1),1))]),k<$.length-1?(l(),a("div",Us)):P("",!0)]),e("div",Ns,[e("span",Ts,y(M.label),1),c.value===k?(l(),a("span",Os,"Current Stage")):P("",!0)])],10,As)),64))]),w.loading?P("",!0):(l(),a("div",Is,[e("div",qs,[e("button",{class:"btn-text-icon",onClick:_[0]||(_[0]=M=>b.$emit("toggle-history"))},[..._[3]||(_[3]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1),E(" History ",-1)])])]),U.value?P("",!0):(l(),a("div",Gs,[c.value>0?(l(),a("div",Js,[e("button",{class:"btn-text-danger",onClick:_[1]||(_[1]=G(M=>B.value=!B.value,["stop"]))},[..._[4]||(_[4]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1),E(" Revert Status ",-1)])]),B.value?H((l(),a("div",Hs,[_[5]||(_[5]=e("div",{class:"menu-label"},"Revert to:",-1)),(l(!0),a(I,null,Y(T.value,(M,k)=>(l(),a("button",{key:M.key,class:"menu-item",onClick:p=>R(M.key)},y(M.label),9,Ys))),128))])),[[F,()=>B.value=!1]]):P("",!0)])):P("",!0),A.value?(l(),a("div",zs,[e("span",js,"Next: "+y(A.value.label),1),e("button",{class:"btn btn-primary btn-sm",onClick:V},[E(y(A.value.buttonText)+" ",1),_[6]||(_[6]=e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9 18 15 12 9 6"})],-1))])])):P("",!0)]))]))]))}},Ks={class:"deal-documents"},Qs={class:"docs-header flex-between mb-lg"},Xs={class:"flex gap-md items-center"},Zs=["disabled"],en={key:0,class:"spinner-sm mr-sm"},tn={key:1},sn={key:0,class:"text-sm text-muted"},nn={class:"search-box"},ln={key:0,class:"flex-center p-xl"},an={key:1,class:"empty-state card flex-center flex-col p-xl"},on={key:2,class:"documents-grid"},rn=["onClick"],un={class:"doc-icon"},dn={key:0,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"#ef4444","stroke-width":"1.5"},cn={key:1,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 24 24",fill:"none",stroke:"#3b82f6","stroke-width":"1.5"},vn={key:2,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},pn={class:"doc-info"},mn=["title"],fn={class:"doc-meta"},yn={key:0,class:"doc-tags mt-xs"},gn={class:"doc-actions flex gap-xs"},hn=["onClick"],bn=["onClick"],kn={class:"modal-header flex-between"},wn={class:"flex items-center gap-md"},$n={class:"m-0 text-truncate",style:{"max-width":"400px"}},xn={key:0,class:"tag-badge"},Cn={class:"flex gap-sm"},Rn=["disabled"],Dn={class:"modal-body p-0 preview-body"},Pn={key:0,class:"flex-center h-full flex-col"},Vn=["src"],_n=["src"],Sn={key:3,class:"flex-center h-full flex-col"},Mn={__name:"DealDocuments",props:{dealId:{type:String,required:!0}},setup(w){const se=w,F=h([]),K=h(!1),L=h(!1),B=h(""),$=h(null),c=h(!1),T=h(!1),U=h(null),A=h(null),ee=J(()=>{if(!B.value)return F.value;const D=B.value.toLowerCase();return F.value.filter(v=>v.fileName.toLowerCase().includes(D)||v.tags?.toLowerCase().includes(D))});Se(()=>{R()});const R=async()=>{K.value=!0;try{const D=await Z.get(`/propertydeals/${se.dealId}/documents`);F.value=D.data}catch(D){console.error("Failed to load docs",D)}finally{K.value=!1}},V=async D=>{const v=D.target.files;if(v.length){L.value=!0;try{for(let S=0;S<v.length;S++){const x=new FormData;x.append("file",v[S]),await Z.post(`/propertydeals/${se.dealId}/documents`,x,{headers:{"Content-Type":"multipart/form-data"}})}await R()}catch(S){alert("Upload failed"),console.error(S)}finally{L.value=!1,$.value.value=""}}},b=async D=>{U.value=D,c.value=!0,T.value=!0;try{const v=await Z.get(`/propertydeals/${se.dealId}/documents/${D.id}/download?inline=true`,{responseType:"blob"}),S=new Blob([v.data],{type:D.contentType});A.value=URL.createObjectURL(S)}catch(v){console.error("Failed to load preview",v)}finally{T.value=!1}},_=()=>{c.value=!1,T.value=!1,A.value&&URL.revokeObjectURL(A.value),A.value=null,U.value=null},M=async D=>{try{const v=await Z.get(`/propertydeals/${se.dealId}/documents/${D.id}/download`,{responseType:"blob"}),S=new Blob([v.data],{type:D.contentType||"application/octet-stream"}),x=window.URL.createObjectURL(S),oe=document.createElement("a");oe.href=x,oe.download=D.fileName,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),window.URL.revokeObjectURL(x)}catch(v){console.error("Download failed",v),alert("Failed to download file")}},k=async D=>{console.log("Delete requested for ID:",D);try{await Z.delete(`/propertydeals/${se.dealId}/documents/${D}`),F.value=F.value.filter(v=>v.id!==D)}catch(v){console.error("Delete failed error details:",v),alert("Delete failed")}},p=D=>{if(D===0)return"0 B";const v=1024,S=["B","KB","MB","GB"],x=Math.floor(Math.log(D)/Math.log(v));return parseFloat((D/Math.pow(v,x)).toFixed(1))+" "+S[x]},O=D=>new Date(D).toLocaleDateString();return(D,v)=>(l(),a("div",Ks,[e("div",Qs,[e("div",Xs,[e("input",{type:"file",ref_key:"fileInput",ref:$,onChange:V,class:"hidden",multiple:""},null,544),e("button",{onClick:v[0]||(v[0]=S=>D.$refs.fileInput.click()),class:"btn btn-primary",disabled:L.value},[L.value?(l(),a("span",en)):(l(),a("span",tn,"+")),v[5]||(v[5]=E(" Upload Document ",-1))],8,Zs),L.value?(l(),a("span",sn,"Uploading...")):P("",!0)]),e("div",nn,[H(e("input",{"onUpdate:modelValue":v[1]||(v[1]=S=>B.value=S),placeholder:"Search documents...",class:"form-input-sm"},null,512),[[W,B.value]])])]),K.value?(l(),a("div",ln,[pe(He,{size:"lg",text:"Loading Documents..."})])):F.value.length===0?(l(),a("div",an,[...v[6]||(v[6]=[_e('<div class="empty-icon-bg mb-md"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg></div><h3>No Documents Yet</h3><p>Upload contracts, due diligence reports, or floor plans.</p>',3)])])):(l(),a("div",on,[(l(!0),a(I,null,Y(ee.value,S=>(l(),a("div",{key:S.id,class:"doc-card card",onClick:x=>b(S)},[e("div",un,[S.contentType?.toLowerCase().includes("pdf")?(l(),a("svg",dn,[...v[7]||(v[7]=[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},null,-1),e("polyline",{points:"14 2 14 8 20 8"},null,-1),e("line",{x1:"12",y1:"18",x2:"12",y2:"12"},null,-1),e("line",{x1:"9",y1:"15",x2:"15",y2:"15"},null,-1)])])):S.contentType?.toLowerCase().includes("image")?(l(),a("svg",cn,[...v[8]||(v[8]=[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},null,-1),e("circle",{cx:"8.5",cy:"8.5",r:"1.5"},null,-1),e("polyline",{points:"21 15 16 10 5 21"},null,-1)])])):(l(),a("svg",vn,[...v[9]||(v[9]=[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},null,-1),e("polyline",{points:"14 2 14 8 20 8"},null,-1)])]))]),e("div",pn,[e("div",{class:"doc-name text-truncate",title:S.fileName},y(S.fileName),9,mn),e("div",fn,y(p(S.fileSizeBytes))+" • "+y(O(S.uploadedAt)),1),S.tags?(l(),a("div",yn,[(l(!0),a(I,null,Y(S.tags.split(","),x=>(l(),a("span",{key:x,class:"tag-badge"},y(x),1))),128))])):P("",!0)]),e("div",gn,[e("button",{onClick:G(x=>M(S),["stop"]),class:"btn-icon",title:"Download"},[...v[10]||(v[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,hn),e("button",{onClick:G(x=>k(S.id),["stop"]),class:"btn-icon text-danger",title:"Delete"},[...v[11]||(v[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,bn)])],8,rn))),128))])),(l(),$e(De,{to:"body"},[c.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:_},[e("div",{class:"modal preview-modal card",onClick:v[4]||(v[4]=G(()=>{},["stop"]))},[e("div",kn,[e("div",wn,[e("h3",$n,y(U.value?.fileName),1),U.value?.tags?(l(),a("span",xn,y(U.value.tags),1)):P("",!0)]),e("div",Cn,[e("button",{onClick:v[2]||(v[2]=S=>M(U.value)),class:"btn btn-secondary btn-sm",disabled:T.value},[...v[12]||(v[12]=[e("span",{class:"flex items-center gap-xs"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]),E(" Download ")],-1)])],8,Rn),e("button",{onClick:_,class:"btn-close"},"×")])]),e("div",Dn,[T.value?(l(),a("div",Pn,[...v[13]||(v[13]=[e("span",{class:"spinner-lg mb-md"},null,-1),e("p",null,"Loading document...",-1)])])):A.value&&U.value.contentType?.toLowerCase().includes("pdf")?(l(),a("iframe",{key:1,src:A.value,width:"100%",height:"100%",frameborder:"0"},null,8,Vn)):A.value&&U.value.contentType?.toLowerCase().includes("image")?(l(),a("img",{key:2,src:A.value,class:"preview-image"},null,8,_n)):(l(),a("div",Sn,[v[14]||(v[14]=e("p",null,"Preview not available for this file type.",-1)),e("button",{onClick:v[3]||(v[3]=S=>M(U.value)),class:"btn btn-primary mt-md"},"Download File")]))])])])):P("",!0)]))]))}},An={class:"history-modal"},Ln={class:"modal-header"},Bn={class:"modal-body"},Fn={key:0,class:"loading-state"},En={key:1,class:"empty-state"},Un={key:2,class:"history-feed"},Nn={class:"card-header"},Tn={class:"timestamp"},On={class:"card-meta"},In={key:0,class:"transition-info"},qn={class:"user-info"},Gn={key:0,class:"comment-text"},Jn={key:1,class:"card-actions"},Hn=["onClick"],Yn=["onClick","disabled"],zn={key:0,class:"snapshot-panel"},jn={class:"snapshot-header"},Wn={key:0,class:"snapshot-grid"},Kn={class:"snapshot-item"},Qn={class:"snapshot-value"},Xn={class:"snapshot-item"},Zn={class:"snapshot-value"},el={class:"snapshot-item"},tl={class:"snapshot-value"},sl={class:"snapshot-item"},nl={class:"snapshot-value"},ll={class:"snapshot-item"},al={class:"snapshot-value"},ol={class:"snapshot-item"},il={class:"snapshot-value"},rl={class:"confirm-dialog"},ul={class:"confirm-actions"},dl=["disabled"],cl={__name:"StatusHistoryModal",props:{dealId:{type:String,required:!0}},emits:["close","restored"],setup(w,{emit:se}){const F=w,K=se,L=h([]),B=h(!0),$=h(null),c=h(!1),T=h(null),U=h(!1),A=J(()=>{if(!$.value?.inputsSnapshotJson)return null;try{return JSON.parse($.value.inputsSnapshotJson)}catch{return null}});Se(async()=>{try{const k=await Z.get(`/propertydeals/${F.dealId}/status-history`);L.value=k.data}catch(k){console.error("Failed to fetch status history:",k)}finally{B.value=!1}});function ee(k){$.value=k}function R(k){T.value=k,c.value=!0}async function V(){if(T.value)try{U.value=!0,await Z.post(`/propertydeals/${F.dealId}/restore-snapshot/${T.value.id}`),c.value=!1,K("restored"),K("close")}catch(k){console.error("Failed to restore snapshot:",k),alert("Failed to restore snapshot. Please try again.")}finally{U.value=!1}}function b(k){return new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(k||0)}function _(k){return{Draft:"status--draft","Under Review":"status--review","Proceed to Acquire":"status--proceed","Offer Made":"status--offer","Under Due Diligence":"status--dd","Waiting Settlement":"status--settlement",Acquired:"status--acquired",Pass:"status--pass"}[k]||"status--default"}function M(k){return k?new Date(k).toLocaleString("en-AU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}return(k,p)=>(l(),a("div",{class:"modal-backdrop",onClick:p[4]||(p[4]=G(O=>k.$emit("close"),["self"]))},[e("div",An,[e("div",Ln,[p[6]||(p[6]=e("div",{class:"header-title"},[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})]),e("h2",null,"Status History")],-1)),e("button",{class:"close-btn",onClick:p[0]||(p[0]=O=>k.$emit("close"))},[...p[5]||(p[5]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",Bn,[B.value?(l(),a("div",Fn,[...p[7]||(p[7]=[e("span",{class:"spinner"},null,-1),e("span",null,"Loading history...",-1)])])):L.value.length===0?(l(),a("div",En,[...p[8]||(p[8]=[e("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1),e("p",null,"No status changes recorded yet.",-1)])])):(l(),a("div",Un,[(l(!0),a(I,null,Y(L.value,(O,D)=>(l(),a("article",{key:O.id,class:N(["history-card",{"is-first":D===0}])},[e("header",Nn,[e("span",{class:N(["status-pill",_(O.status)])},y(O.status),3),e("time",Tn,y(M(O.timestamp)),1)]),e("div",On,[O.previousStatus?(l(),a("span",In,[p[9]||(p[9]=e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9 18 15 12 9 6"})],-1)),p[10]||(p[10]=E(" from ",-1)),e("strong",null,y(O.previousStatus),1)])):P("",!0),e("span",qn,[p[11]||(p[11]=e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)),E(" "+y(O.userName),1)])]),O.comment?(l(),a("p",Gn,' "'+y(O.comment)+'" ',1)):P("",!0),O.hasSnapshot?(l(),a("footer",Jn,[e("button",{class:"action-btn",onClick:v=>ee(O)},[...p[12]||(p[12]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),E(" View Snapshot ",-1)])],8,Hn),e("button",{class:"action-btn action-btn--warning",onClick:v=>R(O),disabled:U.value},[...p[13]||(p[13]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"1 4 1 10 7 10"}),e("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),E(" Restore ",-1)])],8,Yn)])):P("",!0)],2))),128))]))]),$.value?(l(),a("div",zn,[e("div",jn,[e("h3",null,"Snapshot at "+y(M($.value.timestamp)),1),e("button",{class:"close-btn close-btn--small",onClick:p[1]||(p[1]=O=>$.value=null)},[...p[14]||(p[14]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),A.value?(l(),a("div",Wn,[e("div",Kn,[p[15]||(p[15]=e("span",{class:"snapshot-label"},"Asking Price",-1)),e("span",Qn,y(b(A.value.AskingPrice)),1)]),e("div",Xn,[p[16]||(p[16]=e("span",{class:"snapshot-label"},"Gross Rent",-1)),e("span",Zn,y(b(A.value.EstimatedGrossRent)),1)]),e("div",el,[p[17]||(p[17]=e("span",{class:"snapshot-label"},"Vacancy",-1)),e("span",tl,y(A.value.VacancyRatePercent)+"%",1)]),e("div",sl,[p[18]||(p[18]=e("span",{class:"snapshot-label"},"Interest Rate",-1)),e("span",nl,y(A.value.InterestRatePercent)+"%",1)]),e("div",ll,[p[19]||(p[19]=e("span",{class:"snapshot-label"},"Discount Rate",-1)),e("span",al,y(A.value.DiscountRate)+"%",1)]),e("div",ol,[p[20]||(p[20]=e("span",{class:"snapshot-label"},"Hold Period",-1)),e("span",il,y(A.value.HoldingPeriodYears)+" yrs",1)])])):P("",!0)])):P("",!0)]),c.value?(l(),a("div",{key:0,class:"confirm-overlay",onClick:p[3]||(p[3]=G(O=>c.value=!1,["self"]))},[e("div",rl,[p[21]||(p[21]=e("h3",null,"Restore to snapshot?",-1)),e("p",null,"This will overwrite current inputs with the values from "+y(M(T.value?.timestamp))+".",1),e("div",ul,[e("button",{class:"btn btn-secondary",onClick:p[2]||(p[2]=O=>c.value=!1)},"Cancel"),e("button",{class:"btn btn-warning",onClick:V,disabled:U.value},y(U.value?"Restoring...":"Restore"),9,dl)])])])):P("",!0)]))}},vl=Ne(cl,[["__scopeId","data-v-ff4848a3"]]),pl={key:0,class:"deal-workbench card"},ml={key:1,class:"deal-workbench card"},fl={class:"workbench-header"},yl={class:"deal-info"},gl={class:"deal-title"},hl={class:"deal-meta"},bl={key:0,class:"deal-address"},kl={key:1,class:"deal-type badge"},wl={class:"lifecycle-container"},$l={class:"view-tabs"},xl={key:0,class:"workbench-grid-container"},Cl={class:"workbench-toolbar"},Rl={class:"save-status"},Dl={key:0,class:"status-saving"},Pl={key:1,class:"status-saved"},Vl={class:"bento-grid"},_l={class:"input-card glass-card"},Sl={class:"card-content"},Ml={class:"input-row"},Al={class:"input-wrapper"},Ll=["value"],Bl={class:"input-row"},Fl={class:"input-wrapper"},El=["value"],Ul={class:"input-row"},Nl={class:"input-wrapper"},Tl=["value"],Ol={class:"input-row"},Il={class:"input-wrapper"},ql=["value"],Gl={class:"input-row"},Jl={class:"input-wrapper"},Hl=["value"],Yl={class:"summary-row"},zl={class:"summary-value"},jl={class:"input-card glass-card"},Wl={class:"card-content"},Kl={class:"input-grid-row"},Ql={class:"input-wrapper"},Xl=["value"],Zl={class:"input-wrapper"},ea=["value"],ta={class:"input-grid-row"},sa={class:"input-wrapper"},na=["value"],la={class:"input-wrapper"},aa=["value"],oa={key:1,class:"col-span-2 detailed-label"},ia={key:0,class:"detailed-subgroup"},ra={class:"input-row compact"},ua={class:"input-wrapper xs"},da=["value"],ca={class:"input-row compact"},va=["value"],pa={key:0,class:"input-row compact"},ma={class:"input-wrapper xs"},fa=["value"],ya={class:"input-row compact"},ga={class:"input-wrapper xs"},ha=["value"],ba={class:"input-grid-row"},ka={class:"input-wrapper"},wa=["value"],$a={class:"input-wrapper"},xa=["value"],Ca={class:"input-grid-row"},Ra={class:"input-wrapper"},Da=["value"],Pa={class:"input-wrapper"},Va=["value"],_a={class:"summary-row"},Sa={class:"summary-value"},Ma={class:"input-card glass-card"},Aa={class:"card-header-flex"},La={class:"card-content"},Ba={class:"input-row"},Fa={class:"input-wrapper"},Ea=["value"],Ua={class:"input-row"},Na={class:"input-wrapper"},Ta=["value"],Oa={class:"input-row"},Ia={class:"input-wrapper"},qa=["value"],Ga={key:1,class:"detailed-subgroup"},Ja=["onUpdate:modelValue"],Ha={class:"input-wrapper xs"},Ya=["onUpdate:modelValue"],za={class:"input-wrapper xs"},ja=["onUpdate:modelValue"],Wa=["onClick"],Ka={class:"loan-summary-mini"},Qa={class:"summary-row"},Xa={class:"input-card glass-card"},Za={class:"card-content"},eo={class:"input-row"},to={class:"input-wrapper"},so=["value"],no={class:"input-row"},lo={class:"input-wrapper"},ao=["value"],oo={class:"input-row"},io={class:"input-wrapper"},ro=["value"],uo={class:"input-row"},co={class:"input-wrapper"},vo=["value"],po={class:"results-bar glass-card"},mo={key:0,class:"metrics-flex"},fo={class:"metric-item"},yo={class:"metric-item"},go={class:"metric-value-lg"},ho={class:"metric-item"},bo={key:1,class:"empty-metrics"},ko={key:1,class:"risk-view"},wo={class:"control-status"},$o={key:0,class:"status-icon warning"},xo={key:1,class:"status-icon success"},Co={class:"status-text"},Ro={class:"status-title"},Do={class:"status-desc"},Po={class:"control-actions"},Vo=["disabled"],_o={key:0,class:"spinner-sm"},So={key:1},Mo={key:2},Ao={key:2,class:"spreadsheet-view"},Lo={key:3,class:"documents-view p-lg"},Bo={class:"modal revert-modal glass-card"},Fo={class:"modal-header"},Eo={class:"modal-body"},Uo={class:"form-group"},No={class:"modal-actions"},To=["disabled"],Oo={key:0,class:"spinner-sm"},Io={class:"modal transition-modal glass-card"},qo={class:"modal-header"},Go={class:"modal-body"},Jo={class:"form-group"},Ho={class:"modal-actions"},Yo=["disabled"],zo={key:0,class:"spinner-sm"},jo={__name:"DealWorkbench",props:{deal:{type:Object,required:!0},simulationResults:{type:Object,default:null},runningSimulation:{type:Boolean,default:!1}},emits:["update","run-simulation","record-decision","refresh"],setup(w,{emit:se}){const F=h("summary"),K=h(null),L=h(!1),B=h(!1),$=h(!1),c=h(""),T=h(""),U=h(""),A=h(!1),ee=h([]),R=h(!1),V=w,b=se,_=h(!1),M=h(!1);let k=null;function p(){_.value=!0,M.value=!1,k&&clearTimeout(k),setTimeout(()=>{_.value=!1,M.value=!0,k=setTimeout(()=>M.value=!1,3e3)},800)}async function O(){if(V.deal)try{R.value=!0;const f=await Z.get(`/propertydeals/${V.deal.id}/status-history`);ee.value=f.data}catch(f){console.error("Failed to fetch history:",f),ee.value=[]}finally{R.value=!1}}function D(f){T.value=f,U.value="",$.value=!0}function v(f){c.value=f,T.value=f,U.value="",B.value=!0}async function S(){if(V.deal)try{L.value=!0,await Z.post(`/propertydeals/${V.deal.id}/status`,{status:T.value,comment:U.value}),B.value=!1,$.value=!1,b("refresh"),A.value&&await O()}catch(f){console.error("Failed to update status:",f),alert("Failed to update status. Please try again.")}finally{L.value=!1}}function x(f,s){p();const u=parseFloat(s.target.value)||0;b("update",{[f]:u})}function oe(f){p(),b("update",{spreadsheetOverridesJson:f})}function be(f){K.value=f,f.timeVariance&&b("update",{timeVarianceEarlyMonths:f.timeVariance.early,timeVarianceLateMonths:f.timeVariance.late})}function te(){b("run-simulation",K.value)}const ne=J(()=>{try{return V.deal.leaseDetailsJson?JSON.parse(V.deal.leaseDetailsJson):null}catch{return null}}),X=J(()=>{try{return V.deal.loanDetailsJson?JSON.parse(V.deal.loanDetailsJson):null}catch{return null}}),le=J(()=>X.value?X.value.reduce((f,s)=>f+(s.amount||0),0):V.deal.loanAmount),ke=J(()=>!X.value||le.value===0?V.deal.interestRatePercent:X.value.reduce((s,u)=>s+u.amount*u.rate,0)/le.value),ce=J(()=>{if(!V.deal)return 0;const f=V.deal.askingPrice||0,s=f*((V.deal.stampDutyRate||0)/100);return f+s+(V.deal.legalCosts||0)+(V.deal.capExReserve||0)}),fe=J(()=>V.deal?it(V.deal.estimatedGrossRent||0,V.deal.vacancyRatePercent||0,V.deal.managementFeePercent||0,V.deal.outgoingsEstimate||0):0),ve=J(()=>!V.deal||!V.deal.askingPrice?0:le.value/V.deal.askingPrice*100),me=J(()=>V.deal),g=h(!1);function i(f){g.value=!0;const s={};f.rentVariancePercent!==V.deal.rentVariancePercent&&(s.rentVariancePercent=f.rentVariancePercent),f.vacancyVariancePercent!==V.deal.vacancyVariancePercent&&(s.vacancyVariancePercent=f.vacancyVariancePercent),f.capitalGrowthVariancePercent!==V.deal.capitalGrowthVariancePercent&&(s.capitalGrowthVariancePercent=f.capitalGrowthVariancePercent),f.interestVariancePercent!==V.deal.interestVariancePercent&&(s.interestVariancePercent=f.interestVariancePercent),f.distributionSettingsJson!==void 0&&(s.distributionSettingsJson=f.distributionSettingsJson),f.correlationMatrixJson!==void 0&&(s.correlationMatrixJson=f.correlationMatrixJson),Object.keys(s).length>0&&b("update",s)}function q(){p(),ne.value?b("update",{leaseDetailsJson:""}):b("update",{leaseDetailsJson:JSON.stringify({remainingTerm:3,reviewType:"fixed",reviewValue:3,vacancyDurationMonths:3})})}function C(f,s){p();const u={...ne.value};let re=s.target.value;s.target.type==="number"&&(re=parseFloat(re)),u[f]=re,b("update",{leaseDetailsJson:JSON.stringify(u)})}function ae(){if(p(),X.value)b("update",{loanDetailsJson:""});else{const f=[{name:"Senior Debt",amount:V.deal.loanAmount,rate:V.deal.interestRatePercent}];b("update",{loanDetailsJson:JSON.stringify(f)})}}function Me(){const f=[...X.value||[]];f.push({name:"Mezzanine",amount:0,rate:8}),ge(f)}function xe(f){const s=[...X.value];s.splice(f,1),ge(s)}function ye(){ge(X.value)}function ge(f){p();const s=JSON.stringify(f),u=f.reduce((z,ue)=>z+(ue.amount||0),0);let re=0;u>0&&(re=f.reduce((z,ue)=>z+ue.amount*ue.rate,0)/u),b("update",{loanDetailsJson:s,loanAmount:u,interestRatePercent:parseFloat(re.toFixed(2))})}function he(f){switch(f){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";default:return"status-draft"}}function ie(f){return Je(f)}return(f,s)=>w.deal?(l(),a("div",ml,[e("div",fl,[e("div",yl,[e("h2",gl,y(w.deal.name),1),e("div",hl,[w.deal.address?(l(),a("span",bl,y(w.deal.address),1)):P("",!0),w.deal.buildingType?(l(),a("span",kl,y(w.deal.buildingType),1)):P("",!0)])]),e("div",wl,[pe(Ws,{"current-status":w.deal.status,loading:L.value,onRequestTransition:D,onRequestRevert:v,onToggleHistory:s[0]||(s[0]=u=>A.value=!0)},null,8,["current-status","loading"])])]),e("div",$l,[e("button",{class:N(["view-tab",{active:F.value==="summary"}]),onClick:s[1]||(s[1]=u=>F.value="summary")},[...s[40]||(s[40]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),e("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1),E(" Assumptions & Inputs ",-1)])],2),e("button",{class:N(["view-tab",{active:F.value==="detailed"}]),onClick:s[2]||(s[2]=u=>F.value="detailed")},[...s[41]||(s[41]=[_e('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-5b39c1ee><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-5b39c1ee></rect><line x1="3" y1="9" x2="21" y2="9" data-v-5b39c1ee></line><line x1="3" y1="15" x2="21" y2="15" data-v-5b39c1ee></line><line x1="9" y1="3" x2="9" y2="21" data-v-5b39c1ee></line><line x1="15" y1="3" x2="15" y2="21" data-v-5b39c1ee></line></svg> Detailed Model ',2)])],2),e("button",{class:N(["view-tab",{active:F.value==="risk"}]),onClick:s[3]||(s[3]=u=>F.value="risk")},[...s[42]||(s[42]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})],-1),E(" Risk Analysis ",-1)])],2),e("button",{class:N(["view-tab",{active:F.value==="documents"}]),onClick:s[4]||(s[4]=u=>F.value="documents")},[...s[43]||(s[43]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})],-1),E(" Documents ",-1)])],2)]),F.value==="summary"?(l(),a("div",xl,[e("div",Cl,[s[45]||(s[45]=e("h3",{class:"section-title"},"Deal Assumptions",-1)),e("div",Rl,[_.value?(l(),a("span",Dl,[...s[44]||(s[44]=[e("span",{class:"spinner-sm"},null,-1),E(" Saving... ",-1)])])):M.value?(l(),a("span",Pl," ✓ Saved ")):P("",!0)])]),e("div",Vl,[e("section",_l,[s[57]||(s[57]=e("h4",{class:"card-title"},"Acquisition",-1)),e("div",Sl,[e("div",Ml,[s[47]||(s[47]=e("label",null,"Asking Price",-1)),e("div",Al,[s[46]||(s[46]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:w.deal.askingPrice,onChange:s[5]||(s[5]=u=>x("askingPrice",u))},null,40,Ll)])]),e("div",Bl,[s[49]||(s[49]=e("label",null,"Stamp Duty",-1)),e("div",Fl,[e("input",{type:"number",step:"0.1",value:w.deal.stampDutyRate,onChange:s[6]||(s[6]=u=>x("stampDutyRate",u))},null,40,El),s[48]||(s[48]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Ul,[s[51]||(s[51]=e("label",null,"Buyers Agent",-1)),e("div",Nl,[e("input",{type:"number",step:"0.1",value:w.deal.buyersAgentFeeRate,onChange:s[7]||(s[7]=u=>x("buyersAgentFeeRate",u))},null,40,Tl),s[50]||(s[50]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Ol,[s[53]||(s[53]=e("label",null,"Legal Costs",-1)),e("div",Il,[s[52]||(s[52]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:w.deal.legalCosts,onChange:s[8]||(s[8]=u=>x("legalCosts",u))},null,40,ql)])]),e("div",Gl,[s[55]||(s[55]=e("label",null,"CapEx Reserve",-1)),e("div",Jl,[s[54]||(s[54]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:w.deal.capExReserve,onChange:s[9]||(s[9]=u=>x("capExReserve",u))},null,40,Hl)])]),e("div",Yl,[s[56]||(s[56]=e("label",null,"Total Cost",-1)),e("span",zl,y(ie(ce.value)),1)])])]),e("section",jl,[s[75]||(s[75]=e("h4",{class:"card-title"},"Income & Expenses",-1)),s[76]||(s[76]=e("div",{class:"card-header-row"},[e("span"),e("span",{class:"col-header"},"Value"),e("span",{class:"col-header"},"Growth %")],-1)),e("div",Wl,[e("div",Kl,[s[59]||(s[59]=e("label",null,"Gross Rent",-1)),e("div",Ql,[s[58]||(s[58]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:w.deal.estimatedGrossRent,onChange:s[10]||(s[10]=u=>x("estimatedGrossRent",u))},null,40,Xl)]),e("div",Zl,[e("input",{type:"number",step:"0.5",value:w.deal.rentalGrowthPercent,onChange:s[11]||(s[11]=u=>x("rentalGrowthPercent",u))},null,40,ea)])]),e("div",ta,[e("label",null,[s[60]||(s[60]=E("Vacancy ",-1)),e("button",{class:"btn-xs-link",onClick:q},y(w.deal.leaseDetailsJson?"(Detailed)":"(Simple)"),1)]),ne.value?(l(),a("div",oa,"Configured via Details")):(l(),a(I,{key:0},[e("div",sa,[e("input",{type:"number",step:"0.5",value:w.deal.vacancyRatePercent,onChange:s[12]||(s[12]=u=>x("vacancyRatePercent",u))},null,40,na),s[61]||(s[61]=e("span",{class:"input-suffix"},"%",-1))]),e("div",la,[e("input",{type:"number",step:"0.5",value:w.deal.vacancyGrowthPercent??0,onChange:s[13]||(s[13]=u=>x("vacancyGrowthPercent",u))},null,40,aa)])],64))]),ne.value?(l(),a("div",ia,[e("div",ra,[s[63]||(s[63]=e("label",null,"Term",-1)),e("div",ua,[e("input",{type:"number",value:ne.value.remainingTerm,onChange:s[14]||(s[14]=u=>C("remainingTerm",u))},null,40,da),s[62]||(s[62]=e("span",{class:"input-suffix"},"yrs",-1))])]),e("div",ca,[s[65]||(s[65]=e("label",null,"Review",-1)),e("select",{value:ne.value.reviewType,onChange:s[15]||(s[15]=u=>C("reviewType",u)),class:"select-xs"},[...s[64]||(s[64]=[e("option",{value:"fixed"},"Fixed",-1),e("option",{value:"cpi"},"CPI",-1)])],40,va)]),ne.value.reviewType==="fixed"?(l(),a("div",pa,[s[67]||(s[67]=e("label",null,"Rate",-1)),e("div",ma,[e("input",{type:"number",step:"0.1",value:ne.value.reviewValue,onChange:s[16]||(s[16]=u=>C("reviewValue",u))},null,40,fa),s[66]||(s[66]=e("span",{class:"input-suffix"},"%",-1))])])):P("",!0),e("div",ya,[s[69]||(s[69]=e("label",null,"Vac. Shift",-1)),e("div",ga,[e("input",{type:"number",value:ne.value.vacancyDurationMonths,onChange:s[17]||(s[17]=u=>C("vacancyDurationMonths",u))},null,40,ha),s[68]||(s[68]=e("span",{class:"input-suffix"},"m",-1))])])])):P("",!0),e("div",ba,[s[71]||(s[71]=e("label",null,"Outgoings",-1)),e("div",ka,[s[70]||(s[70]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:w.deal.outgoingsEstimate,onChange:s[18]||(s[18]=u=>x("outgoingsEstimate",u))},null,40,wa)]),e("div",$a,[e("input",{type:"number",step:"0.5",value:w.deal.outgoingsGrowthPercent??0,onChange:s[19]||(s[19]=u=>x("outgoingsGrowthPercent",u))},null,40,xa)])]),e("div",Ca,[s[73]||(s[73]=e("label",null,"Mgmt Fee",-1)),e("div",Ra,[e("input",{type:"number",step:"0.5",value:w.deal.managementFeePercent,onChange:s[20]||(s[20]=u=>x("managementFeePercent",u))},null,40,Da),s[72]||(s[72]=e("span",{class:"input-suffix"},"%",-1))]),e("div",Pa,[e("input",{type:"number",step:"0.5",value:w.deal.managementGrowthPercent??0,onChange:s[21]||(s[21]=u=>x("managementGrowthPercent",u))},null,40,Va)])]),e("div",_a,[s[74]||(s[74]=e("label",null,"Net Operating Income",-1)),e("span",Sa,y(ie(fe.value)),1)])])]),e("section",Ma,[e("div",Aa,[s[77]||(s[77]=e("h4",{class:"card-title"},"Financing",-1)),e("button",{class:"btn-xs-link",onClick:ae},y(X.value?"Multi-Tranche":"Simple Loan"),1)]),e("div",La,[!X.value||X.value.length===0?(l(),a(I,{key:0},[e("div",Ba,[s[79]||(s[79]=e("label",null,"Loan Amount",-1)),e("div",Fa,[s[78]||(s[78]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:w.deal.loanAmount,onChange:s[22]||(s[22]=u=>x("loanAmount",u))},null,40,Ea)])]),e("div",Ua,[s[81]||(s[81]=e("label",null,"Interest Rate",-1)),e("div",Na,[e("input",{type:"number",step:"0.1",value:w.deal.interestRatePercent,onChange:s[23]||(s[23]=u=>x("interestRatePercent",u))},null,40,Ta),s[80]||(s[80]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Oa,[s[84]||(s[84]=e("label",null,"Rate Variance (Risk)",-1)),e("div",Ia,[s[82]||(s[82]=e("span",{class:"input-prefix"},"±",-1)),e("input",{type:"number",step:"0.1",value:w.deal.interestVariancePercent,onChange:s[24]||(s[24]=u=>x("interestVariancePercent",u))},null,40,qa),s[83]||(s[83]=e("span",{class:"input-suffix"},"%",-1))])])],64)):(l(),a("div",Ga,[s[85]||(s[85]=e("div",{class:"multi-loan-header"},[e("span",null,"Tranche"),e("span",null,"Amount"),e("span",null,"Rate"),e("span")],-1)),(l(!0),a(I,null,Y(X.value,(u,re)=>(l(),a("div",{key:re,class:"loan-item-grid"},[H(e("input",{type:"text","onUpdate:modelValue":z=>u.name=z,placeholder:"Name",class:"input-xs",onChange:ye},null,40,Ja),[[W,u.name]]),e("div",Ha,[H(e("input",{type:"number","onUpdate:modelValue":z=>u.amount=z,onChange:ye},null,40,Ya),[[W,u.amount,void 0,{number:!0}]])]),e("div",za,[H(e("input",{type:"number",step:"0.1","onUpdate:modelValue":z=>u.rate=z,onChange:ye},null,40,ja),[[W,u.rate,void 0,{number:!0}]])]),e("button",{class:"btn-icon-xs text-danger",onClick:z=>xe(re)},"×",8,Wa)]))),128)),e("button",{class:"btn-xs-secondary full-width mt-sm",onClick:Me},"+ Add Tranche"),e("div",Ka," Avg Rate: "+y(ke.value.toFixed(2))+"% ",1)])),e("div",Qa,[s[86]||(s[86]=e("label",null,"LVR",-1)),e("span",{class:N(["summary-value",{"text-warning":ve.value>65}])},y(ve.value.toFixed(1))+"%",3)])])]),e("section",Xa,[s[96]||(s[96]=e("h4",{class:"card-title"},"Market & Projections",-1)),e("div",Za,[e("div",eo,[s[88]||(s[88]=e("label",null,"Capital Growth",-1)),e("div",to,[e("input",{type:"number",step:"0.5",value:w.deal.capitalGrowthPercent,onChange:s[25]||(s[25]=u=>x("capitalGrowthPercent",u))},null,40,so),s[87]||(s[87]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",no,[s[91]||(s[91]=e("label",null,"Growth Variance",-1)),e("div",lo,[s[89]||(s[89]=e("span",{class:"input-prefix"},"±",-1)),e("input",{type:"number",step:"0.5",value:w.deal.capitalGrowthVariancePercent,onChange:s[26]||(s[26]=u=>x("capitalGrowthVariancePercent",u))},null,40,ao),s[90]||(s[90]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",oo,[s[93]||(s[93]=e("label",null,"Discount Rate",-1)),e("div",io,[e("input",{type:"number",step:"0.1",value:w.deal.discountRate||8,onChange:s[27]||(s[27]=u=>x("discountRate",u))},null,40,ro),s[92]||(s[92]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",uo,[s[95]||(s[95]=e("label",null,"Holding Period",-1)),e("div",co,[e("input",{type:"number",min:"1",max:"30",value:w.deal.holdingPeriodYears,onChange:s[28]||(s[28]=u=>x("holdingPeriodYears",u))},null,40,vo),s[94]||(s[94]=e("span",{class:"input-suffix"},"yrs",-1))])])])])]),e("section",po,[w.simulationResults?(l(),a("div",mo,[e("div",fo,[s[97]||(s[97]=e("span",{class:"metric-label"},"Median NPV",-1)),e("span",{class:N(["metric-value-lg",w.simulationResults.medianNPV>=0?"text-success":"text-danger"])},y(ie(w.simulationResults.medianNPV)),3)]),s[100]||(s[100]=e("div",{class:"vertical-divider"},null,-1)),e("div",yo,[s[98]||(s[98]=e("span",{class:"metric-label"},"Median IRR",-1)),e("span",go,y(w.simulationResults.medianIRR.toFixed(1))+"%",1)]),s[101]||(s[101]=e("div",{class:"vertical-divider"},null,-1)),e("div",ho,[s[99]||(s[99]=e("span",{class:"metric-label"},"Rec. Decision",-1)),e("span",{class:N(["metric-tag",he(w.simulationResults.recommendedDecision)])},y(w.simulationResults.recommendedDecision),3)])])):(l(),a("div",bo,[...s[102]||(s[102]=[e("span",null,"Run simulation to see results",-1)])]))])])):F.value==="risk"?(l(),a("div",ko,[e("div",{class:N(["simulation-control-bar",{"has-changes":g.value}])},[e("div",wo,[g.value?(l(),a("span",$o,"⚠️")):(l(),a("span",xo,"✓")),e("div",Co,[e("span",Ro,y(g.value?"Inputs Changed":"Up to Date"),1),e("span",Do,y(g.value?"Deal inputs have changed since the last simulation.":"Results reflect current inputs."),1)])]),e("div",Po,[e("button",{class:N(["btn",g.value?"btn-primary":"btn-secondary"]),onClick:te,disabled:w.runningSimulation},[w.runningSimulation?(l(),a("span",_o)):g.value?(l(),a("span",So,"Update & Run Analysis")):(l(),a("span",Mo,"Re-run Simulation"))],10,Vo)])],2),pe(ot,{"initial-data":me.value,"initial-results":w.simulationResults,"detailed-cashflow":K.value,"hide-run-button":!0,"onUpdate:inputs":i},null,8,["initial-data","initial-results","detailed-cashflow"])])):F.value==="detailed"?(l(),a("div",Ao,[pe(_s,{deal:w.deal,"holding-period":w.deal.holdingPeriodYears,"initial-overrides-json":w.deal.spreadsheetOverridesJson,onApplyChanges:be,"onUpdate:overrides":oe},null,8,["deal","holding-period","initial-overrides-json"])])):F.value==="documents"?(l(),a("div",Lo,[pe(Mn,{"deal-id":w.deal.id},null,8,["deal-id"])])):P("",!0),A.value?(l(),$e(vl,{key:4,"deal-id":w.deal.id,onClose:s[29]||(s[29]=u=>A.value=!1),onRestored:s[30]||(s[30]=u=>b("refresh"))},null,8,["deal-id"])):P("",!0),B.value?(l(),a("div",{key:5,class:"modal-backdrop",onClick:s[34]||(s[34]=G(u=>B.value=!1,["self"]))},[e("div",Bo,[e("div",Fo,[s[103]||(s[103]=e("h2",null,"Revert Status",-1)),e("button",{class:"btn-close",onClick:s[31]||(s[31]=u=>B.value=!1)},"×")]),e("div",Eo,[e("p",null,[s[104]||(s[104]=E("Are you sure you want to revert the status to ",-1)),e("strong",null,y(c.value),1),s[105]||(s[105]=E("?",-1))]),e("div",Uo,[s[106]||(s[106]=e("label",null,"Reason for reverting (optional)",-1)),H(e("textarea",{"onUpdate:modelValue":s[32]||(s[32]=u=>U.value=u),class:"form-control",rows:"3",placeholder:"e.g., Lease details were incorrect, need to re-evaluate..."},null,512),[[W,U.value]])])]),e("div",No,[e("button",{class:"btn btn-secondary",onClick:s[33]||(s[33]=u=>B.value=!1)},"Cancel"),e("button",{class:"btn btn-warning",onClick:S,disabled:L.value},[L.value?(l(),a("span",Oo)):P("",!0),E(" "+y(L.value?"Reverting...":"Confirm Revert"),1)],8,To)])])])):P("",!0),$.value?(l(),a("div",{key:6,class:"modal-backdrop",onClick:s[38]||(s[38]=G(u=>$.value=!1,["self"]))},[e("div",Io,[e("div",qo,[s[107]||(s[107]=e("h2",null,"Update Status",-1)),e("button",{class:"btn-close",onClick:s[35]||(s[35]=u=>$.value=!1)},"×")]),e("div",Go,[e("p",null,[s[108]||(s[108]=E("Move stage to ",-1)),e("strong",null,y(T.value),1),s[109]||(s[109]=E("?",-1))]),e("div",Jo,[s[110]||(s[110]=e("label",null,"Comment (optional)",-1)),H(e("textarea",{"onUpdate:modelValue":s[36]||(s[36]=u=>U.value=u),class:"form-control",rows:"3",placeholder:"e.g., Offer accepted by vendor..."},null,512),[[W,U.value]])])]),e("div",Ho,[e("button",{class:"btn btn-secondary",onClick:s[37]||(s[37]=u=>$.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:S,disabled:L.value},[L.value?(l(),a("span",zo)):P("",!0),E(" "+y(L.value?"Updating...":"Confirm Update"),1)],8,Yo)])])])):P("",!0)])):(l(),a("div",pl,[...s[39]||(s[39]=[e("div",{class:"workbench-loading"},[e("div",{class:"spinner"}),e("p",null,"Loading deal...")],-1)])]))}},Wo=Ne(jo,[["__scopeId","data-v-5b39c1ee"]]),Ko={class:"acquisition-planner"},Qo={class:"planner-header"},Xo={class:"header-content"},Zo={class:"nav-area"},ei={class:"breadcrumb"},ti={key:1,class:"breadcrumb-current"},si={key:0,class:"page-title-wrapper"},ni={key:1,class:"deal-selector-wrapper"},li={class:"deal-selector-name"},ai={key:0,class:"deal-dropdown-menu glass-card"},oi={class:"dropdown-search"},ii={class:"dropdown-list"},ri={key:0,class:"dropdown-empty"},ui=["onClick"],di={class:"dropdown-item-name"},ci={class:"header-actions"},vi={class:"view-toggles"},pi={class:"immersive-content"},mi={key:0,class:"dashboard-grid-view"},fi={key:0,class:"loading-state"},yi={key:1,class:"empty-state-large"},gi={key:2,class:"deals-grid"},hi=["onClick"],bi={class:"deal-card-header"},ki={class:"deal-card-body"},wi={class:"deal-card-title"},$i={class:"deal-card-address"},xi={class:"deal-metrics"},Ci={class:"metric"},Ri={class:"value"},Di={class:"metric"},Pi={class:"value"},Vi={class:"deal-card-footer"},_i={key:0,class:"sim-badge success"},Si={key:1,class:"sim-badge empty"},Mi={class:"workbench-container",key:"workbench"},Ai={class:"modal deal-modal glass-card"},Li={class:"modal-header"},Bi={class:"form-group"},Fi={class:"form-row"},Ei={class:"form-group"},Ui={class:"form-group"},Ni={class:"form-row"},Ti={class:"form-group"},Oi={class:"form-group"},Ii={class:"modal-actions"},qi=["disabled"],Gi={__name:"AcquisitionPlannerView",setup(w){const se={mounted(g,i){g._clickOutsideHandler=q=>{g===q.target||g.contains(q.target)||i.value(q)},document.body.addEventListener("click",g._clickOutsideHandler)},unmounted(g){document.body.removeEventListener("click",g._clickOutsideHandler)}},F=st(),K=nt(),L=at(),B=h(!0),$=h([]),c=h(null),T=h(null),U=h(""),A=h(!1),ee=h(!1),R=h(!1),V=J(()=>L.currentPortfolioId),b=h(!1),_=h(""),M=h(null),k=h({name:"",address:"",buildingType:"",askingPrice:0,estimatedGrossRent:0}),p=J(()=>U.value?$.value.filter(g=>g.status===U.value):$.value),O=J(()=>{let g=$.value;if(_.value){const i=_.value.toLowerCase();g=g.filter(q=>q.name.toLowerCase().includes(i)||q.address&&q.address.toLowerCase().includes(i))}return g});Se(async()=>{await D();const g=F.query.deal;g&&await v(g)});async function D(){if(!V.value){$.value=[],B.value=!1;return}try{B.value=!0;const g=await Z.get(`/propertydeals?portfolioId=${V.value}`);$.value=g.data}catch(g){console.error("Failed to fetch deals:",g)}finally{B.value=!1}}async function v(g,i=!1){try{if($.value.length>0&&!i&&c.value?.id===g)return;const q=await Z.get(`/propertydeals/${g}`);c.value=q.data,T.value=q.data.simulationResults?.[0]||null,K.replace({query:{deal:g}}),b.value=!1}catch(q){console.error("Failed to load deal:",q)}}function S(){c.value=null,K.replace({query:{}}),b.value=!1,D()}function x(g){v(g)}function oe(){b.value=!b.value,b.value&&Ve(()=>{M.value?.focus()})}function be(){b.value=!1}function te(){k.value={name:"",address:"",buildingType:"",askingPrice:0,estimatedGrossRent:0},A.value=!0}function ne(){b.value=!1,te()}async function X(){try{ee.value=!0;const g=await Z.post("/propertydeals",{...k.value,portfolioId:V.value});A.value=!1,await D(),await v(g.data.id)}catch(g){console.error("Failed to create deal:",g),alert("Failed to create deal. Please try again.")}finally{ee.value=!1}}async function le(g){if(c.value)try{const i=await Z.put(`/propertydeals/${c.value.id}`,g);c.value=i.data;const q=$.value.findIndex(C=>C.id===c.value.id);q!==-1&&($.value[q]={...$.value[q],...i.data})}catch(i){console.error("Failed to update deal:",i)}}async function ke(){if(c.value)try{R.value=!0;const g={askingPrice:c.value.askingPrice,stampDutyRate:c.value.stampDutyRate,legalCosts:c.value.legalCosts,capExReserve:c.value.capExReserve,estimatedGrossRent:c.value.estimatedGrossRent,vacancyRatePercent:c.value.vacancyRatePercent,managementFeePercent:c.value.managementFeePercent,outgoingsEstimate:c.value.outgoingsEstimate,loanAmount:c.value.loanAmount,interestRatePercent:c.value.interestRatePercent,capitalGrowthPercent:c.value.capitalGrowthPercent,holdingPeriodYears:c.value.holdingPeriodYears,rentVariancePercent:c.value.rentVariancePercent,vacancyVariancePercent:c.value.vacancyVariancePercent,interestVariancePercent:c.value.interestVariancePercent,capitalGrowthVariancePercent:c.value.capitalGrowthVariancePercent,discountRate:c.value.discountRate,leaseDetails:c.value.leaseDetailsJson?JSON.parse(c.value.leaseDetailsJson):null,loanDetails:c.value.loanDetailsJson?JSON.parse(c.value.loanDetailsJson):null},i=rt(g,5e3);T.value=i,await Z.post(`/propertydeals/${c.value.id}/simulations`,{iterations:i.iterations,medianNPV:i.medianNPV,p10NPV:i.p10NPV,p90NPV:i.p90NPV,medianIRR:i.medianIRR,p10IRR:i.p10IRR,p90IRR:i.p90IRR,calculatedCapRate:i.calculatedCapRate,recommendedDecision:i.recommendedDecision,npvHistogramJson:JSON.stringify(i.npvHistogram),irrHistogramJson:JSON.stringify(i.irrHistogram),yearlyDCFJson:JSON.stringify(i.yearlyDCF),inputsSnapshotJson:JSON.stringify(g)});const q=await Z.get(`/propertydeals/${c.value.id}`);c.value=q.data;const C=$.value.findIndex(ae=>ae.id===c.value.id);C!==-1&&($.value[C]={...q.data})}catch(g){console.error("Simulation failed:",g),alert("Simulation failed. Please try again.")}finally{R.value=!1}}async function ce(g,i){if(c.value)try{await Z.put(`/propertydeals/${c.value.id}/decision`,{decision:g,rationale:i});const q=await Z.get(`/propertydeals/${c.value.id}`);c.value=q.data;const C=$.value.findIndex(ae=>ae.id===c.value.id);C!==-1&&($.value[C].status=g)}catch(q){console.error("Failed to record decision:",q),alert("Failed to record decision. Please try again.")}}async function fe(){c.value&&await v(c.value.id,!0)}function ve(g){switch(g){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";default:return"status-draft"}}function me(g){return Je(g)}return Ue(V,()=>{D()}),(g,i)=>{const q=lt("router-link");return l(),a("div",Ko,[e("header",Qo,[e("div",Xo,[e("div",Zo,[e("div",ei,[pe(q,{to:"/properties",class:"breadcrumb-link"},{default:Ee(()=>[...i[11]||(i[11]=[E("Properties",-1)])]),_:1}),i[12]||(i[12]=e("span",{class:"breadcrumb-sep"},"/",-1)),c.value?(l(),a("a",{key:0,href:"#",onClick:G(S,["prevent"]),class:"breadcrumb-link"},"Acquisitions")):(l(),a("span",ti,"Acquisitions"))]),c.value?H((l(),a("div",ni,[e("button",{class:"deal-selector-btn",onClick:oe},[e("span",li,y(c.value.name),1),(l(),a("svg",{class:N(["chevron-icon",{rotated:b.value}]),width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...i[14]||(i[14]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))]),pe(qe,{name:"dropdown-fade"},{default:Ee(()=>[b.value?(l(),a("div",ai,[e("div",oi,[H(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=C=>_.value=C),placeholder:"Search deals...",class:"search-input",ref_key:"searchInput",ref:M},null,512),[[W,_.value]])]),e("div",ii,[O.value.length===0?(l(),a("div",ri,"No deals found")):P("",!0),(l(!0),a(I,null,Y(O.value,C=>(l(),a("button",{key:C.id,class:N(["dropdown-item",{active:C.id===c.value.id}]),onClick:ae=>x(C.id)},[e("span",di,y(C.name),1),e("span",{class:N(["dropdown-item-status",ve(C.status)])},y(C.status),3)],10,ui))),128))]),e("div",{class:"dropdown-footer"},[e("button",{class:"btn-create-dropdown",onClick:ne}," + New Deal ")])])):P("",!0)]),_:1})])),[[se,be]]):(l(),a("div",si,[...i[13]||(i[13]=[e("h1",{class:"page-title"},"Acquisition Planner",-1),e("p",{class:"page-subtitle"},"Analyze potential deals with uncertainty modeling",-1)])]))])]),e("div",ci,[c.value?(l(),a("button",{key:1,class:"btn btn-secondary",onClick:S}," Close Deal ")):(l(),a(I,{key:0},[e("div",vi,[H(e("select",{"onUpdate:modelValue":i[1]||(i[1]=C=>U.value=C),class:"status-filter-large"},[...i[15]||(i[15]=[_e('<option value="" data-v-fd1945ca>All Statuses</option><option value="Draft" data-v-fd1945ca>Drafts</option><option value="Analyzing" data-v-fd1945ca>Analyzing</option><option value="Buy" data-v-fd1945ca>Buy</option><option value="Pass" data-v-fd1945ca>Pass</option>',5)])],512),[[Ge,U.value]])]),e("button",{class:"btn btn-primary",onClick:te},[...i[16]||(i[16]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" New Deal ",-1)])])],64))])]),e("div",pi,[pe(qe,{name:"fade-slide",mode:"out-in"},{default:Ee(()=>[c.value?(l(),a("div",Mi,[pe(Wo,{deal:c.value,"simulation-results":T.value,"running-simulation":R.value,onUpdate:le,onRunSimulation:ke,onRecordDecision:ce,onRefresh:fe},null,8,["deal","simulation-results","running-simulation"])])):(l(),a("div",mi,[B.value?(l(),a("div",fi,[pe(He)])):p.value.length===0?(l(),a("div",yi,[e("div",{class:"empty-content"},[i[17]||(i[17]=e("div",{class:"empty-icon-circle"},[e("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e("polyline",{points:"9 22 9 12 15 12 15 22"})])],-1)),i[18]||(i[18]=e("h3",null,"No Deals Found",-1)),i[19]||(i[19]=e("p",null,"Start your acquisition pipeline by adding a new property deal.",-1)),e("button",{class:"btn btn-primary mt-4",onClick:te},"Create First Deal")])])):(l(),a("div",gi,[(l(!0),a(I,null,Y(p.value,C=>(l(),a("div",{key:C.id,class:"deal-card glass-card hover-lift",onClick:ae=>v(C.id)},[e("div",bi,[e("span",{class:N(["deal-status-badge",ve(C.status)])},y(C.status),3),e("button",{class:"btn-icon-more",onClick:i[2]||(i[2]=G(()=>{},["stop"]))},[...i[20]||(i[20]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"1"}),e("circle",{cx:"19",cy:"12",r:"1"}),e("circle",{cx:"5",cy:"12",r:"1"})],-1)])])]),e("div",ki,[e("h3",wi,y(C.name),1),e("p",$i,y(C.address||"No address provided"),1),e("div",xi,[e("div",Ci,[i[21]||(i[21]=e("span",{class:"label"},"Price",-1)),e("span",Ri,y(me(C.askingPrice)),1)]),e("div",Di,[i[22]||(i[22]=e("span",{class:"label"},"Cap Rate",-1)),e("span",Pi,y(C.calculatedCapRate?(C.calculatedCapRate*100).toFixed(1)+"%":"-"),1)])])]),e("div",Vi,[C.simulationResults&&C.simulationResults.length>0?(l(),a("div",_i," Simulated ")):(l(),a("div",Si," No Analysis ")),i[23]||(i[23]=e("span",{class:"last-updated"},"Updated today",-1))])],8,hi))),128))]))]))]),_:1})]),A.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:i[10]||(i[10]=G(C=>A.value=!1,["self"]))},[e("div",Ai,[e("div",Li,[i[24]||(i[24]=e("h2",null,"New Property Deal",-1)),e("button",{class:"btn-close",onClick:i[3]||(i[3]=C=>A.value=!1)},"×")]),e("form",{onSubmit:G(X,["prevent"]),class:"modal-body"},[e("div",Bi,[i[25]||(i[25]=e("label",null,"Deal Name *",-1)),H(e("input",{"onUpdate:modelValue":i[4]||(i[4]=C=>k.value.name=C),type:"text",required:"",placeholder:"e.g., 123 Industrial Ave - Warehouse",class:"input-lg"},null,512),[[W,k.value.name]])]),e("div",Fi,[e("div",Ei,[i[26]||(i[26]=e("label",null,"Address",-1)),H(e("input",{"onUpdate:modelValue":i[5]||(i[5]=C=>k.value.address=C),type:"text",placeholder:"123 Main St, Sydney NSW"},null,512),[[W,k.value.address]])]),e("div",Ui,[i[28]||(i[28]=e("label",null,"Building Type",-1)),H(e("select",{"onUpdate:modelValue":i[6]||(i[6]=C=>k.value.buildingType=C)},[...i[27]||(i[27]=[_e('<option value="" data-v-fd1945ca>Select type</option><option value="Office" data-v-fd1945ca>Office</option><option value="Retail" data-v-fd1945ca>Retail</option><option value="Industrial" data-v-fd1945ca>Industrial</option><option value="Mixed" data-v-fd1945ca>Mixed Use</option>',5)])],512),[[Ge,k.value.buildingType]])])]),e("div",Ni,[e("div",Ti,[i[29]||(i[29]=e("label",null,"Asking Price *",-1)),H(e("input",{"onUpdate:modelValue":i[7]||(i[7]=C=>k.value.askingPrice=C),type:"number",min:"0",step:"any",required:"",placeholder:"1500000"},null,512),[[W,k.value.askingPrice,void 0,{number:!0}]])]),e("div",Oi,[i[30]||(i[30]=e("label",null,"Estimated Gross Rent (p.a.) *",-1)),H(e("input",{"onUpdate:modelValue":i[8]||(i[8]=C=>k.value.estimatedGrossRent=C),type:"number",min:"0",step:"any",required:"",placeholder:"120000"},null,512),[[W,k.value.estimatedGrossRent,void 0,{number:!0}]])])]),e("div",Ii,[e("button",{type:"button",class:"btn btn-secondary",onClick:i[9]||(i[9]=C=>A.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:ee.value},y(ee.value?"Creating...":"Create & Analyze"),9,qi)])],32)])])):P("",!0)])}}},ji=Ne(Gi,[["__scopeId","data-v-fd1945ca"]]);export{ji as default};
