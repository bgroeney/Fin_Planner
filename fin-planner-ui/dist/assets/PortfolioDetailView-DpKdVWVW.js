import{_ as X,r as le,o as n,c as i,a as e,d as R,F as H,l as G,B as ne,t as r,z as A,w as W,f as C,m as Q,n as S,e as B,k as U,p as M,v as N,C as ie,g as c,s as D,i as re,j as se,D as de,T as ae,b as ue,x as ce,A as ve,h as pe,E as me}from"./index-oVbs5Hxd.js";import{usePortfolioStore as fe}from"./portfolio-CjZnfIUI.js";import{_ as ge}from"./MoneyBoxLoader-BOnNyVJS.js";import{f as L,a as he}from"./formatters-DwG4QyEz.js";const ye={key:0,class:"allocation-section"},be={class:"chart-wrapper"},we={class:"legend-wrapper"},ke={class:"legend-label"},xe={class:"legend-value"},$e={class:"legend-percent"},_e={key:1,class:"empty-state text-muted text-center"},Ce={__name:"AllocationChart",props:{holdings:{type:Array,required:!0}},setup(I){const z=I,u=["#1e40af","#3b82f6","#60a5fa","#93c5fd","#2563eb","#1d4ed8","#dbeafe"],x=A(()=>{const s={};return z.holdings.forEach(f=>{const g=f.categoryName||"Uncategorized";s[g]=(s[g]||0)+f.currentValue}),Object.values(s)}),y=A(()=>x.value),w=A(()=>{const s={};return z.holdings.forEach(f=>{const g=f.categoryName||"Uncategorized";s[g]=(s[g]||0)+f.currentValue}),Object.keys(s)}),d=A(()=>x.value.reduce((s,f)=>s+f,0)),k=s=>d.value===0?"0":(x.value[s]/d.value*100).toFixed(1),b=s=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(s),P=A(()=>({labels:w.value,colors:u,chart:{type:"donut",fontFamily:"inherit"},plotOptions:{pie:{donut:{size:"75%",labels:{show:!0,name:{show:!1},value:{show:!1},total:{show:!0,label:"Total",fontSize:"12px",fontWeight:600,color:"var(--color-text-muted)",formatter:()=>b(d.value)}}}}},dataLabels:{enabled:!1},legend:{show:!1},stroke:{width:2,colors:["var(--color-bg-secondary)"]},tooltip:{y:{formatter:s=>b(s)}}}));return(s,f)=>{const g=le("apexchart");return y.value.length>0?(n(),i("div",ye,[e("div",be,[R(g,{type:"donut",height:"200",options:P.value,series:y.value},null,8,["options","series"])]),e("div",we,[(n(!0),i(H,null,G(w.value,(V,$)=>(n(),i("div",{key:V,class:"legend-item"},[e("span",{class:"legend-dot",style:ne({background:u[$%u.length]})},null,4),e("span",ke,r(V),1),e("span",xe,r(b(x.value[$])),1),e("span",$e,r(k($))+"%",1)]))),128))])])):(n(),i("div",_e," No allocation data "))}}},Ie=X(Ce,[["__scopeId","data-v-3fd051ec"]]),Pe={key:0,class:"drawer-loading"},Ve={key:1,class:"drawer-error"},Ae={key:2,class:"drawer-body"},Se={class:"drawer-header"},De={class:"asset-info"},Fe={class:"asset-symbol"},Me={class:"asset-name"},Be={class:"asset-category"},Oe={class:"category-badge interactive"},Te={key:0,class:"category-dropdown"},Ne=["onClick"],Ue={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Le={key:0,class:"cat-option disabled"},ze={key:1,class:"cat-saving"},je={class:"value-section"},Ee={class:"current-value"},He={class:"chart-section"},Re={class:"actions-section"},qe={key:0,class:"action-buttons"},Ge={key:1,class:"decision-form card"},Ke={class:"form-title"},We={class:"form-group"},Ze={key:0,class:"form-group"},Qe={key:0,class:"tax-hint"},Je={class:"form-group"},Xe={class:"form-actions"},Ye=["disabled"],et={class:"stats-section"},tt={class:"stats-grid"},ot={class:"stat-item"},st={class:"stat-value"},lt={class:"stat-item"},at={class:"stat-value"},nt={class:"stat-item"},it={class:"stat-value"},rt={class:"stat-item"},dt={class:"transactions-section"},ut={class:"transactions-list"},ct={key:0,class:"transactions-loading"},vt={key:1,class:"transactions-empty"},pt={class:"tx-date"},mt={class:"tx-type"},ft={class:"tx-units"},gt={class:"tx-amount"},ht={__name:"AssetDetailDrawer",props:{isOpen:Boolean,portfolioId:String,assetId:String,embedded:{type:Boolean,default:!1}},emits:["close"],setup(I,{emit:z}){const u=I,x=z,y=c(!1),w=c(!1),d=c(null),k=c([]),b=c(!1),P=c(!1),s=c([]),f=c(!1),g=c(1),V=c(!0),$=v=>{const t=k.value.find(o=>o.id===v);return t?t.name:"Uncategorized"},F=async()=>{if(u.portfolioId)try{const v=await D.get(`/portfolios/${u.portfolioId}`);k.value=v.data.targetAllocation?.map(t=>({id:t.id,name:t.name}))||[]}catch(v){console.error(v)}},j=async()=>{if(!(!u.portfolioId||!u.assetId)){y.value=!0,w.value=!1,s.value=[],g.value=1,V.value=!0;try{const v=await D.get(`/portfolios/${u.portfolioId}/assets/${u.assetId}/details`);d.value=v.data,y.value=!1,await T()}catch(v){console.error(v),w.value=!0,y.value=!1}}},T=async()=>{if(!(!u.portfolioId||!u.assetId||f.value||!V.value)){f.value=!0;try{const v=await D.get(`/portfolios/${u.portfolioId}/assets/${u.assetId}/transactions?page=${g.value}&pageSize=20`);v.data.length<20&&(V.value=!1),s.value.push(...v.data),g.value++}catch(v){console.error("Failed to load transactions",v)}finally{f.value=!1}}},q=v=>{const{scrollTop:t,clientHeight:o,scrollHeight:l}=v.target;l-t<=o+50&&T()};W(()=>u.isOpen,v=>{v&&(j(),F(),b.value=!1)},{immediate:!0}),W(()=>u.assetId,v=>{u.isOpen&&v&&j()});const h=A(()=>[{name:"Value",data:d.value?.history?.map(v=>({x:new Date(v.date).getTime(),y:v.value}))||[]}]),a=c(!1),p=c("Buy"),m=c(0),_=c(""),O=c("FIFO"),Z=c(null),K=c(!1),J=v=>{p.value=v,a.value=!0,m.value=0,_.value="",O.value="FIFO",Z.value=null};W([m,O],async()=>{p.value==="Sell"&&m.value>0});const Y=async()=>{if(!(!u.portfolioId||!m.value)){K.value=!0;try{await D.post("/decisions",{portfolioId:u.portfolioId,title:`${p.value} ${m.value} ${d.value.symbol}`,rationale:_.value||`${p.value} decision for ${d.value.symbol}`,allocationMethod:p.value==="Sell"?O.value:null,saveAsDraft:!1}),a.value=!1,j(),x("updated")}catch(v){console.error(v),alert("Failed to create decision")}finally{K.value=!1}}},ee=A(()=>({chart:{type:"area",toolbar:{show:!1},sparkline:{enabled:!1},fontFamily:"inherit"},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2,colors:["var(--color-accent)"]},xaxis:{type:"datetime",labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{show:!1},grid:{show:!1},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.3,opacityTo:.05,stops:[0,100]}},tooltip:{x:{format:"dd MMM yyyy"},y:{formatter:v=>L(v)}},colors:["var(--color-accent)"]})),te=()=>{b.value=!b.value},oe=async v=>{if(!u.portfolioId||!u.assetId||v===d.value.categoryId){b.value=!1;return}P.value=!0;try{await D.put(`/portfolios/${u.portfolioId}/assets/${u.assetId}/category`,{categoryId:v}),d.value.categoryId=v,b.value=!1}catch(t){console.error("Failed to update category",t)}finally{P.value=!1}};return(v,t)=>{const o=le("apexchart");return I.isOpen?(n(),i("div",{key:0,class:S(["asset-drawer",{"is-overlay":!I.embedded}])},[I.embedded?C("",!0):(n(),i("div",{key:0,class:"drawer-backdrop",onClick:t[0]||(t[0]=l=>v.$emit("close"))})),e("div",{class:S(["drawer-content",{"overlay-mode":!I.embedded}])},[y.value?(n(),i("div",Pe,[R(ge,{size:"lg",text:"Loading Asset Data..."})])):w.value?(n(),i("div",Ve,[t[8]||(t[8]=e("p",null,"Failed to load asset details",-1)),e("button",{onClick:j,class:"btn btn-secondary"},"Retry")])):d.value?(n(),i("div",Ae,[e("div",Se,[e("div",De,[e("div",Fe,r(d.value.symbol),1),e("div",Me,r(d.value.name),1),e("div",Be,[e("div",{class:S(["category-selector",{open:b.value}]),onClick:Q(te,["stop"])},[e("span",Oe,r($(d.value.categoryId)),1),t[9]||(t[9]=e("svg",{class:"cat-chevron",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"6 9 12 15 18 9"})],-1))],2),b.value?(n(),i("div",Te,[(n(!0),i(H,null,G(k.value,l=>(n(),i("div",{key:l.id,class:S(["cat-option",{selected:d.value.categoryId===l.id}]),onClick:Q(E=>oe(l.id),["stop"])},[B(r(l.name)+" ",1),d.value.categoryId===l.id?(n(),i("svg",Ue,[...t[10]||(t[10]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):C("",!0)],10,Ne))),128)),k.value.length===0?(n(),i("div",Le,"No categories defined")):C("",!0)])):C("",!0),P.value?(n(),i("span",ze,"Saving...")):C("",!0)])]),e("button",{onClick:t[1]||(t[1]=l=>v.$emit("close")),class:"btn-close",title:"Close"},[...t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",je,[e("div",Ee,r(U(L)(d.value.position.currentValue)),1),e("div",{class:S(["return-badge",{positive:d.value.position.returnPercent>=0,negative:d.value.position.returnPercent<0}])},r(d.value.position.returnPercent>=0?"+":"")+r(d.value.position.returnPercent.toFixed(2))+"% ",3)]),e("div",He,[R(o,{type:"area",height:"160",options:ee.value,series:h.value},null,8,["options","series"])]),e("div",Re,[a.value?(n(),i("div",Ge,[e("h4",Ke,r(p.value)+" "+r(d.value.symbol),1),e("div",We,[t[12]||(t[12]=e("label",null,"Units",-1)),M(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>m.value=l),type:"number",class:"form-input",placeholder:"0"},null,512),[[N,m.value,void 0,{number:!0}]])]),p.value==="Sell"?(n(),i("div",Ze,[t[14]||(t[14]=e("label",null,"Tax Optimization Method",-1)),M(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>O.value=l),class:"form-select"},[...t[13]||(t[13]=[e("option",{value:"FIFO"},"First-In-First-Out (Standard)",-1),e("option",{value:"MinTax"},"Minimize Tax (High Cost/Long Term)",-1),e("option",{value:"MaxGain"},"Maximize Gain (Low Cost)",-1)])],512),[[ie,O.value]]),Z.value!==null?(n(),i("div",Qe," Projected Taxable Gain: "+r(U(L)(Z.value)),1)):C("",!0)])):C("",!0),e("div",Je,[t[15]||(t[15]=e("label",null,"Rationale",-1)),M(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=l=>_.value=l),class:"form-input",rows:"2",placeholder:"Why make this trade?"},null,512),[[N,_.value]])]),e("div",Xe,[e("button",{onClick:t[7]||(t[7]=l=>a.value=!1),class:"btn btn-secondary"},"Cancel"),e("button",{onClick:Y,class:"btn btn-primary",disabled:K.value},r(K.value?"Saving...":"Create Decision"),9,Ye)])])):(n(),i("div",qe,[e("button",{onClick:t[2]||(t[2]=l=>J("Buy")),class:"btn btn-success flex-1"},"Buy"),e("button",{onClick:t[3]||(t[3]=l=>J("Sell")),class:"btn btn-danger flex-1"},"Sell")]))]),e("div",et,[t[20]||(t[20]=e("h4",{class:"section-title"},"Position Details",-1)),e("div",tt,[e("div",ot,[t[16]||(t[16]=e("span",{class:"stat-label"},"Units",-1)),e("span",st,r(d.value.position.units.toLocaleString()),1)]),e("div",lt,[t[17]||(t[17]=e("span",{class:"stat-label"},"Avg Cost",-1)),e("span",at,r(U(L)(Math.abs(d.value.position.avgCost))),1)]),e("div",nt,[t[18]||(t[18]=e("span",{class:"stat-label"},"Total Cost",-1)),e("span",it,r(U(L)(Math.abs(d.value.position.totalCost))),1)]),e("div",rt,[t[19]||(t[19]=e("span",{class:"stat-label"},"P&L",-1)),e("span",{class:S(["stat-value",{"text-success":d.value.position.profitLoss>=0,"text-danger":d.value.position.profitLoss<0}])},r(U(L)(d.value.position.profitLoss)),3)])])]),e("div",dt,[t[22]||(t[22]=e("h4",{class:"section-title"},"Transaction History",-1)),e("div",ut,[f.value&&s.value.length===0?(n(),i("div",ct,[...t[21]||(t[21]=[e("div",{class:"spinner-sm"},null,-1),B(" Loading transactions... ",-1)])])):s.value.length===0?(n(),i("div",vt," No transactions found ")):(n(),i("div",{key:2,class:"transaction-items",onScroll:q},[(n(!0),i(H,null,G(s.value,l=>(n(),i("div",{key:l.id,class:"transaction-item"},[e("div",pt,r(U(he)(l.date)),1),e("div",mt,[e("span",{class:S(["tx-badge",l.type.toLowerCase()])},r(l.type),3)]),e("div",ft,r(l.units.toLocaleString()),1),e("div",gt,r(U(L)(Math.abs(l.cost||l.value))),1)]))),128))],32))])])])):C("",!0)],2)],2)):C("",!0)}}},yt=X(ht,[["__scopeId","data-v-096b7059"]]),bt={class:"modal card danger-modal"},wt={class:"modal-body"},kt={class:"warning-text"},xt={class:"confirmation-section"},$t={for:"confirmInput"},_t={class:"highlight"},Ct=["placeholder"],It={class:"modal-footer"},Pt=["disabled"],Vt={key:0,class:"spinner"},At={__name:"ConfirmDeleteModal",props:{isOpen:Boolean,portfolioName:{type:String,required:!0}},emits:["cancel","confirm"],setup(I,{emit:z}){const u=I,x=z,y=c(""),w=c(!1),d=A(()=>y.value.trim()===u.portfolioName);W(()=>u.isOpen,P=>{P||(y.value="",w.value=!1)});const k=()=>{x("cancel")},b=()=>{!d.value||w.value||(w.value=!0,x("confirm"))};return(P,s)=>(n(),re(ae,{name:"modal"},{default:se(()=>[I.isOpen?(n(),i("div",{key:0,class:"modal-backdrop",onClick:Q(k,["self"])},[e("div",bt,[e("div",{class:"modal-header"},[s[3]||(s[3]=e("div",{class:"danger-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})])],-1)),s[4]||(s[4]=e("h2",null,"Delete Portfolio",-1)),e("button",{onClick:k,class:"btn-close","aria-label":"Close"},[...s[2]||(s[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",wt,[e("p",kt,[s[5]||(s[5]=B(" This action ",-1)),s[6]||(s[6]=e("strong",null,"cannot be undone",-1)),s[7]||(s[7]=B(". This will permanently delete the ",-1)),e("strong",null,r(I.portfolioName),1),s[8]||(s[8]=B(" portfolio and all associated data. ",-1))]),s[11]||(s[11]=e("div",{class:"deletion-summary"},[e("h4",null,"The following will be permanently deleted:"),e("ul",null,[e("li",null,"All accounts and their settings"),e("li",null,"All holdings and position history"),e("li",null,"All transaction records"),e("li",null,"All asset categories and allocations"),e("li",null,"All decisions and recommendations"),e("li",null,"All performance snapshots")])],-1)),e("div",xt,[e("label",$t,[s[9]||(s[9]=B(" To confirm, type ",-1)),e("strong",_t,r(I.portfolioName),1),s[10]||(s[10]=B(" below: ",-1))]),M(e("input",{id:"confirmInput","onUpdate:modelValue":s[0]||(s[0]=f=>y.value=f),type:"text",class:"input confirm-input",placeholder:`Type ${I.portfolioName} to confirm`,autocomplete:"off",onKeyup:s[1]||(s[1]=de(f=>d.value&&b(),["enter"]))},null,40,Ct),[[N,y.value]])])]),e("div",It,[e("button",{onClick:k,class:"btn btn-secondary"},"Cancel"),e("button",{onClick:b,class:"btn btn-danger",disabled:!d.value||w.value},[w.value?(n(),i("span",Vt)):C("",!0),B(" "+r(w.value?"Deleting...":"Delete this portfolio"),1)],8,Pt)])])])):C("",!0)]),_:1}))}},St={class:"modal card p-xl slide-in"},Dt={class:"form-group mb-lg"},Ft={class:"form-group mb-xl"},Mt={class:"relative"},Bt={key:0,class:"dropdown-list"},Ot=["onClick"],Tt={class:"font-bold"},Nt={key:0,class:"mt-sm p-sm bg-gray-50 flex-between border-radius text-sm"},Ut={class:"font-bold text-primary"},Lt={class:"text-muted ml-sm"},zt={class:"flex-end gap-md"},jt=["disabled"],Et={class:"allocation-section"},Ht={class:"section-header-row"},Rt={key:0,class:"remaining-label"},qt={key:0,class:"categories-table"},Gt=["max"],Kt={class:"cat-actions"},Wt=["onClick","disabled"],Zt={class:"cat-name"},Qt={class:"cat-code"},Jt={class:"cat-pct"},Xt={class:"cat-actions"},Yt=["onClick"],eo=["onClick","disabled"],to={key:1,class:"empty-categories"},oo={key:2,class:"add-form"},so=["max"],lo={class:"cat-actions"},ao=["disabled"],no={class:"danger-zone"},io={class:"danger-content"},ro={__name:"PortfolioSettingsModal",props:["isOpen","portfolio"],emits:["close","updated","deleted"],setup(I,{emit:z}){const u=I,x=z,y=c({name:"",benchmarkAssetId:null}),w=c(""),d=c([]),k=c(null),b=c(!1),P=c(!1),s=c([]),f=c(null),g=c({name:"",code:"",targetPercentage:0}),V=c(!1),$=c({name:"",code:"",targetPercentage:0}),F=c(!1),j=A(()=>s.value.reduce((t,o)=>t+(o.targetPercentage||0),0)),T=A(()=>Math.max(0,+(100-j.value).toFixed(1))),q=A(()=>{if(!f.value)return 100;const t=s.value.filter(o=>o.id!==f.value).reduce((o,l)=>o+(l.targetPercentage||0),0);return Math.max(0,+(100-t).toFixed(1))}),h=A(()=>{const t=j.value;return Math.abs(t-100)<.1?"total-ok":t>100?"total-over":"total-under"});let a=null;W(()=>u.isOpen,t=>{t&&u.portfolio&&(y.value.name=u.portfolio.name,y.value.benchmarkAssetId=u.portfolio.benchmarkAssetId,u.portfolio.benchmarkAssetId&&u.portfolio.benchmarkSymbol?k.value={id:u.portfolio.benchmarkAssetId,symbol:u.portfolio.benchmarkSymbol,name:"Benchmark Asset"}:k.value=null,w.value="",d.value=[],s.value=(u.portfolio.targetAllocation||[]).map(o=>({...o})),f.value=null,V.value=!1)});const p=async()=>{if(!w.value){d.value=[];return}clearTimeout(a),a=setTimeout(async()=>{try{const t=await D.get(`/assets?query=${w.value}`);d.value=t.data}catch(t){console.error(t)}},300)},m=t=>{k.value=t,y.value.benchmarkAssetId=t.id,d.value=[],w.value=""},_=()=>{k.value=null,y.value.benchmarkAssetId=null},O=()=>x("close"),Z=async()=>{b.value=!0;try{await D.put(`/portfolios/${u.portfolio.id}`,{name:y.value.name,benchmarkAssetId:y.value.benchmarkAssetId}),x("updated"),O()}catch(t){console.error(t),alert("Failed to save settings")}finally{b.value=!1}},K=t=>{f.value=t.id,g.value={name:t.name,code:t.code,targetPercentage:t.targetPercentage}},J=()=>{f.value=null},Y=async t=>{g.value.targetPercentage=Math.min(g.value.targetPercentage,q.value),F.value=!0;try{await D.put(`/portfolios/${u.portfolio.id}/categories/${t}`,g.value);const o=s.value.find(l=>l.id===t);o&&(o.name=g.value.name,o.code=g.value.code,o.targetPercentage=g.value.targetPercentage),f.value=null}catch(o){console.error(o),alert("Failed to update category")}finally{F.value=!1}},ee=()=>{$.value={name:"",code:"",targetPercentage:T.value},V.value=!0},te=async()=>{if($.value.name){$.value.targetPercentage=Math.min($.value.targetPercentage,T.value),F.value=!0;try{const t=await D.post(`/portfolios/${u.portfolio.id}/categories`,$.value);s.value.push(t.data),V.value=!1}catch(t){console.error(t),alert("Failed to add category")}finally{F.value=!1}}},oe=async t=>{if(confirm("Remove this category? Holdings assigned to it will become uncategorized.")){F.value=!0;try{await D.delete(`/portfolios/${u.portfolio.id}/categories/${t}`),s.value=s.value.filter(o=>o.id!==t)}catch(o){console.error(o),alert("Failed to delete category")}finally{F.value=!1}}},v=async()=>{try{await D.delete(`/portfolios/${u.portfolio.id}`),P.value=!1,x("deleted"),O()}catch(t){console.error("Failed to delete portfolio:",t),alert("Failed to delete portfolio. Please try again."),P.value=!1}};return(t,o)=>I.isOpen?(n(),i("div",{key:0,class:"modal-backdrop",onClick:Q(O,["self"])},[e("div",St,[e("div",{class:"flex-between mb-lg"},[o[11]||(o[11]=e("h2",null,"Portfolio Settings",-1)),e("button",{onClick:O,class:"btn-icon"},"Ã—")]),e("form",{onSubmit:Q(Z,["prevent"])},[e("div",Dt,[o[12]||(o[12]=e("label",{class:"block mb-sm text-sm font-bold text-muted"},"Portfolio Name",-1)),M(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>y.value.name=l),type:"text",class:"input w-full",required:""},null,512),[[N,y.value.name]])]),e("div",Ft,[o[13]||(o[13]=e("label",{class:"block mb-sm text-sm font-bold text-muted"},"Benchmark Index",-1)),o[14]||(o[14]=e("p",{class:"text-xs text-muted mb-sm"},"Select an asset to compare your portfolio against (e.g. VAS, IVV).",-1)),e("div",Mt,[M(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>w.value=l),onInput:p,type:"text",class:"input w-full",placeholder:"Search for an index (e.g. VAS)..."},null,544),[[N,w.value]]),d.value.length>0?(n(),i("div",Bt,[(n(!0),i(H,null,G(d.value,l=>(n(),i("div",{key:l.id,class:"dropdown-item",onClick:E=>m(l)},[e("span",Tt,r(l.symbol),1),B(" - "+r(l.name),1)],8,Ot))),128))])):C("",!0)]),k.value?(n(),i("div",Nt,[e("div",null,[e("span",Ut,r(k.value.symbol),1),e("span",Lt,r(k.value.name),1)]),e("button",{type:"button",onClick:_,class:"text-danger text-xs hover:underline"},"Remove")])):C("",!0)]),e("div",zt,[e("button",{type:"button",onClick:O,class:"btn btn-secondary"},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:b.value},r(b.value?"Saving...":"Save Changes"),9,jt)])],32),e("div",Et,[e("div",Ht,[o[16]||(o[16]=e("h3",{class:"section-title"},"Target Allocation",-1)),e("div",{class:S(["total-indicator",h.value])},[B(r(j.value.toFixed(1))+"% ",1),o[15]||(o[15]=e("span",{class:"total-label"},"total",-1)),T.value>.05?(n(),i("span",Rt,"("+r(T.value.toFixed(1))+"% remaining)",1)):C("",!0)],2)]),o[26]||(o[26]=e("p",{class:"text-xs text-muted mb-md"},"Define asset categories and their target allocation percentages for rebalancing. Total must not exceed 100%.",-1)),s.value.length>0?(n(),i("div",qt,[o[21]||(o[21]=ue('<div class="cat-header-row" data-v-748f5f08><span class="cat-col-name" data-v-748f5f08>Category</span><span class="cat-col-code" data-v-748f5f08>Code</span><span class="cat-col-pct" data-v-748f5f08>Target %</span><span class="cat-col-actions" data-v-748f5f08></span></div>',1)),(n(!0),i(H,null,G(s.value,l=>(n(),i("div",{key:l.id,class:"cat-row"},[f.value===l.id?(n(),i(H,{key:0},[M(e("input",{"onUpdate:modelValue":o[2]||(o[2]=E=>g.value.name=E),class:"cat-input",placeholder:"Name"},null,512),[[N,g.value.name]]),M(e("input",{"onUpdate:modelValue":o[3]||(o[3]=E=>g.value.code=E),class:"cat-input cat-code-input",placeholder:"CODE"},null,512),[[N,g.value.code]]),M(e("input",{"onUpdate:modelValue":o[4]||(o[4]=E=>g.value.targetPercentage=E),type:"number",step:"0.1",min:"0",max:q.value,class:"cat-input cat-pct-input"},null,8,Gt),[[N,g.value.targetPercentage,void 0,{number:!0}]]),e("div",Kt,[e("button",{onClick:E=>Y(l.id),class:"action-btn save",title:"Save",disabled:F.value},[...o[17]||(o[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"20 6 9 17 4 12"})],-1)])],8,Wt),e("button",{onClick:J,class:"action-btn cancel",title:"Cancel"},[...o[18]||(o[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])])],64)):(n(),i(H,{key:1},[e("span",Zt,r(l.name),1),e("span",Qt,r(l.code),1),e("span",Jt,r(l.targetPercentage)+"%",1),e("div",Xt,[e("button",{onClick:E=>K(l),class:"action-btn edit",title:"Edit"},[...o[19]||(o[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})],-1)])],8,Yt),e("button",{onClick:E=>oe(l.id),class:"action-btn delete",title:"Delete",disabled:F.value},[...o[20]||(o[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18"}),e("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})],-1)])],8,eo)])],64))]))),128))])):(n(),i("div",to,[...o[22]||(o[22]=[e("p",null,"No categories defined yet.",-1)])])),V.value?(n(),i("div",oo,[M(e("input",{"onUpdate:modelValue":o[5]||(o[5]=l=>$.value.name=l),class:"cat-input",placeholder:"Category name"},null,512),[[N,$.value.name]]),M(e("input",{"onUpdate:modelValue":o[6]||(o[6]=l=>$.value.code=l),class:"cat-input cat-code-input",placeholder:"CODE"},null,512),[[N,$.value.code]]),M(e("input",{"onUpdate:modelValue":o[7]||(o[7]=l=>$.value.targetPercentage=l),type:"number",step:"0.1",min:"0",max:T.value,class:"cat-input cat-pct-input",placeholder:"%"},null,8,so),[[N,$.value.targetPercentage,void 0,{number:!0}]]),e("div",lo,[e("button",{onClick:te,class:"action-btn save",title:"Add",disabled:F.value||!$.value.name||$.value.targetPercentage>T.value},[...o[23]||(o[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"20 6 9 17 4 12"})],-1)])],8,ao),e("button",{onClick:o[8]||(o[8]=l=>V.value=!1),class:"action-btn cancel",title:"Cancel"},[...o[24]||(o[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])])])):C("",!0),V.value?C("",!0):(n(),i("button",{key:3,onClick:ee,class:"add-category-btn",type:"button"},[...o[25]||(o[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),B(" Add Category ",-1)])]))]),e("div",no,[o[28]||(o[28]=e("h3",{class:"danger-title"},"Danger Zone",-1)),e("div",io,[o[27]||(o[27]=e("div",{class:"danger-info"},[e("strong",null,"Delete this portfolio"),e("p",null,"Once deleted, this portfolio and all its data cannot be recovered.")],-1)),e("button",{type:"button",onClick:o[9]||(o[9]=l=>P.value=!0),class:"btn btn-danger-outline"}," Delete Portfolio ")])])]),R(At,{isOpen:P.value,portfolioName:I.portfolio?.name||"",onCancel:o[10]||(o[10]=l=>P.value=!1),onConfirm:v},null,8,["isOpen","portfolioName"])])):C("",!0)}},uo=X(ro,[["__scopeId","data-v-748f5f08"]]),co={key:0,class:"portfolio-detail animate-fade-in"},vo={class:"page-header"},po={class:"header-info"},mo={class:"title-row"},fo={key:0,class:"benchmark-badge"},go={class:"text-muted"},ho={class:"controls-bar"},yo={class:"tabs"},bo=["onClick"],wo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ko={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},xo={class:"allocation-section"},$o={class:"total-value"},_o={class:"allocation-chart"},Co={class:"holdings-table card"},Io={class:"group-row"},Po={colspan:"5"},Vo=["onClick"],Ao={class:"col-name"},So={class:"holding-name"},Do={class:"holding-symbol"},Fo={class:"col-num"},Mo={class:"col-num"},Bo={class:"col-num font-bold"},Oo={class:"col-num"},To={key:0,class:"side-panel"},No={key:1,class:"loading-state"},Uo={__name:"PortfolioDetailView",setup(I){ve();const z=pe(),u=fe(),x=c(null),y=c([]),w=c([]),d=c(null),k=c(!1),b=c(!1),P=c(!1),s=c(null),f=c(!0),g=A(()=>{let h=[];if(d.value)h=w.value.filter(a=>a.accountId===d.value);else{const a=new Map;for(const p of w.value){a.has(p.assetId)||a.set(p.assetId,{...p,units:0,currentValue:0,totalCost:0});const m=a.get(p.assetId);m.units+=p.units,m.currentValue+=p.currentValue,m.totalCost+=p.units*p.avgCost}h=Array.from(a.values()).map(p=>({...p,avgCost:p.units!==0?p.totalCost/p.units:0}))}return k.value||(h=h.filter(a=>Math.abs(a.units)>1e-4)),h}),V=A(()=>g.value.reduce((h,a)=>h+a.currentValue,0)),$=A(()=>{const h={};for(const a of g.value){const p=a.categoryName||"Uncategorized";h[p]||(h[p]={name:p,holdings:[],totalValue:0}),h[p].holdings.push(a),h[p].totalValue+=a.currentValue}return Object.values(h).sort((a,p)=>p.totalValue-a.totalValue)}),F=h=>{s.value=h,b.value=!0,f.value=!1},j=()=>{b.value=!1,s.value=null},T=()=>{z.push("/")},q=async()=>{const h=u.currentPortfolioId;if(h)try{const a=await D.get(`/portfolios/${h}`);x.value=a.data;const p=await D.get(`/accounts/portfolio/${h}`);y.value=p.data;const m=await D.get(`/holdings/portfolio/${h}`);w.value=m.data}catch(a){console.error(a)}};return W(()=>u.currentPortfolioId,h=>{h&&q()}),ce(()=>{u.currentPortfolioId&&q()}),(h,a)=>{const p=le("router-link");return x.value?(n(),i("div",co,[e("div",vo,[e("div",po,[e("div",mo,[e("h1",null,r(x.value.name),1),e("button",{onClick:a[0]||(a[0]=m=>P.value=!0),class:"btn-icon",title:"Portfolio Settings"},[...a[5]||(a[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"3"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})],-1)])]),x.value.benchmarkSymbol?(n(),i("span",fo,"vs "+r(x.value.benchmarkSymbol),1)):C("",!0)]),e("p",go,r(y.value.length)+" accounts connected",1)]),R(p,{to:"/import",class:"btn btn-secondary"},{default:se(()=>[...a[6]||(a[6]=[B("Import Data",-1)])]),_:1})]),e("div",ho,[e("div",yo,[e("button",{class:S(["tab",{active:!d.value}]),onClick:a[1]||(a[1]=m=>d.value=null)},"All Accounts",2),(n(!0),i(H,null,G(y.value,m=>(n(),i("button",{key:m.id,class:S(["tab",{active:d.value===m.id}]),onClick:_=>d.value=m.id},r(m.accountName||m.accountNumber),11,bo))),128))]),e("button",{class:S(["toggle-btn",{active:k.value}]),onClick:a[2]||(a[2]=m=>k.value=!k.value)},[k.value?(n(),i("svg",wo,[...a[7]||(a[7]=[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1),e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)])])):(n(),i("svg",ko,[...a[8]||(a[8]=[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},null,-1)])])),a[9]||(a[9]=B(" Show Closed ",-1))],2)]),e("div",xo,[e("button",{onClick:a[3]||(a[3]=m=>f.value=!f.value),class:"section-header"},[e("span",{class:S(["chevron",{expanded:f.value}])},[...a[10]||(a[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"9 18 15 12 9 6"})],-1)])],2),a[11]||(a[11]=e("span",null,"Allocation",-1)),e("span",$o,r(U(L)(V.value)),1)]),R(ae,{name:"collapse"},{default:se(()=>[M(e("div",_o,[R(Ie,{holdings:g.value},null,8,["holdings"])],512),[[me,f.value]])]),_:1})]),e("div",{class:S(["split-layout",{"panel-open":b.value}])},[e("div",Co,[e("table",null,[a[12]||(a[12]=e("thead",null,[e("tr",null,[e("th",{class:"col-name"},"Name"),e("th",{class:"col-num"},"Units"),e("th",{class:"col-num"},"Price"),e("th",{class:"col-num"},"Value"),e("th",{class:"col-num"},"Alloc")])],-1)),(n(!0),i(H,null,G($.value,m=>(n(),i("tbody",{key:m.name},[e("tr",Io,[e("td",Po,r(m.name)+" ("+r(U(L)(m.totalValue))+")",1)]),(n(!0),i(H,null,G(m.holdings,_=>(n(),i("tr",{key:_.id,class:S(["holding-row",{selected:s.value===_.assetId}]),onClick:O=>F(_.assetId)},[e("td",Ao,[e("div",So,r(_.name),1),e("div",Do,r(_.symbol),1)]),e("td",Fo,r(_.units.toLocaleString("en-AU",{maximumFractionDigits:4})),1),e("td",Mo,r(_.units!==0?U(L)(_.currentValue/_.units):"-"),1),e("td",Bo,r(U(L)(_.currentValue)),1),e("td",Oo,r(V.value?(_.currentValue/V.value*100).toFixed(1):"0")+"%",1)],10,Vo))),128))]))),128))])]),b.value?(n(),i("div",To,[R(yt,{isOpen:b.value,portfolioId:x.value?.id,assetId:s.value,embedded:!0,onClose:j},null,8,["isOpen","portfolioId","assetId"])])):C("",!0)],2),R(uo,{isOpen:P.value,portfolio:x.value,onClose:a[4]||(a[4]=m=>P.value=!1),onUpdated:q,onDeleted:T},null,8,["isOpen","portfolio"])])):(n(),i("div",No,"Loading Portfolio..."))}}},Ho=X(Uo,[["__scopeId","data-v-ad6cd9ae"]]);export{Ho as default};
