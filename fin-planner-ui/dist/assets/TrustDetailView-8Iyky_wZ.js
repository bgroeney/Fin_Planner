import{_ as H,g as r,x as J,o as a,c as i,a as e,d as R,j as A,t as l,F as $,l as N,k as g,i as K,m as F,p as c,v as p,f as _,C as G,G as Q,s as v,r as W,A as X,e as E,n as U}from"./index-oVbs5Hxd.js";import{f as C}from"./formatters-DwG4QyEz.js";const Z={key:0,class:"trust-detail animate-fade-in"},ee={class:"header-row"},te={class:"header-content"},se={class:"breadcrumb"},ne={class:"current"},ae={class:"meta-row"},le={class:"meta-item"},ie={class:"meta-item"},oe={class:"meta-item"},de={class:"actions"},re={class:"detail-grid"},ue={class:"card section-card"},ce={key:0,class:"empty-state-mini"},ve={key:1,class:"beneficiary-grid"},me={class:"b-header"},pe={class:"b-icon"},be={class:"b-name"},fe={key:0,class:"badge badge-error"},ye={class:"b-meta"},ke={class:"b-actions"},ge=["onClick"],_e=["onClick"],Ce={class:"card section-card"},Ie={class:"section-header"},he={key:0,class:"empty-state-mini"},De={key:1,class:"income-summary"},we={class:"income-grid"},$e={class:"income-item"},Ne={class:"value"},Fe={class:"income-item"},xe={class:"value"},Be={class:"income-item"},Ve={class:"value"},Te={class:"income-item highlight"},Ge={class:"value"},Re={class:"distributions-section mt-xl"},Ae={key:0,class:"data-table"},Ee={class:"text-right font-semibold"},Ue={class:"text-right text-success"},Ye=["onClick"],Se={key:1,class:"empty-state-mini"},Me={class:"modal-card"},Le={class:"modal-header"},ze={class:"form-group"},Oe={class:"form-row"},Pe={class:"form-group"},je={class:"form-group"},qe={class:"form-row"},He={class:"form-group"},Je={class:"form-group"},Ke={class:"form-row"},Qe={class:"form-group"},We={class:"form-group"},Xe={class:"modal-actions"},Ze=["disabled"],et={class:"modal-card"},tt={class:"modal-header"},st={class:"form-group"},nt={key:0,class:"form-group"},at=["value"],lt={key:1,class:"form-group"},it=["value"],ot={class:"form-group"},dt={class:"modal-actions"},rt=["disabled"],ut={__name:"TrustDetailView",setup(ct){const x=X(),d=r(null),B=r([]),m=r(null),h=r(new Date().getMonth()>5?new Date().getFullYear()+1:new Date().getFullYear()),Y=r(!1),b=r(!1),f=r(!1),V=r([]),T=r([]),I=r("person"),u=r({personId:null,companyId:null,relationship:""}),o=r({fiscalYear:2025,frankedDividends:0,unfrankedIncome:0,discountCapitalGains:0,nonDiscountCapitalGains:0,rentalIncome:0,frankingCredits:0}),y=r(!1),k=async()=>{try{const n=await v.get(`/trusts/${x.params.id}`);d.value=n.data;const[t,D,s,w]=await Promise.all([v.get(`/trusts/${x.params.id}/distributions?fiscalYear=${h.value}`),v.get(`/trusts/${x.params.id}/income/${h.value}`).catch(()=>({data:null})),v.get(`/persons?portfolioId=${n.data.portfolioId}`),v.get(`/companies?portfolioId=${n.data.portfolioId}`)]);B.value=t.data,m.value=D.data,V.value=s.data,T.value=w.data,m.value&&(o.value={...m.value})}catch(n){console.error("Failed to load trust data",n)}},S=async()=>{y.value=!0;try{await v.post(`/trusts/${d.value.id}/income`,o.value),b.value=!1,await k()}catch{alert("Failed to save income")}finally{y.value=!1}},M=()=>{f.value=!0},L=async()=>{y.value=!0;try{const n=I.value==="person"?V.value.find(t=>t.id===u.value.personId)?.fullName:T.value.find(t=>t.id===u.value.companyId)?.companyName;await v.post(`/trusts/${d.value.id}/beneficiaries`,{personAccountId:u.value.personId,companyAccountId:u.value.companyId,beneficiaryName:n,relationship:u.value.relationship,isEligible:!0}),f.value=!1,await k()}catch{alert("Failed to add beneficiary")}finally{y.value=!1}},z=async n=>{try{await v.put(`/trusts/${d.value.id}/beneficiaries/${n.id}`,{...n,isEligible:!n.isEligible}),await k()}catch{alert("Update failed")}},O=async n=>{if(confirm("Remove this beneficiary?"))try{await v.delete(`/trusts/${d.value.id}/beneficiaries/${n}`),await k()}catch{alert("Delete failed")}},P=async n=>{if(confirm("Delete this distribution resolution?"))try{await v.delete(`/trusts/${d.value.id}/distributions/${n}`),await k()}catch{alert("Delete failed")}},j=n=>(n.frankedDividends||0)+(n.unfrankedIncome||0)+(n.rentalIncome||0)+(n.discountCapitalGains||0)*.5+(n.nonDiscountCapitalGains||0),q=n=>n.frankedDividends+n.unfrankedIncome+n.discountCapitalGains+n.nonDiscountCapitalGains;return J(k),(n,t)=>{const D=W("router-link");return d.value?(a(),i("div",Z,[e("div",ee,[e("div",te,[e("div",se,[R(D,{to:"/entities"},{default:A(()=>[...t[20]||(t[20]=[E("Entities",-1)])]),_:1}),t[21]||(t[21]=e("span",{class:"separator"},"/",-1)),e("span",ne,l(d.value.trustName),1)]),e("h1",null,l(d.value.trustName),1),e("div",ae,[e("span",le,"ðŸ›ï¸ "+l(d.value.trustType),1),e("span",ie,"ðŸ†” ABN: "+l(d.value.ABN||"N/A"),1),e("span",oe,"ðŸ‘¤ Trustee: "+l(d.value.trusteeName),1)])]),e("div",de,[R(D,{to:"/tax-optimization",class:"btn btn-accent mr-sm"},{default:A(()=>[...t[22]||(t[22]=[E("ðŸŽ¯ Optimizer",-1)])]),_:1}),e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=s=>Y.value=!0)},"Edit Trust")])]),e("div",re,[e("div",ue,[e("div",{class:"section-header"},[t[23]||(t[23]=e("h2",null,"ðŸ‘¥ Beneficiaries",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:M},"Add Beneficiary")]),d.value.beneficiaries?.length===0?(a(),i("div",ce," No beneficiaries added to this trust. ")):(a(),i("div",ve,[(a(!0),i($,null,N(d.value.beneficiaries,s=>(a(),i("div",{key:s.id,class:U(["beneficiary-item",{inactive:!s.isEligible}])},[e("div",me,[e("span",pe,l(s.personAccountId?"ðŸ‘¤":"ðŸ¢"),1),e("span",be,l(s.beneficiaryName),1),s.isEligible?_("",!0):(a(),i("span",fe,"Ineligible"))]),e("div",ye," Relationship: "+l(s.relationship||"N/A"),1),e("div",ke,[e("button",{class:"btn-icon",onClick:w=>z(s)},l(s.isEligible?"â¸ï¸":"â–¶ï¸"),9,ge),e("button",{class:"btn-icon btn-danger-text",onClick:w=>O(s.id)},"ðŸ—‘ï¸",8,_e)])],2))),128))]))]),e("div",Ce,[e("div",Ie,[e("h2",null,"ðŸ’° Fiscal Year Summary (FY"+l(h.value)+")",1),e("button",{class:"btn btn-secondary btn-sm",onClick:t[1]||(t[1]=s=>b.value=!0)},"Record Income")]),m.value?(a(),i("div",De,[e("div",we,[e("div",$e,[t[24]||(t[24]=e("span",{class:"label"},"Franked Dividends",-1)),e("span",Ne,l(g(C)(m.value.frankedDividends)),1)]),e("div",Fe,[t[25]||(t[25]=e("span",{class:"label"},"Franking Credits",-1)),e("span",xe,l(g(C)(m.value.frankingCredits)),1)]),e("div",Be,[t[26]||(t[26]=e("span",{class:"label"},"Rental & Other",-1)),e("span",Ve,l(g(C)(m.value.unfrankedIncome+m.value.rentalIncome)),1)]),e("div",Te,[t[27]||(t[27]=e("span",{class:"label"},"Total Taxable",-1)),e("span",Ge,l(g(C)(j(m.value))),1)])])])):(a(),i("div",he," No income recorded for FY"+l(h.value)+". ",1)),e("div",Re,[t[29]||(t[29]=e("h3",null,"ðŸ“‹ Distribution Resolutions",-1)),B.value.length>0?(a(),i("table",Ae,[t[28]||(t[28]=e("thead",null,[e("tr",null,[e("th",null,"Beneficiary"),e("th",{class:"text-right"},"Total Dist."),e("th",{class:"text-right"},"FC Offset"),e("th",null,"Status"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),i($,null,N(B.value,s=>(a(),i("tr",{key:s.id},[e("td",null,l(s.beneficiary?.beneficiaryName),1),e("td",Ee,l(g(C)(q(s))),1),e("td",Ue,l(g(C)(s.frankingCredits)),1),e("td",null,[e("span",{class:U(["status-pill",s.status.toLowerCase()])},l(s.status),3)]),e("td",null,[e("button",{class:"btn-icon btn-danger-text",onClick:w=>P(s.id)},"ðŸ—‘ï¸",8,Ye)])]))),128))])])):(a(),i("div",Se,"No distributions resolved for this FY."))])])]),(a(),K(Q,{to:"body"},[b.value?(a(),i("div",{key:0,class:"modal-overlay",onClick:t[11]||(t[11]=F(s=>b.value=!1,["self"]))},[e("div",Me,[e("div",Le,[t[30]||(t[30]=e("h2",null,"Record Trust Income",-1)),e("button",{class:"btn-close",onClick:t[2]||(t[2]=s=>b.value=!1)},"Ã—")]),e("form",{onSubmit:F(S,["prevent"]),class:"modal-form"},[e("div",ze,[t[31]||(t[31]=e("label",null,"Fiscal Year",-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.fiscalYear=s),type:"number",required:""},null,512),[[p,o.value.fiscalYear,void 0,{number:!0}]])]),e("div",Oe,[e("div",Pe,[t[32]||(t[32]=e("label",null,"Franked Dividends",-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.frankedDividends=s),type:"number",step:"0.01"},null,512),[[p,o.value.frankedDividends,void 0,{number:!0}]])]),e("div",je,[t[33]||(t[33]=e("label",null,"Franking Credits",-1)),c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.frankingCredits=s),type:"number",step:"0.01"},null,512),[[p,o.value.frankingCredits,void 0,{number:!0}]])])]),e("div",qe,[e("div",He,[t[34]||(t[34]=e("label",null,"Unfranked & Interest",-1)),c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.unfrankedIncome=s),type:"number",step:"0.01"},null,512),[[p,o.value.unfrankedIncome,void 0,{number:!0}]])]),e("div",Je,[t[35]||(t[35]=e("label",null,"Net Rental Income",-1)),c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.rentalIncome=s),type:"number",step:"0.01"},null,512),[[p,o.value.rentalIncome,void 0,{number:!0}]])])]),e("div",Ke,[e("div",Qe,[t[36]||(t[36]=e("label",null,"Discount CG (Gross)",-1)),c(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.discountCapitalGains=s),type:"number",step:"0.01"},null,512),[[p,o.value.discountCapitalGains,void 0,{number:!0}]])]),e("div",We,[t[37]||(t[37]=e("label",null,"Non-Discount CG",-1)),c(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>o.value.nonDiscountCapitalGains=s),type:"number",step:"0.01"},null,512),[[p,o.value.nonDiscountCapitalGains,void 0,{number:!0}]])])]),e("div",Xe,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=s=>b.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:y.value},"Save Income",8,Ze)])],32)])])):_("",!0),f.value?(a(),i("div",{key:1,class:"modal-overlay",onClick:t[19]||(t[19]=F(s=>f.value=!1,["self"]))},[e("div",et,[e("div",tt,[t[38]||(t[38]=e("h2",null,"Add Beneficiary",-1)),e("button",{class:"btn-close",onClick:t[12]||(t[12]=s=>f.value=!1)},"Ã—")]),e("form",{onSubmit:F(L,["prevent"]),class:"modal-form"},[e("div",st,[t[40]||(t[40]=e("label",null,"Link Existing Entity",-1)),c(e("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>I.value=s),onChange:t[14]||(t[14]=s=>u.value.id=null)},[...t[39]||(t[39]=[e("option",{value:"person"},"Person",-1),e("option",{value:"company"},"Bucket Company",-1)])],544),[[G,I.value]])]),I.value==="person"?(a(),i("div",nt,[t[41]||(t[41]=e("label",null,"Select Family Member",-1)),c(e("select",{"onUpdate:modelValue":t[15]||(t[15]=s=>u.value.personId=s)},[(a(!0),i($,null,N(V.value,s=>(a(),i("option",{key:s.id,value:s.id},l(s.fullName),9,at))),128))],512),[[G,u.value.personId]])])):_("",!0),I.value==="company"?(a(),i("div",lt,[t[42]||(t[42]=e("label",null,"Select Company",-1)),c(e("select",{"onUpdate:modelValue":t[16]||(t[16]=s=>u.value.companyId=s)},[(a(!0),i($,null,N(T.value,s=>(a(),i("option",{key:s.id,value:s.id},l(s.companyName),9,it))),128))],512),[[G,u.value.companyId]])])):_("",!0),e("div",ot,[t[43]||(t[43]=e("label",null,"Relationship",-1)),c(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>u.value.relationship=s),type:"text",placeholder:"e.g. Spouse, Corporate Beneficiary"},null,512),[[p,u.value.relationship]])]),e("div",dt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[18]||(t[18]=s=>f.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:y.value},"Add Beneficiary",8,rt)])],32)])])):_("",!0)]))])):_("",!0)}}},pt=H(ut,[["__scopeId","data-v-147637bc"]]);export{pt as default};
