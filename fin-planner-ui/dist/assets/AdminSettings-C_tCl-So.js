const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/portfolio-CjZnfIUI.js","assets/index-oVbs5Hxd.js","assets/index-CjcXVqI8.css"])))=>i.map(i=>d[i]);
import{_ as ve,x as me,s as r,g as i,w as ye,o as a,c as l,a as e,F as h,l as w,p as m,v as P,t as d,f as c,m as L,d as fe,j as he,T as _e,z as ge,n as B,q as be,e as T,C as Y,K as ke}from"./index-oVbs5Hxd.js";const we={class:"admin-container"},Se={class:"tabs"},Pe=["onClick"],Ce={class:"tab-content"},xe={key:0,class:"settings-panel"},Ie={class:"card"},Ae={class:"form-group"},$e={class:"input-group"},Ue={class:"form-group"},De={class:"last-update-text"},Fe=["disabled"],Me={key:0},Ne={key:1},Ve={key:1,class:"sources-panel"},Ee={class:"card"},Ke=["onDragstart","onDragenter"],Te={class:"source-header"},Oe={class:"priority-badge"},Re={class:"toggle"},Le={class:"switch"},Be=["onUpdate:modelValue","onChange"],Ye={class:"source-details"},qe={class:"code"},ze={class:"source-actions"},je={key:0,class:"text-muted text-sm"},He={key:1,class:"api-key-status"},Je=["onClick"],We={key:2,class:"api-key-input-group"},Ge=["onUpdate:modelValue"],Qe={class:"btn-group"},Xe=["onClick"],Ze=["onClick"],et={key:0,class:"priority-actions"},tt={key:2,class:"assets-panel"},st={class:"card"},ot={class:"table-container"},at={class:"assets-table"},lt={key:0},nt={class:"font-medium text-main"},it={class:"text-sm text-muted hidden-sm"},rt={class:"pricing-code-cell"},dt=["onUpdate:modelValue","placeholder","onInput"],ut={key:0,class:"text-xs text-muted mt-1 flex items-center gap-1"},ct={key:1,class:"text-xs text-primary mt-1 flex items-center gap-1"},pt={class:"select-wrapper"},vt=["onUpdate:modelValue","onChange"],mt=["value"],yt={class:"price-display"},ft={key:0,class:"price-tag"},ht={key:1,class:"price-error"},_t={key:2,class:"source-badge"},gt={class:"flex flex-col"},bt={class:"text-sm font-medium"},kt={key:0,class:"text-xs text-muted"},wt={key:1,class:"text-xs text-danger"},St={class:"actions-row"},Pt=["onClick","disabled"],Ct={key:0},xt={key:1},It=["onClick"],At=["onClick"],$t={key:3,class:"portfolios-panel"},Ut={class:"card"},Dt={class:"form-group"},Ft={class:"input-group"},Mt=["disabled"],Nt={key:0,class:"portfolio-list"},Vt={class:"portfolio-info"},Et={key:0,class:"shared-badge"},Kt={key:0,class:"portfolio-actions"},Tt=["onClick"],Ot=["onClick"],Rt={key:1,class:"text-muted"},Lt={class:"modal card"},Bt={class:"modal-header"},Yt={class:"form-group"},qt={class:"input-group"},zt=["disabled"],jt={key:0,class:"shares-list"},Ht={class:"share-info"},Jt={class:"share-email"},Wt={class:"role-badge"},Gt=["onClick"],Qt={key:1,class:"text-muted"},Xt={__name:"AdminSettings",setup(Zt){const y=i("settings"),q=[{id:"settings",label:"Price Update Settings"},{id:"sources",label:"Price Source Priority"},{id:"assets",label:"Asset Price Sources"},{id:"portfolios",label:"Portfolios"}],C=i({updateIntervalMinutes:15}),_=i([]),x=i([]),u=i({}),g=i({}),I=i({}),A=i(!1),S=i({}),N=i(null),z=ge(()=>{if(!N.value)return"Never";const s=new Date(N.value);return isNaN(s.getTime())||s.getFullYear()<2e3?"Never":s.toLocaleString()});me(async()=>{await O(),await J(),await V()});async function O(){try{const{data:s}=await r.get("/admin/price-settings");C.value.updateIntervalMinutes=s.updateIntervalMinutes,N.value=s.lastUpdateTime}catch(s){console.error("Failed to load price settings",s)}}async function j(){try{await r.put("/admin/price-settings/interval",{intervalMinutes:C.value.updateIntervalMinutes}),alert("Price update interval saved!")}catch{alert("Failed to save settings")}}async function H(){A.value=!0;try{await r.post("/admin/price-refresh"),alert("Price refresh triggered! This may take a few moments."),setTimeout(()=>O(),3e3)}catch{alert("Failed to trigger refresh")}finally{A.value=!1}}async function J(){try{const{data:s}=await r.get("/admin/price-sources");_.value=s,$.value=!1}catch(s){console.error("Failed to load price sources",s)}}const b=i(null),$=i(!1);function W(s){b.value=s}function G(s){if(b.value===s)return;const t=[..._.value],o=t[b.value];t.splice(b.value,1),t.splice(s,0,o),_.value=t,b.value=s,$.value=!0}function Q(){b.value=null}async function X(){try{const s=_.value.map((t,o)=>({sourceId:t.id,newPriority:o+1}));await r.put("/admin/price-sources/priority",s),alert("Priority order saved!"),$.value=!1}catch{alert("Failed to save priority order")}}async function Z(s){try{await r.put(`/admin/price-sources/${s.id}/toggle`)}catch{alert("Failed to toggle source"),s.isEnabled=!s.isEnabled}}async function ee(s){if(!g.value[s.id]){alert("Please enter an API key");return}try{await r.put(`/admin/price-sources/${s.id}/apikey`,{apiKey:g.value[s.id]}),alert(`API key saved for ${s.name}`),s.hasApiKey=!0,g.value[s.id]="",I.value[s.id]=!1}catch{alert("Failed to save API key")}}function te(s){I.value[s]=!1,g.value[s]=""}async function V(){try{const{data:s}=await r.get("/admin/assets/price-sources");x.value=s,u.value={},s.forEach(t=>{u.value[t.assetId]={customSymbol:t.customSymbol||"",sourceId:t.overrideSourceId||"",modified:!1}})}catch(s){console.error("Failed to load asset price sources",s)}}function R(s){u.value[s].modified=!0}async function se(s){const t=u.value[s];try{await r.put(`/admin/assets/${s}/price-source`,{sourceId:t.sourceId||null,customSymbol:t.customSymbol||null}),alert("Asset mapping saved!"),t.modified=!1,await V()}catch{alert("Failed to save asset mapping")}}async function oe(s){try{await r.put(`/admin/assets/${s}/price-source`,{sourceId:null,customSymbol:null}),alert("Asset mapping reset to default!"),u.value[s].customSymbol="",u.value[s].sourceId="",u.value[s].modified=!1,await V()}catch{alert("Failed to reset asset mapping")}}async function ae(s){S.value[s]=!0;try{const{data:t}=await r.post(`/admin/assets/${s}/sync-price`),o=x.value.findIndex(n=>n.assetId===s);o!==-1&&(x.value[o]=t)}catch(t){console.error("Failed to sync asset price",t),alert("Failed to sync price for this asset")}finally{S.value[s]=!1}}function le(s){if(!s)return"Never";const t=new Date(s);return isNaN(t.getTime())||t.getFullYear()<2e3?"Never":t.toLocaleString()}function ne(s){if(!s)return!0;const t=new Date(s);return new Date-t>1440*60*1e3}const U=i([]),k=i(""),D=i(!1),v=i(null),F=i([]),f=i(""),M=i("Viewer");async function E(){try{const{data:s}=await r.get("/portfolios");U.value=s}catch(s){console.error("Failed to load portfolios",s)}}async function ie(){if(k.value.trim())try{await r.post("/portfolios",{name:k.value.trim()}),k.value="",await E()}catch{alert("Failed to create portfolio")}}async function re(s){const o=U.value.find(n=>n.id===s)?.name||"this portfolio";if(confirm(`Are you sure you want to delete "${o}"? This will permanently remove all associated accounts, holdings, and transactions.`))try{console.log("Deleting portfolio:",s),await r.delete(`/portfolios/${s}`),console.log("Portfolio deleted successfully"),await E();const{usePortfolioStore:n}=await ke(async()=>{const{usePortfolioStore:pe}=await import("./portfolio-CjZnfIUI.js");return{usePortfolioStore:pe}},__vite__mapDeps([0,1,2]));await n().fetchPortfolios()}catch(n){console.error("Delete portfolio error:",n),alert(`Failed to delete portfolio: ${n.response?.data?.message||n.message||"Unknown error"}`)}}async function de(s){v.value=s,D.value=!0,f.value="",M.value="Viewer",await K(s.id)}async function K(s){try{const{data:t}=await r.get(`/portfolios/${s}/shares`);F.value=t}catch(t){console.error("Failed to load shares",t),F.value=[]}}async function ue(){if(!(!f.value.trim()||!v.value))try{await r.post(`/portfolios/${v.value.id}/shares`,{email:f.value.trim(),role:M.value}),f.value="",await K(v.value.id),alert("Invite sent successfully!")}catch(s){alert(s.response?.data?.message||"Failed to invite user")}}async function ce(s){if(v.value)try{await r.delete(`/portfolios/${v.value.id}/shares/${s}`),await K(v.value.id)}catch{alert("Failed to revoke access")}}return ye(y,s=>{s==="portfolios"&&E()}),(s,t)=>(a(),l("div",we,[t[29]||(t[29]=e("h1",null,"Admin Settings",-1)),e("div",Se,[(a(),l(h,null,w(q,o=>e("button",{key:o.id,class:B(["tab-btn",{active:y.value===o.id}]),onClick:n=>y.value=o.id},d(o.label),11,Pe)),64))]),e("div",Ce,[y.value==="settings"?(a(),l("div",xe,[e("div",Ie,[t[9]||(t[9]=e("h2",null,"Price Update Configuration",-1)),e("div",Ae,[t[7]||(t[7]=e("label",null,"Update Interval (minutes)",-1)),e("div",$e,[m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>C.value.updateIntervalMinutes=o),type:"number",min:"1",max:"1440",class:"input"},null,512),[[P,C.value.updateIntervalMinutes,void 0,{number:!0}]]),e("button",{onClick:j,class:"btn btn-primary"},"Save Interval")])]),e("div",Ue,[t[8]||(t[8]=e("label",null,"Last Update",-1)),e("p",De,d(z.value),1)]),e("button",{onClick:H,disabled:A.value,class:"btn btn-success"},[A.value?(a(),l("span",Ne,"Refreshing...")):(a(),l("span",Me,"ðŸ”„ Refresh Prices Now"))],8,Fe)])])):c("",!0),y.value==="sources"?(a(),l("div",Ve,[e("div",Ee,[t[13]||(t[13]=e("h2",null,"Price Source Priority",-1)),t[14]||(t[14]=e("p",{class:"help-text"},"Drag to reorder priority (top = first tried)",-1)),e("div",{class:"sources-list",onDragover:t[1]||(t[1]=L(()=>{},["prevent"])),onDrop:Q},[(a(!0),l(h,null,w(_.value,(o,n)=>(a(),l("div",{key:o.id,class:"source-item",draggable:"true",onDragstart:p=>W(n),onDragenter:p=>G(n)},[e("div",Te,[t[11]||(t[11]=e("span",{class:"drag-handle"},"â‰¡",-1)),e("span",Oe,d(n+1),1),e("strong",null,d(o.name),1),e("span",Re,[e("label",Le,[m(e("input",{type:"checkbox","onUpdate:modelValue":p=>o.isEnabled=p,onChange:p=>Z(o)},null,40,Be),[[be,o.isEnabled]]),t[10]||(t[10]=e("span",{class:"slider"},null,-1))])])]),e("div",Ye,[e("span",qe,d(o.code),1),e("span",null,"Rate: "+d(o.rateLimitPerMinute)+"/min",1)]),e("div",ze,[o.code==="YAHOO"?(a(),l("div",je," No API key required for Yahoo Finance. ")):o.hasApiKey&&!I.value[o.id]?(a(),l("div",He,[t[12]||(t[12]=e("span",{class:"key-indicator"},"Saved Key: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",-1)),e("button",{onClick:p=>I.value[o.id]=!0,class:"btn-sm btn-outline"},"Change",8,Je)])):(a(),l("div",We,[m(e("input",{"onUpdate:modelValue":p=>g.value[o.id]=p,type:"password",placeholder:"Enter API Key",class:"input-sm"},null,8,Ge),[[P,g.value[o.id]]]),e("div",Qe,[e("button",{onClick:p=>ee(o),class:"btn-sm btn-save-key"},"Save Key",8,Xe),o.hasApiKey?(a(),l("button",{key:0,onClick:p=>te(o.id),class:"btn-sm btn-outline"},"Cancel",8,Ze)):c("",!0)])]))])],40,Ke))),128))],32),$.value?(a(),l("div",et,[e("button",{onClick:X,class:"btn btn-primary"},"Save New Priority Order")])):c("",!0)])])):c("",!0),y.value==="assets"?(a(),l("div",tt,[e("div",st,[t[20]||(t[20]=e("h2",null,"Asset Price Symbol Mapping",-1)),t[21]||(t[21]=e("p",{class:"help-text"},"Manually configure pricing symbols and sources for each asset",-1)),e("div",ot,[e("table",at,[t[19]||(t[19]=e("thead",null,[e("tr",null,[e("th",null,"Asset Code"),e("th",null,"Name"),e("th",null,"Pricing Code"),e("th",null,"Source"),e("th",null,"Current Price"),e("th",null,"Last Updated"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),l(h,null,w(x.value,o=>(a(),l(h,{key:o.assetId},[u.value[o.assetId]?(a(),l("tr",lt,[e("td",nt,d(o.symbol),1),e("td",it,d(o.name),1),e("td",null,[e("div",rt,[m(e("input",{"onUpdate:modelValue":n=>u.value[o.assetId].customSymbol=n,type:"text",placeholder:o.symbol,class:"input-premium",onInput:n=>R(o.assetId)},null,40,dt),[[P,u.value[o.assetId].customSymbol]]),u.value[o.assetId].customSymbol?(a(),l("div",ct,[...t[16]||(t[16]=[e("span",{class:"status-dot active"},null,-1),T(" Custom Override ",-1)])])):(a(),l("div",ut,[...t[15]||(t[15]=[e("span",{class:"status-dot"},null,-1),T(" Uses Default ",-1)])]))])]),e("td",null,[e("div",pt,[m(e("select",{"onUpdate:modelValue":n=>u.value[o.assetId].sourceId=n,onChange:n=>R(o.assetId),class:"select-premium"},[t[17]||(t[17]=e("option",{value:""},"Default (Priority Order)",-1)),(a(!0),l(h,null,w(_.value.filter(n=>n.isEnabled),n=>(a(),l("option",{key:n.id,value:n.id},d(n.name),9,mt))),128))],40,vt),[[Y,u.value[o.assetId].sourceId]])])]),e("td",null,[e("div",yt,[o.currentPrice?(a(),l("div",ft," $"+d(o.currentPrice.toFixed(2)),1)):(a(),l("div",ht,[...t[18]||(t[18]=[e("span",{class:"error-icon"},"âš ï¸",-1),T(" No Data ",-1)])])),o.currentSourceUsed?(a(),l("span",_t,d(o.currentSourceUsed),1)):c("",!0)])]),e("td",null,[e("div",gt,[e("span",bt,d(le(o.lastUpdated)),1),ne(o.lastUpdated)?(a(),l("span",wt,"Outdated")):(a(),l("span",kt,"Just now"))])]),e("td",null,[e("div",St,[e("button",{onClick:n=>ae(o.assetId),class:B(["btn-icon btn-sync",{spinning:S.value[o.assetId]}]),disabled:S.value[o.assetId],title:"Sync Price"},[S.value[o.assetId]?(a(),l("span",Ct,"âŒ›")):(a(),l("span",xt,"ðŸ”„"))],10,Pt),u.value[o.assetId].modified?(a(),l("button",{key:0,onClick:n=>se(o.assetId),class:"btn-icon btn-save",title:"Save Changes"}," ðŸ’¾ ",8,It)):c("",!0),o.overrideSourceId||o.customSymbol?(a(),l("button",{key:1,onClick:n=>oe(o.assetId),class:"btn-icon btn-reset",title:"Reset to Default"}," âœ• ",8,At)):c("",!0)])])])):c("",!0)],64))),128))])])])])])):c("",!0),y.value==="portfolios"?(a(),l("div",$t,[e("div",Ut,[t[23]||(t[23]=e("h2",null,"Portfolio Management",-1)),t[24]||(t[24]=e("p",{class:"help-text"},"Create, rename, delete portfolios and manage sharing",-1)),e("div",Dt,[t[22]||(t[22]=e("label",null,"Create New Portfolio",-1)),e("div",Ft,[m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>k.value=o),type:"text",placeholder:"Portfolio name",class:"input"},null,512),[[P,k.value]]),e("button",{onClick:ie,class:"btn btn-primary",disabled:!k.value.trim()}," Create ",8,Mt)])]),U.value.length>0?(a(),l("div",Nt,[(a(!0),l(h,null,w(U.value,o=>(a(),l("div",{key:o.id,class:"portfolio-item"},[e("div",Vt,[e("strong",null,d(o.name),1),o.isShared?(a(),l("span",Et,"Shared with you")):c("",!0)]),o.isShared?c("",!0):(a(),l("div",Kt,[e("button",{onClick:n=>de(o),class:"btn-icon",title:"Share"}," ðŸ‘¥ ",8,Tt),e("button",{onClick:n=>re(o.id),class:"btn-icon btn-reset",title:"Delete"}," ðŸ—‘ï¸ ",8,Ot)]))]))),128))])):(a(),l("p",Rt,"No portfolios yet. Create your first one above."))])])):c("",!0),fe(_e,{name:"modal"},{default:he(()=>[D.value?(a(),l("div",{key:0,class:"modal-backdrop",onClick:t[6]||(t[6]=L(o=>D.value=!1,["self"]))},[e("div",Lt,[e("div",Bt,[e("h2",null,'Share "'+d(v.value?.name)+'"',1),e("button",{class:"btn-close",onClick:t[3]||(t[3]=o=>D.value=!1)},[...t[25]||(t[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",Yt,[t[27]||(t[27]=e("label",null,"Invite by Email",-1)),e("div",qt,[m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>f.value=o),type:"email",placeholder:"user@example.com",class:"input"},null,512),[[P,f.value]]),m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>M.value=o),class:"select-sm"},[...t[26]||(t[26]=[e("option",{value:"Viewer"},"Viewer",-1),e("option",{value:"Editor"},"Editor",-1),e("option",{value:"Admin"},"Admin",-1)])],512),[[Y,M.value]])]),e("button",{onClick:ue,class:"btn btn-primary",disabled:!f.value.trim(),style:{"margin-top":"12px"}}," Send Invite ",8,zt)]),F.value.length>0?(a(),l("div",jt,[t[28]||(t[28]=e("h3",null,"People with Access",-1)),(a(!0),l(h,null,w(F.value,o=>(a(),l("div",{key:o.id,class:"share-item"},[e("div",Ht,[e("span",Jt,d(o.sharedWithUserEmail),1),e("span",Wt,d(o.role),1)]),e("button",{onClick:n=>ce(o.id),class:"btn-icon btn-reset",title:"Revoke"}," âœ• ",8,Gt)]))),128))])):(a(),l("p",Qt,"Not shared with anyone yet."))])])):c("",!0)]),_:1})])]))}},ts=ve(Xt,[["__scopeId","data-v-8d8ffe6d"]]);export{ts as default};
