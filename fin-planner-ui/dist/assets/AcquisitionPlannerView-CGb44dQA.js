import{_ as oe,r as h,G as be,k as F,c as o,o as r,a as e,d as R,n as D,F as G,s as Z,t as p,g as A,m as q,C as le,v as Ae,x as T,y as N,H as Ee,e as te,b as ie,i as De,l as Oe,q as ee,h as Be,w as Ie,f as Ye,A as he}from"./index-CajTN6Mj.js";import{P as Te,f as ke,r as Fe}from"./PropertyRiskAnalyzer-D1yzrQwO.js";import{M as Ge}from"./MoneyBoxLoader-C_1gdrvW.js";const Ne={class:"cashflow-spreadsheet"},Ue={class:"spreadsheet-toolbar"},qe={class:"toolbar-left"},Le={class:"granularity-toggle"},ze={class:"toolbar-right"},Ke={class:"spreadsheet-table"},We={class:"header-row"},je={key:0,class:"category-row"},Je=["colspan"],He=["onClick"],Xe={class:"sticky-col row-label"},Qe=["onClick"],Ze=["onClick"],et={class:"cell-value"},tt={key:0,class:"lock-indicator",title:"Monthly values overridden"},at={class:"sticky-col row-label child-label"},st=["onClick"],nt=["onClick","onContextmenu"],lt=["value","onBlur","onKeydown"],it={class:"cell-value"},ot={key:0,class:"override-indicator",title:"Manual override"},rt={key:3,class:"add-row-row"},ut=["colspan"],dt=["onClick"],ct={class:"sticky-col row-label"},vt={key:0,class:"row-indent"},mt=["onClick","onContextmenu"],pt=["value","onBlur","onKeydown"],yt={class:"cell-value"},gt={key:0,class:"override-indicator",title:"Manual override"},ft={class:"add-line-modal card"},bt={class:"modal-header"},ht={class:"form-group"},kt={class:"form-row"},Ct={class:"form-group"},wt={class:"form-group"},$t={class:"modal-actions"},xt={class:"variance-modal card"},Rt={class:"modal-header"},Pt={class:"modal-body"},Vt={class:"variance-context"},St={class:"variance-input-group"},_t={class:"variance-input-group time-variance"},Mt={class:"time-variance-row"},At={class:"time-input"},Et={class:"time-input"},Dt={class:"time-variance-hint"},Ot={class:"modal-actions"},Bt={__name:"CashflowSpreadsheet",props:{deal:{type:Object,required:!0},holdingPeriod:{type:Number,default:10}},emits:["apply-changes"],setup(f,{emit:K}){const k=f,U=K,$=h("years"),u=h(["income","expenses","financing","summary"]),V=h(["outgoings"]),S=h(null),E=h(null),B=h([]),O=h(!1),b=h(""),l=h({label:"",amount:0,growthRate:3}),i=be({}),m=be({visible:!1,x:0,y:0,rowId:"",cellIndex:-1}),Y=h(!1),W=h({label:"",context:"",rowId:"",cellIndex:-1}),L=h(10),z=h(0),j=h(3),se=F(()=>$.value==="months"),C=F(()=>{const s=[];if($.value==="years")for(let t=1;t<=k.holdingPeriod;t++)s.push({key:`Y${t}`,label:`Y${t}`,year:t,isYearStart:!0,isYearSummary:!1,colType:"year"});else for(let t=1;t<=k.holdingPeriod;t++){for(let a=1;a<=12;a++)s.push({key:`Y${t}M${a}`,label:a===1?"M1":`M${a}`,year:t,month:a,isYearStart:a===1,isYearSummary:!1,colType:"month"});s.push({key:`Y${t}Total`,label:`Y${t}`,year:t,isYearStart:!1,isYearSummary:!0,colType:"yearTotal"})}return s}),J=(s,t,a=.025)=>s*Math.pow(1+a,t),H=s=>{if(!se.value)return s*12;if(C.value[s]?.isYearSummary)return-1;let a=0;for(let d=0;d<s;d++)C.value[d].isYearSummary||a++;return a},ae=s=>{const t=(s-1)*12;return Array.from({length:12},(a,d)=>t+d)},y=(s,t,a={})=>{const{growth:d=0,invert:c=!1}=a,v=[];if($.value==="years")for(let g=0;g<k.holdingPeriod;g++){let P=0;for(let _=0;_<12;_++){const M=g*12+_,I=`${t}-${M}`;if(i[I])P+=i[I].value;else{let x=J(s/12,g,d);c&&(x=-x),P+=x}}v.push({value:P,isOverride:!1})}else for(let g=1;g<=k.holdingPeriod;g++){let P=0;for(let M=1;M<=12;M++){const I=(g-1)*12+(M-1),x=`${t}-${I}`;if(i[x]){const Q=i[x].value;v.push({value:Q,isOverride:!0}),P+=Q}else{let Q=J(s/12,g-1,d);c&&(Q=-Q),v.push({value:Q,isOverride:!1}),P+=Q}}const _=ae(g).some(M=>i[`${t}-${M}`]);v.push({value:P,isOverride:!1,isYearSummary:!0,hasMonthlyOverrides:_})}return v},n=F(()=>{const s=[],t=k.deal;s.push({id:"income",label:"Income",isCategory:!0,category:"income"}),s.push({id:"grossRent",label:"Gross Rent",category:"income",parentCategory:"income",isEditable:!0,baseValue:t.estimatedGrossRent,growth:.025});const a=t.estimatedGrossRent*(t.vacancyRatePercent/100);s.push({id:"vacancyLoss",label:"Less: Vacancy",category:"income",parentCategory:"income",isEditable:!0,baseValue:a,growth:.025,invert:!0});const d=t.estimatedGrossRent*(1-t.vacancyRatePercent/100);s.push({id:"netRentalIncome",label:"Net Rental Income",category:"income",parentCategory:"income",isEditable:!1,baseValue:d,growth:.025}),s.push({id:"expenses",label:"Operating Expenses",isCategory:!0,category:"expenses"});const c=[{id:"councilRates",label:"Council Rates",baseValue:t.outgoingsEstimate*.35,growth:.03},{id:"waterRates",label:"Water Rates",baseValue:t.outgoingsEstimate*.1,growth:.03},{id:"insurance",label:"Insurance",baseValue:t.outgoingsEstimate*.2,growth:.05},{id:"maintenance",label:"Repairs & Maintenance",baseValue:t.outgoingsEstimate*.25,growth:.03},{id:"other",label:"Other",baseValue:t.outgoingsEstimate*.1,growth:.02},...B.value.filter(x=>x.parentId==="outgoings").map(x=>({id:x.id,label:x.label,baseValue:x.amount,growth:x.growthRate/100,isCustom:!0}))];s.push({id:"outgoings",label:"Outgoings",category:"expenses",parentCategory:"expenses",isExpandable:!0,childIds:c.map(x=>x.id)}),c.forEach(x=>{s.push({id:x.id,label:x.label,category:"expenses",parentCategory:"expenses",parentId:"outgoings",isChild:!0,isDeletable:x.isCustom,baseValue:x.baseValue,growth:x.growth,invert:!0})}),s.push({id:"addOutgoingsItem",isAddButton:!0,parentId:"outgoings",parentCategory:"expenses"});const v=d*(t.managementFeePercent/100);s.push({id:"managementFee",label:"Management Fee",category:"expenses",parentCategory:"expenses",isEditable:!0,baseValue:v,growth:.025,invert:!0});const g=t.outgoingsEstimate,P=d-g-v;s.push({id:"noi",label:"Net Operating Income",category:"expenses",parentCategory:"expenses",isEditable:!1,baseValue:P,growth:.02}),s.push({id:"financing",label:"Financing",isCategory:!0,category:"financing"});const _=t.loanAmount*(t.interestRatePercent/100);s.push({id:"debtService",label:"Debt Service",category:"financing",parentCategory:"financing",isEditable:!0,baseValue:_,invert:!0});const M=P-_;s.push({id:"netCashflow",label:"Net Cashflow",category:"financing",parentCategory:"financing",isEditable:!1,baseValue:M,growth:.02}),s.push({id:"summary",label:"Summary",isCategory:!0,category:"summary"});const I=t.askingPrice*Math.pow(1+t.capitalGrowthPercent/100,k.holdingPeriod);return s.push({id:"terminalValue",label:"Terminal Value",category:"summary",parentCategory:"summary",isEditable:!0,isTerminalValue:!0,terminalValue:I}),s});function X(s){return s.isExpandable?w(s):s.isTerminalValue?C.value.map((t,a)=>({value:a===C.value.length-1?s.terminalValue:0,isOverride:!1})):y(s.baseValue,s.id,{growth:s.growth||0,invert:s.invert})}function w(s){const t=n.value.filter(a=>a.parentId===s.id&&a.isChild);return C.value.map((a,d)=>{let c=0;if(a.isYearSummary){const v=ae(a.year);t.forEach(g=>{v.forEach(P=>{const _=`${g.id}-${P}`;if(i[_])c+=i[_].value;else{const M=Math.floor(P/12);let I=J(g.baseValue/12,M,g.growth||0);g.invert&&(I=-I),c+=I}})})}else if(se.value){const v=H(d);t.forEach(g=>{const P=`${g.id}-${v}`;if(i[P])c+=i[P].value;else{const _=Math.floor(v/12);let M=J(g.baseValue/12,_,g.growth||0);g.invert&&(M=-M),c+=M}})}else{const v=a.year-1;for(let g=0;g<12;g++){const P=v*12+g;t.forEach(_=>{const M=`${_.id}-${P}`;if(i[M])c+=i[M].value;else{let I=J(_.baseValue/12,v,_.growth||0);_.invert&&(I=-I),c+=I}})}}return{value:c,isOverride:!1}})}function de(s){const t=u.value.indexOf(s);t>-1?u.value.splice(t,1):u.value.push(s)}function Ce(s){const t=V.value.indexOf(s);t>-1?V.value.splice(t,1):V.value.push(s)}function ce(s){return s.isCategory?!0:u.value.includes(s.parentCategory)}function ve(s){return s.isExpandable?n.value.filter(a=>a.parentId===s.id&&a.isChild).some(a=>Object.keys(i).some(d=>d.startsWith(`${a.id}-`)&&i[d]?.isOverride)):!1}function me(s,t){if(!s.isExpandable)return!1;const a=C.value[t],d=n.value.filter(v=>v.parentId===s.id&&v.isChild);if(a?.isYearSummary){const v=ae(a.year);return d.some(g=>v.some(P=>i[`${g.id}-${P}`]?.isOverride))}const c=H(t);return c<0?!1:d.some(v=>i[`${v.id}-${c}`]?.isOverride)}function we(s){return Object.keys(i).some(t=>t.startsWith(`${s.id}-`)&&i[t]?.isOverride)}function $e(s){n.value.filter(a=>a.parentId===s.id&&a.isChild).forEach(a=>{Object.keys(i).forEach(d=>{d.startsWith(`${a.id}-`)&&delete i[d]})})}function pe(s,t){C.value[t]?.isYearSummary||(S.value={rowId:s.id,index:t},Ee(()=>{const d=document.querySelector(".cell-input");d&&(d.focus(),d.select())}))}function ne(s,t,a){const d=parseFloat(s.target.value)||0,c=t.category==="expenses"||t.category==="financing",v=H(a);if(v<0){S.value=null;return}const g=`${t.id}-${v}`;i[g]={value:c?-Math.abs(d):d,isOverride:!0},S.value=null}function ye(){S.value=null}function ge(s,t,a){C.value[a]?.isYearSummary||(m.visible=!0,m.x=s.clientX,m.y=s.clientY,m.rowId=t.id,m.cellIndex=a)}function re(){m.visible=!1}function xe(){const s=H(m.cellIndex);if(s>=0){const t=`${m.rowId}-${s}`;delete i[t]}re()}function Re(){const s=n.value.find(t=>t.id===m.rowId);W.value={label:s?.label||"",context:C.value[m.cellIndex]?.label||"",rowId:m.rowId,cellIndex:m.cellIndex},L.value=10,z.value=k.deal.timeVarianceEarlyMonths||0,j.value=k.deal.timeVarianceLateMonths||3,Y.value=!0,re()}function Pe(){const s=H(W.value.cellIndex);if(s>=0){const t=`${W.value.rowId}-${s}`;i[t]&&(i[t].variance=L.value)}U("apply-changes",{...fe(),timeVariance:{early:z.value,late:j.value}}),Y.value=!1}function Ve(s){b.value=s,l.value={label:"",amount:0,growthRate:3},O.value=!0}function Se(){B.value.push({id:`custom-${Date.now()}`,parentId:b.value,label:l.value.label,amount:l.value.amount,growthRate:l.value.growthRate||3}),O.value=!1}function _e(s){const t=B.value.findIndex(a=>a.id===s);t>-1&&(B.value.splice(t,1),Object.keys(i).forEach(a=>{a.startsWith(`${s}-`)&&delete i[a]}))}function Me(){Object.keys(i).forEach(s=>delete i[s]),B.value=[]}function fe(){return{granularity:$.value,periods:C.value.length,overrides:{...i},customItems:[...B.value],rows:n.value.filter(s=>!s.isCategory&&!s.isAddButton)}}function ue(s){if(s===0)return"-";const t=Math.abs(s),a=new Intl.NumberFormat("en-AU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(t);return s<0?`(${a})`:a}return(s,t)=>(r(),o("div",Ne,[e("div",Ue,[e("div",qe,[t[18]||(t[18]=e("h3",{class:"spreadsheet-title"},"Cashflow Model",-1)),e("div",Le,[e("button",{class:D(["toggle-btn",{active:$.value==="years"}]),onClick:t[0]||(t[0]=a=>$.value="years")},"Years",2),e("button",{class:D(["toggle-btn",{active:$.value==="months"}]),onClick:t[1]||(t[1]=a=>$.value="months")},"Months",2)])]),e("div",ze,[e("button",{class:"btn btn-secondary btn-sm",onClick:Me}," Reset All "),e("button",{class:"btn btn-primary btn-sm",onClick:t[2]||(t[2]=a=>s.$emit("apply-changes",fe()))}," Apply to Simulation ")])]),e("div",{class:"spreadsheet-container",ref:"spreadsheetContainer",onContextmenu:t[3]||(t[3]=q(()=>{},["prevent"]))},[e("table",Ke,[e("thead",null,[e("tr",We,[t[19]||(t[19]=e("th",{class:"sticky-col row-label-header"},"Parameter",-1)),(r(!0),o(G,null,Z(C.value,a=>(r(),o("th",{key:a.key,class:D(["period-header",{"year-start":a.isYearStart,"year-summary":a.isYearSummary}])},p(a.label),3))),128))])]),e("tbody",null,[(r(!0),o(G,null,Z(n.value,a=>(r(),o(G,{key:a.id},[a.isCategory?(r(),o("tr",je,[e("td",{colspan:C.value.length+1,class:"category-cell"},[e("button",{class:"expand-btn",onClick:d=>de(a.id)},[(r(),o("svg",{class:D({rotated:!u.value.includes(a.id)}),width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...t[20]||(t[20]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,He),A(" "+p(a.label),1)],8,Je)])):a.isExpandable&&ce(a)?(r(),o("tr",{key:1,class:D(["data-row expandable-row",{"has-overrides":ve(a),expanded:V.value.includes(a.id)}])},[e("td",Xe,[e("button",{class:"expand-btn",onClick:d=>Ce(a.id)},[(r(),o("svg",{class:D({rotated:!V.value.includes(a.id)}),width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...t[21]||(t[21]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,Qe),A(" "+p(a.label)+" ",1),ve(a)?(r(),o("span",{key:0,class:"locked-badge",onClick:d=>$e(a),title:"Child values overridden. Click to unlock and reset."},[...t[22]||(t[22]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])],8,Ze)):R("",!0)]),(r(!0),o(G,null,Z(X(a),(d,c)=>(r(),o("td",{key:c,class:D(["value-cell parent-cell",{locked:me(a,c),"year-summary":C.value[c]?.isYearSummary,negative:d.value<0}])},[e("span",et,p(ue(d.value)),1),me(a,c)?(r(),o("span",tt,[...t[23]||(t[23]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):R("",!0)],2))),128))],2)):a.isChild&&V.value.includes(a.parentId)?(r(),o("tr",{key:2,class:D(["data-row child-row",{"has-override":we(a)}])},[e("td",at,[t[24]||(t[24]=e("span",{class:"child-indent"},null,-1)),A(" "+p(a.label)+" ",1),a.isDeletable?(r(),o("button",{key:0,class:"delete-row-btn",onClick:d=>_e(a.id),title:"Remove"},"×",8,st)):R("",!0)]),(r(!0),o(G,null,Z(X(a),(d,c)=>(r(),o("td",{key:c,class:D(["value-cell",{editable:!C.value[c]?.isYearSummary,"year-summary":C.value[c]?.isYearSummary,negative:d.value<0,"has-override":d.isOverride}]),onClick:v=>!C.value[c]?.isYearSummary&&pe(a,c),onContextmenu:q(v=>!C.value[c]?.isYearSummary&&ge(v,a,c),["prevent"])},[S.value?.rowId===a.id&&S.value?.index===c?(r(),o("input",{key:0,ref_for:!0,ref_key:"editInput",ref:E,type:"number",value:Math.abs(d.value),onBlur:v=>ne(v,a,c),onKeydown:[le(v=>ne(v,a,c),["enter"]),le(ye,["escape"])],class:"cell-input"},null,40,lt)):(r(),o(G,{key:1},[e("span",it,p(ue(d.value)),1),d.isOverride?(r(),o("span",ot,"●")):R("",!0)],64))],42,nt))),128))],2)):a.isAddButton&&V.value.includes(a.parentId)?(r(),o("tr",rt,[e("td",{colspan:C.value.length+1,class:"add-row-cell"},[e("button",{class:"add-row-btn",onClick:d=>Ve(a.parentId)},[...t[25]||(t[25]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),A(" Add Line Item ",-1)])],8,dt)],8,ut)])):!a.isChild&&!a.isAddButton&&ce(a)?(r(),o("tr",{key:4,class:D(["data-row",{"derived-row":!a.isEditable,"summary-row":a.category==="summary"}])},[e("td",ct,[a.indent?(r(),o("span",vt,p("  ".repeat(a.indent)),1)):R("",!0),A(" "+p(a.label),1)]),(r(!0),o(G,null,Z(X(a),(d,c)=>(r(),o("td",{key:c,class:D(["value-cell",{editable:a.isEditable&&!C.value[c]?.isYearSummary,"year-summary":C.value[c]?.isYearSummary,negative:d.value<0,"has-override":d.isOverride}]),onClick:v=>a.isEditable&&!C.value[c]?.isYearSummary&&pe(a,c),onContextmenu:q(v=>a.isEditable&&!C.value[c]?.isYearSummary&&ge(v,a,c),["prevent"])},[S.value?.rowId===a.id&&S.value?.index===c?(r(),o("input",{key:0,ref_for:!0,ref_key:"editInput",ref:E,type:"number",value:Math.abs(d.value),onBlur:v=>ne(v,a,c),onKeydown:[le(v=>ne(v,a,c),["enter"]),le(ye,["escape"])],class:"cell-input"},null,40,pt)):(r(),o(G,{key:1},[e("span",yt,p(ue(d.value)),1),d.isOverride?(r(),o("span",gt,"●")):R("",!0)],64))],42,mt))),128))],2)):R("",!0)],64))),128))])])],544),m.visible?(r(),o("div",{key:0,class:"context-menu",style:Ae({top:m.y+"px",left:m.x+"px"}),onClick:t[4]||(t[4]=q(()=>{},["stop"]))},[e("button",{class:"context-menu-item",onClick:xe},[...t[26]||(t[26]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"1 4 1 10 7 10"}),e("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),A(" Reset to Calculated ",-1)])]),e("button",{class:"context-menu-item",onClick:Re},[...t[27]||(t[27]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 20V10"}),e("path",{d:"M18 20V4"}),e("path",{d:"M6 20v-4"})],-1),A(" Set Variance (±%) ",-1)])])],4)):R("",!0),m.visible?(r(),o("div",{key:1,class:"context-menu-backdrop",onClick:re})):R("",!0),O.value?(r(),o("div",{key:2,class:"modal-backdrop",onClick:t[10]||(t[10]=q(a=>O.value=!1,["self"]))},[e("div",ft,[e("div",bt,[t[28]||(t[28]=e("h4",null,"Add Custom Line Item",-1)),e("button",{class:"btn-close",onClick:t[5]||(t[5]=a=>O.value=!1)},"×")]),e("form",{onSubmit:q(Se,["prevent"]),class:"modal-body"},[e("div",ht,[t[29]||(t[29]=e("label",null,"Label *",-1)),T(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>l.value.label=a),type:"text",required:"",placeholder:"e.g., Security System"},null,512),[[N,l.value.label]])]),e("div",kt,[e("div",Ct,[t[30]||(t[30]=e("label",null,"Annual Amount *",-1)),T(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>l.value.amount=a),type:"number",min:"0",required:"",placeholder:"5000"},null,512),[[N,l.value.amount,void 0,{number:!0}]])]),e("div",wt,[t[31]||(t[31]=e("label",null,"Growth Rate (%)",-1)),T(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>l.value.growthRate=a),type:"number",step:"0.5",placeholder:"3.0"},null,512),[[N,l.value.growthRate,void 0,{number:!0}]])])]),e("div",$t,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[9]||(t[9]=a=>O.value=!1)},"Cancel"),t[32]||(t[32]=e("button",{type:"submit",class:"btn btn-primary"},"Add Line Item",-1))])],32)])])):R("",!0),Y.value?(r(),o("div",{key:3,class:"modal-backdrop",onClick:t[17]||(t[17]=q(a=>Y.value=!1,["self"]))},[e("div",xt,[e("div",Rt,[t[33]||(t[33]=e("h4",null,"Set Uncertainty Range",-1)),e("button",{class:"btn-close",onClick:t[11]||(t[11]=a=>Y.value=!1)},"×")]),e("div",Pt,[e("p",Vt,p(W.value.label)+" - "+p(W.value.context),1),e("div",St,[t[34]||(t[34]=e("label",null,[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 20V10"}),e("path",{d:"M18 20V4"}),e("path",{d:"M6 20v-4"})]),A(" Value Variance (±%) ")],-1)),T(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=a=>L.value=a),min:"0",max:"100",step:"1",class:"variance-input"},null,512),[[N,L.value,void 0,{number:!0}]]),T(e("input",{type:"range","onUpdate:modelValue":t[13]||(t[13]=a=>L.value=a),min:"0",max:"50",step:"1",class:"variance-slider"},null,512),[[N,L.value,void 0,{number:!0}]])]),e("div",_t,[t[40]||(t[40]=e("label",null,[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})]),A(" Timing Variance (months) ")],-1)),e("div",Mt,[e("div",At,[t[35]||(t[35]=e("span",{class:"time-label p10-label"},"P10 (Early)",-1)),T(e("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=a=>z.value=a),min:"0",max:"24",class:"variance-input small"},null,512),[[N,z.value,void 0,{number:!0}]]),t[36]||(t[36]=e("span",{class:"time-unit"},"mo",-1))]),t[39]||(t[39]=e("span",{class:"time-divider"},"↔",-1)),e("div",Et,[t[37]||(t[37]=e("span",{class:"time-label p90-label"},"P90 (Late)",-1)),T(e("input",{type:"number","onUpdate:modelValue":t[15]||(t[15]=a=>j.value=a),min:"0",max:"24",class:"variance-input small"},null,512),[[N,j.value,void 0,{number:!0}]]),t[38]||(t[38]=e("span",{class:"time-unit"},"mo",-1))])]),e("div",Dt," Cashflow timing: Receive "+p(z.value)+"mo early (P10) to "+p(j.value)+"mo late (P90) ",1)])]),e("div",Ot,[e("button",{class:"btn btn-secondary",onClick:t[16]||(t[16]=a=>Y.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:Pe},"Apply")])])])):R("",!0)]))}},It=oe(Bt,[["__scopeId","data-v-fc73ff64"]]),Yt={class:"lifecycle-stepper"},Tt={class:"stepper-track"},Ft=["onClick"],Gt={class:"step-indicator"},Nt={class:"step-circle"},Ut={key:0,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},qt={key:1},Lt={key:0,class:"step-line"},zt={class:"step-label"},Kt={class:"step-name"},Wt={key:0,class:"step-status"},jt={key:0,class:"lifecycle-actions"},Jt={class:"action-info"},Ht=["disabled"],Xt={key:0,class:"spinner"},Qt={__name:"LifecycleStepper",props:{currentStatus:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["transition"],setup(f,{emit:K}){const k=f,U=K,$=[{key:"Draft",label:"Draft"},{key:"Under Review",label:"Under Review"},{key:"Proceed to Acquire",label:"Proceed"},{key:"Offer Made",label:"Offer Made"},{key:"Under Due Diligence",label:"Due Diligence"},{key:"Waiting Settlement",label:"Settlement"},{key:"Acquired",label:"Acquired"}],u=F(()=>{const b=$.findIndex(l=>l.key===k.currentStatus);return b===-1?0:b}),V=F(()=>$[u.value]),S=F(()=>u.value===$.length-1),E=F(()=>{if(S.value)return null;const b=$[u.value+1];let l=`Mark as ${b.label}`;return b.key==="Proceed to Acquire"&&(l="Proceed to Acquire"),b.key==="Offer Made"&&(l="Record Offer"),b.key==="Acquired"&&(l="Confirm Acquisition"),{label:b.label,key:b.key,buttonText:l}});function B(b){}function O(){E.value&&U("transition",E.value.key)}return(b,l)=>(r(),o("div",Yt,[e("div",Tt,[(r(),o(G,null,Z($,(i,m)=>e("div",{key:i.key,class:D(["step-item",{active:u.value===m,completed:u.value>m,future:u.value<m}]),onClick:Y=>void 0},[e("div",Gt,[e("div",Nt,[u.value>m?(r(),o("svg",Ut,[...l[0]||(l[0]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(r(),o("span",qt,p(m+1),1))]),m<$.length-1?(r(),o("div",Lt)):R("",!0)]),e("div",zt,[e("span",Kt,p(i.label),1),u.value===m?(r(),o("span",Wt,"Current Stage")):R("",!0)])],10,Ft)),64))]),E.value&&!S.value?(r(),o("div",jt,[e("div",Jt,[l[3]||(l[3]=e("h4",null,"Move to next stage?",-1)),e("p",null,[l[1]||(l[1]=A("Current stage: ",-1)),e("strong",null,p(V.value.label),1),l[2]||(l[2]=A(". Next: ",-1)),e("strong",null,p(E.value.label),1)])]),e("button",{class:"btn btn-primary",onClick:O,disabled:f.loading},[f.loading?(r(),o("span",Xt)):R("",!0),A(" "+p(E.value.buttonText),1)],8,Ht)])):R("",!0)]))}},Zt=oe(Qt,[["__scopeId","data-v-938aa36b"]]),ea={class:"deal-workbench card"},ta={class:"workbench-header"},aa={class:"deal-info"},sa={class:"deal-title"},na={class:"deal-meta"},la={key:0,class:"deal-address"},ia={key:1,class:"deal-type badge"},oa={class:"lifecycle-container"},ra=["disabled"],ua={key:0,class:"spinner"},da={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ca={class:"view-tabs"},va={key:0,class:"workbench-grid"},ma={class:"summary-details"},pa={class:"detail-grid"},ya={class:"detail-item"},ga={class:"detail-item"},fa={class:"detail-item"},ba={class:"summary-actions"},ha={key:1,class:"risk-view"},ka={class:"risk-actions mt-lg flex-end"},Ca=["disabled"],wa={key:2,class:"spreadsheet-view"},$a={__name:"DealWorkbench",props:{deal:{type:Object,required:!0},simulationResults:{type:Object,default:null},runningSimulation:{type:Boolean,default:!1}},emits:["update","run-simulation","record-decision"],setup(f,{emit:K}){const k=h("risk"),U=h(null),$=h(!1),u=f,V=K;F(()=>{const l=u.deal.askingPrice*(u.deal.stampDutyRate/100);return u.deal.askingPrice+l+u.deal.legalCosts+u.deal.capExReserve}),F(()=>{const l=u.deal.estimatedGrossRent*(1-u.deal.vacancyRatePercent/100),i=l*(u.deal.managementFeePercent/100);return l-i-u.deal.outgoingsEstimate}),F(()=>u.deal.askingPrice>0?u.deal.loanAmount/u.deal.askingPrice*100:0),F(()=>null);function S(l){const i={askingPrice:l.propertyValue,estimatedGrossRent:l.estimatedGrossRent,outgoingsEstimate:l.outgoingsEstimate,vacancyRatePercent:l.vacancyRatePercent,capitalGrowthPercent:l.capitalGrowthPercent,capitalGrowthVariancePercent:l.capitalGrowthVariancePercent,discountRate:l.discountRate,loanAmount:l.loanAmount,interestRatePercent:l.interestRatePercent,interestVariancePercent:l.interestVariancePercent,rentVariancePercent:l.rentVariancePercent,holdingPeriodYears:l.holdingPeriodYears};V("update",i)}function E(l){$.value=!0,V("update",{status:l}),setTimeout(()=>$.value=!1,1e3)}function B(l){U.value=l,l.timeVariance&&V("update",{timeVarianceEarlyMonths:l.timeVariance.early,timeVarianceLateMonths:l.timeVariance.late})}function O(){V("run-simulation",U.value)}function b(l){return ke(l)}return(l,i)=>(r(),o("div",ea,[e("div",ta,[e("div",aa,[e("h2",sa,p(f.deal.name),1),e("div",na,[f.deal.address?(r(),o("span",la,p(f.deal.address),1)):R("",!0),f.deal.buildingType?(r(),o("span",ia,p(f.deal.buildingType),1)):R("",!0)])]),e("div",oa,[te(Zt,{"current-status":f.deal.status,loading:$.value,onTransition:E},null,8,["current-status","loading"])]),e("button",{class:"btn btn-primary run-simulation-btn",onClick:O,disabled:f.runningSimulation},[f.runningSimulation?(r(),o("span",ua)):(r(),o("svg",da,[...i[4]||(i[4]=[e("polygon",{points:"5 3 19 12 5 21 5 3"},null,-1)])])),A(" "+p(f.runningSimulation?"Running...":"Update & Run"),1)],8,ra)]),e("div",ca,[e("button",{class:D(["view-tab",{active:k.value==="summary"}]),onClick:i[0]||(i[0]=m=>k.value="summary")},[...i[5]||(i[5]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),e("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1),A(" Summary ",-1)])],2),e("button",{class:D(["view-tab",{active:k.value==="spreadsheet"}]),onClick:i[1]||(i[1]=m=>k.value="spreadsheet")},[...i[6]||(i[6]=[ie('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-bb7c2365><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-bb7c2365></rect><line x1="3" y1="9" x2="21" y2="9" data-v-bb7c2365></line><line x1="3" y1="15" x2="21" y2="15" data-v-bb7c2365></line><line x1="9" y1="3" x2="9" y2="21" data-v-bb7c2365></line><line x1="15" y1="3" x2="15" y2="21" data-v-bb7c2365></line></svg> Spreadsheet ',2)])],2),e("button",{class:D(["view-tab",{active:k.value==="risk"}]),onClick:i[2]||(i[2]=m=>k.value="risk")},[...i[7]||(i[7]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})],-1),A(" Risk Analysis ",-1)])],2)]),k.value==="summary"?(r(),o("div",va,[e("div",ma,[i[11]||(i[11]=e("h3",null,"Deal Overview",-1)),e("div",pa,[e("div",ya,[i[8]||(i[8]=e("label",null,"Asking Price",-1)),e("span",null,p(b(f.deal.askingPrice)),1)]),e("div",ga,[i[9]||(i[9]=e("label",null,"Gross Rent",-1)),e("span",null,p(b(f.deal.estimatedGrossRent)),1)]),e("div",fa,[i[10]||(i[10]=e("label",null,"Cap Rate (Input)",-1)),e("span",null,p(f.deal.askingPrice>0?(f.deal.estimatedGrossRent/f.deal.askingPrice*100).toFixed(2):0)+"%",1)])])]),e("div",ba,[e("button",{class:"btn btn-secondary",onClick:i[3]||(i[3]=m=>k.value="risk")},"Run Detailed Analysis")])])):k.value==="risk"?(r(),o("div",ha,[te(Te,{"initial-data":f.deal,"initial-results":f.simulationResults,"onUpdate:inputs":S},null,8,["initial-data","initial-results"]),e("div",ka,[e("button",{class:"btn btn-primary",onClick:O,disabled:f.runningSimulation},p(f.runningSimulation?"Saving Scenario...":"Save Scenario"),9,Ca)])])):k.value==="spreadsheet"?(r(),o("div",wa,[te(It,{deal:f.deal,"holding-period":f.deal.holdingPeriodYears,onApplyChanges:B},null,8,["deal","holding-period"])])):R("",!0)]))}},xa=oe($a,[["__scopeId","data-v-bb7c2365"]]),Ra={class:"planner-header"},Pa={class:"header-content"},Va={class:"breadcrumb"},Sa={class:"breadcrumb-current"},_a={key:1,class:"breadcrumb-current"},Ma={class:"page-title"},Aa={class:"page-subtitle"},Ea={class:"header-actions"},Da={key:0,class:"planner-layout"},Oa={class:"deals-sidebar card"},Ba={class:"sidebar-header"},Ia={key:0,class:"sidebar-loading"},Ya={key:1,class:"empty-sidebar"},Ta={key:2,class:"deals-list"},Fa=["onClick"],Ga={class:"deal-item-header"},Na={class:"deal-name"},Ua={class:"deal-item-meta"},qa={class:"deal-price"},La={class:"deal-cap"},za={key:1,class:"drill-down-workbench"},Ka={class:"modal deal-modal card"},Wa={class:"modal-header"},ja={class:"form-group"},Ja={class:"form-row"},Ha={class:"form-group"},Xa={class:"form-group"},Qa={class:"form-row"},Za={class:"form-group"},es={class:"form-group"},ts={class:"modal-actions"},as=["disabled"],ss={__name:"AcquisitionPlannerView",setup(f){const K=Oe(),k=Be(),U=h(!0),$=h([]),u=h(null),V=h(null),S=h(""),E=h(!1),B=h(!1),O=h(!1),b=h(!1),l=h({name:"",address:"",buildingType:"",askingPrice:0,estimatedGrossRent:0}),i=F(()=>S.value?$.value.filter(y=>y.status===S.value):$.value);De(async()=>{await m();const y=K.query.deal;y&&await Y(y)});async function m(){try{U.value=!0;const y=await ee.get("/propertydeals");$.value=y.data}catch(y){console.error("Failed to fetch deals:",y)}finally{U.value=!1}}async function Y(y){try{const n=await ee.get(`/propertydeals/${y}`);u.value=n.data,V.value=n.data.simulationResults?.[0]||null,k.replace({query:{deal:y}})}catch(n){console.error("Failed to load deal:",n)}}async function W(y){await Y(y),b.value=!0}function L(){b.value=!1,u.value=null,k.replace({query:{}})}function z(){l.value={name:"",address:"",buildingType:"",askingPrice:0,estimatedGrossRent:0},E.value=!0}async function j(){try{B.value=!0;const y=await ee.post("/propertydeals",l.value);E.value=!1,await m(),await Y(y.data.id)}catch(y){console.error("Failed to create deal:",y),alert("Failed to create deal. Please try again.")}finally{B.value=!1}}async function se(y){if(u.value)try{const n=await ee.put(`/propertydeals/${u.value.id}`,y);u.value=n.data,await m()}catch(n){console.error("Failed to update deal:",n)}}async function C(){if(u.value)try{O.value=!0;const y={askingPrice:u.value.askingPrice,stampDutyRate:u.value.stampDutyRate,legalCosts:u.value.legalCosts,capExReserve:u.value.capExReserve,estimatedGrossRent:u.value.estimatedGrossRent,vacancyRatePercent:u.value.vacancyRatePercent,managementFeePercent:u.value.managementFeePercent,outgoingsEstimate:u.value.outgoingsEstimate,loanAmount:u.value.loanAmount,interestRatePercent:u.value.interestRatePercent,capitalGrowthPercent:u.value.capitalGrowthPercent,holdingPeriodYears:u.value.holdingPeriodYears,rentVariancePercent:u.value.rentVariancePercent,vacancyVariancePercent:u.value.vacancyVariancePercent,interestVariancePercent:u.value.interestVariancePercent,capitalGrowthVariancePercent:u.value.capitalGrowthVariancePercent,discountRate:u.value.discountRate},n=Fe(y,5e3);await ee.post(`/propertydeals/${u.value.id}/simulations`,{iterations:n.iterations,medianNPV:n.medianNPV,p10NPV:n.p10NPV,p90NPV:n.p90NPV,medianIRR:n.medianIRR,p10IRR:n.p10IRR,p90IRR:n.p90IRR,calculatedCapRate:n.calculatedCapRate,recommendedDecision:n.recommendedDecision,npvHistogramJson:JSON.stringify(n.npvHistogram),irrHistogramJson:JSON.stringify(n.irrHistogram),yearlyDCFJson:JSON.stringify(n.yearlyDCF),inputsSnapshotJson:JSON.stringify(y)}),V.value=n,await Y(u.value.id),await m()}catch(y){console.error("Simulation failed:",y),alert("Simulation failed. Please try again.")}finally{O.value=!1}}async function J(y,n){if(u.value)try{await ee.put(`/propertydeals/${u.value.id}/decision`,{decision:y,rationale:n}),await Y(u.value.id),await m()}catch(X){console.error("Failed to record decision:",X),alert("Failed to record decision. Please try again.")}}function H(y){switch(y){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";default:return"status-draft"}}function ae(y){return ke(y)}return(y,n)=>{const X=Ye("router-link");return r(),o("div",{class:D(["acquisition-planner",{"drill-down-mode":b.value}])},[e("header",Ra,[e("div",Pa,[e("div",Va,[te(X,{to:"/properties",class:"breadcrumb-link"},{default:Ie(()=>[...n[9]||(n[9]=[A("Properties",-1)])]),_:1}),n[11]||(n[11]=e("span",{class:"breadcrumb-sep"},"/",-1)),b.value?(r(),o(G,{key:0},[e("a",{href:"#",onClick:q(L,["prevent"]),class:"breadcrumb-link"},"Acquisitions"),n[10]||(n[10]=e("span",{class:"breadcrumb-sep"},"/",-1)),e("span",Sa,p(u.value?.name),1)],64)):(r(),o("span",_a,"Acquisitions"))]),e("h1",Ma,p(b.value?u.value?.name:"Acquisition Planner"),1),e("p",Aa,p(b.value?u.value?.address||"Cashflow Analysis":"Analyze potential deals with uncertainty modeling"),1)]),e("div",Ea,[b.value?(r(),o("button",{key:0,class:"btn btn-secondary",onClick:L},[...n[12]||(n[12]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),e("polyline",{points:"12 19 5 12 12 5"})],-1),A(" Back to List ",-1)])])):R("",!0),b.value?R("",!0):(r(),o("button",{key:1,class:"btn btn-primary",onClick:z},[...n[13]||(n[13]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),A(" New Deal ",-1)])]))])]),b.value?(r(),o("div",za,[te(xa,{deal:u.value,"simulation-results":V.value,"running-simulation":O.value,onUpdate:se,onRunSimulation:C,onRecordDecision:J},null,8,["deal","simulation-results","running-simulation"])])):(r(),o("div",Da,[e("aside",Oa,[e("div",Ba,[n[15]||(n[15]=e("h3",null,"Scenarios",-1)),T(e("select",{"onUpdate:modelValue":n[0]||(n[0]=w=>S.value=w),class:"status-filter"},[...n[14]||(n[14]=[ie('<option value="" data-v-568311f2>All</option><option value="Draft" data-v-568311f2>Drafts</option><option value="Analyzing" data-v-568311f2>Analyzing</option><option value="Buy" data-v-568311f2>Buy</option><option value="Pass" data-v-568311f2>Pass</option><option value="Uneconomic" data-v-568311f2>Uneconomic</option>',6)])],512),[[he,S.value]])]),U.value?(r(),o("div",Ia,[te(Ge,{size:"sm"})])):i.value.length===0?(r(),o("div",Ya,[n[16]||(n[16]=e("p",null,"No deals yet",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:z},"Create First")])):(r(),o("ul",Ta,[(r(!0),o(G,null,Z(i.value,w=>(r(),o("li",{key:w.id,class:"deal-item",onClick:de=>W(w.id)},[e("div",Ga,[e("span",Na,p(w.name),1),e("span",{class:D(["deal-status",H(w.status)])},p(w.status),3)]),e("div",Ua,[e("span",qa,p(ae(w.askingPrice)),1),e("span",La,p(w.capRate.toFixed(1))+"% cap",1)])],8,Fa))),128))]))]),n[17]||(n[17]=ie('<main class="preview-area" data-v-568311f2><div class="empty-workbench card" data-v-568311f2><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-568311f2><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" data-v-568311f2></path><polyline points="9 22 9 12 15 12 15 22" data-v-568311f2></polyline></svg><h3 data-v-568311f2>Select a Deal to Analyze</h3><p data-v-568311f2>Click a scenario from the list to view detailed cashflow analysis</p></div></main>',1))])),E.value?(r(),o("div",{key:2,class:"modal-backdrop",onClick:n[8]||(n[8]=q(w=>E.value=!1,["self"]))},[e("div",Ka,[e("div",Wa,[n[18]||(n[18]=e("h2",null,"New Property Deal",-1)),e("button",{class:"btn-close",onClick:n[1]||(n[1]=w=>E.value=!1)},"×")]),e("form",{onSubmit:q(j,["prevent"]),class:"modal-body"},[e("div",ja,[n[19]||(n[19]=e("label",null,"Deal Name *",-1)),T(e("input",{"onUpdate:modelValue":n[2]||(n[2]=w=>l.value.name=w),type:"text",required:"",placeholder:"e.g., 123 Industrial Ave - Warehouse"},null,512),[[N,l.value.name]])]),e("div",Ja,[e("div",Ha,[n[20]||(n[20]=e("label",null,"Address",-1)),T(e("input",{"onUpdate:modelValue":n[3]||(n[3]=w=>l.value.address=w),type:"text",placeholder:"123 Main St, Sydney NSW"},null,512),[[N,l.value.address]])]),e("div",Xa,[n[22]||(n[22]=e("label",null,"Building Type",-1)),T(e("select",{"onUpdate:modelValue":n[4]||(n[4]=w=>l.value.buildingType=w)},[...n[21]||(n[21]=[ie('<option value="" data-v-568311f2>Select type</option><option value="Office" data-v-568311f2>Office</option><option value="Retail" data-v-568311f2>Retail</option><option value="Industrial" data-v-568311f2>Industrial</option><option value="Mixed" data-v-568311f2>Mixed Use</option>',5)])],512),[[he,l.value.buildingType]])])]),e("div",Qa,[e("div",Za,[n[23]||(n[23]=e("label",null,"Asking Price *",-1)),T(e("input",{"onUpdate:modelValue":n[5]||(n[5]=w=>l.value.askingPrice=w),type:"number",min:"0",step:"1000",required:"",placeholder:"1500000"},null,512),[[N,l.value.askingPrice,void 0,{number:!0}]])]),e("div",es,[n[24]||(n[24]=e("label",null,"Estimated Gross Rent (p.a.) *",-1)),T(e("input",{"onUpdate:modelValue":n[6]||(n[6]=w=>l.value.estimatedGrossRent=w),type:"number",min:"0",step:"100",required:"",placeholder:"120000"},null,512),[[N,l.value.estimatedGrossRent,void 0,{number:!0}]])])]),e("div",ts,[e("button",{type:"button",class:"btn btn-secondary",onClick:n[7]||(n[7]=w=>E.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:B.value},p(B.value?"Creating...":"Create & Analyze"),9,as)])],32)])])):R("",!0)],2)}}},os=oe(ss,[["__scopeId","data-v-568311f2"]]);export{os as default};
