import{o as v,c as p,a as t,e as se,t as _,f as k,F as Y,l as X,B as Je,z as A,g as H,n as ne,b as Te,w as ie,p as z,C as Ue,v as Q,x as we,i as Ae,m as Ee,G as He,_ as ze,q as Ie,d as ae}from"./index-oVbs5Hxd.js";const I={NORMAL:"normal",LOGNORMAL:"lognormal",TRIANGULAR:"triangular",UNIFORM:"uniform"};function me(a=0,o=1){const n=Math.random(),u=Math.random(),e=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*u);return a+e*o}function Ye(a,o){const n=me(a,o);return Math.exp(n)}function je(a,o,n){const u=Math.random(),e=(n-a)/(o-a);return u<=e?a+Math.sqrt(u*(o-a)*(n-a)):o-Math.sqrt((1-u)*(o-a)*(o-n))}function We(a,o){return a+Math.random()*(o-a)}function Fe(a){const o=a.length,n=Array(o).fill(0).map(()=>Array(o).fill(0));for(let u=0;u<o;u++)for(let e=0;e<=u;e++){let r=0;for(let y=0;y<e;y++)r+=n[u][y]*n[e][y];u===e?n[u][e]=Math.sqrt(Math.max(0,a[u][u]-r)):n[u][e]=(a[u][e]-r)/n[e][e]}return n}function Ze(a,o){const n=a.length,u=new Array(n).fill(0);for(let e=0;e<n;e++)for(let r=0;r<=e;r++)u[e]+=o[e][r]*a[r];return u}function Re(a,o){switch(a){case I.LOGNORMAL:return Ye(o.mu,o.sigma);case I.TRIANGULAR:return je(o.min,o.max,o.mode);case I.UNIFORM:return We(o.min,o.max);case I.NORMAL:default:return me(o.mean,o.stdDev)}}function Xe(a,o){const n=a*(o/100)/2;return me(a,n)}function xe(a,o,n,u){const e=a*(1-o/100),r=e*(n/100);return e-r-u}function Ve(a,o){return a*(o/100)}function Ke(a,o,n=100){let u=.1;for(let e=0;e<n;e++){let r=-o,y=0;for(let m=0;m<a.length;m++){const l=Math.pow(1+u,m+1);r+=a[m]/l,y-=(m+1)*a[m]/Math.pow(1+u,m+2)}if(Math.abs(r)<.01)break;u=u-r/y,u<-.99&&(u=-.99),u>1&&(u=1)}return u*100}function Qe(a){const{askingPrice:o,stampDutyRate:n,legalCosts:u,capExReserve:e,estimatedGrossRent:r,vacancyRatePercent:y,managementFeePercent:m,outgoingsEstimate:l,loanAmount:d,interestRatePercent:V,capitalGrowthPercent:h,holdingPeriodYears:C,rentVariancePercent:P,vacancyVariancePercent:F,interestVariancePercent:J,capitalGrowthVariancePercent:G,discountRate:b=8,timeVarianceEarly:R=0,timeVarianceLate:O=0}=a,f=o*(n/100),s=o+f+u+e-d,c=["rent","vacancy","interest","growth"],$=c.map(()=>me(0,1));let N=$;if(a.correlationMatrix&&a.correlationMatrix.length===c.length){const g=a.precalculatedCholesky||Fe(a.correlationMatrix);N=Ze($,g)}const w=g=>N[c.indexOf(g)],L=(g,x)=>{if(!x)return 0;switch(x.type){case I.LOGNORMAL:return Math.exp(x.mu+g*x.sigma);case I.NORMAL:return x.mean+g*x.stdDev;case I.UNIFORM:return Re(x.type,x);case I.TRIANGULAR:return Re(x.type,x);default:return x.mean+g*x.stdDev}},M=(g,x,q)=>{const U=g?.variancePercent??q;return{type:g?.type||I.NORMAL,mean:x,stdDev:x*(U/100)/2,min:x*(1-U/100),max:x*(1+U/100),mode:x,...g}},D=M(a.distributions?.rent,r,P),T=M(a.distributions?.vacancy,y,F),pe=M(a.distributions?.interest,V,J),oe=M(a.distributions?.growth,h,G),le=L(w("rent"),D),re=Math.max(0,L(w("vacancy"),T)),ue=Math.max(.1,L(w("interest"),pe)),ce=L(w("growth"),oe),de=-R,qe=O,be=de+Math.random()*(qe-de),j=[];let K=le,W=o;const Me=a.detailedCashflows&&a.detailedCashflows.length>0;for(let g=1;g<=C;g++){let x;if(Me){const q=a.detailedCashflows[g-1],U=q?q.netCashflow:0,ee=r>0?le/r:1,ve=(1-re/100)/(1-y/100);x=U*ee*ve}else{if(a.leaseDetails){const{remainingTerm:q,reviewType:U,reviewValue:ee,vacancyDurationMonths:ve,newLeaseTermYear:rn}=a.leaseDetails;g<=q&&g>1&&(U==="fixed"?K*=1+ee/100:U==="cpi"&&(K*=1.025)),g>1&&(U==="fixed"&&g<=q?K*=1+ee/100:K*=1.025);let ye=re;if(g===Math.ceil(q+.1)&&ve>0){const te=ve/12*100;ye=Math.max(ye,te)}const Le=xe(K,ye,m,l);let he=0;a.loanDetails&&a.loanDetails.length>0?a.loanDetails.forEach(te=>{const Be=Math.max(.1,Xe(te.rate,J));he+=te.amount*(Be/100)}):he=Ve(d,ue),x=Le-he}else{g>1&&(K*=1.025);const q=xe(K,re,m,l),U=Ve(d,ue);x=q-U}g>1&&(W*=1+ce/100,W>1e11&&(W=1e11))}if(Me&&g>1&&(W*=1+ce/100,W>1e11&&(W=1e11)),g===C){const q=W-d;j.push({amount:x+q,year:g,timingShiftMonths:be})}else j.push({amount:x,year:g,timingShiftMonths:be})}const Ce=b/100,$e=j.reduce((g,x)=>{const q=x.year+x.timingShiftMonths/12;return g+x.amount/Math.pow(1+Ce,q)},0),Oe=$e-s,Se=j.map(g=>g.amount),Ge=Ke(Se,s),Pe=[0];let _e=0;for(let g=0;g<j.length;g++){const x=j[g].year+j[g].timingShiftMonths/12,q=j[g].amount/Math.pow(1+Ce,x);_e+=q,Pe.push(_e)}return{npv:Oe,grossPV:$e,irr:Ge,finalValue:W,cumulativeGrossPV:Pe}}function et(a,o=5e3,n=!1){const u=performance.now(),e={...a,askingPrice:Number(a.askingPrice)||0,stampDutyRate:Number(a.stampDutyRate)||0,legalCosts:Number(a.legalCosts)||0,capExReserve:Number(a.capExReserve)||0,estimatedGrossRent:Number(a.estimatedGrossRent)||0,vacancyRatePercent:Number(a.vacancyRatePercent)||0,managementFeePercent:Number(a.managementFeePercent)||0,outgoingsEstimate:Number(a.outgoingsEstimate)||0,loanAmount:Number(a.loanAmount)||0,interestRatePercent:Number(a.interestRatePercent)||0,capitalGrowthPercent:Math.min(Math.max(Number(a.capitalGrowthPercent)||0,-20),30),holdingPeriodYears:Math.min(Math.max(Number(a.holdingPeriodYears)||10,1),50),rentVariancePercent:Math.min(Number(a.rentVariancePercent)||10,50),vacancyVariancePercent:Math.min(Number(a.vacancyVariancePercent)||5,50),interestVariancePercent:Math.min(Number(a.interestVariancePercent)||1,20),capitalGrowthVariancePercent:Math.min(Number(a.capitalGrowthVariancePercent)||2,20),discountRate:Number(a.discountRate)||8,timeVarianceEarly:Number(a.timeVarianceEarly)||0,timeVarianceLate:Number(a.timeVarianceLate)||0},r=[],y=[],m=[];let l=null;e.correlationMatrix&&(l=Fe(e.correlationMatrix));const d={...e,precalculatedCholesky:l};for(let M=0;M<o;M++){const{npv:D,grossPV:T,irr:pe,cumulativeGrossPV:oe}=Qe(d);if(y.push(pe),n){r.push(D);const le=e.askingPrice*(e.stampDutyRate/100),ue=e.askingPrice+le+e.legalCosts+e.capExReserve-e.loanAmount,ce=oe.map(de=>de-ue);m.push(ce)}else r.push(T),m.push(oe)}r.sort((M,D)=>M-D),y.sort((M,D)=>M-D);const V=Math.floor(o*.1),h=Math.floor(o*.5),C=Math.floor(o*.9),P=r[V],F=r[h],J=r[C],G=y[V],b=y[h],R=y[C],O=Ne(r,20),f=Ne(y,20),i=e.holdingPeriodYears,s={p10:[],median:[],p90:[]};for(let M=0;M<=i;M++){const D=new Float32Array(o);for(let T=0;T<o;T++)D[T]=m[T][M];D.sort(),s.p10.push(D[V]),s.median.push(D[h]),s.p90.push(D[C])}const c=xe(e.estimatedGrossRent,e.vacancyRatePercent,e.managementFeePercent,e.outgoingsEstimate),$=e.askingPrice>0?c/e.askingPrice*100:0;let N="Analyzing";F<0?N="Uneconomic":P>0||F>0&&P>-e.askingPrice*.1?N="Buy":N="Pass";const w=performance.now(),L=[];for(let M=0;M<=100;M++){const D=Math.min(Math.floor(M/100*(o-1)),o-1);L.push({percent:M,value:r[D]})}return{iterations:o,runTimeMs:Math.round(w-u),medianNPV:isFinite(F)?Math.round(F):0,p10NPV:isFinite(P)?Math.round(P):0,p90NPV:isFinite(J)?Math.round(J):0,medianIRR:isFinite(b)?Math.round(b*10)/10:0,p10IRR:isFinite(G)?Math.round(G*10)/10:0,p90IRR:isFinite(R)?Math.round(R*10)/10:0,calculatedCapRate:isFinite($)?Math.round($*100)/100:0,recommendedDecision:N,npvHistogram:O,irrHistogram:f,yearlyDCF:s,probabilityCurve:L.map(M=>({percent:M.percent,value:isFinite(M.value)?M.value:0}))}}function Ne(a,o=20){const n=Math.min(...a),e=Math.max(...a)-n,r=e>0?e/o:1,y=new Array(o).fill(0).map((m,l)=>({min:n+l*(e>0?r:0),max:n+(l+1)*(e>0?r:0),count:0}));return a.forEach(m=>{let l=e>0?Math.floor((m-n)/r):0;isNaN(l)&&(l=0),l=Math.max(0,Math.min(l,o-1)),y[l]&&y[l].count++}),y}function De(a){return new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0)}const tt={class:"value-at-risk-chart"},at={class:"chart-header"},nt={class:"chart-legend"},it={class:"legend-item value-curve"},st={key:0,class:"legend-item cost-line"},ot=["viewBox"],lt={class:"grid-lines"},rt=["x1","y1","x2","y2"],ut=["x1","y1","x2","y2"],ct=["d"],dt=["d"],vt=["x1","y1","x2","y2"],mt=["x","y"],pt={key:2},yt=["points"],ht=["x","y"],ft={class:"markers"},gt=["cx","cy"],xt=["cx","cy"],bt=["cx","cy"],Mt=["x","y"],Ct=["x","y"],$t=["x","y"],Pt={class:"y-axis"},_t=["x","y"],Rt=["x","y"],Vt={class:"x-axis"},Nt=["x","y"],kt=["x","y"],wt=["x","y"],At=["x1","y1","x2","y2"],Ft=["cx","cy"],Dt={class:"tooltip-header"},qt={class:"tooltip-value"},Z=600,E=300,Ot={__name:"ValueAtRiskChart",props:{probabilityCurve:{type:Array,required:!0,default:()=>[]},totalAcquisitionCost:{type:Number,required:!0},isNetMode:{type:Boolean,default:!1}},setup(a){const o=a,n={top:20,right:30,bottom:50,left:80},u=Z-n.left-n.right,e=E-n.top-n.bottom,r=H(null),y=H({visible:!1,x:0,y:0,xLine:0,value:0,percent:0}),m=A(()=>{if(!o.probabilityCurve.length)return 0;const f=o.probabilityCurve.map(N=>N.value),i=Math.min(...f),s=Math.max(...f),c=s-i;if(c===0)return i-Math.abs(i)*.1-1e3;let $=i-c*.1;return o.isNetMode&&s>0&&i<0?$=Math.min($,i*1.1):o.isNetMode&&($=Math.min($,0)),$}),l=A(()=>{if(!o.probabilityCurve.length)return 1e5;const f=o.probabilityCurve.map(N=>N.value),i=Math.min(...f),s=Math.max(...f),c=s-i;if(c===0)return s+Math.abs(s)*.1+1e3;let $=s+c*.1;return o.isNetMode&&($=Math.max($,0)),$}),d=A(()=>o.isNetMode?!1:o.totalAcquisitionCost>=m.value&&o.totalAcquisitionCost<=l.value),V=A(()=>{const i=(l.value-m.value)/4;return[m.value,m.value+i,m.value+i*2,m.value+i*3,l.value]});function h(f){const i=l.value-m.value||1;return n.left+(f-m.value)/i*u}function C(f){return n.top+(1-f/100)*e}function P(f){const i=o.probabilityCurve.find(s=>s.percent===f);return i&&isFinite(i.value)?i.value:0}const F=A(()=>{if(!o.probabilityCurve.length)return"";const f=o.probabilityCurve.filter(s=>isFinite(s.value));return f.length?f.map((s,c)=>{const $=c===0?"M":"L",N=h(s.value),w=C(s.percent);return!isFinite(N)||!isFinite(w)?"":`${$} ${N.toFixed(2)} ${w.toFixed(2)}`}).filter(s=>s).join(" "):""}),J=A(()=>{if(!o.probabilityCurve.length)return"";const f=o.probabilityCurve.filter($=>isFinite($.value));if(!f.length)return"";const i=f[0],s=f[f.length-1];let c=`M ${h(i.value)} ${E-n.bottom} `;return c+=F.value.substring(1),c+=` L ${h(s.value)} ${E-n.bottom} Z`,c});function G(f){const i=r.value.getBoundingClientRect(),c=f.clientX-i.left-n.left,$=l.value-m.value||1,N=Math.max(0,Math.min(1,c/u)),w=m.value+N*$,L=o.probabilityCurve.reduce((D,T)=>Math.abs(T.value-w)<Math.abs(D.value-w)?T:D),M=h(L.value);y.value={visible:!0,x:M+10,y:C(L.percent)-40,xLine:M,value:L.value,percent:L.percent}}function b(){y.value.visible=!1}function R(f){return De(f)}function O(f){return Math.abs(f)>=1e6?`$${(f/1e6).toFixed(1)}M`:Math.abs(f)>=1e3?`$${(f/1e3).toFixed(0)}K`:`$${f.toFixed(0)}`}return(f,i)=>(v(),p("div",tt,[t("div",at,[i[0]||(i[0]=t("h4",{class:"chart-title"},[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})]),se(" Value at Risk (Cumulative Distribution) ")],-1)),t("div",nt,[t("span",it,_(a.isNetMode?"Net Profit":"Intrinsic Value"),1),a.isNetMode?k("",!0):(v(),p("span",st,"Total Cost"))])]),t("div",{class:"chart-container",ref_key:"chartContainer",ref:r},[(v(),p("svg",{viewBox:`0 0 ${Z} ${E}`,class:"chart-svg"},[t("g",lt,[(v(),p(Y,null,X(5,s=>t("line",{key:"h"+s,x1:n.left,y1:n.top+(s-1)*(e/4),x2:Z-n.right,y2:n.top+(s-1)*(e/4),class:"grid-line"},null,8,rt)),64)),(v(),p(Y,null,X(5,s=>t("line",{key:"v"+s,x1:n.left+(s-1)*(u/4),y1:n.top,x2:n.left+(s-1)*(u/4),y2:E-n.bottom,class:"grid-line"},null,8,ut)),64))]),i[1]||(i[1]=t("defs",null,[t("linearGradient",{id:"valueGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[t("stop",{offset:"0%","stop-color":"var(--color-industrial-copper)","stop-opacity":"0.3"}),t("stop",{offset:"100%","stop-color":"var(--color-industrial-copper)","stop-opacity":"0.05"})])],-1)),t("path",{d:J.value,fill:"url(#valueGradient)",class:"curve-area"},null,8,ct),t("path",{d:F.value,class:"value-curve-line"},null,8,dt),!a.isNetMode&&d.value?(v(),p("line",{key:0,x1:h(a.totalAcquisitionCost),y1:n.top,x2:h(a.totalAcquisitionCost),y2:E-n.bottom,class:"cost-benchmark-line"},null,8,vt)):k("",!0),!a.isNetMode&&d.value?(v(),p("text",{key:1,x:h(a.totalAcquisitionCost)+5,y:n.top+10,class:"benchmark-label",style:{"text-anchor":"start"}},"Cost: "+_(R(a.totalAcquisitionCost)),9,mt)):k("",!0),!a.isNetMode&&!d.value&&a.totalAcquisitionCost>l.value?(v(),p("g",pt,[t("polygon",{points:`${Z-n.right-15},${n.top+20} ${Z-n.right},${n.top+25} ${Z-n.right-15},${n.top+30}`,fill:"var(--color-text-muted)"},null,8,yt),t("text",{x:Z-n.right-20,y:n.top+28,class:"benchmark-label",style:{"text-anchor":"end","font-size":"9px"}},"Cost: "+_(R(a.totalAcquisitionCost))+" →",9,ht)])):k("",!0),t("g",ft,[t("circle",{cx:h(P(10)),cy:C(10),r:"4",class:"marker-point p10"},null,8,gt),t("circle",{cx:h(P(50)),cy:C(50),r:"4",class:"marker-point median"},null,8,xt),t("circle",{cx:h(P(90)),cy:C(90),r:"4",class:"marker-point p90"},null,8,bt),t("text",{x:h(P(10)),y:C(10)-10,class:"marker-label"},"P10",8,Mt),t("text",{x:h(P(50)),y:C(50)-10,class:"marker-label"},"Median",8,Ct),t("text",{x:h(P(90)),y:C(90)-10,class:"marker-label"},"P90",8,$t)]),t("g",Pt,[(v(),p(Y,null,X([0,25,50,75,100],s=>t("text",{key:"y"+s,x:n.left-8,y:C(s)+4,class:"axis-label"},_(s)+"%",9,_t)),64)),t("text",{x:n.left-45,y:E/2,transform:"rotate(-90, 20, 150)",class:"axis-title",style:{"transform-box":"fill-box","transform-origin":"center"}},"Cumulative Probability",8,Rt)]),t("g",Vt,[(v(!0),p(Y,null,X(V.value,(s,c)=>(v(),p("text",{key:"x"+c,x:h(s),y:E-n.bottom+16,class:"axis-label"},_(O(s)),9,Nt))),128)),t("text",{x:Z/2,y:E-5,class:"axis-title"},_(a.isNetMode?"Net Profit ($)":"Intrinsic Value ($)"),9,kt)]),t("rect",{x:n.left,y:n.top,width:u,height:e,fill:"transparent",onMousemove:G,onMouseleave:b},null,40,wt),y.value.visible?(v(),p("line",{key:3,x1:y.value.xLine,y1:n.top,x2:y.value.xLine,y2:E-n.bottom,class:"interactive-line"},null,8,At)):k("",!0),y.value.visible?(v(),p("circle",{key:4,cx:y.value.xLine,cy:C(y.value.percent),r:"5",class:"interactive-point"},null,8,Ft)):k("",!0)],8,ot)),y.value.visible?(v(),p("div",{key:0,class:"chart-tooltip",style:Je({left:y.value.x+"px",top:y.value.y+"px"})},[t("div",Dt,_(y.value.percent.toFixed(0))+"% Probability",1),t("div",qt,_(R(y.value.value)),1),i[2]||(i[2]=t("div",{class:"tooltip-sub"},"Value ≤ this amount",-1))],4)):k("",!0)],512)]))}},St={class:"monte-carlo-chart"},Gt={class:"chart-title"},Lt={class:"chart-container"},Bt=["viewBox"],Jt={class:"bars"},Tt=["x","y","width","height"],Ut={class:"percentile-lines"},Et=["x1","x2","y2"],Ht=["x1","x2","y2"],zt=["x1","x2","y2"],It=["x1","x2","y2"],Yt={class:"labels"},jt=["x","y"],Wt=["x","y"],Zt=["x","y"],Xt={class:"axis-values"},Kt=["y"],Qt=["x","y"],fe=400,B=150,S=20,ke=2,ea={__name:"MonteCarloChart",props:{histogram:{type:Array,required:!0},p10:{type:Number,required:!0},median:{type:Number,required:!0},p90:{type:Number,required:!0},title:{type:String,default:"Distribution"}},setup(a){const o=a,n=A(()=>o.histogram?.length?Math.min(...o.histogram.map(b=>b.min)):0),u=A(()=>o.histogram?.length?Math.max(...o.histogram.map(b=>b.max)):0),e=A(()=>u.value-n.value||1),r=A(()=>o.histogram?.length&&Math.max(...o.histogram.map(b=>b.count))||1),y=A(()=>fe-S*2),m=A(()=>B-S*2),l=A(()=>{if(!o.histogram?.length)return[];const b=y.value/o.histogram.length-ke;return o.histogram.map((R,O)=>{const f=R.count/r.value*m.value,i=(R.min+R.max)/2;return{x:S+O*(b+ke),y:B-S-f,width:b,height:f,value:i,count:R.count,isNegative:i<0}})}),d=b=>S+(b-n.value)/e.value*y.value,V=A(()=>d(o.p10)),h=A(()=>d(o.median)),C=A(()=>d(o.p90)),P=A(()=>n.value<0&&u.value>0),F=A(()=>d(0));function J(b){return b.isNegative?"bar-negative":"bar-positive"}function G(b){return Math.abs(b)>=1e6?`$${(b/1e6).toFixed(1)}M`:Math.abs(b)>=1e3?`$${(b/1e3).toFixed(0)}K`:`$${b.toFixed(0)}`}return(b,R)=>(v(),p("div",St,[t("h4",Gt,_(a.title),1),t("div",Lt,[(v(),p("svg",{viewBox:`0 0 ${fe} ${B}`,class:"histogram-svg"},[t("g",Jt,[(v(!0),p(Y,null,X(l.value,(O,f)=>(v(),p("rect",{key:f,x:O.x,y:O.y,width:O.width,height:O.height,class:ne([J(O),"bar"])},null,10,Tt))),128))]),t("g",Ut,[t("line",{x1:V.value,y1:S,x2:V.value,y2:B-S,class:"percentile-line p10-line"},null,8,Et),t("line",{x1:h.value,y1:S,x2:h.value,y2:B-S,class:"percentile-line median-line"},null,8,Ht),t("line",{x1:C.value,y1:S,x2:C.value,y2:B-S,class:"percentile-line p90-line"},null,8,zt),P.value?(v(),p("line",{key:0,x1:F.value,y1:S,x2:F.value,y2:B-S,class:"zero-line"},null,8,It)):k("",!0)]),t("g",Yt,[t("text",{x:V.value,y:B-5,class:"percentile-label"},"P10",8,jt),t("text",{x:h.value,y:B-5,class:"percentile-label median-label"},"P50",8,Wt),t("text",{x:C.value,y:B-5,class:"percentile-label"},"P90",8,Zt)]),t("g",Xt,[t("text",{x:S,y:B-5,class:"axis-value start"},_(G(n.value)),9,Kt),t("text",{x:fe-S,y:B-5,class:"axis-value end"},_(G(u.value)),9,Qt)])],8,Bt))]),R[0]||(R[0]=Te('<div class="chart-legend"><div class="legend-item"><span class="legend-color negative"></span><span class="legend-text">Negative NPV</span></div><div class="legend-item"><span class="legend-color positive"></span><span class="legend-text">Positive NPV</span></div></div>',1))]))}},ta={class:"distribution-card"},aa={class:"card-header"},na={class:"label"},ia={class:"base-value"},sa={key:0,class:"dist-selector"},oa={key:1,class:"dist-type-read"},la={key:2,class:"params-area"},ra={key:0,class:"param-row"},ua={class:"input-wrapper"},ca={key:1,class:"param-grid"},da={class:"param-col"},va={class:"param-col"},ma={class:"param-col"},pa={key:2,class:"param-grid"},ya={class:"param-col"},ha={class:"param-col"},fa={key:3,class:"params-read"},ga={key:0},xa={key:1},ba={class:"dist-preview"},Ma={width:"60",height:"20",viewBox:"0 0 60 20",class:"dist-icon"},Ca={key:0,d:"M2,18 C15,18 20,2 30,2 C40,2 45,18 58,18",fill:"none",class:"line-path"},$a={key:1,d:"M2,18 L30,2 L58,18",fill:"none",class:"line-path"},Pa={key:2,d:"M5,18 L5,5 L55,5 L55,18",fill:"none",class:"line-path"},ge={__name:"DistributionCard",props:{label:String,baseValue:Number,isCurrency:Boolean,suffix:String,config:Object,readOnly:Boolean},emits:["update"],setup(a,{emit:o}){const n=a,u=o,e=H({...n.config});ie(()=>n.config,m=>{e.value={...m}},{deep:!0}),ie(()=>e.value.type,(m,l)=>{m!==l&&(m==="triangular"&&e.value.min===void 0?(e.value.min=n.baseValue*.9,e.value.max=n.baseValue*1.1,e.value.mode=n.baseValue):m==="uniform"&&e.value.min===void 0&&(e.value.min=n.baseValue*.9,e.value.max=n.baseValue*1.1),r())});function r(){u("update",e.value)}function y(m){return n.isCurrency?new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(m):n.suffix?`${m}${n.suffix}`:m}return(m,l)=>(v(),p("div",ta,[t("div",aa,[t("span",na,_(a.label),1),t("span",ia,_(y(a.baseValue)),1)]),a.readOnly?(v(),p("div",oa,_(e.value.type),1)):(v(),p("div",sa,[z(t("select",{"onUpdate:modelValue":l[0]||(l[0]=d=>e.value.type=d),onChange:r},[...l[7]||(l[7]=[t("option",{value:"normal"},"Normal",-1),t("option",{value:"lognormal",disabled:"",title:"Coming soon"},"Lognormal",-1),t("option",{value:"triangular"},"Triangular",-1),t("option",{value:"uniform"},"Flat (Uniform)",-1)])],544),[[Ue,e.value.type]])])),a.readOnly?(v(),p("div",fa,[e.value.type==="normal"?(v(),p("div",ga,"±"+_(e.value.variancePercent)+"%",1)):e.value.type==="uniform"?(v(),p("div",xa,"Range: "+_(e.value.min)+" - "+_(e.value.max),1)):k("",!0)])):(v(),p("div",la,[e.value.type==="normal"?(v(),p("div",ra,[l[9]||(l[9]=t("label",null,"Variance (±%)",-1)),t("div",ua,[z(t("input",{type:"number","onUpdate:modelValue":l[1]||(l[1]=d=>e.value.variancePercent=d),onChange:r},null,544),[[Q,e.value.variancePercent,void 0,{number:!0}]]),l[8]||(l[8]=t("span",{class:"suffix"},"%",-1))])])):k("",!0),e.value.type==="triangular"?(v(),p("div",ca,[t("div",da,[l[10]||(l[10]=t("label",null,"Min",-1)),z(t("input",{type:"number","onUpdate:modelValue":l[2]||(l[2]=d=>e.value.min=d),onChange:r,class:"small-input"},null,544),[[Q,e.value.min,void 0,{number:!0}]])]),t("div",va,[l[11]||(l[11]=t("label",null,"Max",-1)),z(t("input",{type:"number","onUpdate:modelValue":l[3]||(l[3]=d=>e.value.max=d),onChange:r,class:"small-input"},null,544),[[Q,e.value.max,void 0,{number:!0}]])]),t("div",ma,[l[12]||(l[12]=t("label",null,"Mode",-1)),z(t("input",{type:"number","onUpdate:modelValue":l[4]||(l[4]=d=>e.value.mode=d),onChange:r,class:"small-input"},null,544),[[Q,e.value.mode,void 0,{number:!0}]])])])):k("",!0),e.value.type==="uniform"?(v(),p("div",pa,[t("div",ya,[l[13]||(l[13]=t("label",null,"Min",-1)),z(t("input",{type:"number","onUpdate:modelValue":l[5]||(l[5]=d=>e.value.min=d),onChange:r,class:"small-input"},null,544),[[Q,e.value.min,void 0,{number:!0}]])]),t("div",ha,[l[14]||(l[14]=t("label",null,"Max",-1)),z(t("input",{type:"number","onUpdate:modelValue":l[6]||(l[6]=d=>e.value.max=d),onChange:r,class:"small-input"},null,544),[[Q,e.value.max,void 0,{number:!0}]])])])):k("",!0)])),t("div",ba,[(v(),p("svg",Ma,[e.value.type==="normal"?(v(),p("path",Ca)):k("",!0),e.value.type==="triangular"?(v(),p("path",$a)):k("",!0),e.value.type==="uniform"?(v(),p("path",Pa)):k("",!0)]))])]))}},_a={class:"correlation-modal"},Ra={class:"modal-header"},Va={class:"modal-body"},Na={key:0,class:"matrix-grid"},ka={class:"grid-row-header"},wa=["value","onInput"],Aa={key:1,class:"diagonal"},Fa={__name:"CorrelationModal",props:{matrix:Array},emits:["close","save"],setup(a,{emit:o}){const n=a,u=o,e=[{key:"rent",label:"Rent"},{key:"vacancy",label:"Vacancy"},{key:"interest",label:"Interest"},{key:"growth",label:"Growth"}],r=H([]);we(()=>{r.value=n.matrix.map(l=>[...l])});function y(l,d,V){let h=parseFloat(V);isNaN(h)&&(h=0),h>1&&(h=1),h<-1&&(h=-1),r.value[l][d]=h,r.value[d][l]=h}function m(){u("save",r.value)}return(l,d)=>(v(),Ae(He,{to:"body"},[t("div",{class:"modal-backdrop",onClick:d[1]||(d[1]=Ee(V=>l.$emit("close"),["self"]))},[t("div",_a,[t("div",Ra,[d[2]||(d[2]=t("h3",null,"Correlation Matrix",-1)),t("button",{class:"btn-close",onClick:d[0]||(d[0]=V=>l.$emit("close"))},"×")]),t("div",Va,[d[4]||(d[4]=t("p",{class:"description"},[se(" Define relationships between variables (-1.0 to 1.0). "),t("br"),se("Positive = Variables move together. Negative = Inverse relationship. ")],-1)),r.value.length===e.length?(v(),p("div",Na,[d[3]||(d[3]=t("div",{class:"grid-header-cell"},null,-1)),(v(),p(Y,null,X(e,V=>t("div",{class:"grid-header-cell",key:V.key},_(V.label),1)),64)),(v(),p(Y,null,X(e,(V,h)=>(v(),p(Y,{key:h},[t("div",ka,_(V.label),1),(v(),p(Y,null,X(e,(C,P)=>t("div",{key:`${h}-${P}`,class:"grid-cell"},[h!==P?(v(),p("input",{key:0,type:"number",step:"0.1",min:"-1",max:"1",value:r.value[h][P],onInput:F=>y(h,P,F.target.value),class:ne(["correlation-input",{positive:r.value[h][P]>0,negative:r.value[h][P]<0}])},null,42,wa)):(v(),p("span",Aa,"1.0"))])),64))],64))),64))])):k("",!0)]),t("div",{class:"modal-actions"},[t("button",{class:"btn btn-primary",onClick:m},"Apply Correlations")])])])]))}},Da={class:"property-risk-analyzer"},qa={class:"analyzer-grid"},Oa={class:"inputs-column"},Sa={class:"input-group"},Ga={class:"financials-header"},La=["title"],Ba={class:"switch"},Ja={class:"input-row"},Ta={key:0,class:"input-wrapper"},Ua={key:1,class:"static-value"},Ea={class:"input-group"},Ha={class:"group-header"},za={key:1,class:"actions"},Ia=["disabled"],Ya={key:0,class:"spinner"},ja={class:"results-column"},Wa={key:0,class:"empty-state"},Za={key:1,class:"results-content"},Xa={class:"metrics-row"},Ka={class:"metric"},Qa={class:"label"},en={class:"metric"},tn={class:"value"},an={class:"metric"},nn={class:"value negative"},sn={class:"chart-section"},on={class:"chart-section small"},ln={__name:"PropertyRiskAnalyzer",props:{initialData:{type:Object,required:!0},initialResults:{type:Object,default:null},detailedCashflow:{type:Object,default:null},autoRun:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},hideRunButton:{type:Boolean,default:!1}},emits:["update:inputs"],setup(a,{emit:o}){const n=a,u=o,e=H({propertyValue:0,estimatedGrossRent:0,outgoingsEstimate:0,vacancyRatePercent:5,vacancyVariancePercent:5,managementFeePercent:7,capitalGrowthPercent:3,capitalGrowthVariancePercent:2,discountRate:8,loanAmount:0,interestRatePercent:6.5,interestVariancePercent:1,rentVariancePercent:10,timeVarianceEarly:0,timeVarianceLate:3,holdingPeriodYears:10,stampDutyRate:0,legalCosts:0,buyersAgentFeeRate:0,capExReserve:0,includeAcquisitionCost:!1}),r=H({rent:{type:"normal",variancePercent:10},vacancy:{type:"normal",variancePercent:5},growth:{type:"normal",variancePercent:2},interest:{type:"normal",variancePercent:1}}),y=H([[1,-.7,0,.7],[-.7,1,.3,-.6],[0,.3,1,-.5],[.7,-.6,-.5,1]]),m=H(!1),l=H(null),d=H(!1),V=A(()=>{const i=e.value.propertyValue*(e.value.stampDutyRate/100),s=e.value.propertyValue*(e.value.buyersAgentFeeRate/100),c=i+s+e.value.legalCosts+e.value.capExReserve;return e.value.propertyValue+c-e.value.loanAmount});we(()=>{if(P(),n.initialResults){const i={...n.initialResults};typeof i.yearlyDCFJson=="string"&&(i.yearlyDCF=JSON.parse(i.yearlyDCFJson)),typeof i.npvHistogramJson=="string"&&(i.npvHistogram=JSON.parse(i.npvHistogramJson)),typeof i.irrHistogramJson=="string"&&(i.irrHistogram=JSON.parse(i.irrHistogramJson)),l.value=i}else n.autoRun&&R()});let h=!1,C=null;ie(()=>n.initialResults,(i,s)=>{if(i){const c={...i};typeof c.yearlyDCFJson=="string"&&(c.yearlyDCF=JSON.parse(c.yearlyDCFJson)),typeof c.npvHistogramJson=="string"&&(c.npvHistogram=JSON.parse(c.npvHistogramJson)),typeof c.irrHistogramJson=="string"&&(c.irrHistogram=JSON.parse(c.irrHistogramJson)),!c.probabilityCurve&&l.value?.probabilityCurve&&c.medianNPV===l.value.medianNPV&&(c.probabilityCurve=l.value.probabilityCurve),l.value=c}else i===null&&s!==null&&(l.value=null)},{deep:!0,immediate:!0}),ie(()=>n.initialData,()=>{h=!0,P(),setTimeout(()=>{h=!1},0)},{deep:!0}),ie(e,i=>{h||(u("update:inputs",i),n.autoRun&&(C&&clearTimeout(C),C=setTimeout(()=>{d.value||R()},300)))},{deep:!0});function P(){const i=n.initialData;if(e.value={...e.value,propertyValue:i.askingPrice||i.currentValue||0,estimatedGrossRent:i.estimatedGrossRent||i.annualRent||0,outgoingsEstimate:i.outgoingsEstimate||i.annualOutgoings||0,loanAmount:i.loanAmount||0,...i},i.askingPrice)e.value.askingPrice=i.askingPrice;else{if(i.distributionSettingsJson)try{const s=JSON.parse(i.distributionSettingsJson);r.value={...r.value,...s}}catch{}else r.value.rent.variancePercent=i.rentVariancePercent||10,r.value.vacancy.variancePercent=i.vacancyVariancePercent||5,r.value.growth.variancePercent=i.capitalGrowthVariancePercent||2,r.value.interest.variancePercent=i.interestVariancePercent||1;if(i.correlationMatrixJson)try{y.value=JSON.parse(i.correlationMatrixJson)}catch{}}}function F(i,s){r.value[i]=s,R(),b()}function J(i){y.value=i,m.value=!1,R(),u("update:inputs",{...e.value,correlationMatrixJson:JSON.stringify(i)})}let G=null;function b(){G&&clearTimeout(G),G=setTimeout(()=>{u("update:inputs",{...e.value,distributionSettingsJson:JSON.stringify(r.value)})},500)}async function R(){d.value=!0,await new Promise(i=>setTimeout(i,50));try{const i={...e.value,distributions:r.value,correlationMatrix:y.value,detailedCashflows:n.detailedCashflow?.rows?.length?O(n.detailedCashflow):null},s=et(i,5e3,e.value.includeAcquisitionCost);l.value=s}catch(i){console.error(i)}finally{d.value=!1}}function O(i){if(!i||!i.rows)return null;const s=i.rows.find(w=>w.id==="netCashflow");if(!s)return null;const c=[];let $=0,N=0;return s.cells.forEach(w=>{w.isYearSummary?(c.push({netCashflow:w.value}),$=0,N=0):i.granularity==="years"?c.push({netCashflow:w.value}):($+=w.value,N++,N===12&&(c.push({netCashflow:$}),$=0,N=0))}),c}function f(i){return De(i)}return(i,s)=>(v(),p("div",Da,[t("div",qa,[t("div",Oa,[s[13]||(s[13]=t("h3",{class:"column-title"},"Simulation Assumptions",-1)),t("div",Sa,[t("div",Ga,[s[8]||(s[8]=t("h4",null,"Base Financials",-1)),t("div",{class:"toggle-wrapper",title:e.value.includeAcquisitionCost?"Switch to Intrinsic Value (Gross)":"Switch to Profit Analysis (Net)"},[t("span",{class:ne(["toggle-label",{active:!e.value.includeAcquisitionCost}])},"Gross",2),t("label",Ba,[z(t("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=c=>e.value.includeAcquisitionCost=c),onChange:R},null,544),[[Ie,e.value.includeAcquisitionCost]]),s[7]||(s[7]=t("span",{class:"slider round"},null,-1))]),t("span",{class:ne(["toggle-label",{active:e.value.includeAcquisitionCost}])},"Net",2)],8,La)]),t("div",Ja,[s[10]||(s[10]=t("label",null,"Property Value",-1)),a.readOnly?(v(),p("div",Ua,_(f(e.value.propertyValue)),1)):(v(),p("div",Ta,[s[9]||(s[9]=t("span",{class:"input-prefix"},"$",-1)),z(t("input",{type:"number","onUpdate:modelValue":s[1]||(s[1]=c=>e.value.propertyValue=c),onChange:R},null,544),[[Q,e.value.propertyValue,void 0,{number:!0}]])]))])]),t("div",Ea,[t("div",Ha,[s[12]||(s[12]=t("h4",null,"Risk Parameters",-1)),a.readOnly?k("",!0):(v(),p("button",{key:0,class:"btn btn-sm btn-secondary icon-btn",onClick:s[2]||(s[2]=c=>m.value=!0)},[...s[11]||(s[11]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),t("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1),se(" Correlation Matrix ",-1)])]))]),ae(ge,{label:"Gross Rent","base-value":e.value.estimatedGrossRent,"is-currency":!0,config:r.value.rent,onUpdate:s[3]||(s[3]=c=>F("rent",c)),"read-only":a.readOnly},null,8,["base-value","config","read-only"]),ae(ge,{label:"Vacancy Rate","base-value":e.value.vacancyRatePercent,suffix:"%",config:r.value.vacancy,onUpdate:s[4]||(s[4]=c=>F("vacancy",c)),"read-only":a.readOnly},null,8,["base-value","config","read-only"]),ae(ge,{label:"Capital Growth","base-value":e.value.capitalGrowthPercent,suffix:"%",config:r.value.growth,onUpdate:s[5]||(s[5]=c=>F("growth",c)),"read-only":a.readOnly},null,8,["base-value","config","read-only"])]),m.value?(v(),Ae(Fa,{key:0,matrix:y.value,onClose:s[6]||(s[6]=c=>m.value=!1),onSave:J},null,8,["matrix"])):k("",!0),!a.readOnly&&!a.hideRunButton?(v(),p("div",za,[t("button",{class:"btn btn-primary full-width",onClick:R,disabled:d.value},[d.value?(v(),p("span",Ya)):k("",!0),se(" "+_(d.value?"Simulating...":"Run Analysis"),1)],8,Ia)])):k("",!0)]),t("div",ja,[l.value?(v(),p("div",Za,[t("div",Xa,[t("div",Ka,[t("span",Qa,"Median "+_(e.value.includeAcquisitionCost?"Net Profit":"Value"),1),t("span",{class:ne(["value",l.value.medianNPV>=0?"positive":"negative"])},_(f(l.value.medianNPV)),3)]),t("div",en,[s[15]||(s[15]=t("span",{class:"label"},"Median IRR",-1)),t("span",tn,_(l.value.medianIRR)+"%",1)]),t("div",an,[s[16]||(s[16]=t("span",{class:"label"},"Value at Risk (5%)",-1)),t("span",nn,_(f(l.value.p10NPV)),1)])]),t("div",sn,[ae(Ot,{"probability-curve":l.value.probabilityCurve,"total-acquisition-cost":V.value,"is-net-mode":e.value.includeAcquisitionCost},null,8,["probability-curve","total-acquisition-cost","is-net-mode"])]),t("div",on,[ae(ea,{histogram:l.value.npvHistogram,p10:l.value.p10NPV,median:l.value.medianNPV,p90:l.value.p90NPV,title:e.value.includeAcquisitionCost?"Net Profit Distribution ($)":"Intrinsic Value Distribution ($)"},null,8,["histogram","p10","median","p90","title"])])])):(v(),p("div",Wa,[...s[14]||(s[14]=[t("p",null,"Enter assumptions and run simulation to view risk analysis.",-1)])]))])])]))}},cn=ze(ln,[["__scopeId","data-v-ccec9588"]]);export{cn as P,xe as c,De as f,et as r};
