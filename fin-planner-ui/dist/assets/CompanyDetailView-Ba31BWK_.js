import{_ as E,g as u,x as I,o,c as i,a as e,d as O,j as W,t as a,k as r,F as B,l as S,f,i as j,m as g,p as d,v as m,q as z,e as $,C as G,G as H,s as R,r as J,A as K,n as U}from"./index-oVbs5Hxd.js";import{a as V,f as v}from"./formatters-DwG4QyEz.js";const Q={key:0,class:"company-detail animate-fade-in"},X={class:"header-row"},Z={class:"header-content"},ee={class:"breadcrumb"},te={class:"current"},se={class:"meta-row"},ae={class:"meta-item"},le={class:"meta-item"},ne={class:"meta-item"},oe={class:"actions"},ie={class:"detail-grid"},re={class:"summary-cards"},de={class:"card summary-card gradient-emerald"},ue={class:"value"},me={class:"card summary-card gradient-amber"},ve={class:"value"},pe={class:"card summary-card gradient-blue"},ce={class:"value"},ye={class:"sub-label"},be={key:0,class:"card warning-card mt-xl"},fe={class:"shortfall"},ge={class:"content-grid"},_e={class:"card section-card"},ke={class:"section-header"},De={key:0,class:"empty-state-mini"},we={class:"loan-main"},Ce={class:"loan-borrower"},Re={class:"loan-meta"},Ae={class:"loan-status"},Ne=["onClick"],xe={class:"loan-financials"},$e={class:"metric"},Be={class:"v"},Se={class:"metric"},Ve={class:"v font-bold"},Le={class:"metric"},Ue={class:"v text-primary"},Fe={class:"card section-card"},Pe={class:"section-header"},Ye={key:0,class:"data-table"},Me={class:"text-right font-semibold"},Te={class:"text-right text-success"},he={key:1,class:"empty-state-mini"},qe={class:"modal-card"},Ee={class:"modal-header"},Ie={class:"form-group"},Oe={class:"form-row"},We={class:"form-group"},je={class:"form-group"},ze={class:"form-group"},Ge={class:"checkbox-label"},He={class:"modal-actions"},Je=["disabled"],Ke={class:"modal-card"},Qe={class:"modal-header"},Xe={class:"form-group"},Ze={class:"form-row"},et={class:"form-group"},tt={class:"form-group"},st={class:"form-row"},at={class:"form-group"},lt={class:"form-group"},nt={class:"modal-actions"},ot=["disabled"],it={class:"modal-card"},rt={class:"modal-header"},dt={class:"form-group"},ut={class:"loan-info-mini"},mt={class:"form-row"},vt={class:"form-group"},pt={class:"form-group"},ct={class:"modal-actions"},yt=["disabled"],bt={class:"modal-card"},ft={class:"modal-header"},gt={class:"form-group"},_t={class:"form-row"},kt={class:"form-group"},Dt={class:"form-group"},wt={class:"form-group"},Ct={class:"modal-actions"},Rt=["disabled"],At={__name:"CompanyDetailView",setup(Nt){const L=K(),l=u(null),A=u(null),F=u(!0),p=u(!1),_=u(!1),k=u(!1),D=u(!1),w=u(!1),N=u(null),y=u({}),c=u({borrowerName:"",principalAmount:0,interestRate:.0847,loanDate:new Date().toISOString().split("T")[0],loanTermYears:7,isSecured:!1}),C=u({amount:0,paymentDate:new Date().toISOString().split("T")[0]}),b=u({amount:0,declarationDate:new Date().toISOString().split("T")[0],paymentDate:new Date().toISOString().split("T")[0],frankingPercentage:100}),x=async()=>{try{const[n,t]=await Promise.all([R.get(`/companies/${L.params.id}`),R.get(`/companies/${L.params.id}/summary`)]);l.value=n.data,A.value=t.data,y.value={...n.data}}catch(n){console.error("Failed to load company data",n)}finally{F.value=!1}},P=async()=>{p.value=!0;try{await R.put(`/companies/${l.value.id}`,y.value),_.value=!1,await x()}catch{alert("Update failed")}finally{p.value=!1}},Y=async()=>{p.value=!0;try{const n={...c.value,interestRate:c.value.interestRate};n.interestRate>1&&(n.interestRate=n.interestRate/100),await R.post(`/companies/${l.value.id}/loans`,n),k.value=!1,await x()}catch(n){alert(n.response?.data||"Failed to create loan")}finally{p.value=!1}},M=n=>{N.value=n,C.value.amount=n.minimumYearlyRepayment,D.value=!0},T=async()=>{p.value=!0;try{await R.post(`/companies/${l.value.id}/loans/${N.value.id}/repayment`,C.value),D.value=!1,await x()}catch{alert("Repayment failed")}finally{p.value=!1}},h=async()=>{p.value=!0;try{await R.post(`/companies/${l.value.id}/dividends`,b.value),w.value=!1,await x()}catch(n){alert(n.response?.data||"Failed to declare dividend")}finally{p.value=!1}};return I(x),(n,t)=>{const q=J("router-link");return l.value?(o(),i("div",Q,[e("div",X,[e("div",Z,[e("div",ee,[O(q,{to:"/entities"},{default:W(()=>[...t[30]||(t[30]=[$("Entities",-1)])]),_:1}),t[31]||(t[31]=e("span",{class:"separator"},"/",-1)),e("span",te,a(l.value.companyName),1)]),e("h1",null,a(l.value.companyName),1),e("div",se,[e("span",ae,"ðŸ¢ "+a(l.value.isBaseRateEntity?"Base Rate Entity (25%)":"Full Rate (30%)"),1),e("span",le,"ðŸ†” ABN: "+a(l.value.ABN||"N/A")+" / ACN: "+a(l.value.ACN||"N/A"),1),e("span",ne,"ðŸ“… Inc: "+a(r(V)(l.value.incorporationDate)),1)])]),e("div",oe,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=s=>_.value=!0)},"Edit Company")])]),e("div",ie,[e("div",re,[e("div",de,[t[32]||(t[32]=e("span",{class:"label"},"Retained Profits",-1)),e("span",ue,a(r(v)(l.value.retainedProfits)),1)]),e("div",me,[t[33]||(t[33]=e("span",{class:"label"},"Franking Account",-1)),e("span",ve,a(r(v)(l.value.frankingAccountBalance)),1)]),e("div",pe,[t[34]||(t[34]=e("span",{class:"label"},"Active Loans (Div 7A)",-1)),e("span",ce,a(r(v)(A.value?.totalLoanBalance||0)),1),e("span",ye,a(A.value?.activeLoans||0)+" active loan(s)",1)])]),A.value?.division7AWarnings?.length>0?(o(),i("div",be,[t[35]||(t[35]=e("h3",null,"âš ï¸ Division 7A Compliance Warnings",-1)),t[36]||(t[36]=e("p",null,"The following loans have not met their minimum yearly repayment for the current FY:",-1)),(o(!0),i(B,null,S(A.value.division7AWarnings,s=>(o(),i("div",{key:s.borrowerName,class:"warning-item"},[e("strong",null,a(s.borrowerName),1),$(": Paid "+a(r(v)(s.repaidThisYear))+" / Min "+a(r(v)(s.minimumYearlyRepayment))+" ",1),e("span",fe,"(Shortfall: "+a(r(v)(s.shortfall))+")",1)]))),128))])):f("",!0),e("div",ge,[e("div",_e,[e("div",ke,[t[37]||(t[37]=e("h2",null,"ðŸ“œ Division 7A Loans",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:t[1]||(t[1]=s=>k.value=!0)},"New Loan Record")]),l.value.division7ALoans?.length===0?(o(),i("div",De," No Div 7A loans recorded for this company. ")):f("",!0),(o(!0),i(B,null,S(l.value.division7ALoans,s=>(o(),i("div",{key:s.id,class:"loan-item"},[e("div",we,[e("div",Ce,"Borrower: "+a(s.borrowerName),1),e("div",Re,"Dated "+a(r(V)(s.loanDate))+" â€¢ "+a(s.loanTermYears)+" year term",1),e("div",Ae,[e("span",{class:U(["status-pill",s.status.toLowerCase()])},a(s.status),3),s.status==="Active"?(o(),i("button",{key:0,class:"btn btn-secondary btn-xs ml-sm",onClick:xt=>M(s)},"Record Repayment",8,Ne)):f("",!0)])]),e("div",xe,[e("div",$e,[t[38]||(t[38]=e("span",{class:"l"},"Principal",-1)),e("span",Be,a(r(v)(s.principalAmount)),1)]),e("div",Se,[t[39]||(t[39]=e("span",{class:"l"},"Balance",-1)),e("span",Ve,a(r(v)(s.currentBalance)),1)]),e("div",Le,[t[40]||(t[40]=e("span",{class:"l"},"Min Repayment",-1)),e("span",Ue,a(r(v)(s.minimumYearlyRepayment)),1)])])]))),128))]),e("div",Fe,[e("div",Pe,[t[41]||(t[41]=e("h2",null,"ðŸ’° Dividend History",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:t[2]||(t[2]=s=>w.value=!0)},"Declare Dividend")]),l.value.dividends?.length>0?(o(),i("table",Ye,[t[42]||(t[42]=e("thead",null,[e("tr",null,[e("th",null,"Date"),e("th",{class:"text-right"},"Amount"),e("th",{class:"text-right"},"Franking Credits"),e("th",null,"Status")])],-1)),e("tbody",null,[(o(!0),i(B,null,S(l.value.dividends,s=>(o(),i("tr",{key:s.id},[e("td",null,a(r(V)(s.paymentDate)),1),e("td",Me,a(r(v)(s.amount)),1),e("td",Te,a(r(v)(s.frankingCredits))+" ("+a(s.frankingPercentage)+"%)",1),e("td",null,[e("span",{class:U(["status-pill",s.status.toLowerCase()])},a(s.status),3)])]))),128))])])):(o(),i("div",he,"No dividends recorded."))])])]),(o(),j(H,{to:"body"},[_.value?(o(),i("div",{key:0,class:"modal-overlay",onClick:t[9]||(t[9]=g(s=>_.value=!1,["self"]))},[e("div",qe,[e("div",Ee,[t[43]||(t[43]=e("h2",null,"Edit Company",-1)),e("button",{class:"btn-close",onClick:t[3]||(t[3]=s=>_.value=!1)},"Ã—")]),e("form",{onSubmit:g(P,["prevent"]),class:"modal-form"},[e("div",Ie,[t[44]||(t[44]=e("label",null,"Company Name",-1)),d(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>y.value.companyName=s),type:"text",required:""},null,512),[[m,y.value.companyName]])]),e("div",Oe,[e("div",We,[t[45]||(t[45]=e("label",null,"ABN",-1)),d(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>y.value.abn=s),type:"text"},null,512),[[m,y.value.abn]])]),e("div",je,[t[46]||(t[46]=e("label",null,"ACN",-1)),d(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>y.value.acn=s),type:"text"},null,512),[[m,y.value.acn]])])]),e("div",ze,[e("label",Ge,[d(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=s=>y.value.isBaseRateEntity=s)},null,512),[[z,y.value.isBaseRateEntity]]),t[47]||(t[47]=$(" Base rate entity (lower tax rate) ",-1))])]),e("div",He,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=s=>_.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:p.value},"Save Changes",8,Je)])],32)])])):f("",!0),k.value?(o(),i("div",{key:1,class:"modal-overlay",onClick:t[17]||(t[17]=g(s=>k.value=!1,["self"]))},[e("div",Ke,[e("div",Qe,[t[48]||(t[48]=e("h2",null,"Record Division 7A Loan",-1)),e("button",{class:"btn-close",onClick:t[10]||(t[10]=s=>k.value=!1)},"Ã—")]),e("form",{onSubmit:g(Y,["prevent"]),class:"modal-form"},[e("div",Xe,[t[49]||(t[49]=e("label",null,"Borrower Name",-1)),d(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>c.value.borrowerName=s),type:"text",required:"",placeholder:"e.g. John Smith"},null,512),[[m,c.value.borrowerName]])]),e("div",Ze,[e("div",et,[t[50]||(t[50]=e("label",null,"Principal Amount",-1)),d(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>c.value.principalAmount=s),type:"number",step:"0.01",required:""},null,512),[[m,c.value.principalAmount,void 0,{number:!0}]])]),e("div",tt,[t[51]||(t[51]=e("label",null,"Loan Date",-1)),d(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>c.value.loanDate=s),type:"date",required:""},null,512),[[m,c.value.loanDate]])])]),e("div",st,[e("div",at,[t[52]||(t[52]=e("label",null,"Interest Rate (%)",-1)),d(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>c.value.interestRate=s),type:"number",step:"0.01",placeholder:"8.47"},null,512),[[m,c.value.interestRate,void 0,{number:!0}]]),t[53]||(t[53]=e("small",null,"Benchmark for FY25 is 8.47%",-1))]),e("div",lt,[t[55]||(t[55]=e("label",null,"Term (Years)",-1)),d(e("select",{"onUpdate:modelValue":t[15]||(t[15]=s=>c.value.loanTermYears=s)},[...t[54]||(t[54]=[e("option",{value:7},"7 Years (Unsecured)",-1),e("option",{value:25},"25 Years (Secured)",-1)])],512),[[G,c.value.loanTermYears,void 0,{number:!0}]])])]),e("div",nt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[16]||(t[16]=s=>k.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:p.value},"Create Loan",8,ot)])],32)])])):f("",!0),D.value?(o(),i("div",{key:2,class:"modal-overlay",onClick:t[22]||(t[22]=g(s=>D.value=!1,["self"]))},[e("div",it,[e("div",rt,[t[56]||(t[56]=e("h2",null,"Record Loan Repayment",-1)),e("button",{class:"btn-close",onClick:t[18]||(t[18]=s=>D.value=!1)},"Ã—")]),e("form",{onSubmit:g(T,["prevent"]),class:"modal-form"},[e("div",dt,[e("label",null,"Borrower: "+a(N.value?.borrowerName),1),e("div",ut,[$(" Remaining Balance: "+a(r(v)(N.value?.currentBalance)),1),t[57]||(t[57]=e("br",null,null,-1)),$(" Min Yearly Repayment: "+a(r(v)(N.value?.minimumYearlyRepayment)),1)])]),e("div",mt,[e("div",vt,[t[58]||(t[58]=e("label",null,"Repayment Amount",-1)),d(e("input",{"onUpdate:modelValue":t[19]||(t[19]=s=>C.value.amount=s),type:"number",step:"0.01",required:""},null,512),[[m,C.value.amount,void 0,{number:!0}]])]),e("div",pt,[t[59]||(t[59]=e("label",null,"Payment Date",-1)),d(e("input",{"onUpdate:modelValue":t[20]||(t[20]=s=>C.value.paymentDate=s),type:"date",required:""},null,512),[[m,C.value.paymentDate]])])]),e("div",ct,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[21]||(t[21]=s=>D.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:p.value},"Record Payment",8,yt)])],32)])])):f("",!0),w.value?(o(),i("div",{key:3,class:"modal-overlay",onClick:t[29]||(t[29]=g(s=>w.value=!1,["self"]))},[e("div",bt,[e("div",ft,[t[60]||(t[60]=e("h2",null,"Declare Dividend",-1)),e("button",{class:"btn-close",onClick:t[23]||(t[23]=s=>w.value=!1)},"Ã—")]),e("form",{onSubmit:g(h,["prevent"]),class:"modal-form"},[e("div",gt,[t[61]||(t[61]=e("label",null,"Dividend Amount (Net)",-1)),d(e("input",{"onUpdate:modelValue":t[24]||(t[24]=s=>b.value.amount=s),type:"number",step:"0.01",required:""},null,512),[[m,b.value.amount,void 0,{number:!0}]])]),e("div",_t,[e("div",kt,[t[62]||(t[62]=e("label",null,"Declaration Date",-1)),d(e("input",{"onUpdate:modelValue":t[25]||(t[25]=s=>b.value.declarationDate=s),type:"date",required:""},null,512),[[m,b.value.declarationDate]])]),e("div",Dt,[t[63]||(t[63]=e("label",null,"Payment Date",-1)),d(e("input",{"onUpdate:modelValue":t[26]||(t[26]=s=>b.value.paymentDate=s),type:"date",required:""},null,512),[[m,b.value.paymentDate]])])]),e("div",wt,[t[64]||(t[64]=e("label",null,"Franking Percentage (%)",-1)),d(e("input",{"onUpdate:modelValue":t[27]||(t[27]=s=>b.value.frankingPercentage=s),type:"number",step:"1",max:"100"},null,512),[[m,b.value.frankingPercentage,void 0,{number:!0}]]),e("small",null,"Max possible credits will be calculated based on "+a(l.value.taxRate*100)+"% tax rate.",1)]),e("div",Ct,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[28]||(t[28]=s=>w.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:p.value},"Declare & Subtract Profits",8,Rt)])],32)])])):f("",!0)]))])):f("",!0)}}},St=E(At,[["__scopeId","data-v-0047b776"]]);export{St as default};
