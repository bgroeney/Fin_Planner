import{_ as j,r as d,i as H,c as i,d as _,o as a,a as e,v as J,e as U,w as A,f as K,t as l,F as w,q as $,m as N,x as c,z as p,y as T,G as Q,B as v,l as W,g as G,n as R}from"./index-D_ssXn_P.js";const X={key:0,class:"trust-detail animate-fade-in"},Z={class:"header-row"},ee={class:"header-content"},te={class:"breadcrumb"},se={class:"current"},ne={class:"meta-row"},ae={class:"meta-item"},le={class:"meta-item"},ie={class:"meta-item"},oe={class:"actions"},re={class:"detail-grid"},de={class:"card section-card"},ue={key:0,class:"empty-state-mini"},ce={key:1,class:"beneficiary-grid"},ve={class:"b-header"},me={class:"b-icon"},pe={class:"b-name"},be={key:0,class:"badge badge-error"},fe={class:"b-meta"},ye={class:"b-actions"},ke=["onClick"],ge=["onClick"],_e={class:"card section-card"},Ce={class:"section-header"},Ie={key:0,class:"empty-state-mini"},he={key:1,class:"income-summary"},De={class:"income-grid"},we={class:"income-item"},$e={class:"value"},Ne={class:"income-item"},Fe={class:"value"},xe={class:"income-item"},Be={class:"value"},Ve={class:"income-item highlight"},Te={class:"value"},Ue={class:"distributions-section mt-xl"},Ae={key:0,class:"data-table"},Ge={class:"text-right font-semibold"},Re={class:"text-right text-success"},Ee=["onClick"],Ye={key:1,class:"empty-state-mini"},Se={class:"modal-card"},Me={class:"modal-header"},Le={class:"form-group"},ze={class:"form-row"},Oe={class:"form-group"},Pe={class:"form-group"},qe={class:"form-row"},je={class:"form-group"},He={class:"form-group"},Je={class:"form-row"},Ke={class:"form-group"},Qe={class:"form-group"},We={class:"modal-actions"},Xe=["disabled"],Ze={class:"modal-card"},et={class:"modal-header"},tt={class:"form-group"},st={key:0,class:"form-group"},nt=["value"],at={key:1,class:"form-group"},lt=["value"],it={class:"form-group"},ot={class:"modal-actions"},rt=["disabled"],dt={__name:"TrustDetailView",setup(ut){const F=W(),r=d(null),x=d([]),m=d(null),I=d(new Date().getMonth()>5?new Date().getFullYear()+1:new Date().getFullYear()),E=d(!1),b=d(!1),f=d(!1),B=d([]),V=d([]),C=d("person"),u=d({personId:null,companyId:null,relationship:""}),o=d({fiscalYear:2025,frankedDividends:0,unfrankedIncome:0,discountCapitalGains:0,nonDiscountCapitalGains:0,rentalIncome:0,frankingCredits:0}),y=d(!1),k=async()=>{try{const n=await v.get(`/trusts/${F.params.id}`);r.value=n.data;const[t,h,s,D]=await Promise.all([v.get(`/trusts/${F.params.id}/distributions?fiscalYear=${I.value}`),v.get(`/trusts/${F.params.id}/income/${I.value}`).catch(()=>({data:null})),v.get(`/persons?portfolioId=${n.data.portfolioId}`),v.get(`/companies?portfolioId=${n.data.portfolioId}`)]);x.value=t.data,m.value=h.data,B.value=s.data,V.value=D.data,m.value&&(o.value={...m.value})}catch(n){console.error("Failed to load trust data",n)}},Y=async()=>{y.value=!0;try{await v.post(`/trusts/${r.value.id}/income`,o.value),b.value=!1,await k()}catch{alert("Failed to save income")}finally{y.value=!1}},S=()=>{f.value=!0},M=async()=>{y.value=!0;try{const n=C.value==="person"?B.value.find(t=>t.id===u.value.personId)?.fullName:V.value.find(t=>t.id===u.value.companyId)?.companyName;await v.post(`/trusts/${r.value.id}/beneficiaries`,{personAccountId:u.value.personId,companyAccountId:u.value.companyId,beneficiaryName:n,relationship:u.value.relationship,isEligible:!0}),f.value=!1,await k()}catch{alert("Failed to add beneficiary")}finally{y.value=!1}},L=async n=>{try{await v.put(`/trusts/${r.value.id}/beneficiaries/${n.id}`,{...n,isEligible:!n.isEligible}),await k()}catch{alert("Update failed")}},z=async n=>{if(confirm("Remove this beneficiary?"))try{await v.delete(`/trusts/${r.value.id}/beneficiaries/${n}`),await k()}catch{alert("Delete failed")}},O=async n=>{if(confirm("Delete this distribution resolution?"))try{await v.delete(`/trusts/${r.value.id}/distributions/${n}`),await k()}catch{alert("Delete failed")}},g=n=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(n||0),P=n=>(n.frankedDividends||0)+(n.unfrankedIncome||0)+(n.rentalIncome||0)+(n.discountCapitalGains||0)*.5+(n.nonDiscountCapitalGains||0),q=n=>n.frankedDividends+n.unfrankedIncome+n.discountCapitalGains+n.nonDiscountCapitalGains;return H(k),(n,t)=>{const h=K("router-link");return r.value?(a(),i("div",X,[e("div",Z,[e("div",ee,[e("div",te,[U(h,{to:"/entities"},{default:A(()=>[...t[20]||(t[20]=[G("Entities",-1)])]),_:1}),t[21]||(t[21]=e("span",{class:"separator"},"/",-1)),e("span",se,l(r.value.trustName),1)]),e("h1",null,l(r.value.trustName),1),e("div",ne,[e("span",ae,"ðŸ›ï¸ "+l(r.value.trustType),1),e("span",le,"ðŸ†” ABN: "+l(r.value.ABN||"N/A"),1),e("span",ie,"ðŸ‘¤ Trustee: "+l(r.value.trusteeName),1)])]),e("div",oe,[U(h,{to:"/tax-optimization",class:"btn btn-accent mr-sm"},{default:A(()=>[...t[22]||(t[22]=[G("ðŸŽ¯ Optimizer",-1)])]),_:1}),e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=s=>E.value=!0)},"Edit Trust")])]),e("div",re,[e("div",de,[e("div",{class:"section-header"},[t[23]||(t[23]=e("h2",null,"ðŸ‘¥ Beneficiaries",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:S},"Add Beneficiary")]),r.value.beneficiaries?.length===0?(a(),i("div",ue," No beneficiaries added to this trust. ")):(a(),i("div",ce,[(a(!0),i(w,null,$(r.value.beneficiaries,s=>(a(),i("div",{key:s.id,class:R(["beneficiary-item",{inactive:!s.isEligible}])},[e("div",ve,[e("span",me,l(s.personAccountId?"ðŸ‘¤":"ðŸ¢"),1),e("span",pe,l(s.beneficiaryName),1),s.isEligible?_("",!0):(a(),i("span",be,"Ineligible"))]),e("div",fe," Relationship: "+l(s.relationship||"N/A"),1),e("div",ye,[e("button",{class:"btn-icon",onClick:D=>L(s)},l(s.isEligible?"â¸ï¸":"â–¶ï¸"),9,ke),e("button",{class:"btn-icon btn-danger-text",onClick:D=>z(s.id)},"ðŸ—‘ï¸",8,ge)])],2))),128))]))]),e("div",_e,[e("div",Ce,[e("h2",null,"ðŸ’° Fiscal Year Summary (FY"+l(I.value)+")",1),e("button",{class:"btn btn-secondary btn-sm",onClick:t[1]||(t[1]=s=>b.value=!0)},"Record Income")]),m.value?(a(),i("div",he,[e("div",De,[e("div",we,[t[24]||(t[24]=e("span",{class:"label"},"Franked Dividends",-1)),e("span",$e,l(g(m.value.frankedDividends)),1)]),e("div",Ne,[t[25]||(t[25]=e("span",{class:"label"},"Franking Credits",-1)),e("span",Fe,l(g(m.value.frankingCredits)),1)]),e("div",xe,[t[26]||(t[26]=e("span",{class:"label"},"Rental & Other",-1)),e("span",Be,l(g(m.value.unfrankedIncome+m.value.rentalIncome)),1)]),e("div",Ve,[t[27]||(t[27]=e("span",{class:"label"},"Total Taxable",-1)),e("span",Te,l(g(P(m.value))),1)])])])):(a(),i("div",Ie," No income recorded for FY"+l(I.value)+". ",1)),e("div",Ue,[t[29]||(t[29]=e("h3",null,"ðŸ“‹ Distribution Resolutions",-1)),x.value.length>0?(a(),i("table",Ae,[t[28]||(t[28]=e("thead",null,[e("tr",null,[e("th",null,"Beneficiary"),e("th",{class:"text-right"},"Total Dist."),e("th",{class:"text-right"},"FC Offset"),e("th",null,"Status"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),i(w,null,$(x.value,s=>(a(),i("tr",{key:s.id},[e("td",null,l(s.beneficiary?.beneficiaryName),1),e("td",Ge,l(g(q(s))),1),e("td",Re,l(g(s.frankingCredits)),1),e("td",null,[e("span",{class:R(["status-pill",s.status.toLowerCase()])},l(s.status),3)]),e("td",null,[e("button",{class:"btn-icon btn-danger-text",onClick:D=>O(s.id)},"ðŸ—‘ï¸",8,Ee)])]))),128))])])):(a(),i("div",Ye,"No distributions resolved for this FY."))])])]),(a(),J(Q,{to:"body"},[b.value?(a(),i("div",{key:0,class:"modal-overlay",onClick:t[11]||(t[11]=N(s=>b.value=!1,["self"]))},[e("div",Se,[e("div",Me,[t[30]||(t[30]=e("h2",null,"Record Trust Income",-1)),e("button",{class:"btn-close",onClick:t[2]||(t[2]=s=>b.value=!1)},"Ã—")]),e("form",{onSubmit:N(Y,["prevent"]),class:"modal-form"},[e("div",Le,[t[31]||(t[31]=e("label",null,"Fiscal Year",-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.fiscalYear=s),type:"number",required:""},null,512),[[p,o.value.fiscalYear,void 0,{number:!0}]])]),e("div",ze,[e("div",Oe,[t[32]||(t[32]=e("label",null,"Franked Dividends",-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.frankedDividends=s),type:"number",step:"0.01"},null,512),[[p,o.value.frankedDividends,void 0,{number:!0}]])]),e("div",Pe,[t[33]||(t[33]=e("label",null,"Franking Credits",-1)),c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.frankingCredits=s),type:"number",step:"0.01"},null,512),[[p,o.value.frankingCredits,void 0,{number:!0}]])])]),e("div",qe,[e("div",je,[t[34]||(t[34]=e("label",null,"Unfranked & Interest",-1)),c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.unfrankedIncome=s),type:"number",step:"0.01"},null,512),[[p,o.value.unfrankedIncome,void 0,{number:!0}]])]),e("div",He,[t[35]||(t[35]=e("label",null,"Net Rental Income",-1)),c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.rentalIncome=s),type:"number",step:"0.01"},null,512),[[p,o.value.rentalIncome,void 0,{number:!0}]])])]),e("div",Je,[e("div",Ke,[t[36]||(t[36]=e("label",null,"Discount CG (Gross)",-1)),c(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.discountCapitalGains=s),type:"number",step:"0.01"},null,512),[[p,o.value.discountCapitalGains,void 0,{number:!0}]])]),e("div",Qe,[t[37]||(t[37]=e("label",null,"Non-Discount CG",-1)),c(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>o.value.nonDiscountCapitalGains=s),type:"number",step:"0.01"},null,512),[[p,o.value.nonDiscountCapitalGains,void 0,{number:!0}]])])]),e("div",We,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=s=>b.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:y.value},"Save Income",8,Xe)])],32)])])):_("",!0),f.value?(a(),i("div",{key:1,class:"modal-overlay",onClick:t[19]||(t[19]=N(s=>f.value=!1,["self"]))},[e("div",Ze,[e("div",et,[t[38]||(t[38]=e("h2",null,"Add Beneficiary",-1)),e("button",{class:"btn-close",onClick:t[12]||(t[12]=s=>f.value=!1)},"Ã—")]),e("form",{onSubmit:N(M,["prevent"]),class:"modal-form"},[e("div",tt,[t[40]||(t[40]=e("label",null,"Link Existing Entity",-1)),c(e("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>C.value=s),onChange:t[14]||(t[14]=s=>u.value.id=null)},[...t[39]||(t[39]=[e("option",{value:"person"},"Person",-1),e("option",{value:"company"},"Bucket Company",-1)])],544),[[T,C.value]])]),C.value==="person"?(a(),i("div",st,[t[41]||(t[41]=e("label",null,"Select Family Member",-1)),c(e("select",{"onUpdate:modelValue":t[15]||(t[15]=s=>u.value.personId=s)},[(a(!0),i(w,null,$(B.value,s=>(a(),i("option",{key:s.id,value:s.id},l(s.fullName),9,nt))),128))],512),[[T,u.value.personId]])])):_("",!0),C.value==="company"?(a(),i("div",at,[t[42]||(t[42]=e("label",null,"Select Company",-1)),c(e("select",{"onUpdate:modelValue":t[16]||(t[16]=s=>u.value.companyId=s)},[(a(!0),i(w,null,$(V.value,s=>(a(),i("option",{key:s.id,value:s.id},l(s.companyName),9,lt))),128))],512),[[T,u.value.companyId]])])):_("",!0),e("div",it,[t[43]||(t[43]=e("label",null,"Relationship",-1)),c(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>u.value.relationship=s),type:"text",placeholder:"e.g. Spouse, Corporate Beneficiary"},null,512),[[p,u.value.relationship]])]),e("div",ot,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[18]||(t[18]=s=>f.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:y.value},"Add Beneficiary",8,rt)])],32)])])):_("",!0)]))])):_("",!0)}}},vt=j(dt,[["__scopeId","data-v-32a97011"]]);export{vt as default};
