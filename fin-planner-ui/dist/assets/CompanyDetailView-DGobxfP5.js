import{_ as q,r as u,i as E,c as i,d as b,o,a as e,v as I,e as O,w as W,f as z,t as a,F as $,q as S,m as f,x as r,z as m,g as x,A as G,y as H,G as J,B as C,l as j,n as U}from"./index-D2Wtd9Sa.js";const K={key:0,class:"company-detail animate-fade-in"},Q={class:"header-row"},X={class:"header-content"},Z={class:"breadcrumb"},ee={class:"current"},te={class:"meta-row"},se={class:"meta-item"},ae={class:"meta-item"},le={class:"meta-item"},ne={class:"actions"},oe={class:"detail-grid"},ie={class:"summary-cards"},re={class:"card summary-card gradient-emerald"},de={class:"value"},ue={class:"card summary-card gradient-amber"},me={class:"value"},ve={class:"card summary-card gradient-blue"},pe={class:"value"},ce={class:"sub-label"},ye={key:0,class:"card warning-card mt-xl"},be={class:"shortfall"},fe={class:"content-grid"},ge={class:"card section-card"},_e={class:"section-header"},De={key:0,class:"empty-state-mini"},ke={class:"loan-main"},we={class:"loan-borrower"},Ce={class:"loan-meta"},Re={class:"loan-status"},Ae=["onClick"],Ne={class:"loan-financials"},xe={class:"metric"},Be={class:"v"},$e={class:"metric"},Se={class:"v font-bold"},Ve={class:"metric"},Ue={class:"v text-primary"},Le={class:"card section-card"},Fe={class:"section-header"},Pe={key:0,class:"data-table"},Ye={class:"text-right font-semibold"},Me={class:"text-right text-success"},Te={key:1,class:"empty-state-mini"},he={class:"modal-card"},qe={class:"modal-header"},Ee={class:"form-group"},Ie={class:"form-row"},Oe={class:"form-group"},We={class:"form-group"},ze={class:"form-group"},Ge={class:"checkbox-label"},He={class:"modal-actions"},Je=["disabled"],je={class:"modal-card"},Ke={class:"modal-header"},Qe={class:"form-group"},Xe={class:"form-row"},Ze={class:"form-group"},et={class:"form-group"},tt={class:"form-row"},st={class:"form-group"},at={class:"form-group"},lt={class:"modal-actions"},nt=["disabled"],ot={class:"modal-card"},it={class:"modal-header"},rt={class:"form-group"},dt={class:"loan-info-mini"},ut={class:"form-row"},mt={class:"form-group"},vt={class:"form-group"},pt={class:"modal-actions"},ct=["disabled"],yt={class:"modal-card"},bt={class:"modal-header"},ft={class:"form-group"},gt={class:"form-row"},_t={class:"form-group"},Dt={class:"form-group"},kt={class:"form-group"},wt={class:"modal-actions"},Ct=["disabled"],Rt={__name:"CompanyDetailView",setup(At){const V=j(),n=u(null),R=u(null),L=u(!0),v=u(!1),g=u(!1),_=u(!1),D=u(!1),k=u(!1),A=u(null),c=u({}),p=u({borrowerName:"",principalAmount:0,interestRate:.0847,loanDate:new Date().toISOString().split("T")[0],loanTermYears:7,isSecured:!1}),w=u({amount:0,paymentDate:new Date().toISOString().split("T")[0]}),y=u({amount:0,declarationDate:new Date().toISOString().split("T")[0],paymentDate:new Date().toISOString().split("T")[0],frankingPercentage:100}),N=async()=>{try{const[l,t]=await Promise.all([C.get(`/companies/${V.params.id}`),C.get(`/companies/${V.params.id}/summary`)]);n.value=l.data,R.value=t.data,c.value={...l.data}}catch(l){console.error("Failed to load company data",l)}finally{L.value=!1}},F=async()=>{v.value=!0;try{await C.put(`/companies/${n.value.id}`,c.value),g.value=!1,await N()}catch{alert("Update failed")}finally{v.value=!1}},P=async()=>{v.value=!0;try{const l={...p.value,interestRate:p.value.interestRate};l.interestRate>1&&(l.interestRate=l.interestRate/100),await C.post(`/companies/${n.value.id}/loans`,l),_.value=!1,await N()}catch(l){alert(l.response?.data||"Failed to create loan")}finally{v.value=!1}},Y=l=>{A.value=l,w.value.amount=l.minimumYearlyRepayment,D.value=!0},M=async()=>{v.value=!0;try{await C.post(`/companies/${n.value.id}/loans/${A.value.id}/repayment`,w.value),D.value=!1,await N()}catch{alert("Repayment failed")}finally{v.value=!1}},T=async()=>{v.value=!0;try{await C.post(`/companies/${n.value.id}/dividends`,y.value),k.value=!1,await N()}catch(l){alert(l.response?.data||"Failed to declare dividend")}finally{v.value=!1}},B=l=>l?new Date(l).toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"}):"N/A",d=l=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(l||0);return E(N),(l,t)=>{const h=z("router-link");return n.value?(o(),i("div",K,[e("div",Q,[e("div",X,[e("div",Z,[O(h,{to:"/entities"},{default:W(()=>[...t[30]||(t[30]=[x("Entities",-1)])]),_:1}),t[31]||(t[31]=e("span",{class:"separator"},"/",-1)),e("span",ee,a(n.value.companyName),1)]),e("h1",null,a(n.value.companyName),1),e("div",te,[e("span",se,"ðŸ¢ "+a(n.value.isBaseRateEntity?"Base Rate Entity (25%)":"Full Rate (30%)"),1),e("span",ae,"ðŸ†” ABN: "+a(n.value.ABN||"N/A")+" / ACN: "+a(n.value.ACN||"N/A"),1),e("span",le,"ðŸ“… Inc: "+a(B(n.value.incorporationDate)),1)])]),e("div",ne,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=s=>g.value=!0)},"Edit Company")])]),e("div",oe,[e("div",ie,[e("div",re,[t[32]||(t[32]=e("span",{class:"label"},"Retained Profits",-1)),e("span",de,a(d(n.value.retainedProfits)),1)]),e("div",ue,[t[33]||(t[33]=e("span",{class:"label"},"Franking Account",-1)),e("span",me,a(d(n.value.frankingAccountBalance)),1)]),e("div",ve,[t[34]||(t[34]=e("span",{class:"label"},"Active Loans (Div 7A)",-1)),e("span",pe,a(d(R.value?.totalLoanBalance||0)),1),e("span",ce,a(R.value?.activeLoans||0)+" active loan(s)",1)])]),R.value?.division7AWarnings?.length>0?(o(),i("div",ye,[t[35]||(t[35]=e("h3",null,"âš ï¸ Division 7A Compliance Warnings",-1)),t[36]||(t[36]=e("p",null,"The following loans have not met their minimum yearly repayment for the current FY:",-1)),(o(!0),i($,null,S(R.value.division7AWarnings,s=>(o(),i("div",{key:s.borrowerName,class:"warning-item"},[e("strong",null,a(s.borrowerName),1),x(": Paid "+a(d(s.repaidThisYear))+" / Min "+a(d(s.minimumYearlyRepayment))+" ",1),e("span",be,"(Shortfall: "+a(d(s.shortfall))+")",1)]))),128))])):b("",!0),e("div",fe,[e("div",ge,[e("div",_e,[t[37]||(t[37]=e("h2",null,"ðŸ“œ Division 7A Loans",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:t[1]||(t[1]=s=>_.value=!0)},"New Loan Record")]),n.value.division7ALoans?.length===0?(o(),i("div",De," No Div 7A loans recorded for this company. ")):b("",!0),(o(!0),i($,null,S(n.value.division7ALoans,s=>(o(),i("div",{key:s.id,class:"loan-item"},[e("div",ke,[e("div",we,"Borrower: "+a(s.borrowerName),1),e("div",Ce,"Dated "+a(B(s.loanDate))+" â€¢ "+a(s.loanTermYears)+" year term",1),e("div",Re,[e("span",{class:U(["status-pill",s.status.toLowerCase()])},a(s.status),3),s.status==="Active"?(o(),i("button",{key:0,class:"btn btn-secondary btn-xs ml-sm",onClick:Nt=>Y(s)},"Record Repayment",8,Ae)):b("",!0)])]),e("div",Ne,[e("div",xe,[t[38]||(t[38]=e("span",{class:"l"},"Principal",-1)),e("span",Be,a(d(s.principalAmount)),1)]),e("div",$e,[t[39]||(t[39]=e("span",{class:"l"},"Balance",-1)),e("span",Se,a(d(s.currentBalance)),1)]),e("div",Ve,[t[40]||(t[40]=e("span",{class:"l"},"Min Repayment",-1)),e("span",Ue,a(d(s.minimumYearlyRepayment)),1)])])]))),128))]),e("div",Le,[e("div",Fe,[t[41]||(t[41]=e("h2",null,"ðŸ’° Dividend History",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:t[2]||(t[2]=s=>k.value=!0)},"Declare Dividend")]),n.value.dividends?.length>0?(o(),i("table",Pe,[t[42]||(t[42]=e("thead",null,[e("tr",null,[e("th",null,"Date"),e("th",{class:"text-right"},"Amount"),e("th",{class:"text-right"},"Franking Credits"),e("th",null,"Status")])],-1)),e("tbody",null,[(o(!0),i($,null,S(n.value.dividends,s=>(o(),i("tr",{key:s.id},[e("td",null,a(B(s.paymentDate)),1),e("td",Ye,a(d(s.amount)),1),e("td",Me,a(d(s.frankingCredits))+" ("+a(s.frankingPercentage)+"%)",1),e("td",null,[e("span",{class:U(["status-pill",s.status.toLowerCase()])},a(s.status),3)])]))),128))])])):(o(),i("div",Te,"No dividends recorded."))])])]),(o(),I(J,{to:"body"},[g.value?(o(),i("div",{key:0,class:"modal-overlay",onClick:t[9]||(t[9]=f(s=>g.value=!1,["self"]))},[e("div",he,[e("div",qe,[t[43]||(t[43]=e("h2",null,"Edit Company",-1)),e("button",{class:"btn-close",onClick:t[3]||(t[3]=s=>g.value=!1)},"Ã—")]),e("form",{onSubmit:f(F,["prevent"]),class:"modal-form"},[e("div",Ee,[t[44]||(t[44]=e("label",null,"Company Name",-1)),r(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>c.value.companyName=s),type:"text",required:""},null,512),[[m,c.value.companyName]])]),e("div",Ie,[e("div",Oe,[t[45]||(t[45]=e("label",null,"ABN",-1)),r(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>c.value.abn=s),type:"text"},null,512),[[m,c.value.abn]])]),e("div",We,[t[46]||(t[46]=e("label",null,"ACN",-1)),r(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>c.value.acn=s),type:"text"},null,512),[[m,c.value.acn]])])]),e("div",ze,[e("label",Ge,[r(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=s=>c.value.isBaseRateEntity=s)},null,512),[[G,c.value.isBaseRateEntity]]),t[47]||(t[47]=x(" Base rate entity (lower tax rate) ",-1))])]),e("div",He,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=s=>g.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:v.value},"Save Changes",8,Je)])],32)])])):b("",!0),_.value?(o(),i("div",{key:1,class:"modal-overlay",onClick:t[17]||(t[17]=f(s=>_.value=!1,["self"]))},[e("div",je,[e("div",Ke,[t[48]||(t[48]=e("h2",null,"Record Division 7A Loan",-1)),e("button",{class:"btn-close",onClick:t[10]||(t[10]=s=>_.value=!1)},"Ã—")]),e("form",{onSubmit:f(P,["prevent"]),class:"modal-form"},[e("div",Qe,[t[49]||(t[49]=e("label",null,"Borrower Name",-1)),r(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>p.value.borrowerName=s),type:"text",required:"",placeholder:"e.g. John Smith"},null,512),[[m,p.value.borrowerName]])]),e("div",Xe,[e("div",Ze,[t[50]||(t[50]=e("label",null,"Principal Amount",-1)),r(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>p.value.principalAmount=s),type:"number",step:"0.01",required:""},null,512),[[m,p.value.principalAmount,void 0,{number:!0}]])]),e("div",et,[t[51]||(t[51]=e("label",null,"Loan Date",-1)),r(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>p.value.loanDate=s),type:"date",required:""},null,512),[[m,p.value.loanDate]])])]),e("div",tt,[e("div",st,[t[52]||(t[52]=e("label",null,"Interest Rate (%)",-1)),r(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>p.value.interestRate=s),type:"number",step:"0.01",placeholder:"8.47"},null,512),[[m,p.value.interestRate,void 0,{number:!0}]]),t[53]||(t[53]=e("small",null,"Benchmark for FY25 is 8.47%",-1))]),e("div",at,[t[55]||(t[55]=e("label",null,"Term (Years)",-1)),r(e("select",{"onUpdate:modelValue":t[15]||(t[15]=s=>p.value.loanTermYears=s)},[...t[54]||(t[54]=[e("option",{value:7},"7 Years (Unsecured)",-1),e("option",{value:25},"25 Years (Secured)",-1)])],512),[[H,p.value.loanTermYears,void 0,{number:!0}]])])]),e("div",lt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[16]||(t[16]=s=>_.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:v.value},"Create Loan",8,nt)])],32)])])):b("",!0),D.value?(o(),i("div",{key:2,class:"modal-overlay",onClick:t[22]||(t[22]=f(s=>D.value=!1,["self"]))},[e("div",ot,[e("div",it,[t[56]||(t[56]=e("h2",null,"Record Loan Repayment",-1)),e("button",{class:"btn-close",onClick:t[18]||(t[18]=s=>D.value=!1)},"Ã—")]),e("form",{onSubmit:f(M,["prevent"]),class:"modal-form"},[e("div",rt,[e("label",null,"Borrower: "+a(A.value?.borrowerName),1),e("div",dt,[x(" Remaining Balance: "+a(d(A.value?.currentBalance)),1),t[57]||(t[57]=e("br",null,null,-1)),x(" Min Yearly Repayment: "+a(d(A.value?.minimumYearlyRepayment)),1)])]),e("div",ut,[e("div",mt,[t[58]||(t[58]=e("label",null,"Repayment Amount",-1)),r(e("input",{"onUpdate:modelValue":t[19]||(t[19]=s=>w.value.amount=s),type:"number",step:"0.01",required:""},null,512),[[m,w.value.amount,void 0,{number:!0}]])]),e("div",vt,[t[59]||(t[59]=e("label",null,"Payment Date",-1)),r(e("input",{"onUpdate:modelValue":t[20]||(t[20]=s=>w.value.paymentDate=s),type:"date",required:""},null,512),[[m,w.value.paymentDate]])])]),e("div",pt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[21]||(t[21]=s=>D.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:v.value},"Record Payment",8,ct)])],32)])])):b("",!0),k.value?(o(),i("div",{key:3,class:"modal-overlay",onClick:t[29]||(t[29]=f(s=>k.value=!1,["self"]))},[e("div",yt,[e("div",bt,[t[60]||(t[60]=e("h2",null,"Declare Dividend",-1)),e("button",{class:"btn-close",onClick:t[23]||(t[23]=s=>k.value=!1)},"Ã—")]),e("form",{onSubmit:f(T,["prevent"]),class:"modal-form"},[e("div",ft,[t[61]||(t[61]=e("label",null,"Dividend Amount (Net)",-1)),r(e("input",{"onUpdate:modelValue":t[24]||(t[24]=s=>y.value.amount=s),type:"number",step:"0.01",required:""},null,512),[[m,y.value.amount,void 0,{number:!0}]])]),e("div",gt,[e("div",_t,[t[62]||(t[62]=e("label",null,"Declaration Date",-1)),r(e("input",{"onUpdate:modelValue":t[25]||(t[25]=s=>y.value.declarationDate=s),type:"date",required:""},null,512),[[m,y.value.declarationDate]])]),e("div",Dt,[t[63]||(t[63]=e("label",null,"Payment Date",-1)),r(e("input",{"onUpdate:modelValue":t[26]||(t[26]=s=>y.value.paymentDate=s),type:"date",required:""},null,512),[[m,y.value.paymentDate]])])]),e("div",kt,[t[64]||(t[64]=e("label",null,"Franking Percentage (%)",-1)),r(e("input",{"onUpdate:modelValue":t[27]||(t[27]=s=>y.value.frankingPercentage=s),type:"number",step:"1",max:"100"},null,512),[[m,y.value.frankingPercentage,void 0,{number:!0}]]),e("small",null,"Max possible credits will be calculated based on "+a(n.value.taxRate*100)+"% tax rate.",1)]),e("div",wt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[28]||(t[28]=s=>k.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:v.value},"Declare & Subtract Profits",8,Ct)])],32)])])):b("",!0)]))])):b("",!0)}}},Bt=q(Rt,[["__scopeId","data-v-9c0ced51"]]);export{Bt as default};
