import{_ as T,r as i,k as v,i as R,c as n,o as l,a as e,v as U,x as P,y as z,F as b,q as w,t as o,n as h,d as L,G as $,B as k,h as j,g as G,s as Y,A as q}from"./index-D2Wtd9Sa.js";const H={class:"rebalancing-view animate-fade-in content-container"},W={class:"header-row mb-xl"},J={class:"portfolio-selector"},K=["value"],O={key:0,class:"loader-container"},Q={class:"health-summary card mb-xl"},X={class:"health-item"},Z={class:"value"},ee={class:"health-item"},te={class:"health-item"},se={class:"card mb-xl overflow-hidden"},ae={class:"data-table"},oe={class:"cat-name"},le={class:"cat-value"},ne={class:"text-right"},re={class:"percentage-bar-mini"},ie={class:"text-right"},ce={class:"text-right"},de={class:"recommendations-section"},ue={key:0,class:"empty-state card"},ve={key:1,class:"actions-list"},he={class:"action-checkbox"},ge=["onUpdate:modelValue"],pe={class:"action-details"},me={class:"asset-info"},fe={class:"symbol"},ye={class:"name"},be={class:"action-math"},_e={class:"units"},xe={class:"price"},we={class:"action-total"},ke={class:"execution-footer mt-xl"},Ce=["disabled"],Pe={key:2,class:"empty-state card"},Ve={key:0,class:"modal-overlay"},Ae={__name:"RebalancingView",setup(Be){const V=j(),g=i([]),c=i(null),r=i(null),p=i(!0),m=i(!1),_=i(!1),d=i([]),f=s=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD"}).format(s||0),y=v(()=>r.value?r.value.categories.reduce((s,t)=>s+Math.abs(t.currentPercentage-t.targetPercentage),0)/2:0),A=v(()=>{const s=y.value;return s<2?"text-success":s<5?"text-warning":"text-danger"}),B=v(()=>{const s=y.value;return s<2?"badge-success":s<5?"badge-warning":"badge-danger"}),F=v(()=>{const s=y.value;return s<2?"Balanced":s<5?"Slight Drift":"Rebalance Needed"}),M=s=>Math.abs(s)<1?"text-success":Math.abs(s)<3?"text-warning":"text-danger",S=async()=>{try{const s=await k.get("/portfolios");g.value=s.data,g.value.length>0&&(c.value=g.value[0].id,await C())}catch(s){console.error("Failed to load portfolios",s)}finally{p.value=!1}},C=async()=>{if(c.value){p.value=!0;try{const s=await k.get(`/rebalancing/${c.value}`);r.value=s.data,N()}catch(s){console.error("Failed to load rebalancing report",s)}finally{p.value=!1}}},N=()=>{d.value=[],r.value&&r.value.categories.forEach(s=>{if(s.recommendation==="Hold")return;const t=s.assets.sort((a,u)=>u.totalValue-a.totalValue)[0];if(t&&Math.abs(s.varianceAmount)>100){const a=Math.abs(s.varianceAmount),u=a/t.currentPrice;d.value.push({assetId:t.assetId,symbol:t.symbol,assetName:t.name,type:s.recommendation==="Buy"?"Buy":"Sell",units:u,price:t.currentPrice,amount:a,selected:!0})}})},x=v(()=>d.value.filter(s=>s.selected)),D=async()=>{m.value=!0;try{const s=x.value.map(t=>({assetId:t.assetId,type:t.type==="Buy"?0:1,units:t.units,amount:t.amount}));await k.post(`/rebalancing/${c.value}/execute`,s),_.value=!0}catch(s){console.error("Execution failed",s),alert("Failed to execute rebalancing trades.")}finally{m.value=!1}},E=()=>{_.value=!1,V.push("/reports")};return R(S),(s,t)=>(l(),n("div",H,[e("div",W,[t[1]||(t[1]=e("div",{class:"header-content"},[e("h1",null,"Rebalancing Wizard"),e("p",{class:"subtitle"},"Align your portfolio with your target asset allocation")],-1)),e("div",J,[P(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),onChange:C,class:"form-select"},[(l(!0),n(b,null,w(g.value,a=>(l(),n("option",{key:a.id,value:a.id},o(a.name),9,K))),128))],544),[[z,c.value]])])]),p.value?(l(),n("div",O,[...t[2]||(t[2]=[e("div",{class:"spinner"},null,-1),e("p",null,"Analyzing portfolio allocations...",-1)])])):r.value?(l(),n(b,{key:1},[e("div",Q,[e("div",X,[t[3]||(t[3]=e("span",{class:"label"},"Total Value",-1)),e("span",Z,o(f(r.value.totalValue)),1)]),t[6]||(t[6]=e("div",{class:"health-divider"},null,-1)),e("div",ee,[t[4]||(t[4]=e("span",{class:"label"},"Allocation Drift",-1)),e("span",{class:h(["value",A.value])},o(y.value.toFixed(1))+"%",3)]),t[7]||(t[7]=e("div",{class:"health-divider"},null,-1)),e("div",te,[t[5]||(t[5]=e("span",{class:"label"},"Status",-1)),e("span",{class:h(["badge",B.value])},o(F.value),3)])]),e("div",se,[e("table",ae,[t[8]||(t[8]=e("thead",null,[e("tr",null,[e("th",null,"Category"),e("th",{class:"text-right"},"Current"),e("th",{class:"text-right"},"Target"),e("th",{class:"text-right"},"Drift"),e("th",{class:"text-right"},"Action")])],-1)),e("tbody",null,[(l(!0),n(b,null,w(r.value.categories,a=>(l(),n("tr",{key:a.categoryId},[e("td",null,[e("div",oe,o(a.categoryName),1),e("div",le,o(f(a.currentValue)),1)]),e("td",ne,[e("div",re,[e("div",{class:"bar-fill",style:Y({width:a.currentPercentage+"%"})},null,4)]),G(" "+o(a.currentPercentage.toFixed(1))+"% ",1)]),e("td",ie,o(a.targetPercentage.toFixed(1))+"%",1),e("td",{class:h(["text-right",M(a.currentPercentage-a.targetPercentage)])},o((a.currentPercentage-a.targetPercentage).toFixed(1))+"% ",3),e("td",ce,[e("span",{class:h(["action-tag",a.recommendation.toLowerCase()])},o(a.recommendation),3)])]))),128))])])]),e("div",de,[t[10]||(t[10]=e("div",{class:"section-header mb-md"},[e("h2",null,"Execution Plan"),e("p",{class:"subtitle"},"Select the trades you want to execute to realign your portfolio.")],-1)),d.value.length===0?(l(),n("div",ue,[...t[9]||(t[9]=[e("div",{class:"icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e("polyline",{points:"22 4 12 14.01 9 11.01"})])],-1),e("h3",null,"Portfolio is Balanced",-1),e("p",null,"Your current allocations are within tolerance of your targets.",-1)])])):(l(),n("div",ve,[(l(!0),n(b,null,w(d.value,(a,u)=>(l(),n("div",{key:u,class:"action-card card"},[e("div",he,[P(e("input",{type:"checkbox","onUpdate:modelValue":I=>a.selected=I},null,8,ge),[[q,a.selected]])]),e("div",pe,[e("div",{class:h(["action-type",a.type.toLowerCase()])},o(a.type),3),e("div",me,[e("span",fe,o(a.symbol),1),e("span",ye,o(a.assetName),1)])]),e("div",be,[e("div",_e,o(a.units.toFixed(4))+" units",1),e("div",xe,"@ "+o(f(a.price)),1)]),e("div",we,o(f(a.amount)),1)]))),128)),e("div",ke,[e("button",{class:"btn btn-primary btn-lg",onClick:D,disabled:x.value.length===0||m.value},o(m.value?"Executing Trades...":`Execute ${x.value.length} Selected Trades`),9,Ce)])]))])],64)):(l(),n("div",Pe,[...t[11]||(t[11]=[e("p",null,"No rebalancing data available. Ensure your portfolio has target allocations set up.",-1)])])),(l(),U($,{to:"body"},[_.value?(l(),n("div",Ve,[e("div",{class:"modal-card success-modal"},[t[12]||(t[12]=e("div",{class:"success-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e("polyline",{points:"22 4 12 14.01 9 11.01"})])],-1)),t[13]||(t[13]=e("h2",null,"Trades Executed!",-1)),t[14]||(t[14]=e("p",null,"Your portfolio has been updated with the rebalancing transactions.",-1)),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-primary",onClick:E},"Great, take me to Ledger")])])])):L("",!0)]))]))}},Me=T(Ae,[["__scopeId","data-v-935b58b5"]]);export{Me as default};
