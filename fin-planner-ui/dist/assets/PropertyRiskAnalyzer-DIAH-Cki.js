import{_ as oe,r as T,k as A,c as p,o as d,a as t,g as ie,d as w,t as $,F as Y,q as X,s as Ee,b as Je,n as ne,C as se,x as I,y as He,z as Q,i as Ae,v as Fe,m as Te,G as Ie,A as ze,e as ae}from"./index-D2Wtd9Sa.js";const z={NORMAL:"normal",LOGNORMAL:"lognormal",TRIANGULAR:"triangular",UNIFORM:"uniform"};function pe(a=0,s=1){const n=Math.random(),u=Math.random(),e=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*u);return a+e*s}function Ye(a,s){const n=pe(a,s);return Math.exp(n)}function je(a,s,n){const u=Math.random(),e=(n-a)/(s-a);return u<=e?a+Math.sqrt(u*(s-a)*(n-a)):s-Math.sqrt((1-u)*(s-a)*(s-n))}function Ze(a,s){return a+Math.random()*(s-a)}function De(a){const s=a.length,n=Array(s).fill(0).map(()=>Array(s).fill(0));for(let u=0;u<s;u++)for(let e=0;e<=u;e++){let r=0;for(let y=0;y<e;y++)r+=n[u][y]*n[e][y];u===e?n[u][e]=Math.sqrt(Math.max(0,a[u][u]-r)):n[u][e]=(a[u][e]-r)/n[e][e]}return n}function We(a,s){const n=a.length,u=new Array(n).fill(0);for(let e=0;e<n;e++)for(let r=0;r<=e;r++)u[e]+=s[e][r]*a[r];return u}function Ve(a,s){switch(a){case z.LOGNORMAL:return Ye(s.mu,s.sigma);case z.TRIANGULAR:return je(s.min,s.max,s.mode);case z.UNIFORM:return Ze(s.min,s.max);case z.NORMAL:default:return pe(s.mean,s.stdDev)}}function Xe(a,s){const n=a*(s/100)/2;return pe(a,n)}function be(a,s,n,u){const e=a*(1-s/100),r=e*(n/100);return e-r-u}function ke(a,s){return a*(s/100)}function Ke(a,s,n=100){let u=.1;for(let e=0;e<n;e++){let r=-s,y=0;for(let m=0;m<a.length;m++){const i=Math.pow(1+u,m+1);r+=a[m]/i,y-=(m+1)*a[m]/Math.pow(1+u,m+2)}if(Math.abs(r)<.01)break;u=u-r/y,u<-.99&&(u=-.99),u>1&&(u=1)}return u*100}function Qe(a){const{askingPrice:s,stampDutyRate:n,legalCosts:u,capExReserve:e,estimatedGrossRent:r,vacancyRatePercent:y,managementFeePercent:m,outgoingsEstimate:i,loanAmount:c,interestRatePercent:V,capitalGrowthPercent:f,holdingPeriodYears:_,rentVariancePercent:P,vacancyVariancePercent:R,interestVariancePercent:U,capitalGrowthVariancePercent:O,discountRate:o=8,timeVarianceEarly:l=0,timeVarianceLate:b=0}=a,h=s*(n/100),v=s+h+u+e-c,k=["rent","vacancy","interest","growth"],N=k.map(()=>pe(0,1));let D=N;if(a.correlationMatrix&&a.correlationMatrix.length===k.length){const x=a.precalculatedCholesky||De(a.correlationMatrix);D=We(N,x)}const L=x=>D[k.indexOf(x)],S=(x,M)=>{if(!M)return 0;switch(M.type){case z.LOGNORMAL:return Math.exp(M.mu+x*M.sigma);case z.NORMAL:return M.mean+x*M.stdDev;case z.UNIFORM:return Ve(M.type,M);case z.TRIANGULAR:return Ve(M.type,M);default:return M.mean+x*M.stdDev}},C=(x,M,q)=>{const J=x?.variancePercent??q;return{type:x?.type||z.NORMAL,mean:M,stdDev:M*(J/100)/2,min:M*(1-J/100),max:M*(1+J/100),mode:M,...x}},F=C(a.distributions?.rent,r,P),E=C(a.distributions?.vacancy,y,R),ye=C(a.distributions?.interest,V,U),le=C(a.distributions?.growth,f,O),re=S(L("rent"),F),ue=Math.max(0,S(L("vacancy"),E)),ce=Math.max(.1,S(L("interest"),ye)),de=S(L("growth"),le),ve=-l,Ge=b,Me=ve+Math.random()*(Ge-ve),j=[];let K=re,Z=s;const Ce=a.detailedCashflows&&a.detailedCashflows.length>0;for(let x=1;x<=_;x++){let M;if(Ce){const q=a.detailedCashflows[x-1],J=q?q.netCashflow:0,ee=r>0?re/r:1,me=(1-ue/100)/(1-y/100);M=J*ee*me}else{if(a.leaseDetails){const{remainingTerm:q,reviewType:J,reviewValue:ee,vacancyDurationMonths:me,newLeaseTermYear:vn}=a.leaseDetails;x<=q&&x>1&&(J==="fixed"?K*=1+ee/100:J==="cpi"&&(K*=1.025)),x>1&&(J==="fixed"&&x<=q?K*=1+ee/100:K*=1.025);let he=ue;if(x===Math.ceil(q+.1)&&me>0){const te=me/12*100;he=Math.max(he,te)}const Be=be(K,he,m,i);let fe=0;a.loanDetails&&a.loanDetails.length>0?a.loanDetails.forEach(te=>{const Ue=Math.max(.1,Xe(te.rate,U));fe+=te.amount*(Ue/100)}):fe=ke(c,ce),M=Be-fe}else{x>1&&(K*=1.025);const q=be(K,ue,m,i),J=ke(c,ce);M=q-J}x>1&&(Z*=1+de/100,Z>1e11&&(Z=1e11))}if(Ce&&x>1&&(Z*=1+de/100,Z>1e11&&(Z=1e11)),x===_){const q=Z-c;j.push({amount:M+q,year:x,timingShiftMonths:Me})}else j.push({amount:M,year:x,timingShiftMonths:Me})}const _e=o/100,$e=j.reduce((x,M)=>{const q=M.year+M.timingShiftMonths/12;return x+M.amount/Math.pow(1+_e,q)},0),Oe=$e-v,Le=j.map(x=>x.amount),Se=Ke(Le,v),Pe=[0];let Re=0;for(let x=0;x<j.length;x++){const M=j[x].year+j[x].timingShiftMonths/12,q=j[x].amount/Math.pow(1+_e,M);Re+=q,Pe.push(Re)}return{npv:Oe,grossPV:$e,irr:Se,finalValue:Z,cumulativeGrossPV:Pe}}function et(a,s=5e3,n=!1){const u=performance.now(),e={...a,askingPrice:Number(a.askingPrice)||0,stampDutyRate:Number(a.stampDutyRate)||0,legalCosts:Number(a.legalCosts)||0,capExReserve:Number(a.capExReserve)||0,estimatedGrossRent:Number(a.estimatedGrossRent)||0,vacancyRatePercent:Number(a.vacancyRatePercent)||0,managementFeePercent:Number(a.managementFeePercent)||0,outgoingsEstimate:Number(a.outgoingsEstimate)||0,loanAmount:Number(a.loanAmount)||0,interestRatePercent:Number(a.interestRatePercent)||0,capitalGrowthPercent:Math.min(Math.max(Number(a.capitalGrowthPercent)||0,-20),30),holdingPeriodYears:Math.min(Math.max(Number(a.holdingPeriodYears)||10,1),50),rentVariancePercent:Math.min(Number(a.rentVariancePercent)||10,50),vacancyVariancePercent:Math.min(Number(a.vacancyVariancePercent)||5,50),interestVariancePercent:Math.min(Number(a.interestVariancePercent)||1,20),capitalGrowthVariancePercent:Math.min(Number(a.capitalGrowthVariancePercent)||2,20),discountRate:Number(a.discountRate)||8,timeVarianceEarly:Number(a.timeVarianceEarly)||0,timeVarianceLate:Number(a.timeVarianceLate)||0},r=[],y=[],m=[];let i=null;e.correlationMatrix&&(i=De(e.correlationMatrix));const c={...e,precalculatedCholesky:i};for(let C=0;C<s;C++){const{npv:F,grossPV:E,irr:ye,cumulativeGrossPV:le}=Qe(c);if(y.push(ye),n){r.push(F);const re=e.askingPrice*(e.stampDutyRate/100),ce=e.askingPrice+re+e.legalCosts+e.capExReserve-e.loanAmount,de=le.map(ve=>ve-ce);m.push(de)}else r.push(E),m.push(le)}r.sort((C,F)=>C-F),y.sort((C,F)=>C-F);const V=Math.floor(s*.1),f=Math.floor(s*.5),_=Math.floor(s*.9),P=r[V],R=r[f],U=r[_],O=y[V],o=y[f],l=y[_],b=Ne(r,20),h=Ne(y,20),g=e.holdingPeriodYears,v={p10:[],median:[],p90:[]};for(let C=0;C<=g;C++){const F=new Float32Array(s);for(let E=0;E<s;E++)F[E]=m[E][C];F.sort(),v.p10.push(F[V]),v.median.push(F[f]),v.p90.push(F[_])}const k=be(e.estimatedGrossRent,e.vacancyRatePercent,e.managementFeePercent,e.outgoingsEstimate),N=e.askingPrice>0?k/e.askingPrice*100:0;let D="Analyzing";R<0?D="Uneconomic":P>0||R>0&&P>-e.askingPrice*.1?D="Buy":D="Pass";const L=performance.now(),S=[];for(let C=0;C<=100;C++){const F=Math.min(Math.floor(C/100*(s-1)),s-1);S.push({percent:C,value:r[F]})}return{iterations:s,runTimeMs:Math.round(L-u),medianNPV:isFinite(R)?Math.round(R):0,p10NPV:isFinite(P)?Math.round(P):0,p90NPV:isFinite(U)?Math.round(U):0,medianIRR:isFinite(o)?Math.round(o*10)/10:0,p10IRR:isFinite(O)?Math.round(O*10)/10:0,p90IRR:isFinite(l)?Math.round(l*10)/10:0,calculatedCapRate:isFinite(N)?Math.round(N*100)/100:0,recommendedDecision:D,npvHistogram:b,irrHistogram:h,yearlyDCF:v,probabilityCurve:S.map(C=>({percent:C.percent,value:isFinite(C.value)?C.value:0}))}}function Ne(a,s=20){const n=Math.min(...a),e=Math.max(...a)-n,r=e>0?e/s:1,y=new Array(s).fill(0).map((m,i)=>({min:n+i*(e>0?r:0),max:n+(i+1)*(e>0?r:0),count:0}));return a.forEach(m=>{let i=e>0?Math.floor((m-n)/r):0;isNaN(i)&&(i=0),i=Math.max(0,Math.min(i,s-1)),y[i]&&y[i].count++}),y}function qe(a){return new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0)}const tt={class:"value-at-risk-chart"},at={class:"chart-header"},nt={class:"chart-legend"},st={class:"legend-item value-curve"},it={key:0,class:"legend-item cost-line"},ot=["viewBox"],lt={class:"grid-lines"},rt=["x1","y1","x2","y2"],ut=["x1","y1","x2","y2"],ct=["d"],dt=["d"],vt=["x1","y1","x2","y2"],mt=["x","y"],pt={key:2},yt=["points"],ht=["x","y"],ft={class:"markers"},gt=["cx","cy"],xt=["cx","cy"],bt=["cx","cy"],Mt=["x","y"],Ct=["x","y"],_t=["x","y"],$t={class:"y-axis"},Pt=["x","y"],Rt=["x","y"],Vt={class:"x-axis"},kt=["x","y"],Nt=["x","y"],wt=["x","y"],At=["x1","y1","x2","y2"],Ft=["cx","cy"],Dt={class:"tooltip-header"},qt={class:"tooltip-value"},W=600,H=300,Gt={__name:"ValueAtRiskChart",props:{probabilityCurve:{type:Array,required:!0,default:()=>[]},totalAcquisitionCost:{type:Number,required:!0},isNetMode:{type:Boolean,default:!1}},setup(a){const s=a,n={top:20,right:30,bottom:50,left:80},u=W-n.left-n.right,e=H-n.top-n.bottom,r=T(null),y=T({visible:!1,x:0,y:0,xLine:0,value:0,percent:0}),m=A(()=>{if(!s.probabilityCurve.length)return 0;const h=s.probabilityCurve.map(D=>D.value),g=Math.min(...h),v=Math.max(...h),k=v-g;if(k===0)return g-Math.abs(g)*.1-1e3;let N=g-k*.1;return s.isNetMode&&v>0&&g<0?N=Math.min(N,g*1.1):s.isNetMode&&(N=Math.min(N,0)),N}),i=A(()=>{if(!s.probabilityCurve.length)return 1e5;const h=s.probabilityCurve.map(D=>D.value),g=Math.min(...h),v=Math.max(...h),k=v-g;if(k===0)return v+Math.abs(v)*.1+1e3;let N=v+k*.1;return s.isNetMode&&(N=Math.max(N,0)),N}),c=A(()=>s.isNetMode?!1:s.totalAcquisitionCost>=m.value&&s.totalAcquisitionCost<=i.value),V=A(()=>{const g=(i.value-m.value)/4;return[m.value,m.value+g,m.value+g*2,m.value+g*3,i.value]});function f(h){const g=i.value-m.value||1;return n.left+(h-m.value)/g*u}function _(h){return n.top+(1-h/100)*e}function P(h){const g=s.probabilityCurve.find(v=>v.percent===h);return g&&isFinite(g.value)?g.value:0}const R=A(()=>{if(!s.probabilityCurve.length)return"";const h=s.probabilityCurve.filter(v=>isFinite(v.value));return h.length?h.map((v,k)=>{const N=k===0?"M":"L",D=f(v.value),L=_(v.percent);return!isFinite(D)||!isFinite(L)?"":`${N} ${D.toFixed(2)} ${L.toFixed(2)}`}).filter(v=>v).join(" "):""}),U=A(()=>{if(!s.probabilityCurve.length)return"";const h=s.probabilityCurve.filter(N=>isFinite(N.value));if(!h.length)return"";const g=h[0],v=h[h.length-1];let k=`M ${f(g.value)} ${H-n.bottom} `;return k+=R.value.substring(1),k+=` L ${f(v.value)} ${H-n.bottom} Z`,k});function O(h){const g=r.value.getBoundingClientRect(),k=h.clientX-g.left-n.left,N=i.value-m.value||1,D=Math.max(0,Math.min(1,k/u)),L=m.value+D*N,S=s.probabilityCurve.reduce((F,E)=>Math.abs(E.value-L)<Math.abs(F.value-L)?E:F),C=f(S.value);y.value={visible:!0,x:C+10,y:_(S.percent)-40,xLine:C,value:S.value,percent:S.percent}}function o(){y.value.visible=!1}function l(h){return qe(h)}function b(h){return Math.abs(h)>=1e6?`$${(h/1e6).toFixed(1)}M`:Math.abs(h)>=1e3?`$${(h/1e3).toFixed(0)}K`:`$${h.toFixed(0)}`}return(h,g)=>(d(),p("div",tt,[t("div",at,[g[0]||(g[0]=t("h4",{class:"chart-title"},[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})]),ie(" Value at Risk (Cumulative Distribution) ")],-1)),t("div",nt,[t("span",st,$(a.isNetMode?"Net Profit":"Intrinsic Value"),1),a.isNetMode?w("",!0):(d(),p("span",it,"Total Cost"))])]),t("div",{class:"chart-container",ref_key:"chartContainer",ref:r},[(d(),p("svg",{viewBox:`0 0 ${W} ${H}`,class:"chart-svg"},[t("g",lt,[(d(),p(Y,null,X(5,v=>t("line",{key:"h"+v,x1:n.left,y1:n.top+(v-1)*(e/4),x2:W-n.right,y2:n.top+(v-1)*(e/4),class:"grid-line"},null,8,rt)),64)),(d(),p(Y,null,X(5,v=>t("line",{key:"v"+v,x1:n.left+(v-1)*(u/4),y1:n.top,x2:n.left+(v-1)*(u/4),y2:H-n.bottom,class:"grid-line"},null,8,ut)),64))]),g[1]||(g[1]=t("defs",null,[t("linearGradient",{id:"valueGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[t("stop",{offset:"0%","stop-color":"var(--color-industrial-copper)","stop-opacity":"0.3"}),t("stop",{offset:"100%","stop-color":"var(--color-industrial-copper)","stop-opacity":"0.05"})])],-1)),t("path",{d:U.value,fill:"url(#valueGradient)",class:"curve-area"},null,8,ct),t("path",{d:R.value,class:"value-curve-line"},null,8,dt),!a.isNetMode&&c.value?(d(),p("line",{key:0,x1:f(a.totalAcquisitionCost),y1:n.top,x2:f(a.totalAcquisitionCost),y2:H-n.bottom,class:"cost-benchmark-line"},null,8,vt)):w("",!0),!a.isNetMode&&c.value?(d(),p("text",{key:1,x:f(a.totalAcquisitionCost)+5,y:n.top+10,class:"benchmark-label",style:{"text-anchor":"start"}},"Cost: "+$(l(a.totalAcquisitionCost)),9,mt)):w("",!0),!a.isNetMode&&!c.value&&a.totalAcquisitionCost>i.value?(d(),p("g",pt,[t("polygon",{points:`${W-n.right-15},${n.top+20} ${W-n.right},${n.top+25} ${W-n.right-15},${n.top+30}`,fill:"var(--color-text-muted)"},null,8,yt),t("text",{x:W-n.right-20,y:n.top+28,class:"benchmark-label",style:{"text-anchor":"end","font-size":"9px"}},"Cost: "+$(l(a.totalAcquisitionCost))+" →",9,ht)])):w("",!0),t("g",ft,[t("circle",{cx:f(P(10)),cy:_(10),r:"4",class:"marker-point p10"},null,8,gt),t("circle",{cx:f(P(50)),cy:_(50),r:"4",class:"marker-point median"},null,8,xt),t("circle",{cx:f(P(90)),cy:_(90),r:"4",class:"marker-point p90"},null,8,bt),t("text",{x:f(P(10)),y:_(10)-10,class:"marker-label"},"P10",8,Mt),t("text",{x:f(P(50)),y:_(50)-10,class:"marker-label"},"Median",8,Ct),t("text",{x:f(P(90)),y:_(90)-10,class:"marker-label"},"P90",8,_t)]),t("g",$t,[(d(),p(Y,null,X([0,25,50,75,100],v=>t("text",{key:"y"+v,x:n.left-8,y:_(v)+4,class:"axis-label"},$(v)+"%",9,Pt)),64)),t("text",{x:n.left-45,y:H/2,transform:"rotate(-90, 20, 150)",class:"axis-title",style:{"transform-box":"fill-box","transform-origin":"center"}},"Cumulative Probability",8,Rt)]),t("g",Vt,[(d(!0),p(Y,null,X(V.value,(v,k)=>(d(),p("text",{key:"x"+k,x:f(v),y:H-n.bottom+16,class:"axis-label"},$(b(v)),9,kt))),128)),t("text",{x:W/2,y:H-5,class:"axis-title"},$(a.isNetMode?"Net Profit ($)":"Intrinsic Value ($)"),9,Nt)]),t("rect",{x:n.left,y:n.top,width:u,height:e,fill:"transparent",onMousemove:O,onMouseleave:o},null,40,wt),y.value.visible?(d(),p("line",{key:3,x1:y.value.xLine,y1:n.top,x2:y.value.xLine,y2:H-n.bottom,class:"interactive-line"},null,8,At)):w("",!0),y.value.visible?(d(),p("circle",{key:4,cx:y.value.xLine,cy:_(y.value.percent),r:"5",class:"interactive-point"},null,8,Ft)):w("",!0)],8,ot)),y.value.visible?(d(),p("div",{key:0,class:"chart-tooltip",style:Ee({left:y.value.x+"px",top:y.value.y+"px"})},[t("div",Dt,$(y.value.percent.toFixed(0))+"% Probability",1),t("div",qt,$(l(y.value.value)),1),g[2]||(g[2]=t("div",{class:"tooltip-sub"},"Value ≤ this amount",-1))],4)):w("",!0)],512)]))}},Ot=oe(Gt,[["__scopeId","data-v-14a00e0b"]]),Lt={class:"monte-carlo-chart"},St={class:"chart-title"},Bt={class:"chart-container"},Ut=["viewBox"],Et={class:"bars"},Jt=["x","y","width","height"],Ht={class:"percentile-lines"},Tt=["x1","x2","y2"],It=["x1","x2","y2"],zt=["x1","x2","y2"],Yt=["x1","x2","y2"],jt={class:"labels"},Zt=["x","y"],Wt=["x","y"],Xt=["x","y"],Kt={class:"axis-values"},Qt=["y"],ea=["x","y"],ge=400,B=150,G=20,we=2,ta={__name:"MonteCarloChart",props:{histogram:{type:Array,required:!0},p10:{type:Number,required:!0},median:{type:Number,required:!0},p90:{type:Number,required:!0},title:{type:String,default:"Distribution"}},setup(a){const s=a,n=A(()=>s.histogram?.length?Math.min(...s.histogram.map(o=>o.min)):0),u=A(()=>s.histogram?.length?Math.max(...s.histogram.map(o=>o.max)):0),e=A(()=>u.value-n.value||1),r=A(()=>s.histogram?.length&&Math.max(...s.histogram.map(o=>o.count))||1),y=A(()=>ge-G*2),m=A(()=>B-G*2),i=A(()=>{if(!s.histogram?.length)return[];const o=y.value/s.histogram.length-we;return s.histogram.map((l,b)=>{const h=l.count/r.value*m.value,g=(l.min+l.max)/2;return{x:G+b*(o+we),y:B-G-h,width:o,height:h,value:g,count:l.count,isNegative:g<0}})}),c=o=>G+(o-n.value)/e.value*y.value,V=A(()=>c(s.p10)),f=A(()=>c(s.median)),_=A(()=>c(s.p90)),P=A(()=>n.value<0&&u.value>0),R=A(()=>c(0));function U(o){return o.isNegative?"bar-negative":"bar-positive"}function O(o){return Math.abs(o)>=1e6?`$${(o/1e6).toFixed(1)}M`:Math.abs(o)>=1e3?`$${(o/1e3).toFixed(0)}K`:`$${o.toFixed(0)}`}return(o,l)=>(d(),p("div",Lt,[t("h4",St,$(a.title),1),t("div",Bt,[(d(),p("svg",{viewBox:`0 0 ${ge} ${B}`,class:"histogram-svg"},[t("g",Et,[(d(!0),p(Y,null,X(i.value,(b,h)=>(d(),p("rect",{key:h,x:b.x,y:b.y,width:b.width,height:b.height,class:ne([U(b),"bar"])},null,10,Jt))),128))]),t("g",Ht,[t("line",{x1:V.value,y1:G,x2:V.value,y2:B-G,class:"percentile-line p10-line"},null,8,Tt),t("line",{x1:f.value,y1:G,x2:f.value,y2:B-G,class:"percentile-line median-line"},null,8,It),t("line",{x1:_.value,y1:G,x2:_.value,y2:B-G,class:"percentile-line p90-line"},null,8,zt),P.value?(d(),p("line",{key:0,x1:R.value,y1:G,x2:R.value,y2:B-G,class:"zero-line"},null,8,Yt)):w("",!0)]),t("g",jt,[t("text",{x:V.value,y:B-5,class:"percentile-label"},"P10",8,Zt),t("text",{x:f.value,y:B-5,class:"percentile-label median-label"},"P50",8,Wt),t("text",{x:_.value,y:B-5,class:"percentile-label"},"P90",8,Xt)]),t("g",Kt,[t("text",{x:G,y:B-5,class:"axis-value start"},$(O(n.value)),9,Qt),t("text",{x:ge-G,y:B-5,class:"axis-value end"},$(O(u.value)),9,ea)])],8,Ut))]),l[0]||(l[0]=Je('<div class="chart-legend" data-v-60c6031a><div class="legend-item" data-v-60c6031a><span class="legend-color negative" data-v-60c6031a></span><span class="legend-text" data-v-60c6031a>Negative NPV</span></div><div class="legend-item" data-v-60c6031a><span class="legend-color positive" data-v-60c6031a></span><span class="legend-text" data-v-60c6031a>Positive NPV</span></div></div>',1))]))}},aa=oe(ta,[["__scopeId","data-v-60c6031a"]]),na={class:"distribution-card"},sa={class:"card-header"},ia={class:"label"},oa={class:"base-value"},la={key:0,class:"dist-selector"},ra={key:1,class:"dist-type-read"},ua={key:2,class:"params-area"},ca={key:0,class:"param-row"},da={class:"input-wrapper"},va={key:1,class:"param-grid"},ma={class:"param-col"},pa={class:"param-col"},ya={class:"param-col"},ha={key:2,class:"param-grid"},fa={class:"param-col"},ga={class:"param-col"},xa={key:3,class:"params-read"},ba={key:0},Ma={key:1},Ca={class:"dist-preview"},_a={width:"60",height:"20",viewBox:"0 0 60 20",class:"dist-icon"},$a={key:0,d:"M2,18 C15,18 20,2 30,2 C40,2 45,18 58,18",fill:"none",class:"line-path"},Pa={key:1,d:"M2,18 L30,2 L58,18",fill:"none",class:"line-path"},Ra={key:2,d:"M5,18 L5,5 L55,5 L55,18",fill:"none",class:"line-path"},Va={__name:"DistributionCard",props:{label:String,baseValue:Number,isCurrency:Boolean,suffix:String,config:Object,readOnly:Boolean},emits:["update"],setup(a,{emit:s}){const n=a,u=s,e=T({...n.config});se(()=>n.config,m=>{e.value={...m}},{deep:!0}),se(()=>e.value.type,(m,i)=>{m!==i&&(m==="triangular"&&e.value.min===void 0?(e.value.min=n.baseValue*.9,e.value.max=n.baseValue*1.1,e.value.mode=n.baseValue):m==="uniform"&&e.value.min===void 0&&(e.value.min=n.baseValue*.9,e.value.max=n.baseValue*1.1),r())});function r(){u("update",e.value)}function y(m){return n.isCurrency?new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(m):n.suffix?`${m}${n.suffix}`:m}return(m,i)=>(d(),p("div",na,[t("div",sa,[t("span",ia,$(a.label),1),t("span",oa,$(y(a.baseValue)),1)]),a.readOnly?(d(),p("div",ra,$(e.value.type),1)):(d(),p("div",la,[I(t("select",{"onUpdate:modelValue":i[0]||(i[0]=c=>e.value.type=c),onChange:r},[...i[7]||(i[7]=[t("option",{value:"normal"},"Normal",-1),t("option",{value:"lognormal",disabled:"",title:"Coming soon"},"Lognormal",-1),t("option",{value:"triangular"},"Triangular",-1),t("option",{value:"uniform"},"Flat (Uniform)",-1)])],544),[[He,e.value.type]])])),a.readOnly?(d(),p("div",xa,[e.value.type==="normal"?(d(),p("div",ba,"±"+$(e.value.variancePercent)+"%",1)):e.value.type==="uniform"?(d(),p("div",Ma,"Range: "+$(e.value.min)+" - "+$(e.value.max),1)):w("",!0)])):(d(),p("div",ua,[e.value.type==="normal"?(d(),p("div",ca,[i[9]||(i[9]=t("label",null,"Variance (±%)",-1)),t("div",da,[I(t("input",{type:"number","onUpdate:modelValue":i[1]||(i[1]=c=>e.value.variancePercent=c),onChange:r},null,544),[[Q,e.value.variancePercent,void 0,{number:!0}]]),i[8]||(i[8]=t("span",{class:"suffix"},"%",-1))])])):w("",!0),e.value.type==="triangular"?(d(),p("div",va,[t("div",ma,[i[10]||(i[10]=t("label",null,"Min",-1)),I(t("input",{type:"number","onUpdate:modelValue":i[2]||(i[2]=c=>e.value.min=c),onChange:r,class:"small-input"},null,544),[[Q,e.value.min,void 0,{number:!0}]])]),t("div",pa,[i[11]||(i[11]=t("label",null,"Max",-1)),I(t("input",{type:"number","onUpdate:modelValue":i[3]||(i[3]=c=>e.value.max=c),onChange:r,class:"small-input"},null,544),[[Q,e.value.max,void 0,{number:!0}]])]),t("div",ya,[i[12]||(i[12]=t("label",null,"Mode",-1)),I(t("input",{type:"number","onUpdate:modelValue":i[4]||(i[4]=c=>e.value.mode=c),onChange:r,class:"small-input"},null,544),[[Q,e.value.mode,void 0,{number:!0}]])])])):w("",!0),e.value.type==="uniform"?(d(),p("div",ha,[t("div",fa,[i[13]||(i[13]=t("label",null,"Min",-1)),I(t("input",{type:"number","onUpdate:modelValue":i[5]||(i[5]=c=>e.value.min=c),onChange:r,class:"small-input"},null,544),[[Q,e.value.min,void 0,{number:!0}]])]),t("div",ga,[i[14]||(i[14]=t("label",null,"Max",-1)),I(t("input",{type:"number","onUpdate:modelValue":i[6]||(i[6]=c=>e.value.max=c),onChange:r,class:"small-input"},null,544),[[Q,e.value.max,void 0,{number:!0}]])])])):w("",!0)])),t("div",Ca,[(d(),p("svg",_a,[e.value.type==="normal"?(d(),p("path",$a)):w("",!0),e.value.type==="triangular"?(d(),p("path",Pa)):w("",!0),e.value.type==="uniform"?(d(),p("path",Ra)):w("",!0)]))])]))}},xe=oe(Va,[["__scopeId","data-v-02d6c772"]]),ka={class:"correlation-modal"},Na={class:"modal-header"},wa={class:"modal-body"},Aa={key:0,class:"matrix-grid"},Fa={class:"grid-row-header"},Da=["value","onInput"],qa={key:1,class:"diagonal"},Ga={__name:"CorrelationModal",props:{matrix:Array},emits:["close","save"],setup(a,{emit:s}){const n=a,u=s,e=[{key:"rent",label:"Rent"},{key:"vacancy",label:"Vacancy"},{key:"interest",label:"Interest"},{key:"growth",label:"Growth"}],r=T([]);Ae(()=>{r.value=n.matrix.map(i=>[...i])});function y(i,c,V){let f=parseFloat(V);isNaN(f)&&(f=0),f>1&&(f=1),f<-1&&(f=-1),r.value[i][c]=f,r.value[c][i]=f}function m(){u("save",r.value)}return(i,c)=>(d(),Fe(Ie,{to:"body"},[t("div",{class:"modal-backdrop",onClick:c[1]||(c[1]=Te(V=>i.$emit("close"),["self"]))},[t("div",ka,[t("div",Na,[c[2]||(c[2]=t("h3",null,"Correlation Matrix",-1)),t("button",{class:"btn-close",onClick:c[0]||(c[0]=V=>i.$emit("close"))},"×")]),t("div",wa,[c[4]||(c[4]=t("p",{class:"description"},[ie(" Define relationships between variables (-1.0 to 1.0). "),t("br"),ie("Positive = Variables move together. Negative = Inverse relationship. ")],-1)),r.value.length===e.length?(d(),p("div",Aa,[c[3]||(c[3]=t("div",{class:"grid-header-cell"},null,-1)),(d(),p(Y,null,X(e,V=>t("div",{class:"grid-header-cell",key:V.key},$(V.label),1)),64)),(d(),p(Y,null,X(e,(V,f)=>(d(),p(Y,{key:f},[t("div",Fa,$(V.label),1),(d(),p(Y,null,X(e,(_,P)=>t("div",{key:`${f}-${P}`,class:"grid-cell"},[f!==P?(d(),p("input",{key:0,type:"number",step:"0.1",min:"-1",max:"1",value:r.value[f][P],onInput:R=>y(f,P,R.target.value),class:ne(["correlation-input",{positive:r.value[f][P]>0,negative:r.value[f][P]<0}])},null,42,Da)):(d(),p("span",qa,"1.0"))])),64))],64))),64))])):w("",!0)]),t("div",{class:"modal-actions"},[t("button",{class:"btn btn-primary",onClick:m},"Apply Correlations")])])])]))}},Oa=oe(Ga,[["__scopeId","data-v-a0473dea"]]),La={class:"property-risk-analyzer"},Sa={class:"analyzer-grid"},Ba={class:"inputs-column"},Ua={class:"input-group"},Ea={class:"financials-header"},Ja=["title"],Ha={class:"switch"},Ta={class:"input-row"},Ia={key:0,class:"input-wrapper"},za={key:1,class:"static-value"},Ya={class:"input-group"},ja={class:"group-header"},Za={key:1,class:"actions"},Wa=["disabled"],Xa={key:0,class:"spinner"},Ka={class:"results-column"},Qa={key:0,class:"empty-state"},en={key:1,class:"results-content"},tn={class:"metrics-row"},an={class:"metric"},nn={class:"label"},sn={class:"metric"},on={class:"value"},ln={class:"metric"},rn={class:"value negative"},un={class:"chart-section"},cn={class:"chart-section small"},dn={__name:"PropertyRiskAnalyzer",props:{initialData:{type:Object,required:!0},initialResults:{type:Object,default:null},detailedCashflow:{type:Object,default:null},autoRun:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},hideRunButton:{type:Boolean,default:!1}},emits:["update:inputs"],setup(a,{emit:s}){const n=a,u=s,e=T({propertyValue:0,estimatedGrossRent:0,outgoingsEstimate:0,vacancyRatePercent:5,vacancyVariancePercent:5,managementFeePercent:7,capitalGrowthPercent:3,capitalGrowthVariancePercent:2,discountRate:8,loanAmount:0,interestRatePercent:6.5,interestVariancePercent:1,rentVariancePercent:10,timeVarianceEarly:0,timeVarianceLate:3,holdingPeriodYears:10,stampDutyRate:0,legalCosts:0,buyersAgentFeeRate:0,capExReserve:0,includeAcquisitionCost:!1}),r=T({rent:{type:"normal",variancePercent:10},vacancy:{type:"normal",variancePercent:5},growth:{type:"normal",variancePercent:2},interest:{type:"normal",variancePercent:1}}),y=T([[1,-.7,0,.7],[-.7,1,.3,-.6],[0,.3,1,-.5],[.7,-.6,-.5,1]]),m=T(!1),i=T(null),c=T(!1),V=A(()=>{const o=e.value.propertyValue*(e.value.stampDutyRate/100),l=e.value.propertyValue*(e.value.buyersAgentFeeRate/100),b=o+l+e.value.legalCosts+e.value.capExReserve;return e.value.propertyValue+b-e.value.loanAmount});Ae(()=>{if(f(),n.initialResults){const o={...n.initialResults};typeof o.yearlyDCFJson=="string"&&(o.yearlyDCF=JSON.parse(o.yearlyDCFJson)),typeof o.npvHistogramJson=="string"&&(o.npvHistogram=JSON.parse(o.npvHistogramJson)),typeof o.irrHistogramJson=="string"&&(o.irrHistogram=JSON.parse(o.irrHistogramJson)),i.value=o}else n.autoRun&&R()}),se(()=>n.initialResults,o=>{if(o){const l={...o};typeof l.yearlyDCFJson=="string"&&(l.yearlyDCF=JSON.parse(l.yearlyDCFJson)),typeof l.npvHistogramJson=="string"&&(l.npvHistogram=JSON.parse(l.npvHistogramJson)),typeof l.irrHistogramJson=="string"&&(l.irrHistogram=JSON.parse(l.irrHistogramJson)),!l.probabilityCurve&&i.value?.probabilityCurve&&l.medianNPV===i.value.medianNPV&&(l.probabilityCurve=i.value.probabilityCurve),i.value=l,!l.probabilityCurve&&n.autoRun&&!c.value&&R()}},{deep:!0,immediate:!0}),se(()=>n.initialData,()=>{f()},{deep:!0}),se(e,o=>{n.autoRun&&R(),u("update:inputs",o)},{deep:!0});function f(){const o=n.initialData;if(e.value={...e.value,propertyValue:o.askingPrice||o.currentValue||0,estimatedGrossRent:o.estimatedGrossRent||o.annualRent||0,outgoingsEstimate:o.outgoingsEstimate||o.annualOutgoings||0,loanAmount:o.loanAmount||0,...o},o.askingPrice)e.value.askingPrice=o.askingPrice;else{if(o.distributionSettingsJson)try{const l=JSON.parse(o.distributionSettingsJson);r.value={...r.value,...l}}catch{}else r.value.rent.variancePercent=o.rentVariancePercent||10,r.value.vacancy.variancePercent=o.vacancyVariancePercent||5,r.value.growth.variancePercent=o.capitalGrowthVariancePercent||2,r.value.interest.variancePercent=o.interestVariancePercent||1;if(o.correlationMatrixJson)try{y.value=JSON.parse(o.correlationMatrixJson)}catch{}}}function _(o,l){r.value[o]=l,R()}function P(o){y.value=o,m.value=!1,R()}async function R(){c.value=!0,await new Promise(o=>setTimeout(o,50));try{const o={...e.value,distributions:r.value,correlationMatrix:y.value,detailedCashflows:n.detailedCashflow?.rows?.length?U(n.detailedCashflow):null},l=et(o,5e3,e.value.includeAcquisitionCost);i.value=l}catch(o){console.error(o)}finally{c.value=!1}}function U(o){if(!o||!o.rows)return null;const l=o.rows.find(v=>v.id==="netCashflow");if(!l)return null;const b=[];let h=0,g=0;return l.cells.forEach(v=>{v.isYearSummary?(b.push({netCashflow:v.value}),h=0,g=0):o.granularity==="years"?b.push({netCashflow:v.value}):(h+=v.value,g++,g===12&&(b.push({netCashflow:h}),h=0,g=0))}),b}function O(o){return qe(o)}return(o,l)=>(d(),p("div",La,[t("div",Sa,[t("div",Ba,[l[13]||(l[13]=t("h3",{class:"column-title"},"Simulation Assumptions",-1)),t("div",Ua,[t("div",Ea,[l[8]||(l[8]=t("h4",null,"Base Financials",-1)),t("div",{class:"toggle-wrapper",title:e.value.includeAcquisitionCost?"Switch to Intrinsic Value (Gross)":"Switch to Profit Analysis (Net)"},[t("span",{class:ne(["toggle-label",{active:!e.value.includeAcquisitionCost}])},"Gross",2),t("label",Ha,[I(t("input",{type:"checkbox","onUpdate:modelValue":l[0]||(l[0]=b=>e.value.includeAcquisitionCost=b),onChange:R},null,544),[[ze,e.value.includeAcquisitionCost]]),l[7]||(l[7]=t("span",{class:"slider round"},null,-1))]),t("span",{class:ne(["toggle-label",{active:e.value.includeAcquisitionCost}])},"Net",2)],8,Ja)]),t("div",Ta,[l[10]||(l[10]=t("label",null,"Property Value",-1)),a.readOnly?(d(),p("div",za,$(O(e.value.propertyValue)),1)):(d(),p("div",Ia,[l[9]||(l[9]=t("span",{class:"input-prefix"},"$",-1)),I(t("input",{type:"number","onUpdate:modelValue":l[1]||(l[1]=b=>e.value.propertyValue=b),onChange:R},null,544),[[Q,e.value.propertyValue,void 0,{number:!0}]])]))])]),t("div",Ya,[t("div",ja,[l[12]||(l[12]=t("h4",null,"Risk Parameters",-1)),a.readOnly?w("",!0):(d(),p("button",{key:0,class:"btn btn-sm btn-secondary icon-btn",onClick:l[2]||(l[2]=b=>m.value=!0)},[...l[11]||(l[11]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),t("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1),ie(" Correlation Matrix ",-1)])]))]),ae(xe,{label:"Gross Rent","base-value":e.value.estimatedGrossRent,"is-currency":!0,config:r.value.rent,onUpdate:l[3]||(l[3]=b=>_("rent",b)),"read-only":a.readOnly},null,8,["base-value","config","read-only"]),ae(xe,{label:"Vacancy Rate","base-value":e.value.vacancyRatePercent,suffix:"%",config:r.value.vacancy,onUpdate:l[4]||(l[4]=b=>_("vacancy",b)),"read-only":a.readOnly},null,8,["base-value","config","read-only"]),ae(xe,{label:"Capital Growth","base-value":e.value.capitalGrowthPercent,suffix:"%",config:r.value.growth,onUpdate:l[5]||(l[5]=b=>_("growth",b)),"read-only":a.readOnly},null,8,["base-value","config","read-only"])]),m.value?(d(),Fe(Oa,{key:0,matrix:y.value,onClose:l[6]||(l[6]=b=>m.value=!1),onSave:P},null,8,["matrix"])):w("",!0),!a.readOnly&&!a.hideRunButton?(d(),p("div",Za,[t("button",{class:"btn btn-primary full-width",onClick:R,disabled:c.value},[c.value?(d(),p("span",Xa)):w("",!0),ie(" "+$(c.value?"Simulating...":"Run Analysis"),1)],8,Wa)])):w("",!0)]),t("div",Ka,[i.value?(d(),p("div",en,[t("div",tn,[t("div",an,[t("span",nn,"Median "+$(e.value.includeAcquisitionCost?"Net Profit":"Value"),1),t("span",{class:ne(["value",i.value.medianNPV>=0?"positive":"negative"])},$(O(i.value.medianNPV)),3)]),t("div",sn,[l[15]||(l[15]=t("span",{class:"label"},"Median IRR",-1)),t("span",on,$(i.value.medianIRR)+"%",1)]),t("div",ln,[l[16]||(l[16]=t("span",{class:"label"},"Value at Risk (5%)",-1)),t("span",rn,$(O(i.value.p10NPV)),1)])]),t("div",un,[ae(Ot,{"probability-curve":i.value.probabilityCurve,"total-acquisition-cost":V.value,"is-net-mode":e.value.includeAcquisitionCost},null,8,["probability-curve","total-acquisition-cost","is-net-mode"])]),t("div",cn,[ae(aa,{histogram:i.value.npvHistogram,p10:i.value.p10NPV,median:i.value.medianNPV,p90:i.value.p90NPV,title:e.value.includeAcquisitionCost?"Net Profit Distribution ($)":"Intrinsic Value Distribution ($)"},null,8,["histogram","p10","median","p90","title"])])])):(d(),p("div",Qa,[...l[14]||(l[14]=[t("p",null,"Enter assumptions and run simulation to view risk analysis.",-1)])]))])])]))}},pn=oe(dn,[["__scopeId","data-v-8c4ecd45"]]);export{pn as P,be as c,qe as f,et as r};
