import{_ as we,r as k,H as Ie,k as W,C as Ve,c as a,o as l,a as e,d as R,n as E,F as j,q as le,t as g,g as L,m as X,D as Le,s as He,x as q,z as K,I as Me,i as Be,B as te,v as ze,e as ue,b as _e,G as je,w as Re,T as Ae,l as We,h as Ke,f as Qe,y as Te}from"./index-D_ssXn_P.js";import{c as Xe,P as Ze,f as Ue,r as et}from"./PropertyRiskAnalyzer-BZzHeCST.js";import{M as Ee}from"./MoneyBoxLoader-PyUYAG7W.js";const tt={class:"cashflow-spreadsheet"},st={class:"spreadsheet-toolbar"},nt={class:"toolbar-left"},lt={class:"granularity-toggle"},at={class:"spreadsheet-table"},it={class:"header-row"},ot={key:0,class:"category-row"},rt=["colspan"],ut=["onClick"],dt={class:"sticky-col row-label"},ct=["onClick"],vt=["onClick"],pt={class:"cell-value"},mt={key:0,class:"lock-indicator",title:"Monthly values overridden"},yt={class:"sticky-col row-label child-label"},ft=["onClick"],gt=["onClick"],ht=["onClick","onContextmenu"],bt=["value","onBlur","onKeydown"],kt={class:"cell-value"},wt={key:0,class:"override-indicator",title:"Manual override"},Ct={key:3,class:"add-row-row"},$t=["colspan"],xt=["onClick"],Rt={class:"sticky-col row-label"},_t={key:0,class:"row-indent"},Dt=["onClick"],St=["onClick","onContextmenu"],Pt=["value","onBlur","onKeydown"],Vt={class:"cell-value"},Mt={key:0,class:"override-indicator",title:"Manual override"},At={class:"add-line-modal card"},Ot={class:"modal-header"},It={class:"form-group"},Lt={class:"form-row"},Tt={class:"form-group"},Bt={class:"form-group"},Ut={class:"modal-actions"},Et={class:"variance-modal card"},Ft={class:"modal-header"},Nt={class:"modal-body"},Gt={class:"variance-context"},Yt={class:"variance-input-group"},qt={class:"variance-input-group time-variance"},Jt={class:"time-variance-row"},Ht={class:"time-input"},zt={class:"time-input"},jt={class:"time-variance-hint"},Wt={class:"modal-actions"},Kt={class:"confirmation-modal card"},Qt={class:"modal-header"},Xt={class:"modal-actions"},Zt={__name:"CashflowSpreadsheet",props:{deal:{type:Object,required:!0},holdingPeriod:{type:Number,default:10},initialOverridesJson:{type:String,default:null}},emits:["apply-changes","update:overrides"],setup(f,{emit:Z}){const V=f,G=Z,P=k("years"),$=k(["income","expenses","financing","summary"]),u=k(["outgoings"]),A=k(null),H=k(null),M=k([]),O=k(!1),se=k(""),T=k({label:"",amount:0,growthRate:3}),d=Ie({}),m=Ie({visible:!1,x:0,y:0,rowId:"",cellIndex:-1}),w=k(!1),I=k({label:"",context:"",rowId:"",cellIndex:-1}),F=k(10),J=k(0),ee=k(3),D=k(!1),p=W(()=>P.value==="months"),c=W(()=>{const i=[];if(P.value==="years")for(let s=1;s<=V.holdingPeriod;s++)i.push({key:`Y${s}`,label:`Y${s}`,year:s,isYearStart:!0,isYearSummary:!1,colType:"year"});else for(let s=1;s<=V.holdingPeriod;s++){for(let n=1;n<=12;n++)i.push({key:`Y${s}M${n}`,label:n===1?"M1":`M${n}`,year:s,month:n,isYearStart:n===1,isYearSummary:!1,colType:"month"});i.push({key:`Y${s}Total`,label:`Y${s}`,year:s,isYearStart:!1,isYearSummary:!0,colType:"yearTotal"})}return i}),S=(i,s,n=.025)=>i*Math.pow(1+n,s),Q=i=>{if(!p.value)return i*12;if(c.value[i]?.isYearSummary)return-1;let n=0;for(let v=0;v<i;v++)c.value[v].isYearSummary||n++;return n},pe=i=>{const s=(i-1)*12;return Array.from({length:12},(n,v)=>s+v)},fe=(i,s,n={})=>{const{growth:v=0,invert:y=!1}=n,_=[];if(P.value==="years")for(let U=0;U<V.holdingPeriod;U++){let N=0;for(let ne=0;ne<12;ne++){const x=U*12+ne,ce=`${s}-${x}`;if(d[ce])N+=d[ce].value;else{let me=S(i/12,U,v);y&&(me=-me),N+=me}}_.push({value:N,isOverride:!1})}else for(let U=1;U<=V.holdingPeriod;U++){let N=0;for(let x=1;x<=12;x++){const ce=(U-1)*12+(x-1),me=`${s}-${ce}`;if(d[me]){const ve=d[me].value;_.push({value:ve,isOverride:!0}),N+=ve}else{let ve=S(i/12,U-1,v);y&&(ve=-ve),_.push({value:ve,isOverride:!1}),N+=ve}}const ne=pe(U).some(x=>d[`${s}-${x}`]);_.push({value:N,isOverride:!1,isYearSummary:!0,hasMonthlyOverrides:ne})}return _},Y=W(()=>{const i=[],s=V.deal;i.push({id:"income",label:"Income",isCategory:!0,category:"income"}),i.push({id:"grossRent",label:"Gross Rent",category:"income",parentCategory:"income",isEditable:!0,baseValue:s.estimatedGrossRent,growth:(s.rentalGrowthPercent!==void 0?s.rentalGrowthPercent:2.5)/100});const n=s.estimatedGrossRent*(s.vacancyRatePercent/100);i.push({id:"vacancyLoss",label:"Less: Vacancy",category:"income",parentCategory:"income",isEditable:!0,baseValue:n,growth:(s.vacancyGrowthPercent??0)/100,invert:!0});const v=s.estimatedGrossRent*(1-s.vacancyRatePercent/100);i.push({id:"netRentalIncome",label:"Net Rental Income",category:"income",parentCategory:"income",isEditable:!1,componentIds:["grossRent","vacancyLoss"]}),i.push({id:"expenses",label:"Operating Expenses",isCategory:!0,category:"expenses"});const y=(s.outgoingsGrowthPercent??0)/100,_=[{id:"councilRates",label:"Council Rates",baseValue:s.outgoingsEstimate*.35,growth:y},{id:"waterRates",label:"Water Rates",baseValue:s.outgoingsEstimate*.1,growth:y},{id:"insurance",label:"Insurance",baseValue:s.outgoingsEstimate*.2,growth:y},{id:"maintenance",label:"Repairs & Maintenance",baseValue:s.outgoingsEstimate*.25,growth:y},{id:"other",label:"Other",baseValue:s.outgoingsEstimate*.1,growth:y},...M.value.filter(x=>x.parentId==="outgoings").map(x=>({id:x.id,label:x.label,baseValue:x.amount,growth:x.growthRate/100,isCustom:!0}))];i.push({id:"outgoings",label:"Outgoings",category:"expenses",parentCategory:"expenses",isExpandable:!0,childIds:_.map(x=>x.id)}),_.forEach(x=>{i.push({id:x.id,label:x.label,category:"expenses",parentCategory:"expenses",parentId:"outgoings",isChild:!0,isDeletable:x.isCustom,baseValue:x.baseValue,growth:x.growth,invert:!0})}),i.push({id:"addOutgoingsItem",isAddButton:!0,parentId:"outgoings",parentCategory:"expenses"});const U=v*(s.managementFeePercent/100);i.push({id:"managementFee",label:"Management Fee",category:"expenses",parentCategory:"expenses",isEditable:!0,baseValue:U,growth:(s.managementGrowthPercent??0)/100,invert:!0}),s.outgoingsEstimate,i.push({id:"noi",label:"Net Operating Income",category:"expenses",parentCategory:"expenses",isEditable:!1,componentIds:["netRentalIncome","outgoings","managementFee"]}),i.push({id:"financing",label:"Financing",isCategory:!0,category:"financing"});const N=s.loanAmount*(s.interestRatePercent/100);i.push({id:"debtService",label:"Debt Service",category:"financing",parentCategory:"financing",isEditable:!0,baseValue:N,invert:!0}),i.push({id:"netCashflow",label:"Net Cashflow",category:"financing",parentCategory:"financing",isEditable:!1,componentIds:["noi","debtService"]}),i.push({id:"summary",label:"Summary",isCategory:!0,category:"summary"});const ne=s.askingPrice*Math.pow(1+s.capitalGrowthPercent/100,V.holdingPeriod);return i.push({id:"terminalValue",label:"Terminal Value",category:"summary",parentCategory:"summary",isEditable:!0,isTerminalValue:!0,terminalValue:ne}),i}),z=new Map;Ve([()=>V.deal,()=>P.value,d,M],()=>{z.clear()},{deep:!0});function ae(i){if(z.has(i.id))return z.get(i.id);let s;return i.isExpandable||i.componentIds?s=Ce(i):i.isTerminalValue?s=c.value.map((n,v)=>({value:v===c.value.length-1?i.terminalValue:0,isOverride:!1})):s=fe(i.baseValue,i.id,{growth:i.growth||0,invert:i.invert}),z.set(i.id,s),s}function Ce(i){let s=[];return i.componentIds?s=Y.value.filter(n=>i.componentIds.includes(n.id)):i.isExpandable&&(s=Y.value.filter(n=>n.parentId===i.id&&n.isChild)),c.value.map((n,v)=>{let y=0;return s.forEach(_=>{const U=ae(_);y+=U[v]?.value||0}),{value:y,isOverride:!1}})}function ge(i){const s=$.value.indexOf(i);s>-1?$.value.splice(s,1):$.value.push(i)}function $e(i){const s=u.value.indexOf(i);s>-1?u.value.splice(s,1):u.value.push(i)}function h(i){return i.isCategory?!0:$.value.includes(i.parentCategory)}function o(i){return i.isExpandable?Y.value.filter(n=>n.parentId===i.id&&n.isChild).some(n=>Object.keys(d).some(v=>v.startsWith(`${n.id}-`)&&d[v]?.isOverride)):!1}function B(i,s){if(!i.isExpandable)return!1;const n=c.value[s],v=Y.value.filter(_=>_.parentId===i.id&&_.isChild);if(n?.isYearSummary){const _=pe(n.year);return v.some(U=>_.some(N=>d[`${U.id}-${N}`]?.isOverride))}const y=Q(s);return y<0?!1:v.some(_=>d[`${_.id}-${y}`]?.isOverride)}function C(i){return Object.keys(d).some(s=>s.startsWith(`${i.id}-`)&&d[s]?.isOverride)}function de(i){Object.keys(d).forEach(s=>{s.startsWith(`${i.id}-`)&&delete d[s]})}function De(i){Y.value.filter(n=>n.parentId===i.id&&n.isChild).forEach(n=>{Object.keys(d).forEach(v=>{v.startsWith(`${n.id}-`)&&delete d[v]})})}function ye(i,s){const n=c.value[s];(n?.isYearSummary||!p.value&&n?.colType==="year")&&B(i,s)||(A.value={rowId:i.id,index:s},Me(()=>{const v=document.querySelector(".cell-input");v&&(v.focus(),v.select())}))}function he(i,s,n){(i.key==="ArrowRight"||i.key==="ArrowLeft"||i.key==="ArrowUp"||i.key==="ArrowDown")&&(i.key==="ArrowRight"?(ie(i,s,n),be(s,n,1,0)):i.key==="ArrowLeft"?(ie(i,s,n),be(s,n,-1,0)):i.key==="ArrowUp"?(ie(i,s,n),be(s,n,0,-1)):i.key==="ArrowDown"&&(ie(i,s,n),be(s,n,0,1)))}function be(i,s,n,v){const y=Y.value.filter(x=>(x.isEditable||x.isChild)&&h(x)&&!x.isCategory&&!x.isAddButton);let U=y.findIndex(x=>x.id===i.id)+v,N=s+n;U<0&&(U=0),U>=y.length&&(U=y.length-1),N<0&&(N=0),N>=c.value.length&&(N=c.value.length-1);const ne=y[U];Me(()=>{ye(ne,N)})}function ie(i,s,n){const v=parseFloat(i.target.value)||0,y=s.category==="expenses"||s.category==="financing",_=c.value[n];if(_?.isYearSummary||!p.value&&_?.colType==="year"){const ne=_.year,x=pe(ne),ce=v/12,me=y?-Math.abs(ce):Math.abs(ce);x.forEach(ve=>{const Je=`${s.id}-${ve}`;d[Je]={value:me,isOverride:!0}}),A.value=null,xe();return}const U=Q(n);if(U<0){A.value=null;return}const N=`${s.id}-${U}`;d[N]={value:y?-Math.abs(v):v,isOverride:!0},A.value=null,xe()}function b(i,s,n){c.value[n]?.isYearSummary||(m.visible=!0,m.x=i.clientX,m.y=i.clientY,m.rowId=s.id,m.cellIndex=n)}function t(){m.visible=!1}function r(){const i=Q(m.cellIndex);if(i>=0){const s=`${m.rowId}-${i}`;delete d[s]}else if(c.value[m.cellIndex]?.isYearSummary){const s=c.value[m.cellIndex].year;pe(s).forEach(v=>{const y=`${m.rowId}-${v}`;delete d[y]})}t(),xe()}function oe(i){const{rowId:s,cellIndex:n}=m,v=Q(n);if(v<0)return t();const y=Y.value.find(x=>x.id===s);if(!y)return t();const U=ae(y)[n]?.value||0,N=[],ne=V.holdingPeriod*12;if(i==="right")for(let x=v+1;x<ne;x++)N.push(x);else for(let x=0;x<v;x++)N.push(x);N.forEach(x=>{const ce=`${s}-${x}`;d[ce]={value:U,isOverride:!0}}),t(),xe()}function re(){const i=Y.value.find(s=>s.id===m.rowId);I.value={label:i?.label||"",context:c.value[m.cellIndex]?.label||"",rowId:m.rowId,cellIndex:m.cellIndex},F.value=10,J.value=V.deal.timeVarianceEarlyMonths||0,ee.value=V.deal.timeVarianceLateMonths||3,w.value=!0,t()}function ke(){const i=Q(I.value.cellIndex);if(i>=0){const s=`${I.value.rowId}-${i}`;d[s]&&(d[s].variance=F.value)}G("apply-changes",{...Oe(),timeVariance:{early:J.value,late:ee.value}}),w.value=!1}function Fe(i){se.value=i,T.value={label:"",amount:0,growthRate:3},O.value=!0}function Ne(){M.value.push({id:`custom-${Date.now()}`,parentId:se.value,label:T.value.label,amount:T.value.amount,growthRate:T.value.growthRate||3}),O.value=!1}function Ge(i){const s=M.value.findIndex(n=>n.id===i);s>-1&&(M.value.splice(s,1),Object.keys(d).forEach(n=>{n.startsWith(`${i}-`)&&delete d[n]}))}function Se(i){if(i===0)return"-";const s=Math.abs(i),n=new Intl.NumberFormat("en-AU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(s);return i<0?`(${n})`:n}const xe=()=>{G("apply-changes",Oe())};function Oe(){return{rows:Y.value.map(i=>({id:i.id,cells:ae(i)})),granularity:P.value,timeVariance:{early:J.value,late:ee.value}}}Ve(()=>V.initialOverridesJson,i=>{if(i)try{const s=JSON.parse(i);Object.keys(d).forEach(n=>delete d[n]),Object.assign(d,s)}catch(s){console.error("Failed to parse overrides JSON",s)}},{immediate:!0});let Pe=null;Ve(d,i=>{Pe&&clearTimeout(Pe),Pe=setTimeout(()=>{G("update:overrides",JSON.stringify(i))},1e3)},{deep:!0});function Ye(){D.value=!0}function qe(){Object.keys(d).forEach(i=>delete d[i]),xe(),D.value=!1}return(i,s)=>(l(),a("div",tt,[e("div",st,[e("div",nt,[s[22]||(s[22]=e("h3",{class:"spreadsheet-title"},"Cashflow Model",-1)),e("div",lt,[e("button",{class:E(["toggle-btn",{active:P.value==="years"}]),onClick:s[0]||(s[0]=n=>P.value="years")},"Years",2),e("button",{class:E(["toggle-btn",{active:P.value==="months"}]),onClick:s[1]||(s[1]=n=>P.value="months")},"Months",2)])]),e("div",{class:"toolbar-right"},[e("button",{class:"btn btn-secondary btn-sm",onClick:Ye,title:"Clear all manual locks"}," Unlock All ")])]),e("div",{class:"spreadsheet-container",ref:"spreadsheetContainer",onContextmenu:s[2]||(s[2]=X(()=>{},["prevent"]))},[e("table",at,[e("thead",null,[e("tr",it,[s[23]||(s[23]=e("th",{class:"sticky-col row-label-header"},"Parameter",-1)),(l(!0),a(j,null,le(c.value,n=>(l(),a("th",{key:n.key,class:E(["period-header",{"year-start":n.isYearStart,"year-summary":n.isYearSummary}])},g(n.label),3))),128))])]),e("tbody",null,[(l(!0),a(j,null,le(Y.value,n=>(l(),a(j,{key:n.id},[n.isCategory?(l(),a("tr",ot,[e("td",{colspan:c.value.length+1,class:"category-cell"},[e("button",{class:"expand-btn",onClick:v=>ge(n.id)},[(l(),a("svg",{class:E({rotated:!$.value.includes(n.id)}),width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...s[24]||(s[24]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,ut),L(" "+g(n.label),1)],8,rt)])):n.isExpandable&&h(n)?(l(),a("tr",{key:1,class:E(["data-row expandable-row",{"has-overrides":o(n),expanded:u.value.includes(n.id)}])},[e("td",dt,[e("button",{class:"expand-btn",onClick:v=>$e(n.id)},[(l(),a("svg",{class:E({rotated:!u.value.includes(n.id)}),width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...s[25]||(s[25]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,ct),L(" "+g(n.label)+" ",1),o(n)?(l(),a("span",{key:0,class:"locked-badge",onClick:v=>De(n),title:"Child values overridden. Click to unlock and reset."},[...s[26]||(s[26]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])],8,vt)):R("",!0)]),(l(!0),a(j,null,le(ae(n),(v,y)=>(l(),a("td",{key:y,class:E(["value-cell parent-cell calculation-cell",{locked:B(n,y),"year-summary":c.value[y]?.isYearSummary,negative:v.value<0}])},[e("span",pt,g(Se(v.value)),1),B(n,y)?(l(),a("span",mt,[...s[27]||(s[27]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):R("",!0)],2))),128))],2)):n.isChild&&u.value.includes(n.parentId)?(l(),a("tr",{key:2,class:E(["data-row child-row",{"has-override":C(n)}])},[e("td",yt,[s[29]||(s[29]=e("span",{class:"child-indent"},null,-1)),L(" "+g(n.label)+" ",1),C(n)?(l(),a("span",{key:0,class:"locked-badge",onClick:v=>de(n),title:"Row contains manual overrides. Click to reset."},[...s[28]||(s[28]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])],8,ft)):R("",!0),n.isDeletable?(l(),a("button",{key:1,class:"delete-row-btn",onClick:v=>Ge(n.id),title:"Remove"},"×",8,gt)):R("",!0)]),(l(!0),a(j,null,le(ae(n),(v,y)=>(l(),a("td",{key:y,class:E(["value-cell",{editable:!c.value[y]?.isYearSummary,"calculation-cell":c.value[y]?.isYearSummary,"year-summary":c.value[y]?.isYearSummary,negative:v.value<0,"has-override":v.isOverride}]),onClick:_=>!c.value[y]?.isYearSummary&&ye(n,y),onContextmenu:X(_=>!c.value[y]?.isYearSummary&&b(_,n,y),["prevent"])},[A.value?.rowId===n.id&&A.value?.index===y?(l(),a("input",{key:0,ref_for:!0,ref_key:"editInput",ref:H,type:"number",value:Math.abs(v.value),onBlur:_=>ie(_,n,y),onKeydown:[Le(_=>ie(_,n,y),["enter"]),_=>he(_,n,y)],class:"cell-input"},null,40,bt)):(l(),a(j,{key:1},[e("span",kt,g(Se(v.value)),1),v.isOverride?(l(),a("span",wt,"●")):R("",!0)],64))],42,ht))),128))],2)):n.isAddButton&&u.value.includes(n.parentId)?(l(),a("tr",Ct,[e("td",{colspan:c.value.length+1,class:"add-row-cell"},[e("button",{class:"add-row-btn",onClick:v=>Fe(n.parentId)},[...s[30]||(s[30]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),L(" Add Line Item ",-1)])],8,xt)],8,$t)])):!n.isChild&&!n.isAddButton&&h(n)?(l(),a("tr",{key:4,class:E(["data-row",{"derived-row":!n.isEditable,"summary-row":n.category==="summary"}])},[e("td",Rt,[n.indent?(l(),a("span",_t,g("  ".repeat(n.indent)),1)):R("",!0),L(" "+g(n.label)+" ",1),C(n)?(l(),a("span",{key:1,class:"locked-badge",onClick:v=>de(n),title:"Row contains manual overrides. Click to reset."},[...s[31]||(s[31]=[e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])],8,Dt)):R("",!0)]),(l(!0),a(j,null,le(ae(n),(v,y)=>(l(),a("td",{key:y,class:E(["value-cell",{editable:n.isEditable&&!c.value[y]?.isYearSummary,"calculation-cell":!n.isEditable||c.value[y]?.isYearSummary,"year-summary":c.value[y]?.isYearSummary,negative:v.value<0,"has-override":v.isOverride}]),onClick:_=>n.isEditable&&!c.value[y]?.isYearSummary&&ye(n,y),onContextmenu:X(_=>n.isEditable&&!c.value[y]?.isYearSummary&&b(_,n,y),["prevent"])},[A.value?.rowId===n.id&&A.value?.index===y?(l(),a("input",{key:0,ref_for:!0,ref_key:"editInput",ref:H,type:"number",value:Math.abs(v.value),onBlur:_=>ie(_,n,y),onKeydown:[Le(_=>ie(_,n,y),["enter"]),_=>he(_,n,y)],class:"cell-input"},null,40,Pt)):(l(),a(j,{key:1},[e("span",Vt,g(Se(v.value)),1),v.isOverride?(l(),a("span",Mt,"●")):R("",!0)],64))],42,St))),128))],2)):R("",!0)],64))),128))])])],544),m.visible?(l(),a("div",{key:0,class:"context-menu",style:He({top:m.y+"px",left:m.x+"px"}),onClick:s[5]||(s[5]=X(()=>{},["stop"]))},[e("button",{class:"context-menu-item",onClick:r},[...s[32]||(s[32]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"1 4 1 10 7 10"}),e("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),L(" Reset to Calculated ",-1)])]),e("button",{class:"context-menu-item",onClick:s[3]||(s[3]=n=>oe("left"))},[...s[33]||(s[33]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"15 18 9 12 15 6"})],-1),L(" Copy Left ",-1)])]),e("button",{class:"context-menu-item",onClick:s[4]||(s[4]=n=>oe("right"))},[...s[34]||(s[34]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9 18 15 12 9 6"})],-1),L(" Copy Right ",-1)])]),e("button",{class:"context-menu-item",onClick:re},[...s[35]||(s[35]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 20V10"}),e("path",{d:"M18 20V4"}),e("path",{d:"M6 20v-4"})],-1),L(" Set Variance (±%) ",-1)])])],4)):R("",!0),m.visible?(l(),a("div",{key:1,class:"context-menu-backdrop",onClick:t})):R("",!0),O.value?(l(),a("div",{key:2,class:"modal-backdrop",onClick:s[11]||(s[11]=X(n=>O.value=!1,["self"]))},[e("div",At,[e("div",Ot,[s[36]||(s[36]=e("h4",null,"Add Custom Line Item",-1)),e("button",{class:"btn-close",onClick:s[6]||(s[6]=n=>O.value=!1)},"×")]),e("form",{onSubmit:X(Ne,["prevent"]),class:"modal-body"},[e("div",It,[s[37]||(s[37]=e("label",null,"Label *",-1)),q(e("input",{"onUpdate:modelValue":s[7]||(s[7]=n=>T.value.label=n),type:"text",required:"",placeholder:"e.g., Security System"},null,512),[[K,T.value.label]])]),e("div",Lt,[e("div",Tt,[s[38]||(s[38]=e("label",null,"Annual Amount *",-1)),q(e("input",{"onUpdate:modelValue":s[8]||(s[8]=n=>T.value.amount=n),type:"number",min:"0",required:"",placeholder:"5000"},null,512),[[K,T.value.amount,void 0,{number:!0}]])]),e("div",Bt,[s[39]||(s[39]=e("label",null,"Growth Rate (%)",-1)),q(e("input",{"onUpdate:modelValue":s[9]||(s[9]=n=>T.value.growthRate=n),type:"number",step:"0.5",placeholder:"3.0"},null,512),[[K,T.value.growthRate,void 0,{number:!0}]])])]),e("div",Ut,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[10]||(s[10]=n=>O.value=!1)},"Cancel"),s[40]||(s[40]=e("button",{type:"submit",class:"btn btn-primary"},"Add Line Item",-1))])],32)])])):R("",!0),w.value?(l(),a("div",{key:3,class:"modal-backdrop",onClick:s[18]||(s[18]=X(n=>w.value=!1,["self"]))},[e("div",Et,[e("div",Ft,[s[41]||(s[41]=e("h4",null,"Set Uncertainty Range",-1)),e("button",{class:"btn-close",onClick:s[12]||(s[12]=n=>w.value=!1)},"×")]),e("div",Nt,[e("p",Gt,g(I.value.label)+" - "+g(I.value.context),1),e("div",Yt,[s[42]||(s[42]=e("label",null,[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 20V10"}),e("path",{d:"M18 20V4"}),e("path",{d:"M6 20v-4"})]),L(" Value Variance (±%) ")],-1)),q(e("input",{type:"number","onUpdate:modelValue":s[13]||(s[13]=n=>F.value=n),min:"0",max:"100",step:"1",class:"variance-input"},null,512),[[K,F.value,void 0,{number:!0}]]),q(e("input",{type:"range","onUpdate:modelValue":s[14]||(s[14]=n=>F.value=n),min:"0",max:"50",step:"1",class:"variance-slider"},null,512),[[K,F.value,void 0,{number:!0}]])]),e("div",qt,[s[48]||(s[48]=e("label",null,[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})]),L(" Timing Variance (months) ")],-1)),e("div",Jt,[e("div",Ht,[s[43]||(s[43]=e("span",{class:"time-label p10-label"},"P10 (Early)",-1)),q(e("input",{type:"number","onUpdate:modelValue":s[15]||(s[15]=n=>J.value=n),min:"0",max:"24",class:"variance-input small"},null,512),[[K,J.value,void 0,{number:!0}]]),s[44]||(s[44]=e("span",{class:"time-unit"},"mo",-1))]),s[47]||(s[47]=e("span",{class:"time-divider"},"↔",-1)),e("div",zt,[s[45]||(s[45]=e("span",{class:"time-label p90-label"},"P90 (Late)",-1)),q(e("input",{type:"number","onUpdate:modelValue":s[16]||(s[16]=n=>ee.value=n),min:"0",max:"24",class:"variance-input small"},null,512),[[K,ee.value,void 0,{number:!0}]]),s[46]||(s[46]=e("span",{class:"time-unit"},"mo",-1))])]),e("div",jt," Cashflow timing: Receive "+g(J.value)+"mo early (P10) to "+g(ee.value)+"mo late (P90) ",1)])]),e("div",Wt,[e("button",{class:"btn btn-secondary",onClick:s[17]||(s[17]=n=>w.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:ke},"Apply")])])])):R("",!0),D.value?(l(),a("div",{key:4,class:"modal-backdrop",onClick:s[21]||(s[21]=X(n=>D.value=!1,["self"]))},[e("div",Kt,[e("div",Qt,[s[49]||(s[49]=e("h4",null,"Confirm Unlock All",-1)),e("button",{class:"btn-close",onClick:s[19]||(s[19]=n=>D.value=!1)},"×")]),s[50]||(s[50]=e("div",{class:"modal-body"},[e("p",null,"Are you sure you want to remove all manual overrides? This action cannot be undone and all cells will revert to their calculated values.")],-1)),e("div",Xt,[e("button",{class:"btn btn-secondary",onClick:s[20]||(s[20]=n=>D.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",onClick:qe},"Unlock & Reset")])])])):R("",!0)]))}},es=we(Zt,[["__scopeId","data-v-c5a5a775"]]),ts={class:"lifecycle-stepper"},ss={class:"stepper-track"},ns=["onClick"],ls={class:"step-indicator"},as={class:"step-circle"},is={key:0,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},os={key:1},rs={key:0,class:"step-line"},us={class:"step-label"},ds={class:"step-name"},cs={key:0,class:"step-status"},vs={key:0,class:"lifecycle-actions"},ps={class:"action-left"},ms={key:0,class:"action-right"},ys={key:0,class:"revert-dropdown-wrapper"},fs={key:0,class:"revert-menu glass-card"},gs=["onClick"],hs={key:1,class:"forward-action"},bs={class:"next-label"},ks={__name:"LifecycleStepper",props:{currentStatus:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["request-transition","request-revert","toggle-history"],setup(f,{emit:Z}){const V={mounted(m,w){m._clickOutsideHandler=I=>{m===I.target||m.contains(I.target)||w.value(I)},document.body.addEventListener("click",m._clickOutsideHandler)},unmounted(m){document.body.removeEventListener("click",m._clickOutsideHandler)}},G=f,P=Z,$=k(!1),u=[{key:"Draft",label:"Draft"},{key:"Under Review",label:"Under Review"},{key:"Proceed to Acquire",label:"Proceed"},{key:"Offer Made",label:"Offer Made"},{key:"Under Due Diligence",label:"Due Diligence"},{key:"Waiting Settlement",label:"Settlement"},{key:"Acquired",label:"Acquired"}],A=W(()=>{const m=u.findIndex(w=>w.key===G.currentStatus);return m===-1?0:m});W(()=>u[A.value]);const H=W(()=>u.slice(0,A.value).reverse()),M=W(()=>A.value===u.length-1),O=W(()=>{if(M.value)return null;const m=u[A.value+1];let w="Advance";return m.key==="Proceed to Acquire"&&(w="Proceed"),m.key==="Offer Made"&&(w="Record Offer"),m.key==="Under Due Diligence"&&(w="Start DD"),m.key==="Acquired"&&(w="Settled"),{label:m.label,key:m.key,buttonText:w}});function se(m){}function T(m){$.value=!1,P("request-revert",m)}function d(){O.value&&P("request-transition",O.value.key)}return(m,w)=>(l(),a("div",ts,[e("div",ss,[(l(),a(j,null,le(u,(I,F)=>e("div",{key:I.key,class:E(["step-item",{active:A.value===F,completed:A.value>F,future:A.value<F}]),onClick:J=>void 0},[e("div",ls,[e("div",as,[A.value>F?(l(),a("svg",is,[...w[2]||(w[2]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(l(),a("span",os,g(F+1),1))]),F<u.length-1?(l(),a("div",rs)):R("",!0)]),e("div",us,[e("span",ds,g(I.label),1),A.value===F?(l(),a("span",cs,"Current Stage")):R("",!0)])],10,ns)),64))]),f.loading?R("",!0):(l(),a("div",vs,[e("div",ps,[e("button",{class:"btn-text-icon",onClick:w[0]||(w[0]=I=>m.$emit("toggle-history"))},[...w[3]||(w[3]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1),L(" History ",-1)])])]),M.value?R("",!0):(l(),a("div",ms,[A.value>0?(l(),a("div",ys,[e("button",{class:"btn-text-danger",onClick:w[1]||(w[1]=I=>$.value=!$.value)}," Revert Status "),$.value?q((l(),a("div",fs,[w[4]||(w[4]=e("div",{class:"menu-label"},"Revert to:",-1)),(l(!0),a(j,null,le(H.value,(I,F)=>(l(),a("button",{key:I.key,class:"menu-item",onClick:J=>T(I.key)},g(I.label),9,gs))),128))])),[[V,()=>$.value=!1]]):R("",!0)])):R("",!0),O.value?(l(),a("div",hs,[e("span",bs,"Next: "+g(O.value.label),1),e("button",{class:"btn btn-primary btn-sm",onClick:d},[L(g(O.value.buttonText)+" ",1),w[5]||(w[5]=e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9 18 15 12 9 6"})],-1))])])):R("",!0)]))]))]))}},ws=we(ks,[["__scopeId","data-v-f9aedc5c"]]),Cs={class:"deal-documents"},$s={class:"docs-header flex-between mb-lg"},xs={class:"flex gap-md items-center"},Rs=["disabled"],_s={key:0,class:"spinner-sm mr-sm"},Ds={key:1},Ss={key:0,class:"text-sm text-muted"},Ps={class:"search-box"},Vs={key:0,class:"flex-center p-xl"},Ms={key:1,class:"empty-state card flex-center flex-col p-xl"},As={key:2,class:"documents-grid"},Os=["onClick"],Is={class:"doc-icon"},Ls={key:0,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"#ef4444","stroke-width":"1.5"},Ts={key:1,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 24 24",fill:"none",stroke:"#3b82f6","stroke-width":"1.5"},Bs={key:2,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},Us={class:"doc-info"},Es=["title"],Fs={class:"doc-meta"},Ns={key:0,class:"doc-tags mt-xs"},Gs={class:"doc-actions flex gap-xs"},Ys=["onClick"],qs=["onClick"],Js={class:"modal-header flex-between"},Hs={class:"flex items-center gap-md"},zs={class:"m-0 text-truncate",style:{"max-width":"400px"}},js={key:0,class:"tag-badge"},Ws={class:"flex gap-sm"},Ks=["disabled"],Qs={class:"modal-body p-0 preview-body"},Xs={key:0,class:"flex-center h-full flex-col"},Zs=["src"],en=["src"],tn={key:3,class:"flex-center h-full flex-col"},sn={__name:"DealDocuments",props:{dealId:{type:String,required:!0}},setup(f){const Z=f,V=k([]),G=k(!1),P=k(!1),$=k(""),u=k(null),A=k(!1),H=k(!1),M=k(null),O=k(null),se=W(()=>{if(!$.value)return V.value;const D=$.value.toLowerCase();return V.value.filter(p=>p.fileName.toLowerCase().includes(D)||p.tags?.toLowerCase().includes(D))});Be(()=>{T()});const T=async()=>{G.value=!0;try{const D=await te.get(`/propertydeals/${Z.dealId}/documents`);V.value=D.data}catch(D){console.error("Failed to load docs",D)}finally{G.value=!1}},d=async D=>{const p=D.target.files;if(p.length){P.value=!0;try{for(let c=0;c<p.length;c++){const S=new FormData;S.append("file",p[c]),await te.post(`/propertydeals/${Z.dealId}/documents`,S,{headers:{"Content-Type":"multipart/form-data"}})}await T()}catch(c){alert("Upload failed"),console.error(c)}finally{P.value=!1,u.value.value=""}}},m=async D=>{M.value=D,A.value=!0,H.value=!0;try{const p=await te.get(`/propertydeals/${Z.dealId}/documents/${D.id}/download?inline=true`,{responseType:"blob"}),c=new Blob([p.data],{type:D.contentType});O.value=URL.createObjectURL(c)}catch(p){console.error("Failed to load preview",p)}finally{H.value=!1}},w=()=>{A.value=!1,H.value=!1,O.value&&URL.revokeObjectURL(O.value),O.value=null,M.value=null},I=async D=>{try{const p=await te.get(`/propertydeals/${Z.dealId}/documents/${D.id}/download`,{responseType:"blob"}),c=new Blob([p.data],{type:D.contentType||"application/octet-stream"}),S=window.URL.createObjectURL(c),Q=document.createElement("a");Q.href=S,Q.download=D.fileName,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),window.URL.revokeObjectURL(S)}catch(p){console.error("Download failed",p),alert("Failed to download file")}},F=async D=>{console.log("Delete requested for ID:",D);try{await te.delete(`/propertydeals/${Z.dealId}/documents/${D}`),V.value=V.value.filter(p=>p.id!==D)}catch(p){console.error("Delete failed error details:",p),alert("Delete failed")}},J=D=>{if(D===0)return"0 B";const p=1024,c=["B","KB","MB","GB"],S=Math.floor(Math.log(D)/Math.log(p));return parseFloat((D/Math.pow(p,S)).toFixed(1))+" "+c[S]},ee=D=>new Date(D).toLocaleDateString();return(D,p)=>(l(),a("div",Cs,[e("div",$s,[e("div",xs,[e("input",{type:"file",ref_key:"fileInput",ref:u,onChange:d,class:"hidden",multiple:""},null,544),e("button",{onClick:p[0]||(p[0]=c=>D.$refs.fileInput.click()),class:"btn btn-primary",disabled:P.value},[P.value?(l(),a("span",_s)):(l(),a("span",Ds,"+")),p[5]||(p[5]=L(" Upload Document ",-1))],8,Rs),P.value?(l(),a("span",Ss,"Uploading...")):R("",!0)]),e("div",Ps,[q(e("input",{"onUpdate:modelValue":p[1]||(p[1]=c=>$.value=c),placeholder:"Search documents...",class:"form-input-sm"},null,512),[[K,$.value]])])]),G.value?(l(),a("div",Vs,[ue(Ee,{size:"lg",text:"Loading Documents..."})])):V.value.length===0?(l(),a("div",Ms,[...p[6]||(p[6]=[_e('<div class="empty-icon-bg mb-md" data-v-468e7619><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-468e7619><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-468e7619></path><polyline points="14 2 14 8 20 8" data-v-468e7619></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-468e7619></line><line x1="16" y1="17" x2="8" y2="17" data-v-468e7619></line><polyline points="10 9 9 9 8 9" data-v-468e7619></polyline></svg></div><h3 data-v-468e7619>No Documents Yet</h3><p data-v-468e7619>Upload contracts, due diligence reports, or floor plans.</p>',3)])])):(l(),a("div",As,[(l(!0),a(j,null,le(se.value,c=>(l(),a("div",{key:c.id,class:"doc-card card",onClick:S=>m(c)},[e("div",Is,[c.contentType?.toLowerCase().includes("pdf")?(l(),a("svg",Ls,[...p[7]||(p[7]=[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},null,-1),e("polyline",{points:"14 2 14 8 20 8"},null,-1),e("line",{x1:"12",y1:"18",x2:"12",y2:"12"},null,-1),e("line",{x1:"9",y1:"15",x2:"15",y2:"15"},null,-1)])])):c.contentType?.toLowerCase().includes("image")?(l(),a("svg",Ts,[...p[8]||(p[8]=[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},null,-1),e("circle",{cx:"8.5",cy:"8.5",r:"1.5"},null,-1),e("polyline",{points:"21 15 16 10 5 21"},null,-1)])])):(l(),a("svg",Bs,[...p[9]||(p[9]=[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},null,-1),e("polyline",{points:"14 2 14 8 20 8"},null,-1)])]))]),e("div",Us,[e("div",{class:"doc-name text-truncate",title:c.fileName},g(c.fileName),9,Es),e("div",Fs,g(J(c.fileSizeBytes))+" • "+g(ee(c.uploadedAt)),1),c.tags?(l(),a("div",Ns,[(l(!0),a(j,null,le(c.tags.split(","),S=>(l(),a("span",{key:S,class:"tag-badge"},g(S),1))),128))])):R("",!0)]),e("div",Gs,[e("button",{onClick:X(S=>I(c),["stop"]),class:"btn-icon",title:"Download"},[...p[10]||(p[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,Ys),e("button",{onClick:X(S=>F(c.id),["stop"]),class:"btn-icon text-danger",title:"Delete"},[...p[11]||(p[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,qs)])],8,Os))),128))])),(l(),ze(je,{to:"body"},[A.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:w},[e("div",{class:"modal preview-modal card",onClick:p[4]||(p[4]=X(()=>{},["stop"]))},[e("div",Js,[e("div",Hs,[e("h3",zs,g(M.value?.fileName),1),M.value?.tags?(l(),a("span",js,g(M.value.tags),1)):R("",!0)]),e("div",Ws,[e("button",{onClick:p[2]||(p[2]=c=>I(M.value)),class:"btn btn-secondary btn-sm",disabled:H.value},[...p[12]||(p[12]=[e("span",{class:"flex items-center gap-xs"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]),L(" Download ")],-1)])],8,Ks),e("button",{onClick:w,class:"btn-close"},"×")])]),e("div",Qs,[H.value?(l(),a("div",Xs,[...p[13]||(p[13]=[e("span",{class:"spinner-lg mb-md"},null,-1),e("p",null,"Loading document...",-1)])])):O.value&&M.value.contentType?.toLowerCase().includes("pdf")?(l(),a("iframe",{key:1,src:O.value,width:"100%",height:"100%",frameborder:"0"},null,8,Zs)):O.value&&M.value.contentType?.toLowerCase().includes("image")?(l(),a("img",{key:2,src:O.value,class:"preview-image"},null,8,en)):(l(),a("div",tn,[p[14]||(p[14]=e("p",null,"Preview not available for this file type.",-1)),e("button",{onClick:p[3]||(p[3]=c=>I(M.value)),class:"btn btn-primary mt-md"},"Download File")]))])])])):R("",!0)]))]))}},nn=we(sn,[["__scopeId","data-v-468e7619"]]),ln={class:"status-history"},an={key:0,class:"loading-state"},on={key:1,class:"empty-history"},rn={key:2,class:"history-timeline"},un={class:"history-content"},dn={class:"history-header"},cn={class:"history-date"},vn={key:0,class:"history-user"},pn={key:1,class:"history-comment"},mn={__name:"DealStatusHistory",props:{history:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(f){function Z(G){switch(G){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";case"Acquired":return"status-buy";default:return"status-draft"}}function V(G){return G?new Date(G).toLocaleString("en-AU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):""}return(G,P)=>(l(),a("div",ln,[f.loading?(l(),a("div",an,[...P[0]||(P[0]=[e("span",{class:"spinner-sm"},null,-1),L(" Loading history... ",-1)])])):f.history.length===0?(l(),a("div",on,[...P[1]||(P[1]=[e("p",null,"No status history recorded.",-1)])])):(l(),a("ul",rn,[(l(!0),a(j,null,le(f.history,($,u)=>(l(),a("li",{key:u,class:"history-item"},[P[2]||(P[2]=e("div",{class:"timeline-line"},null,-1)),e("div",{class:E(["timeline-marker",Z($.status)])},null,2),e("div",un,[e("div",dn,[e("span",{class:E(["status-badge",Z($.status)])},g($.status),3),e("span",cn,g(V($.timestamp)),1)]),$.userName?(l(),a("div",vn," by "+g($.userName),1)):R("",!0),$.comment?(l(),a("div",pn,' "'+g($.comment)+'" ',1)):R("",!0)])]))),128))]))]))}},yn=we(mn,[["__scopeId","data-v-d71c40b6"]]),fn={key:0,class:"deal-workbench card"},gn={key:1,class:"deal-workbench card"},hn={class:"workbench-header"},bn={class:"deal-info"},kn={class:"deal-title"},wn={class:"deal-meta"},Cn={key:0,class:"deal-address"},$n={key:1,class:"deal-type badge"},xn={class:"lifecycle-container"},Rn={class:"view-tabs"},_n={key:0,class:"workbench-grid-container"},Dn={class:"workbench-toolbar"},Sn={class:"save-status"},Pn={key:0,class:"status-saving"},Vn={key:1,class:"status-saved"},Mn={class:"bento-grid"},An={class:"input-card glass-card"},On={class:"card-content"},In={class:"input-row"},Ln={class:"input-wrapper"},Tn=["value"],Bn={class:"input-row"},Un={class:"input-wrapper"},En=["value"],Fn={class:"input-row"},Nn={class:"input-wrapper"},Gn=["value"],Yn={class:"input-row"},qn={class:"input-wrapper"},Jn=["value"],Hn={class:"input-row"},zn={class:"input-wrapper"},jn=["value"],Wn={class:"summary-row"},Kn={class:"summary-value"},Qn={class:"input-card glass-card"},Xn={class:"card-content"},Zn={class:"input-grid-row"},el={class:"input-wrapper"},tl=["value"],sl={class:"input-wrapper"},nl=["value"],ll={class:"input-grid-row"},al={class:"input-wrapper"},il=["value"],ol={class:"input-wrapper"},rl=["value"],ul={key:1,class:"col-span-2 detailed-label"},dl={key:0,class:"detailed-subgroup"},cl={class:"input-row compact"},vl={class:"input-wrapper xs"},pl=["value"],ml={class:"input-row compact"},yl=["value"],fl={key:0,class:"input-row compact"},gl={class:"input-wrapper xs"},hl=["value"],bl={class:"input-row compact"},kl={class:"input-wrapper xs"},wl=["value"],Cl={class:"input-grid-row"},$l={class:"input-wrapper"},xl=["value"],Rl={class:"input-wrapper"},_l=["value"],Dl={class:"input-grid-row"},Sl={class:"input-wrapper"},Pl=["value"],Vl={class:"input-wrapper"},Ml=["value"],Al={class:"summary-row"},Ol={class:"summary-value"},Il={class:"input-card glass-card"},Ll={class:"card-header-flex"},Tl={class:"card-content"},Bl={class:"input-row"},Ul={class:"input-wrapper"},El=["value"],Fl={class:"input-row"},Nl={class:"input-wrapper"},Gl=["value"],Yl={class:"input-row"},ql={class:"input-wrapper"},Jl=["value"],Hl={key:1,class:"detailed-subgroup"},zl=["onUpdate:modelValue"],jl={class:"input-wrapper xs"},Wl=["onUpdate:modelValue"],Kl={class:"input-wrapper xs"},Ql=["onUpdate:modelValue"],Xl=["onClick"],Zl={class:"loan-summary-mini"},ea={class:"summary-row"},ta={class:"input-card glass-card"},sa={class:"card-content"},na={class:"input-row"},la={class:"input-wrapper"},aa=["value"],ia={class:"input-row"},oa={class:"input-wrapper"},ra=["value"],ua={class:"input-row"},da={class:"input-wrapper"},ca=["value"],va={class:"input-row"},pa={class:"input-wrapper"},ma=["value"],ya={class:"results-bar glass-card"},fa={key:0,class:"metrics-flex"},ga={class:"metric-item"},ha={class:"metric-item"},ba={class:"metric-value-lg"},ka={class:"metric-item"},wa={key:1,class:"empty-metrics"},Ca={key:1,class:"risk-view"},$a={key:0,class:"alert-banner"},xa={class:"risk-actions-bar"},Ra=["disabled"],_a={key:0,class:"spinner"},Da={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Sa={key:2,class:"spreadsheet-view"},Pa={key:3,class:"documents-view p-lg"},Va={key:0,class:"history-panel glass-card"},Ma={class:"panel-header"},Aa={class:"modal revert-modal glass-card"},Oa={class:"modal-header"},Ia={class:"modal-body"},La={class:"form-group"},Ta={class:"modal-actions"},Ba=["disabled"],Ua={key:0,class:"spinner-sm"},Ea={class:"modal transition-modal glass-card"},Fa={class:"modal-header"},Na={class:"modal-body"},Ga={class:"form-group"},Ya={class:"modal-actions"},qa=["disabled"],Ja={key:0,class:"spinner-sm"},Ha={__name:"DealWorkbench",props:{deal:{type:Object,required:!0},simulationResults:{type:Object,default:null},runningSimulation:{type:Boolean,default:!1}},emits:["update","run-simulation","record-decision","refresh"],setup(f,{emit:Z}){const V=k("summary"),G=k(null),P=k(!1),$=k(!1),u=k(!1),A=k(""),H=k(""),M=k(""),O=k(!1),se=k([]),T=k(!1),d=f,m=Z,w=k(!1),I=k(!1);let F=null;function J(){w.value=!0,I.value=!1,F&&clearTimeout(F),setTimeout(()=>{w.value=!1,I.value=!0,F=setTimeout(()=>I.value=!1,3e3)},800)}async function ee(){if(d.deal)try{T.value=!0;const b=await te.get(`/propertydeals/${d.deal.id}/status-history`);se.value=b.data}catch(b){console.error("Failed to fetch history:",b),se.value=[]}finally{T.value=!1}}function D(b){H.value=b,M.value="",u.value=!0}function p(b){A.value=b,H.value=b,M.value="",$.value=!0}async function c(){if(d.deal)try{P.value=!0,await te.post(`/propertydeals/${d.deal.id}/status`,{status:H.value,comment:M.value}),$.value=!1,u.value=!1,m("refresh"),O.value&&await ee()}catch(b){console.error("Failed to update status:",b),alert("Failed to update status. Please try again.")}finally{P.value=!1}}function S(b,t){J();const r=parseFloat(t.target.value)||0;m("update",{[b]:r})}function Q(b){J(),m("update",{spreadsheetOverridesJson:b})}function pe(b){G.value=b,b.timeVariance&&m("update",{timeVarianceEarlyMonths:b.timeVariance.early,timeVarianceLateMonths:b.timeVariance.late})}function fe(){m("run-simulation",G.value)}const Y=W(()=>{try{return d.deal.leaseDetailsJson?JSON.parse(d.deal.leaseDetailsJson):null}catch{return null}}),z=W(()=>{try{return d.deal.loanDetailsJson?JSON.parse(d.deal.loanDetailsJson):null}catch{return null}}),ae=W(()=>z.value?z.value.reduce((b,t)=>b+(t.amount||0),0):d.deal.loanAmount),Ce=W(()=>!z.value||ae.value===0?d.deal.interestRatePercent:z.value.reduce((t,r)=>t+r.amount*r.rate,0)/ae.value),ge=W(()=>{if(!d.deal)return 0;const b=d.deal.askingPrice||0,t=b*((d.deal.stampDutyRate||0)/100);return b+t+(d.deal.legalCosts||0)+(d.deal.capExReserve||0)}),$e=W(()=>d.deal?Xe(d.deal.estimatedGrossRent||0,d.deal.vacancyRatePercent||0,d.deal.managementFeePercent||0,d.deal.outgoingsEstimate||0):0),h=W(()=>!d.deal||!d.deal.askingPrice?0:ae.value/d.deal.askingPrice*100);function o(){J(),Y.value?m("update",{leaseDetailsJson:""}):m("update",{leaseDetailsJson:JSON.stringify({remainingTerm:3,reviewType:"fixed",reviewValue:3,vacancyDurationMonths:3})})}function B(b,t){J();const r={...Y.value};let oe=t.target.value;t.target.type==="number"&&(oe=parseFloat(oe)),r[b]=oe,m("update",{leaseDetailsJson:JSON.stringify(r)})}function C(){if(J(),z.value)m("update",{loanDetailsJson:""});else{const b=[{name:"Senior Debt",amount:d.deal.loanAmount,rate:d.deal.interestRatePercent}];m("update",{loanDetailsJson:JSON.stringify(b)})}}function de(){const b=[...z.value||[]];b.push({name:"Mezzanine",amount:0,rate:8}),he(b)}function De(b){const t=[...z.value];t.splice(b,1),he(t)}function ye(){he(z.value)}function he(b){J();const t=JSON.stringify(b),r=b.reduce((re,ke)=>re+(ke.amount||0),0);let oe=0;r>0&&(oe=b.reduce((re,ke)=>re+ke.amount*ke.rate,0)/r),m("update",{loanDetailsJson:t,loanAmount:r,interestRatePercent:parseFloat(oe.toFixed(2))})}function be(b){switch(b){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";default:return"status-draft"}}function ie(b){return Ue(b)}return(b,t)=>f.deal?(l(),a("div",gn,[e("div",hn,[e("div",bn,[e("h2",kn,g(f.deal.name),1),e("div",wn,[f.deal.address?(l(),a("span",Cn,g(f.deal.address),1)):R("",!0),f.deal.buildingType?(l(),a("span",$n,g(f.deal.buildingType),1)):R("",!0)])]),e("div",xn,[ue(ws,{"current-status":f.deal.status,loading:P.value,onTransition:D,onRequestRevert:p},null,8,["current-status","loading"])])]),e("div",Rn,[e("button",{class:E(["view-tab",{active:V.value==="summary"}]),onClick:t[0]||(t[0]=r=>V.value="summary")},[...t[38]||(t[38]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),e("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1),L(" Assumptions & Inputs ",-1)])],2),e("button",{class:E(["view-tab",{active:V.value==="detailed"}]),onClick:t[1]||(t[1]=r=>V.value="detailed")},[...t[39]||(t[39]=[_e('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-1fc28cbe><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-1fc28cbe></rect><line x1="3" y1="9" x2="21" y2="9" data-v-1fc28cbe></line><line x1="3" y1="15" x2="21" y2="15" data-v-1fc28cbe></line><line x1="9" y1="3" x2="9" y2="21" data-v-1fc28cbe></line><line x1="15" y1="3" x2="15" y2="21" data-v-1fc28cbe></line></svg> Detailed Model ',2)])],2),e("button",{class:E(["view-tab",{active:V.value==="risk"}]),onClick:t[2]||(t[2]=r=>V.value="risk")},[...t[40]||(t[40]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})],-1),L(" Risk Analysis ",-1)])],2),e("button",{class:E(["view-tab",{active:V.value==="documents"}]),onClick:t[3]||(t[3]=r=>V.value="documents")},[...t[41]||(t[41]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})],-1),L(" Documents ",-1)])],2)]),V.value==="summary"?(l(),a("div",_n,[e("div",Dn,[t[43]||(t[43]=e("h3",{class:"section-title"},"Deal Assumptions",-1)),e("div",Sn,[w.value?(l(),a("span",Pn,[...t[42]||(t[42]=[e("span",{class:"spinner-sm"},null,-1),L(" Saving... ",-1)])])):I.value?(l(),a("span",Vn," ✓ Saved ")):R("",!0)])]),e("div",Mn,[e("section",An,[t[55]||(t[55]=e("h4",{class:"card-title"},"Acquisition",-1)),e("div",On,[e("div",In,[t[45]||(t[45]=e("label",null,"Asking Price",-1)),e("div",Ln,[t[44]||(t[44]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:f.deal.askingPrice,onChange:t[4]||(t[4]=r=>S("askingPrice",r))},null,40,Tn)])]),e("div",Bn,[t[47]||(t[47]=e("label",null,"Stamp Duty",-1)),e("div",Un,[e("input",{type:"number",step:"0.1",value:f.deal.stampDutyRate,onChange:t[5]||(t[5]=r=>S("stampDutyRate",r))},null,40,En),t[46]||(t[46]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Fn,[t[49]||(t[49]=e("label",null,"Buyers Agent",-1)),e("div",Nn,[e("input",{type:"number",step:"0.1",value:f.deal.buyersAgentFeeRate,onChange:t[6]||(t[6]=r=>S("buyersAgentFeeRate",r))},null,40,Gn),t[48]||(t[48]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Yn,[t[51]||(t[51]=e("label",null,"Legal Costs",-1)),e("div",qn,[t[50]||(t[50]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:f.deal.legalCosts,onChange:t[7]||(t[7]=r=>S("legalCosts",r))},null,40,Jn)])]),e("div",Hn,[t[53]||(t[53]=e("label",null,"CapEx Reserve",-1)),e("div",zn,[t[52]||(t[52]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:f.deal.capExReserve,onChange:t[8]||(t[8]=r=>S("capExReserve",r))},null,40,jn)])]),e("div",Wn,[t[54]||(t[54]=e("label",null,"Total Cost",-1)),e("span",Kn,g(ie(ge.value)),1)])])]),e("section",Qn,[t[73]||(t[73]=e("h4",{class:"card-title"},"Income & Expenses",-1)),t[74]||(t[74]=e("div",{class:"card-header-row"},[e("span"),e("span",{class:"col-header"},"Value"),e("span",{class:"col-header"},"Growth %")],-1)),e("div",Xn,[e("div",Zn,[t[57]||(t[57]=e("label",null,"Gross Rent",-1)),e("div",el,[t[56]||(t[56]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:f.deal.estimatedGrossRent,onChange:t[9]||(t[9]=r=>S("estimatedGrossRent",r))},null,40,tl)]),e("div",sl,[e("input",{type:"number",step:"0.5",value:f.deal.rentalGrowthPercent,onChange:t[10]||(t[10]=r=>S("rentalGrowthPercent",r))},null,40,nl)])]),e("div",ll,[e("label",null,[t[58]||(t[58]=L("Vacancy ",-1)),e("button",{class:"btn-xs-link",onClick:o},g(f.deal.leaseDetailsJson?"(Detailed)":"(Simple)"),1)]),Y.value?(l(),a("div",ul,"Configured via Details")):(l(),a(j,{key:0},[e("div",al,[e("input",{type:"number",step:"0.5",value:f.deal.vacancyRatePercent,onChange:t[11]||(t[11]=r=>S("vacancyRatePercent",r))},null,40,il),t[59]||(t[59]=e("span",{class:"input-suffix"},"%",-1))]),e("div",ol,[e("input",{type:"number",step:"0.5",value:f.deal.vacancyGrowthPercent??0,onChange:t[12]||(t[12]=r=>S("vacancyGrowthPercent",r))},null,40,rl)])],64))]),Y.value?(l(),a("div",dl,[e("div",cl,[t[61]||(t[61]=e("label",null,"Term",-1)),e("div",vl,[e("input",{type:"number",value:Y.value.remainingTerm,onChange:t[13]||(t[13]=r=>B("remainingTerm",r))},null,40,pl),t[60]||(t[60]=e("span",{class:"input-suffix"},"yrs",-1))])]),e("div",ml,[t[63]||(t[63]=e("label",null,"Review",-1)),e("select",{value:Y.value.reviewType,onChange:t[14]||(t[14]=r=>B("reviewType",r)),class:"select-xs"},[...t[62]||(t[62]=[e("option",{value:"fixed"},"Fixed",-1),e("option",{value:"cpi"},"CPI",-1)])],40,yl)]),Y.value.reviewType==="fixed"?(l(),a("div",fl,[t[65]||(t[65]=e("label",null,"Rate",-1)),e("div",gl,[e("input",{type:"number",step:"0.1",value:Y.value.reviewValue,onChange:t[15]||(t[15]=r=>B("reviewValue",r))},null,40,hl),t[64]||(t[64]=e("span",{class:"input-suffix"},"%",-1))])])):R("",!0),e("div",bl,[t[67]||(t[67]=e("label",null,"Vac. Shift",-1)),e("div",kl,[e("input",{type:"number",value:Y.value.vacancyDurationMonths,onChange:t[16]||(t[16]=r=>B("vacancyDurationMonths",r))},null,40,wl),t[66]||(t[66]=e("span",{class:"input-suffix"},"m",-1))])])])):R("",!0),e("div",Cl,[t[69]||(t[69]=e("label",null,"Outgoings",-1)),e("div",$l,[t[68]||(t[68]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:f.deal.outgoingsEstimate,onChange:t[17]||(t[17]=r=>S("outgoingsEstimate",r))},null,40,xl)]),e("div",Rl,[e("input",{type:"number",step:"0.5",value:f.deal.outgoingsGrowthPercent??0,onChange:t[18]||(t[18]=r=>S("outgoingsGrowthPercent",r))},null,40,_l)])]),e("div",Dl,[t[71]||(t[71]=e("label",null,"Mgmt Fee",-1)),e("div",Sl,[e("input",{type:"number",step:"0.5",value:f.deal.managementFeePercent,onChange:t[19]||(t[19]=r=>S("managementFeePercent",r))},null,40,Pl),t[70]||(t[70]=e("span",{class:"input-suffix"},"%",-1))]),e("div",Vl,[e("input",{type:"number",step:"0.5",value:f.deal.managementGrowthPercent??0,onChange:t[20]||(t[20]=r=>S("managementGrowthPercent",r))},null,40,Ml)])]),e("div",Al,[t[72]||(t[72]=e("label",null,"Net Operating Income",-1)),e("span",Ol,g(ie($e.value)),1)])])]),e("section",Il,[e("div",Ll,[t[75]||(t[75]=e("h4",{class:"card-title"},"Financing",-1)),e("button",{class:"btn-xs-link",onClick:C},g(z.value?"Multi-Tranche":"Simple Loan"),1)]),e("div",Tl,[!z.value||z.value.length===0?(l(),a(j,{key:0},[e("div",Bl,[t[77]||(t[77]=e("label",null,"Loan Amount",-1)),e("div",Ul,[t[76]||(t[76]=e("span",{class:"input-prefix"},"$",-1)),e("input",{type:"number",value:f.deal.loanAmount,onChange:t[21]||(t[21]=r=>S("loanAmount",r))},null,40,El)])]),e("div",Fl,[t[79]||(t[79]=e("label",null,"Interest Rate",-1)),e("div",Nl,[e("input",{type:"number",step:"0.1",value:f.deal.interestRatePercent,onChange:t[22]||(t[22]=r=>S("interestRatePercent",r))},null,40,Gl),t[78]||(t[78]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",Yl,[t[82]||(t[82]=e("label",null,"Rate Variance (Risk)",-1)),e("div",ql,[t[80]||(t[80]=e("span",{class:"input-prefix"},"±",-1)),e("input",{type:"number",step:"0.1",value:f.deal.interestVariancePercent,onChange:t[23]||(t[23]=r=>S("interestVariancePercent",r))},null,40,Jl),t[81]||(t[81]=e("span",{class:"input-suffix"},"%",-1))])])],64)):(l(),a("div",Hl,[t[83]||(t[83]=e("div",{class:"multi-loan-header"},[e("span",null,"Tranche"),e("span",null,"Amount"),e("span",null,"Rate"),e("span")],-1)),(l(!0),a(j,null,le(z.value,(r,oe)=>(l(),a("div",{key:oe,class:"loan-item-grid"},[q(e("input",{type:"text","onUpdate:modelValue":re=>r.name=re,placeholder:"Name",class:"input-xs",onChange:ye},null,40,zl),[[K,r.name]]),e("div",jl,[q(e("input",{type:"number","onUpdate:modelValue":re=>r.amount=re,onChange:ye},null,40,Wl),[[K,r.amount,void 0,{number:!0}]])]),e("div",Kl,[q(e("input",{type:"number",step:"0.1","onUpdate:modelValue":re=>r.rate=re,onChange:ye},null,40,Ql),[[K,r.rate,void 0,{number:!0}]])]),e("button",{class:"btn-icon-xs text-danger",onClick:re=>De(oe)},"×",8,Xl)]))),128)),e("button",{class:"btn-xs-secondary full-width mt-sm",onClick:de},"+ Add Tranche"),e("div",Zl," Avg Rate: "+g(Ce.value.toFixed(2))+"% ",1)])),e("div",ea,[t[84]||(t[84]=e("label",null,"LVR",-1)),e("span",{class:E(["summary-value",{"text-warning":h.value>65}])},g(h.value.toFixed(1))+"%",3)])])]),e("section",ta,[t[94]||(t[94]=e("h4",{class:"card-title"},"Market & Projections",-1)),e("div",sa,[e("div",na,[t[86]||(t[86]=e("label",null,"Capital Growth",-1)),e("div",la,[e("input",{type:"number",step:"0.5",value:f.deal.capitalGrowthPercent,onChange:t[24]||(t[24]=r=>S("capitalGrowthPercent",r))},null,40,aa),t[85]||(t[85]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",ia,[t[89]||(t[89]=e("label",null,"Growth Variance",-1)),e("div",oa,[t[87]||(t[87]=e("span",{class:"input-prefix"},"±",-1)),e("input",{type:"number",step:"0.5",value:f.deal.capitalGrowthVariancePercent,onChange:t[25]||(t[25]=r=>S("capitalGrowthVariancePercent",r))},null,40,ra),t[88]||(t[88]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",ua,[t[91]||(t[91]=e("label",null,"Discount Rate",-1)),e("div",da,[e("input",{type:"number",step:"0.1",value:f.deal.discountRate||8,onChange:t[26]||(t[26]=r=>S("discountRate",r))},null,40,ca),t[90]||(t[90]=e("span",{class:"input-suffix"},"%",-1))])]),e("div",va,[t[93]||(t[93]=e("label",null,"Holding Period",-1)),e("div",pa,[e("input",{type:"number",min:"1",max:"30",value:f.deal.holdingPeriodYears,onChange:t[27]||(t[27]=r=>S("holdingPeriodYears",r))},null,40,ma),t[92]||(t[92]=e("span",{class:"input-suffix"},"yrs",-1))])])])])]),e("section",ya,[f.simulationResults?(l(),a("div",fa,[e("div",ga,[t[95]||(t[95]=e("span",{class:"metric-label"},"Median NPV",-1)),e("span",{class:E(["metric-value-lg",f.simulationResults.medianNPV>=0?"text-success":"text-danger"])},g(ie(f.simulationResults.medianNPV)),3)]),t[98]||(t[98]=e("div",{class:"vertical-divider"},null,-1)),e("div",ha,[t[96]||(t[96]=e("span",{class:"metric-label"},"Median IRR",-1)),e("span",ba,g(f.simulationResults.medianIRR.toFixed(1))+"%",1)]),t[99]||(t[99]=e("div",{class:"vertical-divider"},null,-1)),e("div",ka,[t[97]||(t[97]=e("span",{class:"metric-label"},"Rec. Decision",-1)),e("span",{class:E(["metric-tag",be(f.simulationResults.recommendedDecision)])},g(f.simulationResults.recommendedDecision),3)])])):(l(),a("div",wa,[...t[100]||(t[100]=[e("span",null,"Run simulation to see results",-1)])]))])])):V.value==="risk"?(l(),a("div",Ca,[b.hasUnsavedChanges?(l(),a("div",$a,[t[101]||(t[101]=e("span",null,"⚠️ The deal inputs have changed since the last simulation.",-1)),e("button",{class:"btn btn-sm btn-primary",onClick:fe},"Run New Simulation")])):R("",!0),e("div",xa,[e("button",{class:"btn btn-primary run-simulation-btn full-width",onClick:fe,disabled:f.runningSimulation},[f.runningSimulation?(l(),a("span",_a)):(l(),a("svg",Da,[...t[102]||(t[102]=[e("polygon",{points:"5 3 19 12 5 21 5 3"},null,-1)])])),L(" "+g(f.runningSimulation?"Running...":"Update & Run Analysis"),1)],8,Ra)]),ue(Ze,{"initial-data":b.simulationInputSource,"initial-results":f.simulationResults,"detailed-cashflow":G.value,"hide-run-button":!0,"onUpdate:inputs":b.handleInputsUpdate},null,8,["initial-data","initial-results","detailed-cashflow","onUpdate:inputs"])])):V.value==="detailed"?(l(),a("div",Sa,[ue(es,{deal:f.deal,"holding-period":f.deal.holdingPeriodYears,"initial-overrides-json":f.deal.spreadsheetOverridesJson,onApplyChanges:pe,"onUpdate:overrides":Q},null,8,["deal","holding-period","initial-overrides-json"])])):V.value==="documents"?(l(),a("div",Pa,[ue(nn,{"deal-id":f.deal.id},null,8,["deal-id"])])):R("",!0),ue(Ae,{name:"slide-fade"},{default:Re(()=>[O.value?(l(),a("div",Va,[e("div",Ma,[t[103]||(t[103]=e("h3",null,"Status History",-1)),e("button",{class:"btn-close-sm",onClick:t[28]||(t[28]=r=>O.value=!1)},"×")]),ue(yn,{history:se.value,loading:T.value},null,8,["history","loading"])])):R("",!0)]),_:1}),$.value?(l(),a("div",{key:4,class:"modal-backdrop",onClick:t[32]||(t[32]=X(r=>$.value=!1,["self"]))},[e("div",Aa,[e("div",Oa,[t[104]||(t[104]=e("h2",null,"Revert Status",-1)),e("button",{class:"btn-close",onClick:t[29]||(t[29]=r=>$.value=!1)},"×")]),e("div",Ia,[e("p",null,[t[105]||(t[105]=L("Are you sure you want to revert the status to ",-1)),e("strong",null,g(A.value),1),t[106]||(t[106]=L("?",-1))]),e("div",La,[t[107]||(t[107]=e("label",null,"Reason for reverting (optional)",-1)),q(e("textarea",{"onUpdate:modelValue":t[30]||(t[30]=r=>M.value=r),class:"form-control",rows:"3",placeholder:"e.g., Lease details were incorrect, need to re-evaluate..."},null,512),[[K,M.value]])])]),e("div",Ta,[e("button",{class:"btn btn-secondary",onClick:t[31]||(t[31]=r=>$.value=!1)},"Cancel"),e("button",{class:"btn btn-warning",onClick:c,disabled:P.value},[P.value?(l(),a("span",Ua)):R("",!0),L(" "+g(P.value?"Reverting...":"Confirm Revert"),1)],8,Ba)])])])):R("",!0),u.value?(l(),a("div",{key:5,class:"modal-backdrop",onClick:t[36]||(t[36]=X(r=>u.value=!1,["self"]))},[e("div",Ea,[e("div",Fa,[t[108]||(t[108]=e("h2",null,"Update Status",-1)),e("button",{class:"btn-close",onClick:t[33]||(t[33]=r=>u.value=!1)},"×")]),e("div",Na,[e("p",null,[t[109]||(t[109]=L("Move stage to ",-1)),e("strong",null,g(H.value),1),t[110]||(t[110]=L("?",-1))]),e("div",Ga,[t[111]||(t[111]=e("label",null,"Comment (optional)",-1)),q(e("textarea",{"onUpdate:modelValue":t[34]||(t[34]=r=>M.value=r),class:"form-control",rows:"3",placeholder:"e.g., Offer accepted by vendor..."},null,512),[[K,M.value]])])]),e("div",Ya,[e("button",{class:"btn btn-secondary",onClick:t[35]||(t[35]=r=>u.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:c,disabled:P.value},[P.value?(l(),a("span",Ja)):R("",!0),L(" "+g(P.value?"Updating...":"Confirm Update"),1)],8,qa)])])])):R("",!0)])):(l(),a("div",fn,[...t[37]||(t[37]=[e("div",{class:"workbench-loading"},[e("div",{class:"spinner"}),e("p",null,"Loading deal...")],-1)])]))}},za=we(Ha,[["__scopeId","data-v-1fc28cbe"]]),ja={class:"acquisition-planner"},Wa={class:"planner-header"},Ka={class:"header-content"},Qa={class:"nav-area"},Xa={class:"breadcrumb"},Za={key:1,class:"breadcrumb-current"},ei={key:0,class:"page-title-wrapper"},ti={key:1,class:"deal-selector-wrapper"},si={class:"deal-selector-name"},ni={key:0,class:"deal-dropdown-menu glass-card"},li={class:"dropdown-search"},ai={class:"dropdown-list"},ii={key:0,class:"dropdown-empty"},oi=["onClick"],ri={class:"dropdown-item-name"},ui={class:"header-actions"},di={class:"view-toggles"},ci={class:"immersive-content"},vi={key:0,class:"dashboard-grid-view"},pi={key:0,class:"loading-state"},mi={key:1,class:"empty-state-large"},yi={key:2,class:"deals-grid"},fi=["onClick"],gi={class:"deal-card-header"},hi={class:"deal-card-body"},bi={class:"deal-card-title"},ki={class:"deal-card-address"},wi={class:"deal-metrics"},Ci={class:"metric"},$i={class:"value"},xi={class:"metric"},Ri={class:"value"},_i={class:"deal-card-footer"},Di={key:0,class:"sim-badge success"},Si={key:1,class:"sim-badge empty"},Pi={class:"workbench-container",key:"workbench"},Vi={class:"modal deal-modal glass-card"},Mi={class:"modal-header"},Ai={class:"form-group"},Oi={class:"form-row"},Ii={class:"form-group"},Li={class:"form-group"},Ti={class:"form-row"},Bi={class:"form-group"},Ui={class:"form-group"},Ei={class:"modal-actions"},Fi=["disabled"],Ni={__name:"AcquisitionPlannerView",setup(f){const Z={mounted(h,o){h._clickOutsideHandler=B=>{h===B.target||h.contains(B.target)||o.value(B)},document.body.addEventListener("click",h._clickOutsideHandler)},unmounted(h){document.body.removeEventListener("click",h._clickOutsideHandler)}},V=We(),G=Ke(),P=k(!0),$=k([]),u=k(null),A=k(null),H=k(""),M=k(!1),O=k(!1),se=k(!1),T=k(!1),d=k(""),m=k(null),w=k({name:"",address:"",buildingType:"",askingPrice:0,estimatedGrossRent:0}),I=W(()=>H.value?$.value.filter(h=>h.status===H.value):$.value),F=W(()=>{let h=$.value;if(d.value){const o=d.value.toLowerCase();h=h.filter(B=>B.name.toLowerCase().includes(o)||B.address&&B.address.toLowerCase().includes(o))}return h});Be(async()=>{await J();const h=V.query.deal;h&&await ee(h)});async function J(){try{P.value=!0;const h=await te.get("/propertydeals");$.value=h.data}catch(h){console.error("Failed to fetch deals:",h)}finally{P.value=!1}}async function ee(h){try{if($.value.length>0&&u.value?.id===h)return;const o=await te.get(`/propertydeals/${h}`);u.value=o.data,A.value=o.data.simulationResults?.[0]||null,G.replace({query:{deal:h}}),T.value=!1}catch(o){console.error("Failed to load deal:",o)}}function D(){u.value=null,G.replace({query:{}}),T.value=!1,J()}function p(h){ee(h)}function c(){T.value=!T.value,T.value&&Me(()=>{m.value?.focus()})}function S(){T.value=!1}function Q(){w.value={name:"",address:"",buildingType:"",askingPrice:0,estimatedGrossRent:0},M.value=!0}function pe(){T.value=!1,Q()}async function fe(){try{O.value=!0;const h=await te.post("/propertydeals",w.value);M.value=!1,await J(),await ee(h.data.id)}catch(h){console.error("Failed to create deal:",h),alert("Failed to create deal. Please try again.")}finally{O.value=!1}}async function Y(h){if(u.value)try{const o=await te.put(`/propertydeals/${u.value.id}`,h);u.value=o.data;const B=$.value.findIndex(C=>C.id===u.value.id);B!==-1&&($.value[B]={...$.value[B],...o.data})}catch(o){console.error("Failed to update deal:",o)}}async function z(){if(u.value)try{se.value=!0;const h={askingPrice:u.value.askingPrice,stampDutyRate:u.value.stampDutyRate,legalCosts:u.value.legalCosts,capExReserve:u.value.capExReserve,estimatedGrossRent:u.value.estimatedGrossRent,vacancyRatePercent:u.value.vacancyRatePercent,managementFeePercent:u.value.managementFeePercent,outgoingsEstimate:u.value.outgoingsEstimate,loanAmount:u.value.loanAmount,interestRatePercent:u.value.interestRatePercent,capitalGrowthPercent:u.value.capitalGrowthPercent,holdingPeriodYears:u.value.holdingPeriodYears,rentVariancePercent:u.value.rentVariancePercent,vacancyVariancePercent:u.value.vacancyVariancePercent,interestVariancePercent:u.value.interestVariancePercent,capitalGrowthVariancePercent:u.value.capitalGrowthVariancePercent,discountRate:u.value.discountRate,leaseDetails:u.value.leaseDetailsJson?JSON.parse(u.value.leaseDetailsJson):null,loanDetails:u.value.loanDetailsJson?JSON.parse(u.value.loanDetailsJson):null},o=et(h,5e3);A.value=o,await te.post(`/propertydeals/${u.value.id}/simulations`,{iterations:o.iterations,medianNPV:o.medianNPV,p10NPV:o.p10NPV,p90NPV:o.p90NPV,medianIRR:o.medianIRR,p10IRR:o.p10IRR,p90IRR:o.p90IRR,calculatedCapRate:o.calculatedCapRate,recommendedDecision:o.recommendedDecision,npvHistogramJson:JSON.stringify(o.npvHistogram),irrHistogramJson:JSON.stringify(o.irrHistogram),yearlyDCFJson:JSON.stringify(o.yearlyDCF),inputsSnapshotJson:JSON.stringify(h)});const B=await te.get(`/propertydeals/${u.value.id}`);u.value=B.data;const C=$.value.findIndex(de=>de.id===u.value.id);C!==-1&&($.value[C]={...B.data})}catch(h){console.error("Simulation failed:",h),alert("Simulation failed. Please try again.")}finally{se.value=!1}}async function ae(h,o){if(u.value)try{await te.put(`/propertydeals/${u.value.id}/decision`,{decision:h,rationale:o});const B=await te.get(`/propertydeals/${u.value.id}`);u.value=B.data;const C=$.value.findIndex(de=>de.id===u.value.id);C!==-1&&($.value[C].status=h)}catch(B){console.error("Failed to record decision:",B),alert("Failed to record decision. Please try again.")}}async function Ce(){u.value&&await ee(u.value.id)}function ge(h){switch(h){case"Buy":return"status-buy";case"Pass":return"status-pass";case"Uneconomic":return"status-uneconomic";case"Analyzing":return"status-analyzing";default:return"status-draft"}}function $e(h){return Ue(h)}return(h,o)=>{const B=Qe("router-link");return l(),a("div",ja,[e("header",Wa,[e("div",Ka,[e("div",Qa,[e("div",Xa,[ue(B,{to:"/properties",class:"breadcrumb-link"},{default:Re(()=>[...o[11]||(o[11]=[L("Properties",-1)])]),_:1}),o[12]||(o[12]=e("span",{class:"breadcrumb-sep"},"/",-1)),u.value?(l(),a("a",{key:0,href:"#",onClick:X(D,["prevent"]),class:"breadcrumb-link"},"Acquisitions")):(l(),a("span",Za,"Acquisitions"))]),u.value?q((l(),a("div",ti,[e("button",{class:"deal-selector-btn",onClick:c},[e("span",si,g(u.value.name),1),(l(),a("svg",{class:E(["chevron-icon",{rotated:T.value}]),width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...o[14]||(o[14]=[e("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))]),ue(Ae,{name:"dropdown-fade"},{default:Re(()=>[T.value?(l(),a("div",ni,[e("div",li,[q(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=C=>d.value=C),placeholder:"Search deals...",class:"search-input",ref_key:"searchInput",ref:m},null,512),[[K,d.value]])]),e("div",ai,[F.value.length===0?(l(),a("div",ii,"No deals found")):R("",!0),(l(!0),a(j,null,le(F.value,C=>(l(),a("button",{key:C.id,class:E(["dropdown-item",{active:C.id===u.value.id}]),onClick:de=>p(C.id)},[e("span",ri,g(C.name),1),e("span",{class:E(["dropdown-item-status",ge(C.status)])},g(C.status),3)],10,oi))),128))]),e("div",{class:"dropdown-footer"},[e("button",{class:"btn-create-dropdown",onClick:pe}," + New Deal ")])])):R("",!0)]),_:1})])),[[Z,S]]):(l(),a("div",ei,[...o[13]||(o[13]=[e("h1",{class:"page-title"},"Acquisition Planner",-1),e("p",{class:"page-subtitle"},"Analyze potential deals with uncertainty modeling",-1)])]))])]),e("div",ui,[u.value?(l(),a("button",{key:1,class:"btn btn-secondary",onClick:D}," Close Deal ")):(l(),a(j,{key:0},[e("div",di,[q(e("select",{"onUpdate:modelValue":o[1]||(o[1]=C=>H.value=C),class:"status-filter-large"},[...o[15]||(o[15]=[_e('<option value="" data-v-3952a881>All Statuses</option><option value="Draft" data-v-3952a881>Drafts</option><option value="Analyzing" data-v-3952a881>Analyzing</option><option value="Buy" data-v-3952a881>Buy</option><option value="Pass" data-v-3952a881>Pass</option>',5)])],512),[[Te,H.value]])]),e("button",{class:"btn btn-primary",onClick:Q},[...o[16]||(o[16]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),L(" New Deal ",-1)])])],64))])]),e("div",ci,[ue(Ae,{name:"fade-slide",mode:"out-in"},{default:Re(()=>[u.value?(l(),a("div",Pi,[ue(za,{deal:u.value,"simulation-results":A.value,"running-simulation":se.value,onUpdate:Y,onRunSimulation:z,onRecordDecision:ae,onRefresh:Ce},null,8,["deal","simulation-results","running-simulation"])])):(l(),a("div",vi,[P.value?(l(),a("div",pi,[ue(Ee)])):I.value.length===0?(l(),a("div",mi,[e("div",{class:"empty-content"},[o[17]||(o[17]=e("div",{class:"empty-icon-circle"},[e("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e("polyline",{points:"9 22 9 12 15 12 15 22"})])],-1)),o[18]||(o[18]=e("h3",null,"No Deals Found",-1)),o[19]||(o[19]=e("p",null,"Start your acquisition pipeline by adding a new property deal.",-1)),e("button",{class:"btn btn-primary mt-4",onClick:Q},"Create First Deal")])])):(l(),a("div",yi,[(l(!0),a(j,null,le(I.value,C=>(l(),a("div",{key:C.id,class:"deal-card glass-card hover-lift",onClick:de=>ee(C.id)},[e("div",gi,[e("span",{class:E(["deal-status-badge",ge(C.status)])},g(C.status),3),e("button",{class:"btn-icon-more",onClick:o[2]||(o[2]=X(()=>{},["stop"]))},[...o[20]||(o[20]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"1"}),e("circle",{cx:"19",cy:"12",r:"1"}),e("circle",{cx:"5",cy:"12",r:"1"})],-1)])])]),e("div",hi,[e("h3",bi,g(C.name),1),e("p",ki,g(C.address||"No address provided"),1),e("div",wi,[e("div",Ci,[o[21]||(o[21]=e("span",{class:"label"},"Price",-1)),e("span",$i,g($e(C.askingPrice)),1)]),e("div",xi,[o[22]||(o[22]=e("span",{class:"label"},"Cap Rate",-1)),e("span",Ri,g(C.calculatedCapRate?(C.calculatedCapRate*100).toFixed(1)+"%":"-"),1)])])]),e("div",_i,[C.simulationResults&&C.simulationResults.length>0?(l(),a("div",Di," Simulated ")):(l(),a("div",Si," No Analysis ")),o[23]||(o[23]=e("span",{class:"last-updated"},"Updated today",-1))])],8,fi))),128))]))]))]),_:1})]),M.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:o[10]||(o[10]=X(C=>M.value=!1,["self"]))},[e("div",Vi,[e("div",Mi,[o[24]||(o[24]=e("h2",null,"New Property Deal",-1)),e("button",{class:"btn-close",onClick:o[3]||(o[3]=C=>M.value=!1)},"×")]),e("form",{onSubmit:X(fe,["prevent"]),class:"modal-body"},[e("div",Ai,[o[25]||(o[25]=e("label",null,"Deal Name *",-1)),q(e("input",{"onUpdate:modelValue":o[4]||(o[4]=C=>w.value.name=C),type:"text",required:"",placeholder:"e.g., 123 Industrial Ave - Warehouse",class:"input-lg"},null,512),[[K,w.value.name]])]),e("div",Oi,[e("div",Ii,[o[26]||(o[26]=e("label",null,"Address",-1)),q(e("input",{"onUpdate:modelValue":o[5]||(o[5]=C=>w.value.address=C),type:"text",placeholder:"123 Main St, Sydney NSW"},null,512),[[K,w.value.address]])]),e("div",Li,[o[28]||(o[28]=e("label",null,"Building Type",-1)),q(e("select",{"onUpdate:modelValue":o[6]||(o[6]=C=>w.value.buildingType=C)},[...o[27]||(o[27]=[_e('<option value="" data-v-3952a881>Select type</option><option value="Office" data-v-3952a881>Office</option><option value="Retail" data-v-3952a881>Retail</option><option value="Industrial" data-v-3952a881>Industrial</option><option value="Mixed" data-v-3952a881>Mixed Use</option>',5)])],512),[[Te,w.value.buildingType]])])]),e("div",Ti,[e("div",Bi,[o[29]||(o[29]=e("label",null,"Asking Price *",-1)),q(e("input",{"onUpdate:modelValue":o[7]||(o[7]=C=>w.value.askingPrice=C),type:"number",min:"0",step:"any",required:"",placeholder:"1500000"},null,512),[[K,w.value.askingPrice,void 0,{number:!0}]])]),e("div",Ui,[o[30]||(o[30]=e("label",null,"Estimated Gross Rent (p.a.) *",-1)),q(e("input",{"onUpdate:modelValue":o[8]||(o[8]=C=>w.value.estimatedGrossRent=C),type:"number",min:"0",step:"any",required:"",placeholder:"120000"},null,512),[[K,w.value.estimatedGrossRent,void 0,{number:!0}]])])]),e("div",Ei,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[9]||(o[9]=C=>M.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:O.value},g(O.value?"Creating...":"Create & Analyze"),9,Fi)])],32)])])):R("",!0)])}}},Ji=we(Ni,[["__scopeId","data-v-3952a881"]]);export{Ji as default};
